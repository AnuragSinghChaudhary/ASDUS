var path=document.location.pathname;if(path.match(/^\/td(\/.*)?$/)){path='/td';}else if(path.match(/^\/mcc\/td(\/.*)?$/)){path='/mcc/td';}else{path='';}
function clearfield(checkfield,checkstring){if(checkfield.value==checkstring){checkfield.value="";}}
function unclearfield(checkfield,checkstring){if(checkfield.value==""){checkfield.value=checkstring;}}
function setCookie(name,value,days,path,domain,httponly){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires='; expires='+ date.toGMTString()+';max-age='+(days*24*60*60);}else{var expires='';}
var pathnv='';var domainnv='';if(path)pathnv=';path='+ path;if(domain)domainnv=';domain='+ domain;document.cookie=name+'= '+ value+ expires+ pathnv+ domainnv+';secure'+(httponly?';HttpOnly':'');}
function getCookie(name){var nameEQ=name+'=';var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
function deleteCookie(name){setCookie(name,'',-1);}
function timestampToLocal(date){var nd=new Date(date*1000);var ampm="AM";var hours=nd.getHours();if(hours>12){hours=hours- 12;ampm="PM";}
var minutes=nd.getMinutes();var minuteStr=''+ minutes;if(minutes<10){minuteStr='0'+ minutes;}
return hours+':'+ minuteStr+' '+ ampm;}
var $j=jQuery.noConflict();function setPreference(name,value,reload){$j.getJSON(path+'/ajax/json-set-user-preference.php?pn='+ name+'&pv='+ value,'',function(data){var preference=data[name];if(reload){location.reload();}});}
jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}
var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}
expires='; expires='+ date.toUTCString();}
var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+ 1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+ 1));break;}}}
return cookieValue;}};function hideInsight(insightId){$j("#iid"+ insightId).hide();$j("#piid"+ insightId).show();}
$j(document).ready(function(){$j.fn.clear=function(){$j(this).find('input').filter(':text, :password, :file').val('').end().filter(':checkbox, :radio').removeAttr('checked').end().end().find('textarea').val('').end().find('select').prop("selectedIndex",-1).find('option:selected').removeAttr('selected');return this;};$j('a').click(function(){var aHref=$j(this).attr('href');if(aHref.indexOf('http')==0&&aHref.indexOf('www.techdirt.com')==-1)
ga('send','event','Link','Off-Site Click',aHref);else
ga('send','event','Link','On-Site Click',aHref);});$j("#share_email").hide();var insight_exp=true;$j("#c_insights").click(function(){var arrow=$j(".h_insight").children('img').attr('src');if(insight_exp){$j(".insight").slideUp();arrow=arrow.replace('arrow-orange-dn','arrow-orange-rt')
$j(".h_insight").children('img').attr('src',arrow);insight_exp=false;}else{$j(".insight").slideDown();arrow=arrow.replace('arrow-orange-rt','arrow-orange-dn')
$j(".h_insight").children('img').attr('src',arrow);insight_exp=true;}}).css({cursor:"pointer"});$j(".h_insight").click(function(){var insightid="#insight"+ $j(this).attr("insightid");$j(insightid).slideToggle();var arrow=$j(".h_insight").children('img').attr('src');if(null===arrow.match(/arrow-orange-rt/)){arrow=arrow.replace('arrow-orange-dn','arrow-orange-rt')
$j(this).children().attr('src',arrow);}else{arrow=arrow.replace('arrow-orange-rt','arrow-orange-dn')
$j(this).children().attr('src',arrow);}
return false;}).css({cursor:"pointer"});$j(".t_tab").click(function(){var tab_id=$j(this).attr('id');$j(".t_tab").removeClass("on");$j("#"+ tab_id).addClass("on");var content_id=tab_id.replace('t_','p_');$j(".p_content").hide();$j("#"+ content_id).show();return false;}).css({cursor:"pointer"});$j("#tiersform").submit(function(){if($j("#tiersize").val()==""){alert("Please choose a Size before clicking on the Buy button.");return false;}
return true;});$j(".cmtrp").click(function(){$j("#replycid").attr("value",$j(this).attr("cid"));$j("#replysubject").attr("value","Re: "+ $j(this).attr("subject"));$j(".new_comment_input").attr("disabled","disabled");var position=$j(this).position();$j("#cmmt_form").css('left',position.left);$j("#cmmt_form").css('top',position.top+ 23);$j("#cmmt_form").show();return false;});$j(".cmmt_close").click(function(){$j("#cmmt_form").hide();$j(".new_comment_input").removeAttr("disabled");return false;});$j("#email_sub_tgl").click(function(){if($j("#email_sub_form").is(':visible')){$j("#email_sub_form").slideUp('fast');}else{ga('send','event','Follow Techdirt ('+ etpg+')','Click','Follow - Newsletter');var position=$j(this).position();var parent_position=$j(this).parent().position();$j("#email_sub_form").css('left',parent_position.left- 5);$j("#email_sub_form").css('top',position.top+ 35);$j("#email_sub_form").slideDown('fast');}
return false;});$j(".emailthis_button").click(function(){ga('send','event','Email This','Click','Open Email This');var position=$j(this).offset();var sid=$j(this).attr('href').replace(/.*sid=/i,"").replace(/\&.*/,"");$j("#et_sid").attr("value",sid);$j("#et_popup").css('left',position.left- 135);$j("#et_popup").css('top',position.top- 258);$j("#et_popup").show();return false;});$j(".et_close").click(function(){$j("#et_popup").hide();return false;});$j("#topclose").click(function(){ga('send','event','Top Promo','Click','Top Promo Close');$j("#toppromo_shadow").slideUp('slow');$j("#toppromo").slideUp('slow');$j.cookie('hide_'+ $j("#toppromo").attr('name'),$j("#toppromo").attr('name'),{expires:365});return false;}).css({cursor:"pointer"});$j('#crystalballhide').click(function(){ga('send','event','Crystal Ball','Click','Crystal Ball Hide');$j.get(base_path+'/ajax/json-set-user-preference.php?pn=cbCollapsed&pv=1');$j('#crystalball').slideUp('normal',function(){$j('#crystalballhide').hide();$j('#crystalballhide').css({background:'url(\''+ iroot+'/icons/min-arrow-dn.gif\') no-repeat center bottom'});$j('#crystalballshow').show();});}).hover(function(){$j(this).css({'background-color':"#efefef"});},function(){$j(this).css({'background-color':""});}).css({cursor:"pointer"});$j('#crystalballshow').click(function(){ga('send','event','Crystal Ball','Click','Crystal Ball Show');$j.get(base_path+'/ajax/json-set-user-preference.php?pn=cbCollapsed&pv=0');$j('#crystalballshow').hide();$j('#crystalballhide').show(0,function(){$j('#crystalball').slideDown('normal',function(){$j('#crystalballhide').css({background:'url(\''+ iroot+'/icons/min-arrow-up.gif\') no-repeat center bottom'});});});}).hover(function(){$j(this).css({'background-color':"#efefef"});},function(){$j(this).css({'background-color':""});}).css({cursor:"pointer"});$j('.whatsthis').click(function(){ga('send','event','What\'s This','Click','Open What\'s This Pop-Up');$j('#wt_ol').remove();var position=$j(this).position();var parent=$j(this).parent();var classList=$j(this).attr('class').split(/\s+/);var key;$j.each(classList,function(index,item){if(item.match(/help_/)){key=item;}});$j.getJSON(path+'/ajax/json-whatsthis.php?key='+ key,'',function(data){var whatsthis=data[key];parent.append('<div id="wt_ol"><div class="wt_head">What\'s this?</div><div class="wt_content">'+ whatsthis+'</div>');var postop=$j('#wt_ol').height();$j('#wt_ol').css('left',position.left- 280);$j('#wt_ol').css('top',position.top- postop+ 20);$j('#wt_ol').fadeIn();$j('body').click(function(){$j('#wt_ol').fadeOut('slow',function(){$j('#wt_ol').remove();});});});return false;});$j('.helppop').click(function(){ga('send','event','Help','Click','Open Help Pop-Up');$j('#hp_ol').remove();var xbase=$j('div#contents').position().left;var parent=$j(this).parent();var ybase=parent.position().top;var key=$j(this).attr('class');key=key.replace('helppop ','');var title=$j(this).attr('title');$j.getJSON(path+'/ajax/json-whatsthis.php?key='+ key,'',function(data){var content=data[key];parent.append('<div id="hp_ol"><div class="hp_head">'+ title+'</div><div class="hp_content">'+ content+'</div>');var popheight=$j('#hp_ol').height();var popwidth=$j('#hp_ol').width();if(ybase<popheight)
y=0;else
y=ybase- popheight;x=xbase+($j('div#contents').width()- popwidth)/ 2;$j('#hp_ol').css('left',x);$j('#hp_ol').css('top',y);$j('#hp_ol').fadeIn();$j('body').click(function(){$j('#hp_ol').fadeOut('slow',function(){$j('#hp_ol').remove();});});});return false;});$j('.share_pop').click(function(){var url=$j(this).attr('href');var name='tdsharepop';window.open(url,name,"width=800,height=600,scrollbars=yes");return false;});var Options={"collapsed_height":$j("div.storywrap").height(),"threshold":470,"expand_offset":28,Buttons:{"collapse_post":true,"expand_all":true,"collapse_all":true},"animate":true,"animate_speed":400,"animate_all":false};$j("div.storywrap.collapsed").each(function(){var $this=$j(this);if($this.children("div.story").height()<Options["threshold"]){$this.css("height","auto").children("div.expandermask").remove().end().siblings("div.storyfooter").children("a.expanderlink").remove();}else{$this.children("div.expandermask").on("click",function(e,animate,scroll){e.preventDefault();var $mask=$j(this);var $button=$mask.parent().siblings("div.storyfooter").children("a.expanderlink");animate=typeof animate!=='undefined'?animate:Options["animate"];if($mask.css("display")!="none"){ga('send','event','Expander','Click','Expand Post');scroll=false;var targetCSS={"height":$mask.siblings("div.story").height()+ Options["expand_offset"]};var aniOptions={"duration":Options["animate_speed"],"easing":"swing"}
$mask.css("display","none");if(Options.Buttons["collapse_post"]){$button.empty().html('Collapse <img src="'+ iroot+'/arrow-blue-up.png" />');}else{$button.css("display","none");}}else{ga('send','event','Expander','Click','Collapse Post');scroll=typeof scroll!=='undefined'?scroll:true;var targetCSS={"height":Options["collapsed_height"]};var aniOptions={"duration":Options["animate_speed"],"easing":"swing"}
$mask.css("display","block");if(Options.Buttons["collapse_post"]){$button.empty().html('Expand <img src="'+ iroot+'/arrow-blue-dn.png" />');}else{$button.css("display","block");}}
if(animate){if(scroll){$j("html, body").animate({scrollTop:$this.offset().top},400);}
$mask.parent().animate(targetCSS,aniOptions);}else{if(scroll){$j("html, body").scrollTop($this.offset().top);}
$mask.parent().css(targetCSS);}}).end().siblings("div.storyfooter").children("a.expanderlink").on("click",function(e){e.preventDefault();$j(this).parents("div.storyblock").find("div.expandermask").trigger("click");}).empty().html('Expand <img src="'+ iroot+'/arrow-blue-dn.png" />');}});if(($j("div.storywrap.collapsed").length>0)&&(Options.Buttons["expand_all"]||Options.Buttons["collapse_all"])){var $controls=$j('<div id="expandercontrols"></div>').appendTo("div.maincolumn_head");if(Options.Buttons["expand_all"]){$controls.append($j('<a href="#">Expand All Posts</a>').on("click",function(e){ga('send','event','Expander','Click','Expand All Posts');e.preventDefault();$j("div.storyblock:not(.kiosked-block) div.expandermask:visible").trigger("click",[Options["animate_all"],false]);}));}
if(Options.Buttons["expand_all"]&&Options.Buttons["collapse_all"]){$controls.append(document.createTextNode(" | "));}
if(Options.Buttons["collapse_all"]){$controls.append($j("<a href='#'>Collapse All Posts</a>").on("click",function(e){ga('send','event','Expander','Click','Collapse All Posts');e.preventDefault();$j("div.expandermask").not(":visible").trigger("click",[Options["animate_all"],false]);}));}}});