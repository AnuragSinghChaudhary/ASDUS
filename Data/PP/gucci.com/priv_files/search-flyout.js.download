define(["jquery","breakpoints","handlebars"],function(e,t,n){function _(n){if(!t.is("small")&&!t.is("medium")){if(n===undefined||n.type==="focus")e(m).addClass(g),e(r).addClass(y),e(p).addClass(s),e(u).removeClass(s),e(a).removeClass(s),e(o).addClass(c),e(i).addClass(h),e(r).removeAttr("placeholder"),e(i).text(e(r).attr("data-placeholder"));D()}else if(n===undefined||n.type!=="focus")e(o).addClass(c),e(r).attr("placeholder",e(r).attr("data-placeholder")),e(i).text(""),k?(G(),e(r).val().length>0&&(e(r).removeClass(E),e(i).removeClass(E),e(i).text(""))):k=!0,D()}function D(){e(w).on("click touchstart touchend touchmove",P)}function P(){event.stopPropagation()}function H(t,r,i,o,u){var a=e("#template-list-products").html(),f=n.compile(a),l={title:r,description:i,url:o,primaryImage:t,productCode:u},c=f(l),h=".search-flyout-products";e(h+" ul").append(c),e(h).removeClass(s)}function B(t,r){var i=e("#template-list-categories").html(),o=n.compile(i),u={title:t,url:r},a=o(u),f=".search-flyout-categories";e(f+" ul").append(a),e(f).removeClass(s)}function j(t,r,i){var o=e("#template-list-articles").html(),u=r.substring(0,120),a=n.compile(o),c={title:t,description:u,url:i},h=a(c);e(f+" "+l).append(h),e(f).removeClass(s)}function F(t,r){var i=e("#template-no-suggestions").html(),s=".search-flyout-no-suggestions",o=n.compile(i),u={title:t,url:r},a=o(u);e(s+" ul").append(a),e(s).removeClass("hide-flyout-section"),e(s+" .section-title").show(),e(s+" .search-flyout-no-found").hide(),Q()}function I(){var t=e(T+" li").length>0?!1:!0,n=e(x+" li").length>0?!1:!0,r=e(S+" li").length>0?!1:!0,i=e("body").hasClass("kr")?!0:!1;e(S).removeClass(s),e(S+" li").length>0?(e(S+" .section-title").show(),e(S+" .search-flyout-no-found").removeClass("suggestion-no-border")):(e(S+" .section-title").hide(),e(S+" .search-flyout-no-found").addClass("suggestion-no-border")),t==1&&n==1&&r==1?e(S+" .search-flyout-no-found").show():i==1?e(S+" .search-flyout-no-found").hide():e(S+" .search-flyout-no-found").show(),Q()}function q(t,n){var s=e(r).val(),o=s.length,u=s.substr(0,o),a=t.length,f=t.substr(o,a);e(i).text(u+f),n.keyCode==39&&(e(r).val(t),e(i).text(""))}function R(t,n){var i=e(r).val().toLowerCase(),s=e(r).val(),o=new RegExp(i),u=new RegExp("^"+s+".*$"),a=t.length,f,l,c,h,p,d,v,m,g,y=0,b=e("#predictive-search-enabled").data("product-suggestions-enabled"),w=e("#predictive-search-enabled").data("category-suggestions-enabled"),E=0,S=!0,x=!0,T=!0;for(y;y<a;y++){f=t[y].title,l=t[y].title.toLowerCase(),t[y].description!==undefined?c=t[y].description.toLowerCase():c="";switch(t[y].section){case A[0]:x=!1,p=t[y].imageData,d=t[y].title,v=t[y].description,m=t[y].productCode,E++,g=t[y].url+"?listName=SearchBoxComponent&search-cat=search-autocomplete&position="+E,H(p,d,v,g,m);break;case A[1]:d=t[y].title,g=t[y].url+"?search-cat=search-autocomplete",T=!1,B(d,g);break;case A[2]:d=t[y].title,v=t[y].description,g=t[y].url,j(d,v,g);break;case A[3]:d=t[y].title,F(d,"search/?search-cat=search-autocomplete&text="+d),(l.match(i)||f.match(u))&&S&&(h=t[y].title,q(h,n),S=!1)}}b&&x||w&&T?I():U(t)}function U(e){var t=[],n={};for(var r=0;r<e.length;r++){var i=e[r];A[0]==i.section&&(n={},n.name=i.title,n.id=i.productCode,n.price=i.price,n.category=i.categoryPath,n.variant=i.variant,n.list="SearchBoxComponent",n.dimension5=i.saleType,n.position=r+1,t.push(n))}if(t.length>0){var s={event:"productImpression",ecommerce:{impressions:t}};dataLayer.push(s)}}function z(){e(o).addClass(b)}function W(){e(o).removeClass(b)}function X(){var n=e(r).data("placeholder"),s=e(r).data("placeholder-small");if(!t.is("small")&&!t.is("medium"))e(o).hasClass(b)||(V(),e(r).val().length>0?e(r).removeAttr("data-placeholder"):e(r).attr("placeholder")===undefined||e(r).attr("data-placeholder")===undefined?e(r).attr("data-placeholder",n).attr("placeholder",s):e(r).attr("placeholder",s),e(r).removeClass(y),e(i).text(""),e(m).removeClass(g));else{var u=e("#header-nav-search").hasClass("_active");u||V()}e(w).off("click touchstart touchend touchmove",P),L.removeClass("_lock-it")}function V(){e(".header-nav-child-focus").html(""),e(p).addClass(s),e(a).removeClass(s),e(d).removeClass(s).find("ul").append(e(d).find("li")),e(r).removeClass("empty-clicked"),e(i).removeClass(E),e(o).removeClass(c),e(i).removeClass(h)}function $(n){var r=t.is("small")||t.is("medium"),i=e("#header-nav-search").hasClass("_active");!i&&r&&X(n)}function J(e){return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")}function K(t){var n=e(r).val(),o=e(r).val().length,c=v+n;e(i).text(""),e(i).removeClass(E),e(f+" "+l).empty(),e(p+":not("+u+", "+a+") ul").empty(),e(p).addClass(s),c=J(c),"undefined"!=typeof O&&o>=O?(M.push(n),e.ajax({url:c,type:"GET",dataType:"json"}).done(function(e){var r=!1;M.length>0&&M.lastIndexOf(n)==M.length-1&&(M.push(""),r=!0),r&&R(e,t)})):M.lastIndexOf("")==M.length&&(M=[]),o===0&&(e(r).attr("placeholder")!==undefined&&e(r).removeAttr("placeholder"),e(i).text(e(r).attr("data-placeholder")))}function Q(){}function G(){var n=e(r).attr("data-two-click-placeholder");e(r).addClass("empty-clicked").attr("data-placeholder",n).attr("placeholder",""),e("#header-nav-search-input-disabled").addClass(E).html(n),t.is("standard")||(e("#header-nav-search").addClass("border-highlight _active"),e(r).addClass(E))}function Y(n){if(e(r).val()!=="")return!0;n.preventDefault(),e(r).focus(),t.is("standard")?C?G():(C=!0,_()):_()}function Z(){e(document).bind("closing_search",X),e(document).bind("open_search",_),e(r).bind("input propertychange",K),e(r).bind("focus",_),e(r).bind("blur",X),e(o).bind("mouseenter",z),e(o).bind("mouseleave",W),e(r).on("click touchstart touchend touchmove",function(e){e.stopPropagation()}),e(N).bind("submit",Y)}function et(){n.registerHelper("breaklines",function(e){return e=n.Utils.escapeExpression(e),e=e.replace(/(\r\n|\n|\r)/gm,"<br>"),new n.SafeString(e)})}var r="#header-nav-search-input",i="#header-nav-search-input-disabled",s="hide-flyout-section",o=".search-flyout",u=".search-flyout-recent",a=".search-flyout-section-keywords",f=".search-flyout-articles",l=".search-flyout-articles-content",c="search-flyout-show",h="focus-disabled",p=".search-flyout-section",d=".search-flyout-recent",v=hybris.contextPath+"/search/autocomplete/SearchBoxComponent?term=",m=".header-nav-search-submit",g="submit-focus-state",y="input-focus",b="classHover",w="#scroll-wrapper",E="red-text",S=".search-flyout-no-suggestions",x=".search-flyout-categorie",T=".search-flyout-products",N="#header-nav-search",C=!1,k=!1,L=e("body"),A=["Products","Categories","Articles","Suggestion"],O=e(r).attr("data-trigger-predictive-count"),M=[];return{load:function(){Z(),et();var t=e(document.activeElement);t.attr("id")=="header-nav-search-input"&&t.trigger("focus"),e(m).attr("disabled",!1),setTimeout(function(){e(i).attr("style",e(r).attr("style"))},1e3)}}});