define(["jquery","eventDispatcher","litelog"],function(e,t,n){function h(){var t=s+"-hover",n=".tooltip-close";c.hasClass("no-touch")?c.off("mouseenter focus",o,b).off("mouseenter focus",t,p).on("mouseenter focus",o,b).on("mouseenter focus",t,p).on("click",s,p).on("click",n,function(){e(o).removeClass(i)}).on("mouseleave blur",t+", "+o,v):c.hasClass("touch")&&c.on("click",t,p).on("click",s,p).on("click",n,function(){e(o).removeClass(i)})}function p(t){var n=e(this),s=n.attr("href");u=e(o),t.stopPropagation(),m(s);if(t.type==="mouseenter"||t.type==="click"||t.type==="focusin")e(s).addClass(i);else if(t.type==="touchstart"){e("html").hasClass("iOS")&&e("html").hasClass("mobile")&&n.closest(".overlay._active").length===0&&e(document.activeElement).blur();if(e(s).parents(".tooltip-wrapper").length<=0){var a=e(window).width()<480,f=e(s).hasClass("_active"),l=e("body").hasClass("page-myAccountAddressBookPage");if(a){var h=e(this).offset(),p=e(s).offset();if(l===!0)var d=parseInt(h.left)-250;else var d=parseInt(h.left)-22;var g=-(parseInt(h.left)-25);d+e(s).width()>e(window).width()&&(g=-(e(window).width()-e(s).width()+10),r.log(g)),e(".tooltipStyle")&&e(".tooltipStyle").remove(),e("#page").prepend('<div class="tooltipStyle"><style>.tooltip'+e(s).selector+":after{left:"+d+"px}</style></div>"),l===!0?(e(s).css({left:g+"px",opacity:1,display:"block",visibility:"visible"}),setTimeout(function(){e(s).removeAttr("style"),e(s).removeClass("_active")},2200)):e(s).css({left:g+"px"})}}e(s).toggleClass(i)}else e(s).removeClass(i);b(),e(t.target).is("a")&&y(t),c.hasClass("touch")&&c.on("click touchstart",v)}function d(t){e(t).toggleClass(i)}function v(t){var n=c.hasClass("iOS")?600:275;if(u!==null&&(t.target===u[0]||u.has(t.target).length>0))return;var r=e(this);r.hasClass("tooltip")?(u=r,a=r.parent()):(u=e(o),a=e(o).closest());if(t.type=="touchstart"&&u.hasClass("keep-open-on-touchScroll"))return;l=r.attr("data-autoclose")?e(this).data("autoclose"):!0,!a.is(t.target)&&a.has(t.target).length===0?f=setTimeout(function(){u.removeClass(i)},n):t.type==="mouseleave"&&l===!0&&(f=setTimeout(function(){u.removeClass(i)},n)),c.hasClass("touch")&&c.off("click touchstart",v)}function m(t){var n,r;e(".tooltip._active").each(function(){n=e(this),r="#"+e(this).attr("id"),r!==t&&g(r)})}function g(t){e(t).removeClass(i)}function y(e){e&&e.preventDefault&&e.preventDefault()}function b(){clearTimeout(f)}var r=new n("Tooltip"),i="_active",s=".tooltip-open",o=".tooltip",u=null,a=null,f=null,l=!0,c=e("html");return{load:function(){function e(){}h(),t.dispatchAndListen("tooltip",e)},open:function(e){d(e)},close:function(e){g(e)},closeAll:m}});