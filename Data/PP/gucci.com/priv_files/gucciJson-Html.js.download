define(["jquery","eventDispatcher","handlebars","savedItems"],function(e,t,n,r){function s(t,s,u,a){var f=t.products,l=e(".search-result article").length,c=e(".content.search-result").attr("data-listName"),h=1,p="",d=e("#"+s.replace("-rest","")).html(),v=typeof t.numberOfPages=="undefined"?-1:t.numberOfPages,m=typeof t.currentPage=="undefined"?-1:t.currentPage,g=typeof t.searchPageSize=="undefined"?-1:t.searchPageSize,y=n.compile(d),b=typeof f.maxStandard!="undefined"?f.maxStandard:f.items.length,w=typeof f.maxMedium!="undefined"?f.maxMedium:f.items.length,E=typeof f.maxSmall!="undefined"?f.maxSmall:f.items.length;b=b===null?f.items.length:b;var S=s.indexOf("-rest")>2||v-1==m,x=[];for(var T in f.items){var N={},C=f.items[T],k=i.GRID;typeof f.items[T].isFeatured!="undefined"&&(k+=" "+i.GRID+i.FEATURED+f.items[T].isFeatured),h<=w?k+=" "+i.GRID+i.MEDIUM:k+=" "+i.GRID+i.MEDIUM+i.REMOVE,h<=E?k+=" "+i.GRID+i.SMALL:k+=" "+i.GRID+i.SMALL+i.REMOVE,f.items[T].productClass=k;var L=parseInt(T,10)+l+1;f.items[T].productLink=f.items[T].productLink+"?position="+L+"&listName="+c+"&categoryPath="+C.categoryPath;if(!(h<=b))break;p+=y(f.items[T]),h++,N.name=C.title,N.id=C.productCode,N.price=C.rawPrice,N.dimension5=C.saleType,N.category=t.bcCategoryPath,N.variant=C.variant,N.list=a,N.position=L,x.push(N)}return o(a,x),p+='<div class="'+i.LOAD_MORE_CONTAINER+' _no-content"></div>',e('a[href="'+s+'"]').attr("href",s+"-rest"),r.fillSavedItems(),{html:p,hideButton:S}}function o(e,t){var n={event:"productImpression",ecommerce:{impressions:t}};dataLayer.push(n)}function u(){}var i={GRID:"product-tiles-grid-item",MEDIUM:"-medium",SMALL:"-small",REMOVE:"-remove",FEATURED:"-featured",LINK:"/p/",LOAD_MORE_CONTAINER:"product-tiles-grid-load-content"};return t.dispatchAndListen("gucciJsonHtml",u),{compiler:function(e,t,n,r){return s(e,t,n,r)}}});