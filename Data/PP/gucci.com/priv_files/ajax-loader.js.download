define(["jquery","eventDispatcher","dispatcher","ajaxConfig","jsonHtml","loader","imageLoader","gucciJsonHtml","genericUtilities"],function(e,t,n,r,i,s,o,u,a){function E(){e(window).ready()&&e(".product-tiles-grid .ajax-loader-link").css({display:"inline-block"}).on("click",S)}function S(t){var n=e(this),r=n.attr("data-url");r==null&&(r=n.attr("href")),C(t),T(r,n.attr(l),n,n.attr(d))}function x(e){return decodeURIComponent(e)!==e}function T(t,r,a,f,l,d){var E=t,S=e("."+r),T=m+" "+g;s.updateElementClass(S,v,T),s.updateElementClass(a,v,T);var N="",C=a.attr("ID");C=="filterSortSelect"&&(t="product-tiles-grid-2");var k=w[t.toUpperCase()];k||(k=t);if(C=="looksGridLoadMoreLnk"){var L=a.attr(h),N="categoryCode="+a.attr(c),A=location.href.match(/.+sort=([^&]*)/i,"$1"),O=location.href.match(/.+filter=([^&]*)/i,"$1");A!=null&&(N+="&sort="+A[1]),O!=null&&(N+="&filter="+O[1]),L!=null&&(L==2?N=N+"&page=0"+"&show=All":N=N+"&page="+L)}else if(C=="productGridLoadAllLnk"){var L=a.attr(h),N="categoryCode="+a.attr(c),A=location.href.match(/.+sort=([^&]*)/i,"$1"),O=location.href.match(/.+filter=([^&]*)/i,"$1");A!=null&&(N+="&sort="+A[1]),O!=null&&(N+="&filter="+O[1]),N=N+"&page=0"+"&show=All",e(".product-tiles-grid-item").removeClass("show-desktop")}else if(C=="searchResultsLoadMoreLink"){var L=a.attr(h),M=a.attr(p),N="filter="+(x(M)?M:encodeURIComponent(M)),A=location.href.match(/.+sort=([^&]*)/i,"$1"),O=location.href.match(/.+filter=([^&]*)/i,"$1");A!=null&&(N+="&sort="+A[1]),O!=null&&(N+="&filter="+O[1]),L!=null&&(L==2?N+="&show=All&page=0":N=N+"&show=Page&page="+L)}else if(C=="filterSortSelect")N="categoryCode="+a.attr(c)+"&sort="+E,e("#facetNavSelection").val()!=""&&(N=N+"&filter="+e("#facetNavSelection").val());else if(l!="undefined"&&l!=""&&l!=null)N="lookNumber="+l;else if(t=="product-tiles-grid-3"||t=="product-tiles-grid-2")N="categoryCode="+a.attr(c)+"&filter=:"+e("select.sort-select").val()+":"+e("#facetNavSelection").val();N=N.replace(/[:(.?)]+:/g,":"),e.ajax({url:k,dataType:"json",data:N}).done(function(r){r=t=="looks-detail"?[r,l]:r;if(t.indexOf("search-results-grid")!=-1||t.indexOf("product-tiles-grid")!=-1){var c=a.attr("data-componentName");b=u.compiler(r,t,a.attr(h),c)}else b=i.compiler(r,t);C!="filterSortSelect"&&t!="looks-detail"&&t!="product-tiles-grid-3"&&t!="product-tiles-grid-2"&&(b.hideButton||typeof a.attr("data-all-text")!="undefined"&&a.text().toUpperCase()==a.attr("data-all-text").toUpperCase()?a.hide():a.text(a.attr("data-all-text")));if(C=="searchResultsLoadMoreLink"||C=="productGridLoadAllLnk"){var p=parseInt(a.attr(h));a.attr(h,p+1)}s.loadRepsonseInContainer(S,e(b.html),a,e("."+f)),o.loadImage(S),e("body").removeClass(y),typeof d!="undefined"&&n.fireCallbacks(d,r)}).fail(function(){s.showLoadError(S,a)})}function N(t,n,i){var s=t.toUpperCase();return r.getRemoteService(s)==="undefined"?(console.error("The Key ["+s+"] not exists into AJAX Config"),!1):(i==undefined&&(i="GET"),i=="POST"&&(n.CSRFToken=e("input[name=CSRFToken]").val()),e.ajax({url:r.getRemoteService(s),type:i,data:n,dataType:"JSON",cache:!1}))}function C(e){e&&e.preventDefault&&e.preventDefault()}function k(t){var n={},r=t.serializeArray();return e.each(r,function(){n[this.name]!==undefined?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n}var f=".ajax-loader-link",l="data-load_container",c="data-catCode",h="data-pageNumber",p="data-searchText",d="data-load_remove_class",v="_loading",m="_loaded",g="_error",y="overlay-lock",b={},w=r.config();return{load:function(){function e(){}a.registerGridHandlebarsHelper(),E(),t.dispatchAndListen("ajaxLoader",e)},loadJson:T,endPointAccess:N,serializeObject:k}});