define(["jquery","eventDispatcher","configVariables"],function(e,t,n){function c(e,t){this.$form=e,this.fieldErrorFormat=t||"inline",this.preventSubmit=!1,this.bindEvents()}function h(e,n){function r(){}return new c(e,n)}var r=".error-message",i="error-text",s="error-text-no-ajax",o="tooltip-help",u="tooltip-help-no-ajax",a="tooltip-message error-text",f="error",l=Modernizr.touch;return c.prototype.bindEvents=function(){this.$form.on("submit",e.proxy(this.submitHandler,this))},c.prototype.submitHandler=function(e){var t;if(this.preventSubmit)return;this.$form.find('input[required="required"]').length>0&&(e.preventDefault(),this.$form.find("input.input-login-email").length>0||this.$form.find("input.input-login-pwd").length>0?t=n.userMessages.loginError:t=n.userMessages.required,this.findRequiredField(t));if(this.$form.find(".error").length>0)return;this.$form.find("input[data-validation-match]").length>0&&(e.preventDefault(),t=n.userMessages.match,this.findMatchField(t)),this.$form.find(".error").length===0&&(this.preventSubmit=!0,this.formSuccess())},c.prototype.findRequiredField=function(t){var n=this,r=this.$form;r.find('input[required="required"]').each(function(){var r=e(this),s;r.removeClass(f),r.next("."+i).remove(),r.next("."+o).remove(),e.trim(r.val())===""&&(s=n.getFieldErrorMessage(r,t),n.appendFieldErrorMessage(r,s,t))})},c.prototype.findMatchField=function(t){var n=this,r=this.$form,s,u;r.find("input[data-validation-match]").each(function(){s=e(this),s.removeClass(f),s.next("."+i).remove(),s.next("."+o).remove(),s.val()!==e('input[name="'+s.data("validation-match")+'"]').val()&&(u=n.getFieldErrorMessage(s,t),n.appendFieldErrorMessage(s,u,t))})},c.prototype.appendFieldErrorMessage=function(e,t,n){var r;if(e.is("select"))l?(e.addClass(f),this.addErrorMessage(e,t,n)):(r=e.parents(".selectricWrapper"),r.find(".selectric").addClass(f),this.addErrorMessage(e,t,n));else if(e.is("input")||e.is("textarea"))e.addClass(f),this.addErrorMessage(e,t,n)},c.prototype.addErrorMessage=function(e,t,n){this.findErrorMessage()?e.after(t):this.putErrorMessage(n)},c.prototype.findErrorMessage=function(){return this.$form.find(r).length===0},c.prototype.getFieldErrorMessage=function(e,t){var n;switch(this.fieldErrorFormat){case"tooltip":n=this.getFieldErrorMessageTooltip(e,t);break;case"inline":n=this.getFieldErrorMessageInline(e,t);break;default:n=this.getFieldErrorMessageInline(e,t)}return n},c.prototype.getFieldErrorMessageInline=function(t,n){return e("<span>").addClass(i+" "+s+" "+r).html(n)},c.prototype.getFieldErrorMessageTooltip=function(t,n){var i=e("<div>"),s=e("<div>");return i.addClass(o+" "+u+" "+r),s.addClass(a),s.html(n),i.append(s),i},c.prototype.putErrorMessage=function(e){var t=this.$form;t.find(r).html(e)},c.prototype.formSuccess=function(){this.$form.submit()},{newFormValidate:h}});