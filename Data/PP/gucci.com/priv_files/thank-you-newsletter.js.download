define(["jquery","eventDispatcher","formEndpointValidation","ajaxConfig","overlay","os","imageLoader"],function(e,t,n,r,i,s,o){function d(){e.ajax({url:l+"?key="+(new Date).getTime(),type:"GET",dataType:"json"}).done(function(e){e&&e.uid&&(c=e.uid)})}function v(){d(),h.on("submit",y),p.on("submit",w),p.prop("action",u),n.newInstance(p,b,b),o.loadImage(p),e(".form-overlay-content-newsletter").on("click",E),e("select",p).on("change",m)}function m(){var t=e(this),n=t.val(),r=n>0||isNaN(n);r?t.removeClass("gold"):t.addClass("gold")}function g(t){if(e("body").hasClass("jp"))var n=/\S+@\S+\.\S+/;else var n=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return n.test(t)}function y(t){t.preventDefault();var n=e("#email-updates"),r=n.closest("form"),s=n.val(),o=n.data("reference"),u=e("#"+o).val();typeof n.data("placeholder")=="undefined"&&n.data("placeholder",n.attr("placeholder"));if(!g(s))return n.attr("placeholder",n.data("error-message")),n.val(""),r.addClass("newsletter-invalid-email-error"),!1;var l={email:s,CSRFToken:hybris.CSRFToken};l[o]=u;var d=e.ajax({url:a,type:f,data:jQuery.param(l),dataType:"json"});d.done(function(){p.find(".error-text").remove(),p.find(".tooltip-message error-text").remove(),p.find(".error").removeClass("error"),e("input:text",p).val(""),e("#email-updates",h).val(c),e("select",p).find('option[value="0"]').prop("selected",!0),e("select",p).selectric("refresh"),e("input:checkbox",p).not("checked-at-default").removeAttr("checked"),e(".checked-at-default",p).prop("checked",!0),i.open("#thank-you-newsletter"),e(".newsletter-email").text(s),e(".newsletter-email-input").val(s),r.removeClass("newsletter-invalid-email-error"),n.val(c),n.attr("placeholder",n.data("placeholder"))}),d.error(function(){})}function b(e){e&&e.status=="ok"&&i.close("#thank-you-newsletter")}function w(){dataLayer.push({event:"newsletterSubscribe",email:e("#thank-you-newsletter .newsletter-email").html()}),b()}function E(){e(".selectricWrapper",e(".form-overlay-content-newsletter")).filter(".selectricOpen").find("select").each(function(){e(this).selectric("close")})}var u=r.getRemoteService("THANK-YOU-NEWSLETTER"),a=r.getRemoteService("SIGN-UP-UPDATES"),f=r.mainSubmitMethod(),l=r.getRemoteService("CHECK_CUSTOMER_INFO"),c="",h=e("#thank-you-newsletter-form"),p=e("#thank-you-newsletter-overlay");return{load:function(){function n(){e("#thank-you-newsletter-form").removeClass("inactive-module")}v(),t.dispatchAndListen("thankYouNewsletter",n)}}});