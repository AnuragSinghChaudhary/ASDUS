window.espni=window.espni||{};espni.disneyOneIDUtils=function($){var api={};var conf={loggedIn:false,userInfo:{}};function getConfig(){var hostname=window.location.hostname,path=window.location.pathname,clientId="ESPN-CRICINFO.WEB",langPref="en-US",cssOverride="https://secure.espncdn.com/combiner/c?css=disneyid/core.css,disneyid/cricinfo.css",responderPage="https://ssl.espncricinfo.com/disneyid/responder";return{clientId:clientId,langPref:langPref,cssOverride:cssOverride,responderPage:responderPage,blueCookie:!0,initialize:!0}}function initDisneyID(){if(window.DisneyID===undefined){window.setTimeout(initDisneyID,100)}else{did=DisneyID.get();did.on("login",updateGuestInfo);did.on("logout",showUserLoggedOut);did.on("init",onInitDisneyID)}}function showUserUpdate(guest){if(guest){var url="http://"+endpoint+"/ci/content/submit/api/update_oneid_user.html";var data={};if(guest.displayName){if(guest.displayName.displayName){data.username=guest.displayName.displayName}if(guest.displayName.proposedDisplayName){data.display_name=guest.displayName.proposedDisplayName}}if(guest.profile){if(guest.profile.email){data.email=guest.profile.email}}data.swid=conf.userInfo.swid;data.signin_source_id=conf.userInfo.signin_source_id;if($.cookie("espncricinfo_s2")){data.s2_cookie=encodeURIComponent($.cookie("espncricinfo_s2"))}if(conf.userInfo.swid){$.ajax({url:url,data:data,type:"POST",dataType:"jsonp",jsonpCallback:"jsonCallback",success:function(data){}})}}}function updateGuestInfo(guest){if(guest){var username=guest.profile.firstName;var displayName=guest.displayName.displayName;var proposedDisplayName="";if(guest.displayName.proposedDisplayName){proposedDisplayName=guest.displayName.proposedDisplayName}conf.loggedIn=true;$("#ciMemebermgmt .espni-edit-profile").text("Welcome "+guest.profile.firstName);$("#ciMemebermgmt .espni-profile-signout").show();$("#ciMemebermgmt span").hide();$("#ciMemebermgmt .espni-profile-signin").hide();$("#ciMemebermgmt .espni-profile-register").hide();$(".show_login").hide();$(".show_comment").show();conf.userInfo.swid=guest.profile.swid;if(guest.token.authenticator=="disneyid"){conf.userInfo.signin_source_id=1}else{conf.userInfo.signin_source_id=5}loadCommentModule(username,displayName,proposedDisplayName)}else{conf.loggedIn=false}}function onInitDisneyID(data){conf.loggedIn=data.loggedIn;$("#ciMemebermgmt").show();$(".show_login").hide();$(".show_comment").hide();if(!conf.loggedIn){$("#ciMemebermgmt .espni-profile-signout").hide();$("#ciMemebermgmt .espni-profile-signin").show();$("#ciMemebermgmt span").show();$("#ciMemebermgmt .espni-profile-register").show()}else{$("#ciMemebermgmt .espni-profile-signout").show();$("#ciMemebermgmt .espni-profile-signin").hide();$("#ciMemebermgmt .espni-profile-register").hide();$("#ciMemebermgmt span").hide()}enableButtons();data.loggedIn?updateGuestInfo(data.guest):showUserLoggedOut()}function enableButtons(){$("#ciMemebermgmt .espni-profile-signin, #espni-comm-login").off("click").on("click",function(){if(!conf.loggedIn){did.launchLogin()}});$("#edit_displayname").on("click",function(e){e.preventDefault();did.launchDisplayName()});$("#ciMemebermgmt .espni-profile-register, #espni-comm-register").on("click",function(){did.launchRegistration()});$("#ciMemebermgmt .espni-edit-profile").on("click",function(){did.launchProfile()});$("#ciMemebermgmt .espni-profile-signout").on("click",function(){did.logout()})}function showUserLoggedOut(){conf.loggedIn=false;$("#ciMemebermgmt .espni-edit-profile").text("Welcome Guest ");$("#ciMemebermgmt .espni-profile-signout").hide();$("#ciMemebermgmt .espni-profile-signin").show();$("#ciMemebermgmt .espni-profile-register").show();$("#ciMemebermgmt span").show();$(".show_login").show();$(".show_comment").hide();$("#espni-comm-profile").hide()}function didOn(event,fnc){did.on(event,function(data){try{fnc(data)}catch(e){}})}function appendDisneyScript(){if(document.querySelector('script[src$="/outer/DisneyID.js"]'))return!0;var source="https://cdn.registerdisney.go.com/v2/outer/DisneyID.js";var script=document.createElement("script");script.src=source,script.onload=function(){window.did=DisneyID.get(getConfig()),initDisneyID()},(document.head||document.body).appendChild(script)}function loadCommentModule(username,displayName,proposedDisplayName){var $that;if(typeof _CONTENTTYPE!=="undefined"&&_CONTENTTYPE=="story"){$("#espni-comm-profile").show();if(proposedDisplayName.length>0){$("#espni-comm-profile").html("Welcome <b>"+username+"!</b>")}else{$("#espni-comm-profile span").html("Welcome <b>"+username+"</b>");$("#espni-comm-profile i").text(displayName)}$("#sComments").on("submit",function(e){$that=$(this);e.preventDefault();submitStoryComment($that)})}}function isHYSPage(){var isHYS=false;var genre_id=$("#stryComments").data("genre");if(genre_id==481||genre_id==448){isHYS=true}return isHYS}function submitStoryComment($that){var flag=true;var comm_txt=$("#cmntBox").val();var content_type_id=$that.data("contenttype");var object_id=$that.data("objectid");var genre_id=$that.data("genre");var url="http://"+endpoint+"/ci/content/submit/comment/confirm_new.html";if($("li.hys").length>0){var option_val=$("li.hys input[name=comment_type_id]:checked").val();if(typeof option_val==="undefined"){alert("Please select an option");$("li.hys input[name=comment_type_id]").focus();flag=false;return false}else{option_val=parseInt(option_val,10)}}if(comm_txt.length===0||comm_txt.length<25){alert("Please enter minimum of 25 characters.");$("#cmntBox").focus();flag=false}if(comm_txt.length>1e3){alert("The text size you entered exceeds 1000 characters. Please reduce the text size to 1000 characters.");$("#cmntBox").focus();flag=false}if(isHYSPage()){if(!$("#comment_type_id_Y").is(":checked")&&!$("#comment_type_id_N").is(":checked")){window.alert("Please select yes or no");flag=false}else{content_type_id=$("#sComments input[name=comment_type_id]:checked").val()}}var data={};data.text=comm_txt;data.comment_type_id=content_type_id;data.object_id=object_id;data.swid=conf.userInfo.swid;data.genre_id=genre_id;data.signin_source_id=conf.userInfo.signin_source_id;if($.cookie("espncricinfo_s2")){data.s2_cookie=encodeURIComponent($.cookie("espncricinfo_s2"))}if(!flag){return false}else{if(conf.userInfo.swid){$.ajax({url:url,data:data,type:"POST",dataType:"jsonp",jsonpCallback:"jsonCallback",success:function(data){if(data.status===1){$("#comm_form").html("<p class='thanksmsg'>Thank you for your comment.<br>  It will be moderated by ESPNcricinfo and published soon.</p>")}}})}}}api.init=function(){appendDisneyScript();$("#espni-comm-profile").hide()};return api}(jQuery);jQuery(function(){espni.disneyOneIDUtils.init()});