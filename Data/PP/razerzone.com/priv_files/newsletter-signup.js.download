try{
	var newsletter_translation = {
		'us-en':{
				"STORE_NEW_SIGNUP_EMAIL_TEXT" : "Enter your email address",
				"STORE_NEW_SIGNUP_LINK_TEXT" : "Get US$10 Off",
				"STORE_NEW_SIGNUP_SUBMIT" : "Sign Up",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "By signing up you agree to receive newsletters from Razer. View our ",	
				"STORE_NEW_SIGNUP_PRIVACY_POLICY" : "Privacy Policy",				
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_2" : ". Terms and conditions apply.",	
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Get US$10 Off Today",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>US$10 off*</span> your next purchase at RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Get US$10 Off Today",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Hey, before you go",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>US$10 off*</span> your next purchase at RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offer is valid with a minimum purchase of US$99. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG" : "Please enter valid email address",				
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "THANK YOU FOR SIGNING UP!<br><span class='white'>Your US$10 off code will arrive in your inbox shortly.</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "THANK YOU!<br><span class='white'>This email address has already signed up for our newsletter.</span>",
				"STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_HEADING" : "WELCOME TO RAZERSTORE.COM",
				"STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_PARAGRAPH" : "Here's your US$10 Off. Use code at checkout:",
				"STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_CTA" : "Shop Now",
				"STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_TERMS" : "Offer is valid with a minimum purchase of US$99. Expires on <span class='expiry-date'></span>.",
				"STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_EXPIRE_MESSAGE" : "SORRY, YOUR OFFER HAS EXPIRED.", 
				
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_HEADING" : "ALL TREATS. NO TRICKS.",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_PARAGRAPH" : "For a limited time, receive exclusive gifts with your purchase today.",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/promos/halloween",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_CTA" : "Shop Exclusive Deals",
				
				"STORE_NEW_SIGNUP_POPOUT_HEADING_2" : "Sign Up Today", 
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH_2" : "Keep up to date with our latest deals, exclusive offers, and more.", 
				"STORE_NEW_SIGNUP_EXIT_POPOUT_PARAGRAPH_2" : "Sign up for our newsletters today and keep up to date with our latest deals, exclusive offers, and more.",
				"STORE_NEW_SIGNUP_LINK_TEXT_2" : "Deals & Offers",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_2" : "THANK YOU FOR SIGNING UP!",
		},
		
		'ca-en':{
				"STORE_NEW_SIGNUP_LINK_TEXT" : "Get CA$15 Off",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/ca-en/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Get CA$15 Off Today",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>CA$15 off*</span> your next purchase at RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Get CA$15 Off Today",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Hey, before you go",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>CA$15 off*</span> your next purchase at RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offer is valid with a minimum purchase of CA$130. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "THANK YOU FOR SIGNING UP!<br><span class='white'>Your CA$15 off code will arrive in your inbox shortly.</span>",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "By signing up you agree to receive newsletters from Razer. View our ",	
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/ca-en/promos/halloween",
		},
		
		'sg-en':{
				"STORE_NEW_SIGNUP_LINK_TEXT" : "Get SG$15 Off",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/sg-en/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Get SG$15 Off Today",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>SG$15 off*</span> your next purchase at RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Get SG$15 Off Today",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Hey, before you go",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>SG$15 off*</span> your next purchase at RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offer is valid with a minimum purchase of S$150. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "THANK YOU FOR SIGNING UP!<br><span class='white'>Your SG$15 off code will arrive in your inbox shortly.</span>",	
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "THANK YOU!<br><span class='white'>This email address has already signed up for our newsletter.</span>",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "By signing up you agree to receive newsletters from Razer. View our ",	
				
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/sg-en/promos/halloween",
		},
		
		'hk-en':{
				"STORE_NEW_SIGNUP_LINK_TEXT" : "Get HK$80 Off",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/hk-en/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Get HK$80 Off Today",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>HK$80 off*</span> your next purchase at RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Get HK$80 Off Today",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Hey, before you go",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>HK$80 off*</span> your next purchase at RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offer is valid with a minimum purchase of HK$790. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "THANK YOU FOR SIGNING UP!<br><span class='white'>Your HK$80 off code will arrive in your inbox shortly.</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "THANK YOU!<br><span class='white'>This email address has already signed up for our newsletter.</span>",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "By signing up you agree to receive newsletters from Razer. View our ",	
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/hk-en/promos/halloween",
		},	

		'hk-zh':{
				"STORE_NEW_SIGNUP_EMAIL_TEXT" : "電子郵件地址",
				"STORE_NEW_SIGNUP_LINK_TEXT" : "訂閱電子報",
				"STORE_NEW_SIGNUP_SUBMIT" : "送出",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "一旦訂閱，代表您同意收到 Razer 寄出的電子報。查看我們的",	
				"STORE_NEW_SIGNUP_PRIVACY_POLICY" : "隱私權政策",				
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_2" : "。 適用條款與條件。",	
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/hk-zh/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "今天就取得 HK$80 折價優惠",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "訂閱我們的電子報，就能在下次購物時享有 <span class='green'>HK$80 折價優惠*</span>。",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "今天就取得 HK$80 折價優惠",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "嘿，別忘了",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "訂閱我們的電子報，就能在下次購物時享有 <span class='green'>HK$80 折價優惠*</span>。<style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*優惠僅限最低購買HK$790。 ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG" : "請輸入有效的電子郵件地址",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "感謝您訂閱！<br><span class='white'>您的 HK$80 折價代碼將在不久後寄給您。</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "感謝您！<br><span class='white'>此電子郵件地址已註冊我們的電子報。</span>",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/hk-zh/promos/halloween",
				
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_2" : "感謝您訂閱！",
		},		
		
		'eu-en':{
				"STORE_NEW_SIGNUP_LINK_TEXT" : "Get 10€ Off",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/eu-en/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Get 10€ Off Today",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>10€ off*</span> your next purchase at RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Get 10€ Off Today",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Hey, before you go",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>10€ off*</span> your next purchase at RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offer is valid with a minimum purchase of 99€. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "THANK YOU FOR SIGNING UP!<br><span class='white'>Your 10€ off code will arrive in your inbox shortly.</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "THANK YOU!<br><span class='white'>This email address has already signed up for our newsletter.</span>",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "By signing up you agree to receive newsletters from Razer. View our ",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/eu-en/promos/halloween",
		},
		
		'gb-en':{
				"STORE_NEW_SIGNUP_LINK_TEXT" : "Get £10 Off",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Get £10 Off Today",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>£10 off*</span> your next purchase at RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Get £10 Off Today",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Hey, before you go",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Sign up for our newsletters and enjoy <span class='green'>£10 off*</span> your next purchase at RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offer is valid with a minimum purchase of £99. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "THANK YOU FOR SIGNING UP!<br><span class='white'>Your £10 off code will arrive in your inbox shortly.</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "THANK YOU!<br><span class='white'>This email address has already signed up for our newsletter.</span>",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "By signing up you agree to receive newsletters from Razer. View our ",	
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/gb-en/promos/halloween",
		},
		
		'fr-fr':{
				"STORE_NEW_SIGNUP_EMAIL_TEXT" : "Adresse e-mail",
				"STORE_NEW_SIGNUP_LINK_TEXT" : "10€ Offerts",
				"STORE_NEW_SIGNUP_SUBMIT" : "Envoyer",
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "En vous abonnant, vous acceptez de recevoir un bulletin d'information de Razer.<br> Consultez notre ", 
				"STORE_NEW_SIGNUP_PRIVACY_POLICY" : "politique de confidentialité","STORE_NEW_SIGNUP_PRIVACY_POLICY_2" : ". Offre soumise à nos conditions générales.",					
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Bénéficiez D'une Réduction De 10€ Aujourd'hui", 
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Abonnez-vous à notre bulletin d'information et bénéficiez d'une réduction de <span class='green'>10€*</span> sur votre prochain achat chez RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Bénéficiez D'une Réduction De 10€ Aujourd'hui",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Avant de partir",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Abonnez-vous à notre bulletin d'information et bénéficiez d'une réduction de <span class='green'>10€*</span> sur votre prochain achat chez RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Offre valide pour un achat d’une valeur d’au moins 99€. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG" : "S\'il vous plaît entrez une adresse e-mail valide",				
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "MERCI POUR VOTRE ABONNEMENT!<br><span class='white'>Votre code pour une réduction de 10 € arrivera bientôt dans votre boîte de réception.</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "MERCI!<br><span class='white'>Cette adresse e-mail est déjà abonnée à notre bulletin d’information.</span>",
				
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_HEADING" : "PAS DE MAUVAIS TOURS. SEULEMENT DES CADEAUX.",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_PARAGRAPH" : "Recevez, pour une durée limitée des cadeaux exclusifs en achetant aujourd'hui. ",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/fr-fr/promos/halloween",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_CTA" : "Voir nos Offres Exclusives",
				
				"STORE_NEW_SIGNUP_POPOUT_HEADING_2" : "Inscrivez-vous aujourd'hui!", 
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH_2" : "Tenez-vous informé sur les bonnes affaires, les offres exclusives et bien plus encore.", 
				"STORE_NEW_SIGNUP_EXIT_POPOUT_PARAGRAPH_2" : "Inscrivez-vous à notre lettre d'information et tenez-vous informé sur les bonnes affaires, les offres exclusives et bien plus encore.",
				"STORE_NEW_SIGNUP_LINK_TEXT_2" : "Bonnes affaires et offres",
				
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_2" : "MERCI POUR VOTRE ABONNEMENT!",
		},
		
		'de-de':{
				"STORE_NEW_SIGNUP_EMAIL_TEXT" : "E-Mail-Adresse",
				"STORE_NEW_SIGNUP_LINK_TEXT" : "10€ Rabatt",
				"STORE_NEW_SIGNUP_SUBMIT" : "Absenden",
				
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_1" : "Durch die Registrierung stimmst du zu, den Newsletter von Razer zu erhalten.<br> Schau dir unsere ",	
				"STORE_NEW_SIGNUP_PRIVACY_POLICY" : "Datenschutzrichtlinie","STORE_NEW_SIGNUP_PRIVACY_POLICY_2" : " an. Es gelten die allgemeinen Geschäftsbedingungen.",	
				
				"STORE_NEW_SIGNUP_PRIVACY_POLICY_URL" : "/de-de/privacy-policy",
				"STORE_NEW_SIGNUP_TOUT_HEADING" : "Erhalte Heute 10€ Rabatt",
				"STORE_NEW_SIGNUP_TOUT_PARAGRAPH" : "Registriere dich für unseren Newsletter und erhalte <span class='green'>10€ Rabatt*</span> auf deinen nächsten Kauf bei RazerStore.com.",
				"STORE_NEW_SIGNUP_POPOUT_HEADING" : "Erhalte Heute 10€ Rabatt",
				"STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING" : "Halt, eine Sache noch",
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH" : "Registriere dich für unseren Newsletter und erhalte <span class='green'>10€ Rabatt*</span> auf deinen nächsten Kauf bei RazerStore.com. <style>#signup_new .signup-terms:before,#signup_new_exit .signup-terms:before{ content:'*Gültig ab einem Mindestbestellwert in Höhe von 99€. ';}</style>",
				"STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG" : "Bitte geben Sie eine gültige Email Adresse an",				
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG" : "DANKE FÜR DEINE REGISTRIERUNG!<br><span class='white'>Dein 10 € Rabattcode ist in kürze in deinem Posteingang.</span>",
				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED" : "DANKE!<br><span class='white'>Diese E-Mail-Adresse wurde bereits für unseren Newsletter angemeldet.</span>",

				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_HEADING" : "NUR LECKERBISSEN. KEINE TRICKS.",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_PARAGRAPH" : "Nur für kurze Zeit! Erhalte exklusive Geschenke zu deinem heutigen Einkauf.",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL" : "/de-de/promos/halloween",
				"STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_CTA" : "Exklusives Angebot",
				
				"STORE_NEW_SIGNUP_POPOUT_HEADING_2" : "Heute anmelden", 
				"STORE_NEW_SIGNUP_POPOUT_PARAGRAPH_2" : "Halte dich über unsere neuesten Aktionen, exklusiven Angebote und mehr auf dem Laufenden.", 
				"STORE_NEW_SIGNUP_EXIT_POPOUT_PARAGRAPH_2" : "Registriere dich heute für unsere Newsletter und halte dich über unsere neuesten Aktionen, exklusiven Angebote und mehr auf dem Laufenden.",
				"STORE_NEW_SIGNUP_LINK_TEXT_2" : "Aktionen und Angebote",

				"STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_2" : "DANKE FÜR DEINE REGISTRIERUNG!",
		}
		
	};
	
	//manual detect locale without cookies - safer - START
	var detect_locale = location.pathname;
	var locale_to_restrict = ['ca-en','de-de','tw-zh','au-en','hk-en','hk-zh','sg-en','ap-en','it-it','fr-fr','gb-en','eu-en','es-es','jp-jp','kr-kr'];
	var locale_is = 'us-en';
	var locale_is_db = 'en';
	
	for(var i=0; i<locale_to_restrict.length; i++){
		if(location.pathname.indexOf('/'+locale_to_restrict[i]) != -1){
			locale_is = locale_to_restrict[i];
			break;
		}
	}
	
	if(locale_is == 'us-en'){
		locale_is_db = 'en';
	}
	else{
		locale_is_db = locale_is;
	}
	
	if(locale_is == "ap-en"){
		locale_is_ap = ""; //signup_getCookie('isoCode');
	}
	else{
		locale_is_ap = "";
	}
	//manual detect locale without cookies - safer - END
	
	//get translation copy
	function translate(key){
			locale = locale_is;
			if(typeof newsletter_translation[locale][key] == 'undefined')
				return newsletter_translation['us-en'][key];
			else
				return newsletter_translation[locale][key];
	}
	
	function signup_getCookie(cname) {
		var name = cname + "=";
		var decodedCookie = decodeURIComponent(document.cookie);
		var ca = decodedCookie.split(';');
		for(var i = 0; i <ca.length; i++) {
			var c = ca[i];
			while (c.charAt(0) == ' ') {
				c = c.substring(1);
			}
			if (c.indexOf(name) == 0) {
				return c.substring(name.length, c.length);
			}
		}
		return "";
	}
	
	function isValidEmailAddress(emailAddress) {
				var pattern = new RegExp(/^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);
				return pattern.test(emailAddress);
	}
	
$(document).ready(function() {		

	navbarcat_custom_add_signup();
	
	console.log('GTM - 0. Newsletter Popout Loaded');
	
	//Exit Intent - START
	function addEvent(obj, evt, fn) {
		if (obj.addEventListener) {
			obj.addEventListener(evt, fn, false);
		}
		else if (obj.attachEvent) {
			obj.attachEvent("on" + evt, fn);
		}
	}
	
	if((window.location.href.indexOf('/chromaoffer') != -1 || window.location.href.indexOf('/promos/halloween') != -1 || window.location.href.indexOf('/promos/l33t-mode') != -1) && window.location.href.indexOf('/checkout') == -1 && window.location.href.indexOf('/cart') == -1){
		//Exit Popout for ChromaOffer and BTS only
		if(locale_is == 'us-en' || locale_is == 'ca-en' || locale_is == 'gb-en' || locale_is == 'eu-en' || locale_is == 'de-de' || locale_is == 'fr-fr' || locale_is == 'es-es' || locale_is == 'it-it' || locale_is == 'au-en' || locale_is == 'sg-en' || locale_is == 'hk-zh'|| locale_is == 'hk-en' || locale_is == 'tw-zh' || locale_is == 'ap-en' || locale_is == 'jp-jp')
		setTimeout(exit_signup_deals, $('#signup_new_exit').data('popout-exit-time') || 10000);
	}	
	else if(window.location.href.indexOf('/checkout') == -1 && window.location.href.indexOf('/cart') == -1 && window.location.href.indexOf('/console-advantage') == -1){
		if(locale_is == 'us-en' || locale_is == 'ca-en' || locale_is == 'gb-en' || locale_is == 'eu-en' || locale_is == 'de-de' || locale_is == 'fr-fr' || locale_is == 'es-es' || locale_is == 'it-it' || locale_is == 'au-en' || locale_is == 'sg-en' || locale_is == 'hk-zh'|| locale_is == 'hk-en' || locale_is == 'tw-zh' || locale_is == 'ap-en' || locale_is == 'jp-jp')
		setTimeout(exit_signup, $('#signup_new_exit').data('popout-exit-time') || 10000);
	}	
	
	if(false && window.location.href.indexOf('/chromaoffer') == -1 && window.location.href.indexOf('/promos/halloween') == -1 && window.location.href.indexOf('/checkout') == -1 && window.location.href.indexOf('/cart') == -1 && window.location.href.indexOf('/console-advantage') == -1){
		if(locale_is == 'us-en' || locale_is == 'ca-en' || locale_is == 'gb-en' || locale_is == 'eu-en' || locale_is == 'de-de' || locale_is == 'fr-fr' || locale_is == 'es-es' || locale_is == 'it-it' || locale_is == 'au-en' || locale_is == 'sg-en' || locale_is == 'hk-zh'|| locale_is == 'hk-en' || locale_is == 'tw-zh' || locale_is == 'ap-en' || locale_is == 'jp-jp')
		setTimeout(exit_promo, $('#signup_new_exit_promo').data('popout-exit-time') || 10000);
	}
	
	function exit_signup(){
		if (typeof(Storage) !== "undefined") {
			if(!localStorage.getItem("exitintent_signup")){
				
				if(/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)){
					
					var lastScrollTop = 0;
					var hasScrollDown = false;
					
					function signup_new_exit_mobile(){
						
						st = $(this).scrollTop();
						
						if(st > lastScrollTop && !hasScrollDown) {
							hasScrollDown = true;
						}
						else if(st < lastScrollTop && hasScrollDown) {
							
							$('#signup_new_mobile_only').show('fast');
							
							$('#signup_new_mobile_only .mfp-close').on('click',function(){ $('#signup_new_mobile_only').hide('fast'); });
							
							$('#signup_new_mobile_only .signup-form-button').html(translate('STORE_NEW_SIGNUP_LINK_TEXT'));
							
							$('#signup_new_mobile_only .signup-form-button').on('click',function(e){
								$('#signup_new_mobile_only').hide('fast');
								e.preventDefault();
								$.magnificPopup.open({
								  items: {
									src: '#signup_new',
									type: 'inline',
									 callbacks: {
										open: init_newsletter_content("popout-mobile")
										}
									}
								});
							});
							
							localStorage.setItem("exitintent_signup", "true");
							$(window).off('scroll', signup_new_exit_mobile);
							
						}
						
						lastScrollTop = st > 10 ? st - 10 : 0;
					
					}
					
					$(window).on('scroll', signup_new_exit_mobile);
					
				}
				else{
					addEvent(document, "mouseout", function(e) {
							e = e ? e : window.event;
							var from = e.relatedTarget || e.toElement;
							if (!from || from.nodeName == "HTML") {
								if( e.clientY < 0 && !localStorage.getItem("exitintent_signup")){
										$.magnificPopup.open({
										  items: {
											src: '#signup_new_exit',
											type: 'inline',
											 callbacks: {
												open: init_newsletter_exit_content()
												}
											}
										});

									localStorage.setItem("exitintent_signup", "true");
								}
							}
					});
				}
			}
		}
	}
	
	function exit_signup_deals(){
		if (typeof(Storage) !== "undefined") {
			if(!localStorage.getItem("exitintent_signup")){
				if(/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)){
					
					var lastScrollTop = 0;
					var hasScrollDown = false;
					
					function exit_signup_deals_mobile(){
						
						st = $(this).scrollTop();
						
						if(st > lastScrollTop && !hasScrollDown) {
							hasScrollDown = true;
						}
						else if(st < lastScrollTop && hasScrollDown) {
							setTimeout(function(){
								$.magnificPopup.open({
										  items: {
											src: '#signup_new_exit',
											type: 'inline',
											 callbacks: {
												open: init_newsletter_exit_content_deals()
												}
											}
								});
								
								localStorage.setItem("exitintent_signup", "true");
							},500);
							
							$(window).off('scroll', exit_signup_deals_mobile);
							
						}
						
						lastScrollTop = st > 10 ? st - 10 : 0;
					
					}
					
					$(window).on('scroll', exit_signup_deals_mobile);
					
				}
				else{
					addEvent(document, "mouseout", function(e) {
							e = e ? e : window.event;
							var from = e.relatedTarget || e.toElement;
							if (!from || from.nodeName == "HTML") {
								if( e.clientY < 0 && !localStorage.getItem("exitintent_signup")){
									$.magnificPopup.open({
									  items: {
										src: '#signup_new_exit',
										type: 'inline',
										 callbacks: {
											open: init_newsletter_exit_content_deals()
											}
										}
									});
									localStorage.setItem("exitintent_signup", "true");
								}
							}
					});
				}
			}
		}
	}
	
	function exit_promo(){
		if (typeof(Storage) !== "undefined") {
			if(!localStorage.getItem("exitintent_promo") && localStorage.getItem("exitintent_signup")){
				
				if(/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)){
					
					var lastScrollTop = 0;
					var hasScrollDown = false;
					
					function exit_promo_mobile(){
						
						st = $(this).scrollTop();
						
						if(st > lastScrollTop && !hasScrollDown) {
							hasScrollDown = true;
						}
						else if(st < lastScrollTop && hasScrollDown) {
							setTimeout(function(){
								$.magnificPopup.open({
									  items: {
										src: '#signup_new_exit_promo',
										type: 'inline',
										 callbacks: {
											open: init_newsletter_exit_promo_content()
											}
										}
								});
								
								localStorage.setItem("exitintent_promo", "true");
							},500);
							$(window).off('scroll', exit_promo_mobile);
							
						}
						
						lastScrollTop = st > 10 ? st - 10 : 0;
					
					}
					
					$(window).on('scroll', exit_promo_mobile);
					
				}
				else{
					addEvent(document, "mouseout", function(e) {
							e = e ? e : window.event;
							var from = e.relatedTarget || e.toElement;
							if (!from || from.nodeName == "HTML") {
								if( e.clientY < 0 && !localStorage.getItem("exitintent_promo")){
									$.magnificPopup.open({
									  items: {
										src: '#signup_new_exit_promo',
										type: 'inline',
										 callbacks: {
											open: init_newsletter_exit_promo_content()
											}
										}
									});
									localStorage.setItem("exitintent_promo", "true");
								}
							}
					});
				}
			}
		}
	}

	//Exit Intent - END
	
	if((window.location.href.indexOf('/chromaoffer') != -1 || window.location.href.indexOf('/promos/halloween') != -1 || window.location.href.indexOf('/promos/l33t-mode') != -1)){
		
		$('.main-footer ul li a[href$="/newsletter"], .signup-popout').on('click',function(e){
			e.preventDefault();
			$.magnificPopup.open({
			  items: {
				src: '#signup_new',
				type: 'inline',
				 callbacks: {
					open: init_newsletter_content_deals()
					}
				}
			});
		});
	
	}
	else{
	
		$('.main-footer ul li a[href$="/newsletter"], .signup-popout').on('click',function(e){
			e.preventDefault();
			$.magnificPopup.open({
			  items: {
				src: '#signup_new',
				type: 'inline',
				 callbacks: {
					open: init_newsletter_content()
					}
				}
			});
		});
	
	}
	
	$(window).load(function() {
      newsletter_page_popout();
	});
	
	function newsletter_page_popout(){
		if(location.pathname.indexOf('/newsletter') != -1){		
				$('.main-footer ul li a[href$="/newsletter"]').eq(0).click();
				$.magnificPopup.instance.close = function(){
					if(locale_is != 'us-en')
						location.href = "/"+locale_is+"/";
					else
						location.href = "/";	
				}
		}
	}
	
	function init_newsletter_content(source){
		
		source = source || "popout";
		
		//Newsletter Popout For Other Pages Except ChromaOffer and BTS 
		
		$('#signup_new .error').remove();
		
		//Insert Input
		$('#signup_new .signup-form-container-input').html('<input type="email" name="email" placeholder="" class="signup-form-input"/>');
						
		//Update translation for POPOUT
		$('#signup_new .signup-heading').html(translate('STORE_NEW_SIGNUP_POPOUT_HEADING'));	
		$('#signup_new .signup-paragraph').html(translate('STORE_NEW_SIGNUP_POPOUT_PARAGRAPH'));	
		$('#signup_new .signup-form-submit').html(translate('STORE_NEW_SIGNUP_SUBMIT'));
		$('#signup_new .signup-form-input').attr('placeholder',translate('STORE_NEW_SIGNUP_EMAIL_TEXT'));		
		$('#signup_new .signup-terms').html(translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_1') + ' <a href="'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_URL')+'">'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY')+'</a>'+ translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_2'));
		
		
		$('#signup_new .signup-form-submit').on('click', function(e){
					e.preventDefault();
					$("#signup_new input[name='email']").removeAttr("style");
					$('#signup_new .error').remove();
					
					var email = $("#signup_new input[name='email']").val();
					
					if(isValidEmailAddress(email) == false){
						$("#signup_new input[name='email']").css("border-color",'red');
						$("#signup_new .signup-form-error").html("<span class='error'>"+translate('STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG')+"</span>");
						return false;
					}
					
					$('#signup_new .signup-form-submit').hide();
					$('#signup_new .loader').show();
					
					//formtype: popout
					$.post( "https://subscribe.razerzone.com/exacttarget/signup/", { formtype: "popout-nocode", source: source, email: email, locale: locale_is_db, ap_region: locale_is_ap},
					function(data){
										if(data.success){
												if (typeof(Storage) !== "undefined") {
													localStorage.setItem("exitintent_signup", "true");
												}
												
												if(data.email_is_used != ''){
													$('#signup_new .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED')+"</p>");
												}
												else{
													$('#signup_new .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG')+"</p>");
												
													dataLayer.push({'Category': 'Razer Newsletter', 'Action': 'signup', 'Label': locale_is_db+' - Newsletter Signup- '+window.location.pathname+' - Popout'});
												}
													
												setTimeout(function(){$.magnificPopup.close();},4000);
										}
										else{
												$.each(data, function(i, val) {
													if(val == "error")
														$('#signup_new input[name="'+i+'"]').css("border-color",'red');	
												});

												$('#signup_new .signup-form-submit').show();
												$('#signup_new .loader').hide();
										}
					},'json');
		});	
	}

	function init_newsletter_content_deals(source){
		
		source = source || "deals";
				
		//Newsletter Popout For ChromaOffer and BTS Only
				
		$('#signup_new .error').remove();
		
		//Insert Input
		$('#signup_new .signup-form-container-input').html('<input type="email" name="email" placeholder="" class="signup-form-input"/>');
						
		//Update translation for POPOUT
		$('#signup_new .signup-heading').html(translate('STORE_NEW_SIGNUP_POPOUT_HEADING_2'));	
		$('#signup_new .signup-paragraph').html(translate('STORE_NEW_SIGNUP_POPOUT_PARAGRAPH_2'));	
		$('#signup_new .signup-form-submit').html(translate('STORE_NEW_SIGNUP_SUBMIT'));
		$('#signup_new .signup-form-input').attr('placeholder',translate('STORE_NEW_SIGNUP_EMAIL_TEXT'));		
		$('#signup_new .signup-terms').html(translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_1') + ' <a href="'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_URL')+'">'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY')+'</a>'+ translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_2'));
		
		
		$('#signup_new .signup-form-submit').on('click', function(e){
					e.preventDefault();
					$("#signup_new input[name='email']").removeAttr("style");
					$('#signup_new .error').remove();
					
					var email = $("#signup_new input[name='email']").val();
					
					if(isValidEmailAddress(email) == false){
						$("#signup_new input[name='email']").css("border-color",'red');
						$("#signup_new .signup-form-error").html("<span class='error'>"+translate('STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG')+"</span>");
						return false;
					}
					
					$('#signup_new .signup-form-submit').hide();
					$('#signup_new .loader').show();
					
					//formtype: popout
					$.post( "https://subscribe.razerzone.com/exacttarget/signup/", { formtype: "popout-nocode", source: source, email: email, locale: locale_is_db, ap_region: locale_is_ap},
					function(data){
										if(data.success){
												if (typeof(Storage) !== "undefined") {
													localStorage.setItem("exitintent_signup", "true");
												}
												
												if(data.email_is_used != ''){
													$('#signup_new .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED')+"</p>");
												}
												else{
													$('#signup_new .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_2')+"</p>");
												
													dataLayer.push({'Category': 'Razer Newsletter', 'Action': 'signup', 'Label': locale_is_db+' - Newsletter Signup- '+window.location.pathname+' - Deals Popout'});
												}
													
												setTimeout(function(){$.magnificPopup.close();},4000);
										}
										else{
												$.each(data, function(i, val) {
													if(val == "error")
														$('#signup_new input[name="'+i+'"]').css("border-color",'red');	
												});

												$('#signup_new .signup-form-submit').show();
												$('#signup_new .loader').hide();
										}
					},'json');
		});	
	}
	
	
	function init_newsletter_exit_content(source){
		
		source = source || "popout-exit";
				
		//Exit Intent Popout For Other Pages Except ChromaOffer and BTS 
		
		$('#signup_new_exit .error').remove();
		
		//Insert Input
		$('#signup_new_exit .signup-form-container-input').html('<input type="email" name="email" placeholder="" class="signup-form-input"/>');
						
		//Update translation for EXIT POPOUT
		$('#signup_new_exit .signup-heading').html(translate('STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING'));	
		$('#signup_new_exit .signup-paragraph').html(translate('STORE_NEW_SIGNUP_POPOUT_PARAGRAPH'));	
		$('#signup_new_exit .signup-form-submit').html(translate('STORE_NEW_SIGNUP_SUBMIT'));
		$('#signup_new_exit .signup-form-input').attr('placeholder',translate('STORE_NEW_SIGNUP_EMAIL_TEXT'));		
		$('#signup_new_exit .signup-terms').html(translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_1') + ' <a href="'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_URL')+'">'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY')+'</a>'+ translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_2'));
		
		
		$('#signup_new_exit .signup-form-submit').on('click', function(e){
					e.preventDefault();
					$("#signup_new_exit input[name='email']").removeAttr("style");
					$('#signup_new_exit .error').remove();
					
					var email = $("#signup_new_exit input[name='email']").val();
					
					if(isValidEmailAddress(email) == false){
						$("#signup_new_exit input[name='email']").css("border-color",'red');
						$("#signup_new_exit .signup-form-error").html("<span class='error'>"+translate('STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG')+"</span>");
						return false;
					}
					
					$('#signup_new_exit .signup-form-submit').hide();
					$('#signup_new_exit .loader').show();
					
					//formtype: popout-exit
					$.post( "https://subscribe.razerzone.com/exacttarget/signup/", { formtype: "popout-nocode", source: source, email: email, locale: locale_is_db, ap_region: locale_is_ap},
					function(data){
										if(data.success){	
												if (typeof(Storage) !== "undefined") {
													localStorage.setItem("exitintent_signup", "true");
												}
												
												if(data.email_is_used != ''){
													$('#signup_new_exit .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED')+"</p>");
												}
												else{
													$('#signup_new_exit .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG')+"</p>");
												
													dataLayer.push({'Category': 'Razer Newsletter', 'Action': 'signup', 'Label': locale_is_db+' - Newsletter Signup- '+window.location.pathname+' - Exit Popout'});
												}
													
												setTimeout(function(){$.magnificPopup.close();},4000);
										}
										else{
												$.each(data, function(i, val) {
													if(val == "error")
														$('#signup_new_exit input[name="'+i+'"]').css("border-color",'red');	
												});

												$('#signup_new_exit .signup-form-submit').show();
												$('#signup_new_exit .loader').hide();
										}
					},'json');
		});	
	}
	
	function init_newsletter_exit_content_deals(source){
		
		source = source || "deals-exit";
				
		//Exit Intent Popout For ChromaOffer and BTS Only 
		
		$('#signup_new_exit .error').remove();
		
		//Insert Input
		$('#signup_new_exit .signup-form-container-input').html('<input type="email" name="email" placeholder="" class="signup-form-input"/>');
						
		//Update translation for EXIT POPOUT
		$('#signup_new_exit .signup-heading').html(translate('STORE_NEW_SIGNUP_EXIT_POPOUT_HEADING'));	
		$('#signup_new_exit .signup-paragraph').html(translate('STORE_NEW_SIGNUP_EXIT_POPOUT_PARAGRAPH_2'));	
		$('#signup_new_exit .signup-form-submit').html(translate('STORE_NEW_SIGNUP_SUBMIT'));
		$('#signup_new_exit .signup-form-input').attr('placeholder',translate('STORE_NEW_SIGNUP_EMAIL_TEXT'));		
		$('#signup_new_exit .signup-terms').html(translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_1') + ' <a href="'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_URL')+'">'+translate('STORE_NEW_SIGNUP_PRIVACY_POLICY')+'</a>'+ translate('STORE_NEW_SIGNUP_PRIVACY_POLICY_2'));
		
		
		$('#signup_new_exit .signup-form-submit').on('click', function(e){
					e.preventDefault();
					$("#signup_new_exit input[name='email']").removeAttr("style");
					$('#signup_new_exit .error').remove();
					
					var email = $("#signup_new_exit input[name='email']").val();
					
					if(isValidEmailAddress(email) == false){
						$("#signup_new_exit input[name='email']").css("border-color",'red');
						$("#signup_new_exit .signup-form-error").html("<span class='error'>"+translate('STORE_NEW_SIGNUP_VALIDATION_EMAIL_MSG')+"</span>");
						return false;
					}
					
					$('#signup_new_exit .signup-form-submit').hide();
					$('#signup_new_exit .loader').show();
					
					//formtype: popout-exit
					$.post( "https://subscribe.razerzone.com/exacttarget/signup/", { formtype: "popout-nocode", source: source, email: email, locale: locale_is_db, ap_region: locale_is_ap},
					function(data){
										if(data.success){	
												if (typeof(Storage) !== "undefined") {
													localStorage.setItem("exitintent_signup", "true");
												}
												
												if(data.email_is_used != ''){
													$('#signup_new_exit .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_EMAIL_IS_USED')+"</p>");
												}
												else{
													$('#signup_new_exit .newsletter-signup-container').html("<p class='thankyou'>"+translate('STORE_NEW_SIGNUP_VALIDATION_THANKYOU_MSG_2')+"</p>");
												
													dataLayer.push({'Category': 'Razer Newsletter', 'Action': 'signup', 'Label': locale_is_db+' - Newsletter Signup- '+window.location.pathname+' - Deals Exit Popout'});
												}
													
												setTimeout(function(){$.magnificPopup.close();},4000);
										}
										else{
												$.each(data, function(i, val) {
													if(val == "error")
														$('#signup_new_exit input[name="'+i+'"]').css("border-color",'red');	
												});

												$('#signup_new_exit .signup-form-submit').show();
												$('#signup_new_exit .loader').hide();
										}
					},'json');
		});	
	}
	
	
	function init_newsletter_exit_promo_content(){
						
		//Update translation for EXIT POPOUT PROMO
		$('#signup_new_exit_promo .signup-heading').html(translate('STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_HEADING'));	
		$('#signup_new_exit_promo .signup-paragraph').html(translate('STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_PARAGRAPH'));	
		$('#signup_new_exit_promo .exit_promo_bttn').html(translate('STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_CTA'));
		$('#signup_new_exit_promo .exit_promo_bttn').attr('href',translate('STORE_NEW_SIGNUP_EXIT_PROMO_POPOUT_URL'));		
		$('#signup_new_exit_promo .newsletter-signup-container').css('text-align','center');		
		
		$('#signup_new_exit_promo .newsletter-signup-container .signup-paragraph').css('font-size','1.5em').css('line-height','1em').css('color','white');
		
	}
	
	//COUPON GIVE 10 GET 10
	
	function init_referral_coupon_content(coupon, expiry_date){
						
		//Update translation for Referral Coupon
		$('#signup_new_referral_coupon .signup-heading').html(translate('STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_HEADING'));	
		$('#signup_new_referral_coupon .signup-paragraph').html(translate('STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_PARAGRAPH'));	
		$('#signup_new_referral_coupon .coupon_code').html(coupon);		
		$('#signup_new_referral_coupon .signup_new_referral_coupon_cta').html(translate('STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_CTA'));				
		$('#signup_new_referral_coupon .signup_new_referral_coupon_cta').attr('href','./store');		
		$('#signup_new_referral_coupon .signup-terms').html(translate('STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_TERMS'));		
		$('#signup_new_referral_coupon .signup-terms .expiry-date').html(expiry_date);
	}
	
	function init_referral_coupon_content_expired(){
		
		//Update Referral Coupon Expired Message
		$('#signup_new_referral_coupon .signup-heading').html(translate('STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_EXPIRE_MESSAGE'));
		$('#signup_new_referral_coupon .signup-paragraph').hide();	
		$('#signup_new_referral_coupon .coupon_code').hide();	
		$('#signup_new_referral_coupon .shop_now').hide();				
		$('#signup_new_referral_coupon .signup-terms').hide();
	}
	
	if (typeof(Storage) !== "undefined") {
		if(sessionStorage.infl_status == "give-10-get-10" && infl_getParameter('infl_status') == "give-10-get-10" && locale_is == 'us-en' ){
			var salt = sessionStorage.infl_status;
			
			if(localStorage.getItem('infl_coupon_'+salt)){
				var coupon = localStorage.getItem('infl_coupon_'+salt);
				coupon = coupon.split("|");				
				expiry_date = infl_decode(coupon[1]);
				coupon = infl_decode(coupon[0]);
				expiry_date = expiry_date.split("|");
				expiry_timestamp = parseInt(expiry_date[1]) * 1000;
				expiry_date = expiry_date[0];
				
				//Check time expiry
				var dateobj = new Date();
				var now_timestamp = dateobj.getTime();
				
				if(now_timestamp <= expiry_timestamp){
					setTimeout(function(){
						$.magnificPopup.open({
						  items: {
							src: '#signup_new_referral_coupon',
							type: 'inline',
							 callbacks: {
								open: init_referral_coupon_content(coupon, expiry_date)
								}
							}
						});
					}, 2000);
					
				}
				else{
					setTimeout(function(){
						$.magnificPopup.open({
						  items: {
							src: '#signup_new_referral_coupon',
							type: 'inline',
							 callbacks: {
								open: init_referral_coupon_content_expired()
								}
							}
						});
					}, 2000);
				}
			}
			else{
					try{
						//Get Referral Coupon Code
						var coupon = "";
												
						$.post( "https://www2.razerzone.com/?ACT=34&action=newsletter_signup_2", { formtype: "popout-referral", locale: locale_is_db, ap_region: ''},
						function(data){
								if(data.success){
										coupon = data.code;
										expiry_date = data.expiry;
										expiry_date = expiry_date.split("|");
										expiry_timestamp = expiry_date[1];
										expiry_date = expiry_date[0];
										
										localStorage.setItem('infl_coupon_'+salt, infl_encode(salt,coupon)+'|'+infl_encode(salt,data.expiry));
										
										$.magnificPopup.open({
										  items: {
											src: '#signup_new_referral_coupon',
											type: 'inline',
											 callbacks: {
												open: init_referral_coupon_content(coupon, expiry_date)
												}
											}
										});
								}
						},'json');
					}
					catch(error){
						//Sorry Failed
					}
			}
		}
	}

	function infl_decode(message){
		try{
			return window.atob(window.atob(message.substring(2)).substring(5)).substring(4);
		}
		catch(error){
			return false;
		}
	}

	function infl_encode(salt,message){
		try{
			return window.btoa(salt)[2]+window.btoa(message)[2]+window.btoa(window.btoa(message)[0]+window.btoa(salt)[0]+window.btoa(salt)[1]+window.btoa(message)[1]+window.btoa(salt)[1]+window.btoa(window.btoa(message)[1]+window.btoa(salt)[2]+window.btoa(salt)[0]+window.btoa(message)[0]+message));
		}
		catch(error){
			return false;
		}
	}
	
	//For /store Category Nav Bar and Hybris Category Pages
	function navbarcat_custom_add_signup(){
		if(typeof translate !== "undefined" && typeof translate('STORE_NEW_SIGNUP_LINK_TEXT') !== "undefined" ){
			var url_locale = (locale_is == 'us-en') ? '' : '/'+locale_is;
			$('.navbarcat-custom ul.navbarcat-nav').append('<li class="icon-signup"><a class="signup-popout" rel="external" href="'+url_locale+'/newsletter"><i></i><div><span>'+translate('STORE_NEW_SIGNUP_LINK_TEXT')+'</span></div></a></li>');
		}
	}

	//HSS100
	function init_hss_100(){
						
		//Update translation for Referral Coupon
		$('#signup_new_referral_coupon .signup-heading').html('RAZER BLADE EXCLUSIVE OFFER');	
		$('#signup_new_referral_coupon .signup-paragraph').html('Recieve a gift with your Razer Blade laptop today.<br>Use code at checkout: <style>.newsletter-signup{background-image:url("https://assets2.razerzone.com/images/store/signup/blade-background.jpg") !important;}</style>');	
		$('#signup_new_referral_coupon .coupon_code').html('100');		
		$('#signup_new_referral_coupon .signup_new_referral_coupon_cta').html(translate('STORE_NEW_SIGNUP_POPOUT_REFERRAL_COUPON_CTA'));				
		$('#signup_new_referral_coupon .signup_new_referral_coupon_cta').attr('href','./store');
		$('#signup_new_referral_coupon .signup_new_referral_coupon_cta').one('click',function(e){e.preventDefault(); $.magnificPopup.close();});
		$('#signup_new_referral_coupon .signup-terms').html('Offer is valid on select Razer Blade laptops. Ends on December 16, 2017.');		
		$('#signup_new_referral_coupon .signup-terms .expiry-date').html('');
	}

	if(window.location.href.indexOf('/gaming-laptops') != -1 && location.hash == '#hss100' && locale_is == 'us-en'){
		setTimeout(function(){
		$.magnificPopup.open({
		  items: {
			src: '#signup_new_referral_coupon',
			type: 'inline',
			 callbacks: {
				open: init_hss_100()
				}
			}
		});
		}, 500);
	}
});

}
catch(err){
	//Error
}