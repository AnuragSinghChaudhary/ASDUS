if(typeof CQ!="undefined"){CQ.form.rte.plugins.customRTEPlugin=CQ.Ext.extend(CQ.form.rte.plugins.Plugin,{customRTEDialog:null,customRTEtext:null,envEditContext:null,constructor:function(editorKernel){CQ.form.rte.plugins.customRTEPlugin.superclass.constructor.call(this,editorKernel);},getFeatures:function(){return["customRTEpicker"];},initializeUI:function(tbGenerator){var plg=CQ.form.rte.plugins;var ui=CQ.form.rte.ui;if(this.isFeatureEnabled("customRTEpicker")){this.checkTextUI=new ui.TbElement("customRTEpicker",this,true,this.getTooltip("customRTEpicker"));tbGenerator.addElement("addcustomRTEPlugin",plg.Plugin.SORT_LISTS,this.checkTextUI,10);}},notifyPluginConfig:function(pluginConfig){pluginConfig=pluginConfig||{};CQ.Util.applyDefaults(pluginConfig,{"tooltips":{"customRTEpicker":{"title":"customRTE plugin","text":"customRTE plugin text"}}});this.config=pluginConfig;},execute:function(id,value,env){switch(id){case"customRTEpicker":this.envEditContext=env.editContext;this.getYourData();break;}},getYourData:function(){this.customRTEtext="custom RTE Plugin";this.callDialog(this.envEditContext);},callDialog:function(context){if(CQ.Ext.isIE){this.savedRange=context.doc.selection.createRange();}
var editorKernel=this.editorKernel;var configdialog={"editContext":context,"title":CQ.I18n.getMessage("Custom RTE Plugin"),"customRTEtext":this.customRTEtext,"insertContentIntoRTE":this.insertContentIntoRTE.createDelegate(this),"editorKernel":editorKernel,"listeners":{"show":function(){editorKernel.fireUIEvent("dialogshow");},"hide":function(){editorKernel.fireUIEvent("dialoghide");}}};this.customRTEDialog=new CQ.form.rte.plugins.addcustomRTEDialog(configdialog);this.customRTEDialog.setPosition(this.editorKernel.calculateWindowPosition("left"));this.customRTEDialog.show();window.setTimeout(function(){this.customRTEDialog.toFront();this.customRTEDialog.focus();}.createDelegate(this),10);},insertContentIntoRTE:function(context,options,dialog){var selectionDef=this.editorKernel.analyzeSelection();var nodelist=selectionDef["nodeList"];if(nodelist.nodes.length>1){var nodes=nodelist.nodes;var node,nodeDom,nodeText;var selectedText="";for(item in nodes){item=parseInt(item);if(!isNaN(item)){node=nodes[item];nodeDom=node.dom;nodeText=nodeDom.nodeValue||nodeDom.innerText;selectedText+=nodeText;}}}else{var node=nodelist["nodes"][0];var nodeDom=node["dom"];var nodeText=nodeDom["nodeValue"];var selectedText=nodeText.substring(node["startPos"],node["startPos"]+node["charCnt"]);}
var style="style= '";for(var opt in options){if(opt!=undefined&&opt!=""&&opt!='remove'&&opt!='indexOf'){color=options[opt].value;style+=options[opt].property+":"+options[opt].value+"; ";}}
var htmlCode="<n-span "+style+"'>"+selectedText+"</n-span>";this.editorKernel.execCmd("inserthtml",htmlCode);dialog.hide();convertTag($("iframe").contents().find("#CQrte span"),"n-span")},execCancel:function(){},updateState:function(selDef){}});CQ.form.rte.plugins.PluginRegistry.register("addcustomRTEPlugin",CQ.form.rte.plugins.customRTEPlugin);}
if(typeof CQ!="undefined"){CQ.form.rte.plugins.addcustomRTEDialog=CQ.Ext.extend(CQ.Ext.Window,{editContext:null,insertContentIntoRTE:null,constructor:function(config){var dialogRef=this;var dialogItems=[];var buttonItems=[];var defaults={"title":"Custom RTE Plugin"};CQ.Util.applyDefaults(config,defaults);CQ.Ext.apply(this,config);var defaults={defaultColor:"",defaultBgColor:"",defaultFontSize:"",defaultLineHeight:""}
var nodes=config.editorKernel.analyzeSelection().nodeList.nodes;if(nodes.length===1&&nodes[0].dom.parentElement.tagName!=="P"){defaults.defaultColor=RGBToHex($(nodes[0].dom.parentNode).css("color"))||defaults.defaultColor,defaults.defaultBgColor=RGBToHex($(nodes[0].dom.parentNode).css("background-color"))||defaults.defaultBgColor,defaults.defaultFontSize=$(nodes[0].dom.parentNode).css("font-size").replace(/[^0-9.]/g,"")||defaults.defaultFontSize,defaults.defaultLineHeight=$(nodes[0].dom.parentNode).css("line-height").replace(/[^0-9.]/g,"")||defaults.defaultLineHeight}
dialogItems.push({"itemId":"colorPickerField","name":"colorPickerField","xtype":"colorfield","fieldLabel":"Font Color","showHexValue":true,"emptyText":"TYPE HEX","defaultColor":defaults.defaultColor,"fieldDescription":"Please select a font color or type the hex code without '#' to apply the color"});dialogItems.push({"itemId":"highlightText","name":"highlightText","xtype":"colorfield","fieldLabel":"Highlight Color","showHexValue":true,"emptyText":"TYPE HEX","defaultColor":defaults.defaultBgColor,"fieldDescription":"Please select a highlight color or type the hex code without '#' to apply the color"});dialogItems.push({"itemId":"lineHeight","name":"lineHeight","xtype":"numberfield","fieldLabel":"Line Height","value":defaults.defaultLineHeight,"fieldDescription":"Please provide a line height Ex:150 (value is taken in px)"});dialogItems.push({"itemId":"fontSize","name":"fontSize","xtype":"numberfield","fieldLabel":"Font Size","allowDecimals":false,"allowNegative":false,"value":defaults.defaultFontSize,"fieldDescription":"Please provide a font-size Ex:16 (value is taken in px)"});buttonItems.push({"itemId":"ok","name":"ok","text":"OK","handler":function(){this.applyDialog(this.insertContentIntoRTE,null);},"scope":this});buttonItems.push({"text":"Cancel","handler":function(){if(this.cancelFn){this.cancelFn();}
this.hide();},"scope":this});CQ.form.rte.plugins.addcustomRTEDialog.superclass.constructor.call(this,{"renderTo":CQ.Util.ROOT_ID,"title":this.title,"stateful":false,"minWidth":400,"minHeight":170,"width":400,"height":310,"plain":true,"layout":"fit","items":[{"xtype":"panel","layout":"fit","stateful":false,"items":[{"border":false,"xtype":"form","itemId":"ColorPickerForm","name":"ColorPickerForm","stateful":false,"autoHeight":true,"items":dialogItems,"bodyStyle":"overflow: auto;","afterRender":function(){CQ.Ext.Panel.prototype.afterRender.call(this);dialogRef.findItems=this.items;}}]}],"buttons":buttonItems,"modal":true});},applyDialog:function(fn,options){options=options||[];if(fn){var colorPickerTextValue=this.findItems.get("colorPickerField").getValue();var highlightTextValue=this.findItems.get("highlightText").getValue();var fontsizeVal=this.findItems.get("fontSize").getValue();var lineHeightVal=this.findItems.get("lineHeight").getValue();if(/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(colorPickerTextValue)){options.push({property:"color",value:"#"+colorPickerTextValue})}
if(/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(highlightTextValue)){options.push({property:"background-color",value:"#"+highlightTextValue})}
if(typeof lineHeightVal==="number"){options.push({property:"line-height",value:lineHeightVal+"px"})}
if(typeof fontsizeVal==="number"){options.push({property:"font-size",value:fontsizeVal+"px"})}
fn(this.editContext,options,this);}},cancelFn:function(){}});}