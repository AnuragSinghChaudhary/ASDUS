!function(t,e,n){"use strict";function o(t,e,n,o,a,r,i,c,s,l,g){function u(){C.savedLocations=[],C.recentLocations=[],C.userLocations=[];var t=r.savedLocations.list;t.length&&d(t).then(function(t){C.savedLocations=t});var e=r.recentLocations.list;e.length&&d(e).then(function(t){C.recentLocations=t});var n=t.concat(e);n.length&&d(n).then(function(t){C.userLocations=t})}function d(t){var e=l.defer(),o=[],r={},i={};return n.each(t,function(t){var e=t.getGeocode();if(!e||0===e.split(",")[0].length||0===e.split(",")[0].length)return void m.error("The location does not has geoCode",t);var n={currentLocation:{lat:t.data.lat,"long":t.data["long"]},isShowPollen:c.isAddPollenAlert};i[e]=new g(e),o.push(i[e].execute()),o.push(a.getTurboAlerts(n)),r[e]=o.length-1}),l.all(o).then(function(o){var a=[];n.each(t,function(t){var e=t.getGeocode();if(e&&0!==e.split(",")[0].length&&0!==e.split(",")[0].length){var n=o[r[e]],c=h(t,i[e]);c.alert={count:n.length,severityCode:n[0]&&n[0].severity},a.push(c)}}),e.resolve(a)}),e.promise}function h(t,e){var n;return t&&(n=f(t)),{locUrl:c.weatherTodayUrl+t.getFullLocId(),fullLocId:t.getFullLocId(),skyCode:e?e.getSkyCode():_NO_SKY_CODE,noData:e?"":_NO_DATA,noSkyCode:e?"":_NOT_AVAILABLE_STR,temp:e?e.getTemp():_NOT_AVAILABLE_STR,tempUnit:e?e.getTempUnit():_NOT_AVAILABLE_STR,label:n,curWeather:e?e.getWeatherDescription():"",locObj:t.attrs}}function f(t){var e="N/A";return e=t.data?t.data.tag?t.data.tag.toUpperCase():t&&!n.isEmpty(t.getNickname())?t.getNickname():p(t):t.attrs?t.attrs.tag?t.attrs.tag.toUpperCase():t&&t.getNickname()&&0!==t.getNickname().length?t.getNickname():p(t):t.tag?t.tag.toUpperCase():t&&t.nickname&&0!==t.nickname.length?t.nickname:v(t)}function p(t){if(t){var e;return e=t.recentSearch?t.getFormattedName():"us"===t.getCountryCode().toLowerCase()?t.getCity()+", "+t.getStateCode():t.getCity()+", "+n.capitalize(t.getCountry(),!0)}}function v(t){if(t){var e;return e="us"===t.cntryCd.toLowerCase()?L(t.cityNm)+", "+t.stCd:L(t.cityNm)+", "+n.capitalize(t._country,!0)}}function L(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}var m=e.$log.getInstance("gm_header_savedlocations"),C=(s("pfTranslate")("N/A",{context:"weather_terms"}),this);C.moduleId=c.module_id,C.userLocations=[],C.settings=c,C.tempUnitChanged=function(){location.reload()},C.notifyLink=c.isAddNotificationToggle,i.getEvent("pcoReady").then(function(){u()});var _=i.getEvent("profileLocationsLoaded");_&&_.progress(function(){u()}),r.recentLocations.subscribeListChanged(function(){u()}),r.savedLocations.subscribeListChanged(function(){u()})}t.module("gm_header_savedlocations").controller("twc_gm_header_savedlocations_controller",o),o.$inject=["$injector","$scope","twcUtil","pcoUser","glomoAlertFactory","gmLocations","customEvent","settings","$filter","$q","ObservationTurboModel"]}(angular,jQuery,TWC);
//# sourceMappingURL=/sites/all/modules/glomo/modules/gm_header_savedlocations/gm_header_savedlocations.controller.min.js.map
