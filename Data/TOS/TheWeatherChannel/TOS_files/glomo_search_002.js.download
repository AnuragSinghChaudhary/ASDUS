angular.module("glomo_search").controller("twc_glomo_search_controller",["$scope","$timeout","$controller","$filter","$q","$window","DrupalSettings","settings","dsxclient","httpclient","twcConfig","pcoUser","twcUtil","customEvent","aliases","twcConstant","$injector","logger",function(e,t,r,o,l,c,a,s,n,i,u,g,d,p,h,f,y,m){"use strict";r("glomoBaseSearchController",{$scope:e});var v=e.params;v.resultLimit=s&&s.resultLimit?parseInt(s.resultLimit):10,v.suppressRecentSearches=!(!s||!s.suppress_recent_searches)&&JSON.parse(s.suppress_recent_searches),v.destUrl=s.destUrl,v.profileUrl=s.profileUrl,v.settings=s,v.moduleId=s.module_id;var S=!1;e.createLocArray(s.loc_type);var C=function(e){c.location.href=s.enhancedUrl+"?where="+e+"&loctypes="+v.locTypes+"&from="+v.moduleId},L=function(e){c.location.href=f.pageUrl[v.moduleId].page+e+"&loctypes="+f.locTypes.Ski+"&from="+v.moduleId},w=TWC&&TWC.Titan&&TWC.Titan.locale||TWC&&TWC.Configs&&TWC.Configs.dsx&&TWC.Configs.dsx.locale||"en_US",T=function(t,r){U.apply(e,[r,"deferLandingPage"])},U=function(t,r){var l=t.getKey&&t.getKey()||t.getFullLocId&&t.getFullLocId();if(t&&t.data&&!o("twcFilter").getByProperty("key",l,e.getRecentSearches())&&!o("twcFilter").getByProperty("key",l,e.getSavedLocations())){var c=e.getRecentSearches();p.getEvent("locations_changed").progress(function(o){(10===o.locations.length||o.locations.length>c.length)&&e[r](t)}),e.saveRecentSearch(t)}else e[r](t)},_=function(t){!t||o("twcFilter").getByProperty("loc",t,e.getRecentSearches())||o("twcFilter").getByProperty("loc",t,e.getSavedLocations())||e.getLocationByLocId(t).then(function(r){var o=r.getModel({recordType:"wxd",recordName:v.wxdRecords.loc,locale:w,fullLocId:t});o?T(t,e.getXwebLocFromLoc(o)):C(t)},function(e){})},$=function(e,t){if(e&&e.result&&e.result===v.noResult)return null;var r=t.indexOf(",")>0?t.split(","):t.split(" "),o=e.getCountryCode().toLowerCase(),l="us"===o?e.getStateCode().toLowerCase():e.getCountry().toLowerCase();return angular.forEach(r,function(e,t){r[t]=e.trim()}),0===jQuery.inArray(e.getCity().toLowerCase(),r)&&1===jQuery.inArray(l,r)||1===jQuery.inArray(o,r)?e.getKey():null},b=function(e){var t=e.toLowerCase();return 2===e.length&&h.state[t]?t:null};e.goSelectItem=function(t){if(t){m.debug("should go to today page if location is big city or an exactly match otherwise go to multi-results page.");var r="",o="",l=e.term.toLowerCase();if(e.term=t.autoSelect?l:t.getFormattedName(e.$root.isMobile),!t.result&&(!t.autoSelect||t.autoSelect&&t.isBigCity()||1===e.results.length||t.getLocType()===f.locTypes.Airports&&3===l.length))0===l.length?(r="recentsearchresolved",o="recentsearch"):(r=t.autoSelect?"localsearch":"typeahead",o=t.autoSelect?"localsearchresolved":"typeaheadresolved"),e.tracking(r,o),T(t.getKey(),t);else if(2===v.minChar&&b(l))e.tracking("localsearch","localsearchresolved"),L(l);else if(h.specialty[l])e.tracking("localsearch","localsearchresolved"),_(h.specialty[l]);else{var c=$(t,l);c?(e.tracking("localsearch","localsearchresolved"),T(c,t)):(o=t.result?"localsearcherror":"localsearchresults",e.tracking("localsearch",o),C(l))}}},e.showRecentSearches=function(){var t=e.params.suppressRecentSearches;return e.$root.isMobile&&t&&(e.results=e.getSavedLocations()),t===!0?"Suppressed":"Recent"},e.validatePageUrl=function(t){t=e.ensureUrlSlash(v.destUrl)},e.deferLandingPage=function(t){var r="object"==typeof t?t.getKey():t;c.location.href=e.ensureUrlSlash(v.destUrl)+r};var x=o("pfTranslate");e.placeHolder=x("Search city, zip or place",{context:"glomo_base_search"}),e.term="",e.fromString=v.moduleId+"typeahead",e.config=[{recordType:"xweb",locale:w,recordName:v.xwebRecords.webLoc,locTypes:""}],e.manageLocations=function(){c.location.href=v.profileUrl&&""!==v.profileUrl?v.profileUrl:"/life/profile"},e.validate=function(e){var t=scope.$$childHead,r=!0;return m.debug("go search"),e===scope.placeholderText&&(r=!1,t.$apply(function(){t.isValid=!1})),r},e.getLocTypes=function(){return v.locTypes},e.searchVis=function(){return S},e.toggleVis=function(){S=!S}}]);
//# sourceMappingURL=/sites/all/modules/glomo/modules/glomo_search/glomo_search.controller.min.js.map
