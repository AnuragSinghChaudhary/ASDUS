/*
 https://fareharbor.com/about/licenses/
*/
window.FH_VERSION="0.9.0.1";
(function(){window.configure=function(n){var c=window.slipstream?window.slipstream.configuration:"unknown";n.factory("$exceptionHandler",["Raven",function(g){return function(k,e){var d=_.isArray(k.stack)?k.stack.join("\n"):k.stack;window.slipstream&&window.slipstream.isSentryClientSideEnabled&&g.captureException(k,{extra:{cause:e,message:k.message,stack:d}});if("production"!==c){var m="$exceptionHandler: uncaught exception "+k.message;e&&(m+=' (caused by "'+e+'")',k.message+=' (caused by "'+e+'")');
console.error(m,d||"(no stack trace)")}}}]);n.config(["$animateProvider","$compileProvider","$injector","$interpolateProvider","$httpProvider","$locationProvider","$sceProvider","convertProvider",function(g,k,e,d,m,a,q,h){k.debugInfoEnabled("production"!==c);a.html5Mode(!0);a.hashPrefix("!");d.startSymbol("[[");d.endSymbol("]]");d.staticStartSymbol("[!");d.staticEndSymbol("!]");m.defaults.transformResponse.push(function(a){return h.serverResponse(a)});m.defaults.transformRequest.unshift(function(a){return h.clientRequest(a)});
m.defaults.xsrfCookieName="csrftoken";m.defaults.xsrfHeaderName="X-CSRFToken";m.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";m.defaults.headers.common["X-CSRFToken"]=window.slipstream.csrfToken||"";g.classNameFilter(/\banimatable\b/)}]);n.run(["$filter","$browser","$injector","$interpolate","$rootScope",function(c,k,e,d,m){window.$$injector=e;m.max=Math.max;m.addClassIf=c("addClassIf");m.isUndefined=c("isUndefined");m.handheldsMaxWidth=window.slipstream.isEmbedded?549:679;m.$bind=
function(a,h){var b=this,f=function(){var f=_.get(b,h);_.set(b,a,f)};f();b.$watch(f)};m.$model=function(a){var h=_.bind(a,a,this);h.assign=_.bind(a.assign,a,this);return h};m.$once=function(a,h){var b=this.$on(a,function(){b();return h.apply(this,arguments)});return b};m.isSet=function(a){return _.isUndefined(a)?!1:""===a?!0:this.$eval(a)};var a=m.$new;m.$new=function(q,h){return q?a.call(this,!1,this.$root):a.call(this,q,h)};m.$safeApply=function(a){if(this.$root){var h=this.$root.$$phase;return"$apply"==
h||"$digest"==h?a&&a():this.$apply(a)}};m.$safeDigest=function(){if(this.$root){var a=this.$root.$$phase;"$apply"==a||"$digest"==a||this.$digest()}};m.$asyncApply=function(a){var h=k.defer(_.ignore,31536E6),b=function(){k.defer.cancel(h)};a(b);return b};m.$interpolate=function(a,h){var b=this,f=!1;h&&(b=b.$new(),_.extend(b,h),f=!0);if(_.isUndefined(a))return"";var A=d(a);if(!A)return"";A=A(b);f&&b.$destroy();return A};window.$$digest=function(a,h){var b=angular.element(document.querySelector("[ng-app]"));
h=h||b.injector().get("$rootScope");a=a||100;console.info("digest: running "+a+"...");for(var b=performance.now(),f=0;f<a;f++)h.$digest();f=performance.now();console.info("digest: average time "+(f-b)/a+"ms");var b=0,f=h,A;do if(b+=f.$$watchers?f.$$watchers.length:0,!(A=f.$$childHead||f!==h&&f.$$nextSibling))for(;f!==h&&!(A=f.$$nextSibling);)f=f.$parent;while(f=A);console.info("digest: watcher count",b)};window.$$scope=function(a){return angular.element(a).scope()}}])}})();angular.module("lib","lib.controllers lib.directives lib.filters lib.factories lib.services lib.services.interpolate".split(" "));
(function(){var n=angular.module("lib.directives",[]),c={isTouchEnabled:"ontouchstart"in window||navigator.msMaxTouchPoints,isTextInput:function(a){return a.is("input")&&_.isUndefined(a.attr("type"))||a.is('input[type="text"], input[type="password"], input[type="email"], input[type="tel"], input[type="number"], input[type="url"], input[type="search"], textarea')},bind:function(a,h,b){a.$watch(b,function(b){a[h]=b})},watcher:function(a,h,b,f,A){var c=a.$eval(h);a.$watch(h,function(a){c=a;f&&f(c)},
A);return function(){return!_.isUndefined(c)?c:b}},observer:function(a,h,b,f){var A;A=a[h];a.$observe(h,function(a){A=a;f&&f(A)});return function(){if(!_.isUndefined(A))return A;if(!_.isUndefined(b))return b;throw Error("d: undefined attribute "+h+" for observer");}},restrictKeypresses:function(a,h){a.on("keypress",function(a){if(a.which&&(!a.metaKey&&!a.controlKey&&!a.altKey)&&!(8===a.which||9===a.which||13===a.which)){var f=String.fromCharCode(a.which);h.test(f)||a.preventDefault()}})},safeInvoke:function(a,
h){return _.isArray(h)?a.invoke(h):h},conditionalDirective:function(a){a=_.extend({operator:_.constant(_.identity),link:_.constant(_.ignore),transclude:_.constant(_.ignore),once:_.never},a);return["$animate","$injector",function(h,b){return _.extend({transclude:"element",priority:800,terminal:!0,restrict:"A",compile:function(f,A,w){var u=c.safeInvoke(b,a.watch),e=c.safeInvoke(b,a.operator),d=c.safeInvoke(b,a.transclude),l=c.safeInvoke(b,_.isBoolean(a.once)?_.constant(a.once):a.once);return function(b,
f,A,c){a.link(b,f,A,c);var g,k,m=u(b,f,A,c),n=d(b,f,A,c),y=e(b,f,A,c),L=b.$watch(m,function(a){g&&(h.leave(g),g=void 0);k&&(k.$destroy(),k=void 0);y(a)&&(k=b.$new(),w(k,function(a){g=a;n(k,a);h.enter(a,f.parent(),f)}));l(b,f,A)&&L()})}}},a.directiveDescription)}]},isDropdownSupported:/iP(od|hone|ad)/i.test(window.navigator.userAgent)||/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)||/BlackBerry|Windows Phone|webOS/i.test(window.navigator.userAgent)?!1:!0};n.constant("d",
c);n.config(["$provide",function(a){a.decorator("ngIfDirective",["$delegate",function(a){a.shift();return a}])}]);var g=function(a){var h=a.$modelValue;_.forEach(a.$formatters,function(a){h=a(h)});a.$viewValue=h;a.$render()},k=function(a,h){n.directive(a,[function(){return{restrict:h,priority:500,require:"form",link:function(a,f,q,h){h.$errorCallbacks=[];h.$successCallbacks=[];f.attr("novalidate","novalidate")}}}])};k("form","E");k("ngForm","A");var e=function(a,h){var b="20"+a,f=parseInt(h,10).toFixed();
if(!isNaN(f))return{month:f,year:b}},d=[{device:"MSR100U",trackSeparator:"^",fullName:function(a){var h=a.split("/");a=(h[1]||"").trim();h=(h[0]||"").trim();return a?a+" "+h:h},details:function(a){var h=/;(\d+)=(\d\d)(\d\d)/.exec(a);h||(h=/%B(\d+)=(\d\d)(\d\d)/.exec(a));if(h&&(a=h[1],h=e(h[2],h[3])))return{number:a,expiryMonth:h.month,expiryYear:h.year}}},{device:"denzer-has-a-weird-one",trackSeparator:"^",fullName:_.identity,details:function(a){var h=/;(\d+)=(\d\d)(\d\d)/.exec(a);if(h&&(a=h[1],h=
e(h[2],h[3])))return{number:a,expiryMonth:h.month,expiryYear:h.year}}},{device:"knock-off-MSR100U",trackSeparator:"",details:function(a){var h=/^(\d+)=(\d\d)(\d\d)/.exec(a);if(h&&(a=h[1],h=e(h[2],h[3])))return{number:a,expiryMonth:h.month,expiryYear:h.year}}}];n.directive("ngOverthrow",[function(){return{restrict:"A",link:function(a,h,b){h.addClass("overthrow")}}}]);n.directive("ngSticky",["$parse","$window","auth","d",function(a,h,b,f){return{restrict:"A",link:function(a,q,u){if(!a.isSet(u.ngStickyAllowTouch)&&
f.isTouchEnabled)console.info("ng-sticky: touch is enabled");else{var c=a.$eval(u.ngStickyEdgeTopMargin)||0;a.$eval(u.ngStickyEdgeBottomMargin);var e=a.$eval(u.ngStickyTopMargin)||0,l=a.$eval(u.ngStickyBottomMargin)||0,p=$(h),d=function(){var a=$(u.ngStickyContent);if(a.length){var f=b.currentUser.isAuthenticated?93:0,h=p.height()-f,A=p.scrollTop(),d=a.offset().top,a=a.outerHeight(),g=q.outerHeight();if(g>a||g>h)return q.removeClass("sticky sticky-pinned sticky-floating").css({top:"",bottom:""}),
"no-sticky";h=A+(c+f);A=d+e;d=h+g>d+a-l;a=h>A&&!d;if(h<=A)return d=e,q.removeClass("sticky-floating"),q.addClass("sticky sticky-pinned").css({top:d,bottom:""}),["sticky-pinned","top",d];if(a)return d=f+c,q.removeClass("sticky-pinned"),q.addClass("sticky sticky-floating").css({top:f+c,bottom:""}),["sticky-floating","top",d];if(d)return q.removeClass("sticky-floating"),q.addClass("sticky sticky-pinned").css({top:"",bottom:l}),["sticky-pinned","bottom",l];console.warn("ng-sticky: nothing makes sense")}},
g,k=function(){var b=d();angular.equals(g,b)||(g=b,a.$apply())};p.on("scroll",k);p.on("resize",k);a.$watch(function(){setTimeout(k)})}}}}]);n.directive("ngSwipe",[function(){return{restrict:"A",link:function(a,h,b){var f=a.$eval(b.ngSwipe),A=function(a){return _.chooseFirst(d,function(b){var f="";if(b.trackSeparator){var q=a.split(b.trackSeparator);if(3!==q.length)return;f=b.fullName(q[1]);if(_.isUndefined(f))return}else q=["","",a];b=b.details(q[2]);if(!_.isUndefined(b))return _.extend(b,{fullName:f})})};
h.on("keypress",function(b){13===b.which&&a.$apply(function(){f(A(h.val()))})});h.on("blur",function(){a.$apply(function(){f()})});h.val("");h.focus()}}}]);n.directive("ngApp",[function(){return{restrict:"A",link:function(a,h,b){$("html").removeClass("html-loading")}}}]);n.directive("ngAutoselect",["d",function(a){return{restrict:"A",link:function(h,b,f){b.attr("readonly","readonly");if(!a.isTouchEnabled){var A=!1;b.on("click",function(){b.focus();A||(b.select(),A=!0)});b.on("blur",function(){A=!1})}}}}]);
n.directive("ngAutofocus",["$timeout","d",function(a,h){var b=function(a){if(a.is("input, textarea, select"))return a;a=a.find("input, textarea, select").first();if(a.length)return a};return{restrict:"A",link:function(f,A,c){var u=f.isSet(c.ngAutofocus),e=f.isSet(c.ngAutofocusSelect),d=f.isSet(c.ngAutofocusOpen);u&&(h.isTouchEnabled?e&&a(function(){var f=b(A);if(f&&!f.is("select"))f.on("focus",function(){a(function(){f[0].setSelectionRange(0,1E3)})})}):a(function(){var a=b(A);a&&(a.hasClass("ng-dropdown")?
(a.trigger("dropdown:focus"),d&&a.trigger("dropdown:open")):(a.focus(),e&&!a.is("select")&&a.select()))}))}}}]);n.directive("ngAutoNavigate",["$location","$timeout","$window","navigation",function(a,h,b,f){return{restrict:"A",link:function(A,c,u){var e=!1;(e=u.ngAutoNavigate?A.$eval(u.ngAutoNavigate):!0)&&h(function(){var h=c.prop("href");a.$$rewrite(h)?f.navigate(h):(b.parent||window).location.href=h})}}}]);n.directive("ngCurrentOption",["$parse",function(a){return{restrict:"A",scope:!0,controller:["$scope",
"$attrs",function(h,b){var f=this,A=a(b.ngCurrentOption),c=a(b.ngCurrentOptionTarget||"currentOption"),u=a(b.ngCurrentOptionCollection),e=h.$eval(b.ngCurrentOptionKey)||"pk",d=function(a,b){var q=_.find(b,function(b){return b[e]===a});q||(q=null);c.assign(h.$parent,q);f.currentOption=q};h.$parent.$watch(A,function(a){var b=u(h);d(a,b)});h.$parent.$watch(function(){return _.pluck(u(h),"uri")},function(){var a=u(h),b=A(h);d(b,a)},!0)}],controllerAs:"currentOptionCtrl"}}]);n.directive("ngWatchHeight",
["$document","$window","db","lightframe",function(a,h,b,f){return{restrict:"A",link:function(b,h,c){var e=function(){if(a[0].body)return a[0].body.offsetHeight},d=function(a){f.updateHeight(a)};b.$watch(e,d);setInterval(function(){d(e())},2500)}}}]);n.directive("ngDimensions",["$document","$parse","$window","$rootScope","scrollbar",function(a,h,b,f,c){var e=function(){return{width:Math.max(a[0].documentElement.clientWidth,b.innerWidth||0),height:Math.max(a[0].documentElement.clientHeight,b.innerHeight||
0)}},u=function(a){return{width:a.width(),height:a.height(),outerWidth:a.outerWidth(),outerHeight:a.outerHeight()}};return{restrict:"A",link:function(a,f,q){if(!q.ngDimensionsWhen||a.$eval(q.ngDimensionsWhen)){var p=a.isSet(q.ngDimensionsViewport)?e:_.bind(u,null,f);f=h(q.ngDimensions||"dimensions");var d=p();f.assign(a,d);var g=Math.max(c.getWidth(),15);f=function(){var b=p();if(!(b.width===d.width&&b.height===d.height)){var f=d.width-b.width;0<f&&f<=g||(_.extend(d,b),a.$digest())}};var k=_.debounce(f,
0),m=_.debounce(f,250);a.$watch(k);$(b).on("resize",m);a.$on("$destroy",function(){$(b).off("resize",m);k.cancel();m.cancel()})}}}}]);n.directive("ngStyleOnce",[function(){return{restrict:"A",link:function(a,h,b){h.css(a.$eval(b.ngStyleOnce))}}}]);k=function(a){n.directive(a.name,[function(){return{restrict:"A",link:function(h,b,f){var c=a.transform||_.identity,e=a.isNumeric&&!_.isUndefined(f[a.name+"AddToInitial"]),u=function(){var l=h.$eval(f[a.name+"Selector"]);return l?$(l):b},d=f[a.name+"ForceInitialValue"]?
h.$eval(f[a.name+"ForceInitialValue"]):u().css(a.property);a.isNumeric&&(d=parseInt(d,10));if(_.isUndefined(d)||_.contains(a.emptyValues,d))d="";var g=function(b){b?(e&&d&&(b+=d),u().css(a.property,c(b))):u().css(a.property,d)};a.interpolate?f.$observe(a.name,g):h.$watch(f[a.name],g);h.$on("$destroy",function(){g()})}}}])};k({name:"ngBackgroundImage",property:"background-image",transform:function(a){return"url("+(-1===a.indexOf("Cdn")?a.replace("Url","CdnUrl"):a)+")"},emptyValues:["none"]});k({name:"ngBackgroundColor",
property:"background-color",emptyValues:["rgba(0, 0, 0, 0)","transparent"]});k({name:"ngTop",property:"top",isNumeric:!0});n.directive("ngLocation",[function(){return{restrict:"A",link:function(a,h,b){var f=function(){var a={width:h[0].offsetWidth,height:h[0].offsetHeight},b;try{b=h.position()}catch(q){b={top:0,left:0}}a={position:b,size:a};f.position=a.position;f.size=a.size;return a};a[b.ngLocation]=f}}}]);n.directive("ngScrollStatic",["$window",function(a){return{restrict:"A",link:function(h,b,
f){var c=f.ngScrollStaticContainer||"html,body",e=!f.ngScrollStaticContainer,u=h.$eval(f.ngScrollStaticPadding)||0;(function(){var b=f.ngScrollStatic;"top"===b&&(b=c);var h=$(b),b=$(c);if(h.length&&b.length){var h=_.min(_.map(h,function(a){return $(a).position().top||0})),l=_.chooseFirst(b,function(a){if(a.scrollHeight)return a.scrollHeight})||0,p=_.min(_.choose(b,function(a){if(a=$(a).height())return a}));e&&(p=Math.min(p,a.innerHeight));l=Math.max(0,l-p);h-=u;0>h?h=0:h>l&&(h=l);b.scrollTop(h)}})()}}}]);
n.directive("ngScrollTo",["$window",function(a){return{restrict:"A",link:function(h,b,f){var c=h.isSet(f.ngScrollOnClick),e=h.isSet(f.ngScrollSmooth),u=h.isSet(f.ngScrollForce),d=f.ngScrollContainer||"html,body",g=!f.ngScrollContainer,l=function(){var b=f.ngScrollTo;if(b){"top"===b&&(b="body");var h=$(b),b=$(d);if(h.length&&b.length){var h=Math.min.apply(Math,_.map(h,function(a){return $(a).offset().top||0})),l=_.chooseFirst(b,function(a){if(a=$(a).scrollTop())return a})||0,c=_.chooseFirst(b,function(a){if(a.scrollHeight)return a.scrollHeight})||
0,A=Math.min.apply(Math,_.choose(b,function(a){if(a=$(a).height())return a}));g&&(A=Math.min(A,a.innerHeight));var c=Math.max(0,c-A),l=1>Math.abs(h-l),k;0>h?(k=15,h=0):l?k=h-15:h>c&&(k=c-15,h=c);c&&(u&&!_.isUndefined(k)?b.stop().animate({scrollTop:k},250,"swing").animate({scrollTop:h},250,"swing"):e?b.stop().animate({scrollTop:h},500,"swing"):b.scrollTop(h))}}};if(c)b.on("click",function(a){l()});else l()}}}]);n.directive("ngTopScrolled",["$document",function(a){return{restrict:"A",link:function(h,
b,f){h=h.$eval(f.ngTopScrolled)||0;h=a.scrollTop()+h;b.css({top:h})}}}]);n.directive("ngWithLocation",[function(){return{restrict:"A",link:function(a,h,b){a.$watch(b.ngWithLocation,function(f){h.toggleClass("with-location",!!f);if(f){var c=0,e=0;if(b.ngWithLocationOffset)var u=a.$eval(b.ngWithLocationOffset)||{},c=u.x||c,e=u.y||e;u=a.$eval(b.ngWithLocationRight)||!1;e={top:f.position.top+e};e.left=u?f.position.left+-h[0].offsetWidth+c:f.position.left+f.size.width+c;h.toggleClass("left",!u);h.toggleClass("right",
u);h.css(e)}})}}}]);n.directive("ngTranslate",["$window","translate",function(a,h){return{restrict:"A",link:function(a,f){h.initialize(f)}}}]);var m=function(a){return a&&!_.isUndefined(a.x)&&!_.isUndefined(a.y)&&a.width&&a.height};n.directive("ngImage",["$parse",function(a){var h=function(a){return _.map(a,function(a,b){return b+"="+a.toString()}).join("&")};return{restrict:"A",compile:function(b,f){var c=a(f.ngImage),e=_.isUndefined(f.ngImageOnce)?_.always:""===f.ngImageOnce?_.always:a(f.ngImageOnce);
return function(a,b,f){var l=function(l){if(l){var q=a.$eval(f.ngImageCrop),p=a.$eval(f.ngImageSquare),c=a.$eval(f.ngImageMaxWidth),A=a.$eval(f.ngImageMaxHeight),e=a.$eval(f.ngImageMaxSize),d=a.$eval(f.ngImageWidth),w=a.$eval(f.ngImageHeight),g=a.$eval(f.ngImageFilter),k=a.$eval(f.ngImageFilterAmount),n=["blur","sharpen"],H={cache:!0,compress:!0,quality:90};m(q)&&_.extend(H,{crop:q.x.toFixed(0)+","+q.y.toFixed(0)+","+q.width.toFixed(0)+","+q.height.toFixed(0)});p&&_.extend(H,{w:p,h:p,fit:"crop"});
c&&_.extend(H,{w:c,fit:"max"});A&&_.extend(H,{h:A,fit:"max"});e&&_.extend(H,{w:e,h:e,fit:"max"});d&&_.extend(H,{w:d});w&&_.extend(H,{h:w});g&&(-1!==_.indexOf(n,g)&&k)&&(H.filter=g,H[g+"Amount"]=k);l=l+"/convert?"+h(H);b.is("img")?b.attr("src",l):b.css("background-image","url("+l+")");return l}console.warn("ng-image: no url supplied")};if(e()){var q=l(c(a));console.info("ng-image: once",q)}else a.$watch(c,function(a){a=l(a);console.info("ng-image: watch",a)})}}}}]);n.directive("ngCrop",["$parse","$timeout",
function(a,h){return{restrict:"A",require:"^form",link:function(b,f,c,e){f.attr("src",b.$eval(c.ngCrop));var u=b.$eval(c.ngCropAspectRatio)||1.9,d=a(c.ngCropModel),g=function(a){b.$safeApply(function(){var h=d(b),l=f[0].naturalWidth/f.width();h.x=Math.floor(a.x*l);h.y=Math.floor(a.y*l);h.width=Math.floor(a.w*l);h.height=Math.floor(a.h*l);e.$setDirty()})},l,p=function(){f.Jcrop({onSelect:g,keySupport:!1,aspectRatio:u},function(){l=this;var a=d(b),h=f[0].naturalWidth/f.width();if(m(a))var q=Math.floor(a.x/
h),p=Math.floor(a.y/h),c=q+Math.floor(a.width/h),a=p+Math.floor(a.height/h);else p=l.getWidgetSize(),q=p[0],p=p[1],q/u<p?(c=q,a=q/u,q=0,p=(p-a)/2):(c=p*u,a=p,q=(q-c)/2,p=0),q=Math.floor(q),p=Math.floor(p),c=q+Math.floor(c),a=p+Math.floor(a);l.setSelect([q,p,c,a])})};h(function(){p();b.$on("$destroy",function(){l&&l.destroy()})})}}}]);n.directive("ngAudio",[function(){return{restrict:"A",link:function(a,h,b){var f=b.ngAudioSrc,c;a[b.ngAudio]=function(){c||(c=$('<audio><source src="'+f+'"></audio>'),
h.append(c));c[0].load();c[0].play()};a.$on("$destroy",function(){c&&c.remove()})}}}]);n.directive("ngTip",["$parse","d",function(a,h){var b;return{restrict:"A",link:function(f,c,e){var u=e.ngTipLocation,d=e.ngTipWhen?a(e.ngTipWhen):_.always,g=$("body"),l=e.ngTipPosition;if(!h.isTouchEnabled||f.$eval(e.ngTipTouch)){b||(b=$('<span class="tip"></span>'),g.append(b));var p=function(){var a=c.attr("class")||"",a=a.split(" "),a=_.choose(a,function(a){if(a)return"tip-ele--"+a});return a=a.join(" ")},k=
function(){var a=c;if(u&&(a=c.find(u),!a.length))return;if(d(f)){var h=l?"tip-"+l:"";b.attr("class","tip").addClass(r()+" "+p()+" "+h);b.html(n());b.css({width:"auto"});var h=a.offset(),q=a.outerWidth();0===q&&a[0]instanceof SVGElement&&(q=a[0].getBoundingClientRect().width);var e=b.outerWidth(),w=b.outerHeight(),k=parseInt(g.css("top"),10)||0,m={};if("right"===l||"left"===l)a=a.outerHeight(),m.top=Math.floor(h.top+a/2-w/2)-k;"right"===l?m.left=h.left+q+8:"left"===l?m.left=h.left-e-8:(m.top=Math.floor(h.top-
w-8-k),m.left=Math.floor(Math.max(h.left+(q-e)/2,0)));b.css(m);b.addClass("showing")}},m=function(){b.attr("class","tip");b.css({top:-100,left:-100})},n=h.observer(e,"ngTip",""),r=h.observer(e,"ngTipClasses","");c.on("mouseenter",k);c.on("mouseleave",m);c.on("retip",function(){window.setTimeout(function(){if(f.$root){var a=b.hasClass("showing");m();a&&k()}})});f.$on("$destroy",m)}}}}]);n.directive("ngRadioFlyer",[function(){return{link:function(a,h,b){var f=function(a){h.find('input[type="radio"]').each(function(){var b=
$(this),f=_.isUndefined(a)?b.is(":checked"):b.val()===a;b.closest("label").toggleClass("radio-selected",f)})};b.ngRadioFlyer?a.$watch(b.ngRadioFlyer,function(a){f(a)}):a.$watch(function(){f()});a.$evalAsync(function(){f()})}}}]);n.directive("ngCheckboxMadness",[function(){return{require:"ngModel",link:function(a,h,b){a.$watch(b.ngModel,function(a){h.closest(".field").toggleClass("checkbox-selected",!!a)})}}}]);n.directive("ngSupportHacks",_.optional(["d","events","?native",function(a,h,b){return{restrict:"A",
link:function(f){var c=$("html");c.addClass(a.isTouchEnabled?"touch":"not-touch");c.addClass(b&&b.isNative?"native":"not-native");h.on(f,"fareharbor.native.inApp",function(a,b){c.addClass("native").removeClass("not-native")})}}}]));n.directive("ngBlurEscape",["$document","d",function(a,h){return{restrict:"A",link:function(b,f,c){a.on("keydown",function(a){if(27===a.which){var b=$(a.target);h.isTextInput(b)&&(a.preventDefault(),a.stopPropagation(),b.trigger("blur"))}})}}}]);n.directive("ngShortcut",
["$parse","navigation","shortcuts",function(a,h,b){return{restrict:"A",compile:function(f,c){var e=a(c.ngShortcut),u=c.ngShortcutAction?a(c.ngShortcutAction):_.ignore;return function(a,f,l){var c=e(a);if(!_.isUndefined(c)){var c=c.split("|"),q=_.ignore;a.isSet(l.ngShortcutClick)&&(q=_.then(q,function(){f.trigger("click")}));a.isSet(l.ngShortcutFocus)&&(q=_.then(q,function(){f.is("input, textarea, select")?setTimeout(function(){f.trigger("focus")}):f.find("input, textarea").first().trigger("focus")}));
if(l.ngShortcutNavigate)var A=a.$interpolate(l.ngShortcutNavigate),q=_.then(q,function(){a.$apply(function(){h.navigate(A)})});l.ngShortcutAction&&(q=_.then(q,function(){a.$apply(function(){u(a)})}));a.isSet(l.ngShortcutOnly)&&f.addClass("ng-hide");_.forEach(c,function(f){var h=b.register({keySet:f,action:q,description:l.ngShortcutDescription||""});a.$on("$destroy",function(){b.unregister(h)})})}}}}}]);n.directive("ngUnclick",["$parse",function(a){return{restrict:"A",link:function(h,b,f){var c=a(f.ngUnclick),
e=function(a){$(a.target).closest("[ng-unclick], [ng-unclick-ignore]").length||c(h)};$("html").on("click",e);h.$on("$destroy",function(){$("html").off("click",e)})}}}]);n.directive("ngGenericForm",[function(){return{link:function(a,h,b){a[b.ngGenericForm]={}}}}]);n.directive("ngSortable",[function(){return{restrict:"A",link:function(a,h,b){var f=a.$eval(b.ngSortable)||_.ignore,c=b.ngSortableHandle||".sortable-handle",e=b.ngSortableSelector||"li.sortable",u='<li class="sortable sortable-placeholder"></li>';
a.$eval(b.ngSortableTable)&&(u='<tbody><tr><td style="height: 50px"></td></tr></tbody>');b={itemSelector:e,placeHolderTemplate:u,dragEnd:function(b,h){var l=$(this),c=$(b),e=$(h),u=l.data("ng-sortable-item"),d=c.data("ng-sortable-item"),A=e.data("ng-sortable-item");u===A&&(A=null);u===d&&(d=null);return a.$apply(function(){return f(u,d,A)})}};c&&(b.dragSelector=c,b.dragSelectorExclude="input, textarea");h.dragsort(b);a.$on("$destroy",function(){h.dragsort("destroy")})}}}]);n.directive("ngSortableItem",
[function(){return{restrict:"A",link:function(a,h,b){h.data("ng-sortable-item",a.$eval(b.ngSortableItem));h.addClass("sortable")}}}]);n.directive("ngDropdown",["$interpolate","$parse","d",function(a,h,b){var f=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+group\s+by\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?$/,c=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+hide\s+when\s+([\s\S]+?))?(?:\s+disable\s+when\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+([\s\S]+?)?$/;
return{restrict:"A",require:"ngModel",compile:function(e,u){var d,g,l,p,k,m,n,r,D,B,t;if(u.ngDropdownRemoteOptions){B="remote-options-mode";d=u.ngDropdownRemoteOptions.match(c);if(!d){console.error("ngDropdown: malformed ngDropdownRemoteOptions expression.");return}k=h(d[2]||d[1]);n=d[3]?h(d[3]):null;r=d[4]?h(d[4]):null;g=d[6];l=d[5]||d[7];p=h(d[2]?d[1]:l);m=h(d[8]);t=u.ngDropdownMinimum?h(u.ngDropdownMinimum):_.constant(2)}else if(u.ngOptions){B="ng-options-mode";d=u.ngOptions.match(f);if(!d){console.error("ngDropdown: ng-options regex must match angular.");
return}g=d[5];l=d[4]||d[6];D=h(d[7])}else{console.error("ngDropdown: ngDropdownRemoteOptions or ngOptions required.");return}var y="ng-options-mode"===B&&!b.isDropdownSupported;d=u.ngPlaceholder||"Choose an option";var L=a(d),J=u.ngPlaceholderValue?h(u.ngPlaceholderValue):_.constant(null),s=u.ngDropdownCurrentOption&&h(u.ngDropdownCurrentOption),H=u.ngDropdownAllowClear&&h(u.ngDropdownAllowClear),v=h(u.ngModel);d=$("<option class='empty-option' value='' label='"+d+"'></option>");e.prepend(d);y?e.addClass("ng-dropdown-disabled"):
(e.css("width","100%"),e.addClass("ng-dropdown"));return function(a,b,f,h){var c=!H||H(a);if(y&&!c)var q=a.$watch(f.ngModel,function(a){""!==b.val()&&(b.find(".empty-option").remove(),q())});var e=J(a);h.$parsers.push(function(a){return null===a?e:a});if(!y){var d,c={minimumResultsForSearch:8,allowClear:c,placeholder:L(a)},u={};c.templateResult=function(a){var b=$("<span>"+a.text+"</span>");a=u[a.id];_.isObject(a)&&a.classes&&b.addClass(a.classes);return b};var A={},w=function(b,f,h){if(!b)return null;
g&&(A[g]=h);A[l]=f;return b(a,A)};if("remote-options-mode"===B){var C=m(a),ia=function(a,b){return{id:a.uri||a.pk.toString(),text:w(k,a,b),disabled:w(r,a,b),ngModelValue:w(p,a,b),originalValue:a}};c.minimumInputLength=t(a);c.ajax={delay:250,transport:function(a,b,f){var h=C(a.data.term);h.$promise.then(function(){b(h)},function(){f(h)});return{abort:h.$promise.cancel}},processResults:function(a){u={};var b=[];_.forEach(a,function(a,f){if(!w(n,a,f)){var h=ia(a,f);b.push(h);u[h.id]=h.ngModelValue}});
return{results:b}}};h.$parsers.unshift(function(a){return u[a]||null})}else if("ng-options-mode"===B){h={"default":function(){var b=D(a);if(_.isArray(b))if(b.length)if(_.isUndefined(b[0].label))if(_.isUndefined(b[0].uri))if(_.isUndefined(b[0].pk)){if(_.isString(b[0]))return b}else return _.pluck(b,"pk");else return _.pluck(b,"uri");else return _.pluck(b,"label");else return b;else if(_.isObject(b))return _.keys(b)},uri:function(){var b=D(a);return _.pluck(b,"uri")},pk:function(){var b=D(a);return _.pluck(b,
"pk")}}[a.$eval(f.ngDropdownWatchType)||"default"];var W=function(){window.setTimeout(function(){b.trigger("change.select2")})};a.$watch(h,function(){u=_.indexBy(D(a),function(a,b){return b.toString()});d.dataAdapter.destroy();W()},!0);a.$watch(f.ngModel,W)}h=b.closest(".ng-dropdown-context");h.length&&(c.dropdownParent=h);_.forEach(["open","focus"],function(a){b.bind("dropdown:"+a,function(){b.select2(a)})});a.$watch(f.ngDisabled,function(a){b.attr("disabled",!!a)});a.$watch(function(){return!!b.parents("fieldset[disabled]").length},
function(a){b.attr("disabled",a)});a.$on("$destroy",function(){d.destroy()});b.select2(c);d=b.data("select2");"remote-options-mode"===B&&s&&(a.$watch(s,function(a){if(!_.isUndefined(a)){var b=[];a&&b.push(ia(a));d.trigger("selection:update",{data:b})}}),a.$watch(v,function(b){b||s.assign(a,null)}),d.on("select",function(b){a.$apply(function(){s.assign(a,b.data.originalValue)})}))}}}}}]);n.directive("ngIf",c.conditionalDirective({watch:["$parse",function(a){return function(h,b,f){var c=a(f.ngIf);return function(){return!!c(h)}}}],
operator:function(a,h,b){return function(f){b.ngThen&&(a[b.ngThen]=f);return f}}}));n.directive("ngIfOnce",c.conditionalDirective({watch:["$parse",function(a){return function(h,b,f){var c=a(f.ngIfOnce);return function(){return!!c(h)}}}],operator:function(a,h,b){return function(f){b.ngThen&&(a[b.ngThen]=f);return f}},once:!0}));n.directive("ngIfInLabs",c.conditionalDirective({watch:["labs",function(a){return function(h,b,f){return function(){var b=f.ngIfInLabs.replace("!",""),c=f.ngIfInLabsVariation,
e=0===f.ngIfInLabs.indexOf("!"),b=a.isInVariation(b,c);f.ngThen&&(h[f.ngThen]=b);return e?!b:b}}}]}));n.directive("ngElse",c.conditionalDirective({watch:["$parse",function(a){return function(h,b,f){var c=a(f.ngElse);return function(){return!c(h)}}}]}));n.directive("ngElseOnce",c.conditionalDirective({watch:["$parse",function(a){return function(h,b,f){var c=a(f.ngElseOnce);return function(){return!c(h)}}}],once:!0}));n.directive("ngWatch",c.conditionalDirective({watch:["$parse",function(a){return function(h,
b,f){return a(f.ngWatch)}}],operator:_.constant(_.always),transclude:["$parse",function(a){return function(h,b,f){var c=a(f.ngWatchAction)||_.ignore;return function(){c(h)}}}]}));n.directive("ngInterval",[function(){return{link:function(a,h,b){h=a.$eval(b.ngInterval)||1;var f=setInterval(function(){a.$digest()},1E3*h);a.$on("$destroy",function(){clearInterval(f)})}}}]);n.directive("ngData",["$q",function(a){return{scope:!0,transclude:!0,templateUrl:"ng-data",controllerAs:"dataCtrl",controller:["$scope",
"$attrs",function(h,b){var f=this;f.status="loading";h.isSet(b.ngDataSmall)?f.type="small":h.isSet(b.ngDataManual)?f.type="manual":f.type="large";f.transcludeOnError="transclude"===(b.ngDataOnError||"");var c=h.$eval(b.ngData);if(_.isUndefined(c))f.status="success";else{var e=_.isArray(c);if(!e&&(!_.isObject(c)||!_.isFunction(c.then)))f.status="success";else{e&&(c=a.all(c));var d=h.$eval(b.ngDataStale);if(!_.isUndefined(d)&&(d=e?d:[d],!_.any(d,"$fresh"))){f.status="success";return}c.then(function(){f.status=
"success"},function(){f.status="error"})}}}]}}]);n.config(["$provide",function(a){a.decorator("ngShowDirective",["$delegate",function(a){a.shift();return a}])}]);n.directive("ngShow",["$parse",function(a){return{restrict:"A",compile:function(h,b){var f=a(b.ngShow);return function(a,b,h){a.$watch(f,function(f){b.toggleClass("ng-hide",!f);h.ngThen&&(a[h.ngThen]=f)})}}}}]);n.directive("ngShowOnce",["$parse",function(a){return{restrict:"A",compile:function(h,b){var f=a(b.ngShowOnce);return function(a,
b,h){var c=f(a);b.toggleClass("ng-hide",!c);h.ngThen&&(a[h.ngThen]=c)}}}}]);n.config(["$provide",function(a){a.decorator("ngHideDirective",["$delegate",function(a){a.shift();return a}])}]);n.directive("ngHideOnce",["$parse",function(a){return{restrict:"A",compile:function(h,b){var f=a(b.ngHideOnce);return function(a,b,h){var c=!!f(a);b.toggleClass("ng-hide",c);h.ngThen&&(a[h.ngThen]=c)}}}}]);n.directive("ngHide",["$parse",function(a){return{restrict:"A",compile:function(h,b){var f=a(b.ngHide);return function(a,
b,h){a.$watch(f,function(f){f=!!f;b.toggleClass("ng-hide",f);h.ngThen&&(a[h.ngThen]=f)})}}}}]);n.directive("ngAutoExporter",["$interpolate","autoExport",function(a,h){return{scope:!0,templateUrl:"auto-exporter",replace:!0,compile:function(b,f){var c=a(f.ngAutoExporter),e=a(f.ngAutoExporterFilename);return function(a,b,f){a.autoExport=h;a.isLeft=a.isSet(f.ngAutoExporterLeft);a.$watch(c,function(b){a.namespace=b});a.$watch(e,function(b){a.filename=b})}}}}]);n.directive("ngAutoExportValue",[function(){return{restrict:"A",
compile:function(a,h){var b=h.ngAutoExportValue||"";h.$set("ngAutoExportValue","");return function(a,h,c){h.data("ngAutoExportValue",function(){return a.$interpolate(b)})}}}}]);n.directive("ngAutoExportSkip",["$parse",function(a){return{restrict:"A",compile:function(h,b){var f=a(b.ngAutoExportSkip||"true");return function(a,b,h){b.data("ngAutoExportSkip",_.bind(f,null,a))}}}}]);n.directive("ngAutoExportOnly",["$parse",function(a){return{restrict:"A",compile:function(h,b){if(b.ngAutoExportOnly){var f=
a(b.ngAutoExportOnly);return function(a,b,h){a.$watch(f,function(a){b.toggleClass("ng-hide",a)})}}h.addClass("ng-hide")}}}]);n.directive("ngAutoExport",["$interpolate","$parse","autoExport",function(a,h,b){return{restrict:"A",scope:!0,compile:function(f,c){var e=a(c.ngAutoExport),d=c.ngAutoExportProcess?h(c.ngAutoExportProcess):null;return function(a,f){var h=e(a),c={};d&&(c.process=_.bind(d,null,a));var q=b.addExport(h,f,c);a.$on("$destroy",function(){b.removeExport(q)})}}}}]);n.directive("ngTableFilters",
["$parse","$rootScope","require",function(a,h,b){return{restrict:"A",scope:!0,controller:function(){var a=this;a.ignore=null;a.filters=[];a.addFilter=function(h){b.assert(h.type,"ng-table-filter: expected filter description to include type");b.assert(h.filter,"ng-table-filter: expected filter description to include filter");a.filters.push(h);l(h)};a.removeFilter=function(b){g(b);_.overwriteWithout(a.filters,b)};a.reset=function(){_.forEach(a.filters,function(a){a.resetValue()});a.update()};a.isFiltering=
function(b){return _.any(_.map(a.filters,function(a){return a.isFiltering()}))};var c=function(b,h){for(var c=[],l=a.filters.length,e,q,d,u=0,g=h.length;u<g;u++){q=h[u];e=!0;if(q&&q!==a.ignore)for(var A=0;A<l;A++)if(d=a.filters[A],d.isFiltering()&&!d.filter(q)){e=!1;break}e&&c.push(q)}_.overwrite(b,c);b.filtered=h.length-c.length},e={},q={};a.update=function(){console.info("ng-table-filters: filtering collections");_.forEach(e,function(a,b){c(q[b],a)});g()};a.debouncedUpdate=_.debounce(function(){h.$apply(function(){a.update()})},
500);a.addCollection=function(a,b){e[a.$id]=b||[];var f=q[a.$id];_.isUndefined(f)&&(f=q[a.$id]=[]);c(f,e[a.$id]);return f};a.removeCollection=function(a){delete e[a.$id];delete q[a.$id]};var d={},g=function(b){d&&(_.isUndefined(b)?_.forEach(a.filters,function(a){g(a)}):!_.isUndefined(b.identifier)&&!_.isUndefined(b.value)&&(d[b.identifier]=b.value))},l=function(b){if(d)if(_.isUndefined(b))_.forEach(a.filters,l);else if(!_.isUndefined(b.identifier)){var h=d[b.identifier];_.isUndefined(h)?b.resetValue():
b.value=h}};a.updateModel=function(b){g();d=b||{};l();a.update();return d};a.storeModel=function(){g();return d}},compile:function(b,h){var c=h.ngTableFilters?a(h.ngTableFilters):null,e=h.ngTableFiltersModel?a(h.ngTableFiltersModel):null,d=h.ngTableFiltersIgnore?a(h.ngTableFiltersIgnore):null;return{pre:function(a,b,f,h){a.$tableFilters=h;e&&a.$watch(e,function(b){e.assign(a,h.updateModel(b))});c&&a.$watchCollection(c,function(b){a.$collection=h.addCollection(a,b)});d&&a.$watch(d,function(a){h.ignore=
a;h.update()})}}}}}]);n.directive("ngTableFilter",["$compile","$parse","$templateCache",function(a,h,b){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],scope:!0,controller:function(){this.name="";this.isFiltering=_.never;this.filter=_.always},compile:function(f,c){var e=b.get(c.ngTableFilterTemplate||"tableFilter.filter");if(e){var d=a(e),g=c.ngTableFilterIdentifier?h(c.ngTableFilterIdentifier):null;return{pre:function(a,b,f,h){var c=h[0],e=h[1];a.$tableFilter=e;e.reset=function(){e.resetValue();
c.update()};e.name=e.identifier=f.ngTableFilter;g&&(e.identifier=g(a));f.$observe("ngTableFilter",function(a){e.name=a});b.addClass("ng-table-filter");a.$watch(function(){return e.isFiltering()},function(a){b.toggleClass("filtering",a)});d(a,function(a){b.append(a)})},post:function(a,b,f,h){var c=h[0],e=h[1];c.addFilter(e);a.$on("$destroy",function(){c.removeFilter(e)})}}}console.error("ng-table-filter-filter: template not found")}}}]);n.directive("ngTableFilterString",["$parse",function(a){return{restrict:"A",
require:["^ngTableFilters","ngTableFilter"],compile:function(h,b){var f=a(b.ngTableFilterString);return{post:function(a,b,h,c){var e=c[0],l=c[1];l.type="string";l.value="";l.resetValue=function(){l.value=""};var d="";l.isFiltering=function(){d=l.value.toLowerCase();return!!d};l.filter=function(b){return 0<=(f(a,{$row:b})||"").toLowerCase().indexOf(d)};a.$watch(function(){return l.value},function(){e.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterDate",["$parse",function(a){return{restrict:"A",
require:["^ngTableFilters","ngTableFilter"],compile:function(h,b){var f=a(b.ngTableFilterDate);return{pre:function(a,b,h,c){var e=c[0],l=c[1];l.operations=[{name:"Before",value:"before"},{name:"On",value:"on"},{name:"After",value:"after"}];var d={},q;d.on=function(b){return(b=f(a,{$row:b})||0)?0===b.diff(q,"days"):!1};d.before=function(b){return(b=f(a,{$row:b})||0)?0>b.diff(q,"days"):!1};d.after=function(b){return(b=f(a,{$row:b})||0)?0<b.diff(q,"days"):!1};l.type="date";l.value={operation:"on",date:""};
l.resetValue=function(){l.value.date=""};l.isFiltering=function(){q=l.value.date?moment(l.value.date,"YYYY-MM-DD"):null;return!!q};l.filter=d[l.value.operation];a.$watch(function(){return l.value.operation},function(a){l.filter=d[a];e.debouncedUpdate()});a.$watch(function(){return l.value.date},function(){e.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterAmount",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,b){var f=a(b.ngTableFilterAmount);
return{pre:function(a,b,h,c){var e=c[0],l=c[1];l.operations=[{name:"is",value:"equal"},{name:"less than",value:"less-than"},{name:"greater than",value:"greater-than"}];var d={equal:function(b){return(f(a,{$row:b})||0)===l.value.amount},"less-than":function(b){return(f(a,{$row:b})||0)<l.value.amount},"greater-than":function(b){return(f(a,{$row:b})||0)>l.value.amount}};l.type="amount";l.value={operation:"greater-than",amount:""};l.resetValue=function(){l.value.amount=""};l.isFiltering=function(){return""!==
l.value.amount};l.filter=d[l.value.operation];a.$watch(function(){return l.value.operation},function(a){l.filter=d[a];e.debouncedUpdate()});a.$watch(function(){return l.value.amount},function(){e.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterNumber",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,b){var f=a(b.ngTableFilterNumber);return{pre:function(a,b,h,c){var e=c[0],l=c[1];l.operations=[{name:"is",value:"equal"},{name:"less than",
value:"less-than"},{name:"greater than",value:"greater-than"}];var d={equal:function(b){return(f(a,{$row:b})||0)===l.value.number},"less-than":function(b){return(f(a,{$row:b})||0)<l.value.number},"greater-than":function(b){return(f(a,{$row:b})||0)>l.value.number}};l.type="number";l.value={operation:"greater-than",number:""};l.resetValue=function(){l.value.number=""};l.isFiltering=function(){return""!==l.value.number};l.filter=d[l.value.operation];a.$watch(function(){return l.value.operation},function(a){l.filter=
d[a];e.debouncedUpdate()});a.$watch(function(){return l.value.number},function(){e.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterChoice",["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,b){var f=a(b.ngTableFilterChoice),c=a(b.ngTableFilterChoices),e=a(b.ngTableFilterChoiceName||"$choice.name"),d=a(b.ngTableFilterChoiceValue||"$choice");return{pre:function(a,b,h,q){var g=q[0],k=q[1];b=c(a);var m=_.map(b,function(b){return d(a,{$choice:b})});
k.type="choices";k.choices=b;k.value={};k.resetValue=function(){_.forEach(m,function(a,b){k.value[b]=!1})};k.resetValue();k.isFiltering=function(){return _.any(_.values(k.value))};k.filter=function(b){var h=f(a,{$row:b})||!1;if(_.isArray(h)){for(var c=0,l=h.length;c<l;c++)if(b=m.indexOf(h[c]),0<=b&&k.value[b])return!0;return!1}b=m.indexOf(h);return 0<=b?k.value[b]:!1};k.choiceName=function(b){return e(a,{$choice:b})};a.$watch(function(){return k.value},function(){g.debouncedUpdate()},!0)}}}}}]);n.directive("ngTableFilterYesno",
["$parse",function(a){return{restrict:"A",require:["^ngTableFilters","ngTableFilter"],compile:function(h,b){var f=a(b.ngTableFilterYesno);return{pre:function(a,b,h,c){var e=c[0],l=c[1],d=l.ANY="any";l.type="yesno";l.value=d;l.resetValue=function(){l.value=d};l.isFiltering=function(){return l.value!==d};l.filter=function(b){return(f(a,{$row:b})||!1)===l.value};a.$watch(function(){return l.value},function(){e.debouncedUpdate()})}}}}}]);n.directive("ngTableFilterView",["$compile","$templateCache",function(a,
h){var b={};return{require:"^ngTableFilter",link:{pre:function(f,c,e,d){e="tableFilter.filters."+d.type;var g=b[e];if(!g){g=h.get(e);if(!g){console.warn("ng-table-filter-view: invalid or custom type",d.type);c.remove();return}g=b[e]=a(g)}g(f,function(a){c.append(a)})}}}}]);n.directive("ngTables",[function(){return{restrict:"A",scope:!0,controllerAs:"tablesCtrl",controller:function(){var a=this;a.tables=[];a.predicate=null;a.addTable=function(h){_.contains(a.tables,h)||a.tables.push(h)};a.removeTable=
function(h){_.overwriteWithout(a.tables,h)};a.toggle=function(h){a.predicate=h;_.forEach(a.tables,function(a){a.toggle(h)})}}}}]);n.directive("ngTable",["$filter",function(a){var h=a("orderBy");return{restrict:"A",scope:!0,controller:["$scope","$attrs","$parse","$element",function(a,f,c,e){var d=this,q,g=f.ngTableName||"$table",l=a.isSet(f.ngTableFiltered)?e.controller("ngTableFilters"):null;d.collection=[];d.predicate=null;d.isReversed=!1;d.isHeadersIgnored=a.isSet(f.ngTableIgnoreHeaders);d.toggle=
function(a){a&&d.predicate===a?d.isReversed=!d.isReversed:(d.predicate=a,d.isReversed=!1);d.update()};d.update=function(a){_.isUndefined(a)||(q=a);a=q;d.predicate&&(a=h(q,d.predicate,d.isReversed));_.overwrite(d.collection,a);_.forEach(p,function(a){a()})};var p=[];d.watch=function(a,b){p.push(b);a.$on("$destroy",function(){_.overwriteWithout(p,b)})};a.tablesCtrl&&a.isSet(f.ngTableTables)&&(a.tablesCtrl.addTable(d),d.predicate=a.tablesCtrl.predicate,a.$on("$destroy",function(){a.tablesCtrl.removeTable(d)}));
f=c(f.ngTable);d.update(f(a));var k;a.$watchCollection(f,function(f){l?k=l.addCollection(a,f):d.update(f)});l&&(a.$watchCollection(function(){return k},function(a){d.update(a);d.filtered=a.filtered}),a.$on("$destroy",function(){l.removeCollection(a)}));_.set(a,g,d)}]}}]);n.directive("ngTableHeader",["tableHeaders","require",function(a,h){return{restrict:"A",require:["^?ngTable","^?ngTables"],link:function(b,f,c,e){var d=e[0]||e[1];d&&(d===e[0]&&d.isHeadersIgnored)&&(d=e[1],h.assert(d,"If ngTable is only for summaries, ngTables is required for headers!"));
h.assert(d,"ngTable or ngTables required");if(!c.ngTableHeaderWhen||b.$eval(c.ngTableHeaderWhen)){var g=a.parsePredicate(b,c.ngTableHeader,b.isSet(c.ngTableHeaderDefault),c.ngTableHeaderKey);b.isSet(c.ngTableHeaderDisabled)||(f.on("click",function(){b.$apply(function(){d.toggle(g)})}),f.addClass("ng-table-header"),b.$watch(function(){return d.predicate===g},function(a){f.toggleClass("active",a)}));g.isDefault&&d.toggle(g)}}}}]);n.directive("ngTableSummary",["$parse","require",function(a,h){return{scope:!0,
restrict:"A",compile:function(b,f){var c=f.ngTableSummary?a(f.ngTableSummary):null,d=f.ngTableSummaryOperator?a(f.ngTableSummaryOperator):function(a,b){return(b.$acc||0)+(b.$row||0)},e=f.ngTableSummaryInitial?a(f.ngTableSummaryInitial):f.ngTableSummaryOperator?null:_.constant(0);f.ngTableSummaries&&(c=a(f.ngTableSummaries),e=function(){return[]},d=function(a,b){_.forEach(b.$row,function(a,f){b.$acc[f]=(b.$acc[f]||0)+(a||0)});return b.$acc});return{pre:function(b,f,l){f=l.ngTableSummaryTableName||
"$table";h.inScope(b,f,"ngTable controller must be in scope");var p=b[f],g=l.ngTableSummaryWhen?a(l.ngTableSummaryWhen):_.always,k=function(){if(!g(b))return"";var a=e?e(b):null;return _.reduce(p.collection,function(a,f){return d(b,{$acc:a,$row:c?c(b,{$row:f}):f})},a)};f=function(){b.$summary=k()};f();b.isSet(l.ngTableSummaryOnce)||(b.isSet(l.ngTableSummaryTableOnly)?p.watch(b,f):b.$watch(f))}}}}}]);n.directive("ngGroup",[function(){return{scope:!0,restrict:"A",require:["ngGroup","^?ngGroups"],controller:function(){var a=
this;a.collection=[];a.groups=[];a.byFn=a.asFn=a.name=null;a.group=function(){var h=!0,b=a.byFn;b||(b=_.constant(""),h=!1);var f=a.asFn?a.asFn:b,c={},e={};if(a.collection.length){var d=_.groupBy(a.collection,function(h){h={$row:h};var d=b(h)||"";if(_.isUndefined(c[d])){var p=f===b?d:f(h);c[d]=p||null}_.isUndefined(e[d])&&(e[d]=a.sortByFn?a.sortByFn(h):c[d]);return d}),g={};_.forEach(a.groups,function(a){g[a.by]=a});d=_.map(d,function(b,f){var d=g[f]||{};_.extend(d,{isGrouped:h,by:f,as:c[f],name:a.name,
rows:b,sortBy:e[f]});return d});_.overwrite(a.groups,_.sortBy(d,"sortBy"))}else _.overwrite(a.groups,[{isGrouped:h,name:a.name,rows:[]}])};a.groupBy=function(h,b,f,c){a.byFn=h;a.asFn=b;a.sortByFn=f;a.name=c;a.group()};a.update=function(h){a.collection=h;a.group()}},link:function(a,h,b,f){var c=f[0],d=f[1];d&&(d.addNgGroupCtrl(c),a.$on("$destroy",function(){d.removeNgGroupCtrl(c)}));a.$groups=c.groups;a.$watchCollection(b.ngGroup,function(a){c.update(a)})}}}]);n.directive("ngGroupBy",["$parse","require",
function(a,h){return{require:["^?ngGroup","^?ngGroups"],compile:function(b,f){var c=f.ngGroupBy?a(f.ngGroupBy):null,d=f.ngGroupAs?a(f.ngGroupAs):null,e=f.ngGroupSortBy?a(f.ngGroupSortBy):null,g=f.ngGroupByModel?a(f.ngGroupByModel):null;return function(a,b,p,q){var k=q[0]||q[1];h.assert(k,"Either ngGroup or ngGroups required on ancestor");var m,n,D;c&&(m=_.bind(c,null,a),n=_.bind(d,null,a));e&&(D=_.bind(e,null,a));var B=function(){k.groupBy(m,n,D,p.ngGroupName)};a.isSet(p.ngGroupDefault)&&B();b.on("click",
function(){g?g.assign(a,f.ngGroupBy):B()});a.$watch(function(){return k.byFn===m},function(a){b.toggleClass("toggled",a)});g&&a.$watch(g,function(a,b){a===f.ngGroupBy&&B()})}}}}]);n.directive("ngGroups",["$parse","events",function(a,h){return{scope:!0,restrict:"A",controller:["$scope","$attrs",function(a,f){var c=this;c.ngGroupCtrls=[];var d=function(a){a.groupBy(c.byFn,c.asFn,c.sortByFn,c.name)};c.groupBy=function(a,b,f,h){c.byFn=a;c.asFn=b;c.sortByFn=f;c.name=h;_.forEach(c.ngGroupCtrls,d)};c.addNgGroupCtrl=
function(a){c.ngGroupCtrls.push(a);c.byFn&&d(a)};c.removeNgGroupCtrl=function(a){_.ref.remove(c.ngGroupCtrls,a)};if(f.ngGroupsRegroupEvent)h.on(a,f.ngGroupsRegroupEvent,function(){_.forEach(c.ngGroupCtrls,d)})}]}}]);n.directive("ngToggle",["$parse","$rootScope","toggles",function(a,c,b){return{restrict:"A",compile:function(f,c){var h=a(c.ngToggleValue),d=a(c.ngToggleDefault),e=a(c.ngToggleGroupValue),g=c.ngToggleWhen?a(c.ngToggleWhen):null;return function(a,f,c){var q=h(a)||c.ngToggle,k=d(a)||!1,
m=e(a)||c.ngToggleGroup,A=a.isSet(c.ngToggleAutoClose),n=a.isSet(c.ngToggleGroupCloseable),t=_.isUndefined(c.ngToggleInteractive)||a.isSet(c.ngToggleInteractive),y=g?_.bind(g,null,a):null;b.create(q,{autoClose:A,defaultState:k,group:m,isCloseableGroup:n,when:y});t&&(k="click",a.isSet(c.ngToggleMousedown)&&(k="mousedown"),f.on(k,function(c){a.$apply(function(){b.toggle(q)})}));a.$watch(function(){return b.state(q)},function(a){f.toggleClass("toggled",a)});a.$on("$destroy",function(){b.destroy(q)})}}}}]);
n.directive("ngToggled",c.conditionalDirective({watch:["toggles",function(a){return function(c,b,f){var d=c.$eval(f.ngToggledValue)||f.ngToggled;return function(){return a.state(d)}}}],operator:["$parse",function(a){return function(c,b,f){var d=f.ngToggledAction?a(f.ngToggledAction):_.ignore;return function(a){d(c,{$value:a});return a}}}]}));n.directive("ngToggledShow",["$parse","toggles",function(a,c){return{link:function(b,f,d){var e=d.ngToggledAction?a(d.ngToggledAction):_.ignore,g=d.ngToggledAlways?
a(d.ngToggledAlways):_.never,k=b.$eval(d.ngToggledShowValue)||d.ngToggledShow;b.$watch(function(){return c.state(k)||g(b)},function(a){e(b,{$value:a});f.css("display",a?"":"none")})}}}]);n.directive("ngWith",["$parse",function(a){return{restrict:"A",scope:!0,priority:900,compile:function(c,b){var f=a(b.ngWith);return{pre:function(a,b,c){f(a);a.$watch(f)}}}}}]);n.directive("ngFadeIn",[function(){return{restrict:"A",link:function(a,c,b){a=parseInt(b.ngFadeIn);c.hide();c.fadeIn(a)}}}]).directive("ngFadeOut",
[function(){return{restrict:"A",link:function(a,c,b){var f=parseInt(b.ngFadeOut);b=b.ngFadeTarget;var d=$(c);c=a;b&&(c=a.$eval(b));c.fadeOut=function(b){d.fadeOut(f,function(){b&&b(a)})}}}}]);n.directive("ngNullForm",[function(){return{name:"form",controller:function(){this.$setPristine=this.$setDirty=this.$removeControl=this.$setValidity=this.$addControl=_.ignore;this.$$renameControl=function(a,c){a.$name=c}},link:{pre:function(a){a.nullForm={$dirty:!1,$pristine:!0,$valid:!0,$invalid:!1}}}}}]);n.directive("ngName",
[function(){return{restrict:"A",require:["ngModel","^?form"],link:function(a,c,b,f){a.$watch(b.ngName,function(a){c.attr("name",a);var b=f[0],d=f[1];d.$removeControl(b);b.$name=a;d.$addControl(b)})}}}]).directive("ngPrefix",[function(){return{restrict:"A",priority:100,controller:["$scope","$element","$attrs",function(a,c,b){var f=c.attr("name");a.$watch(b.ngPrefix,function(a){var c=f;a&&(c=a+"-"+c);b.$set("name",c)})}]}}]);n.directive("ngOutboundLink",[function(){return{restrict:"A",priority:-1,link:function(a,
c,b){var f=a.$interpolate(b.ngOutboundLink)||"_self";(!b.ngOutboundLinkWhen||a.$eval(b.ngOutboundLinkWhen))&&c.attr("target",f)}}}]);n.directive("ngBackButton",["$window",function(a){return{restrict:"A",link:function(c,b,f){b.on("click",function(b){setTimeout(function(){a.history.back()},50)})}}}]);n.directive("ngSearchLink",["navigation",function(a){return{restrict:"A",link:function(c,b,f){f.$observe("ngSearchLink",function(d){var e=c.$eval(f.ngSearchLinkCompany)||a.currentCompany;e&&(d=e.$url(urls.dashboard.bookings.index)+
"?q="+d,b.attr("href",d))})}}}]);n.directive("ngPrint",_.optional(["$timeout","$window","?native",function(a,c,b){var f=b&&b.isNative;return{restrict:"A",link:function(d,e,g){var k=function(){if(f){var a;if(g.ngPrintNative){a=$(d.$interpolate(g.ngPrintNative));if(!a.length)return;a=a[0]}b.print(a)}else c.print()};e.on("click",function(a){a.preventDefault();a.stopPropagation();k()});d.isSet(g.ngPrintAuto)&&a(function(){k()},f?0:400)}}}]));n.directive("ngOpenWindow",["$window","d",function(a,c){return{restrict:"A",
link:function(b,f,d){var e=c.observer(d,"ngOpenWindow"),g=c.observer(d,"ngOpenWindowArguments","toolbar=0,status=0,scrollbars=1");f.on("click",function(c){if(e()){var f=b.$eval(d.ngOpenWindowWidth);c=b.$eval(d.ngOpenWindowHeight);var h=g();if(f)var p=Math.max(0,(a.screen.width-f)/2),h=h+(",width="+f)+(",left="+p);c&&(f=Math.max(0,(a.screen.height-c)/2),h+=",height="+c,h+=",top="+f);a.open(e(),"angular-open-winow",h)}})}}}]);n.directive("ngCloseWindow",["$window","d",function(a,c){return{restrict:"A",
link:function(b,c,h){c.on("click",function(b){a.close()})}}}]);n.directive("ngTouch",["$parse","d",function(a,c){return{restrict:"A",compile:function(b,f){var d=a(f.ngTouch);return function(a,b){b.on(c.isTouchEnabled?"touchstart":"click",function(){a.$apply(function(){d(a)})})}}}}]);n.directive("ngConfirmClick",[function(){return{priority:-1,restrict:"A",link:function(a,c,b){c.on("click",function(c){var h=b.ngConfirmClick,d;if(d=h)d=_.isUndefined(b.ngConfirmClickWhen)?!0:a.$eval(b.ngConfirmClickWhen,
{$event:c}),d=d&&!confirm(h);d&&(c.stopImmediatePropagation(),c.preventDefault())})}}}]);n.directive("ngCancelClick",[function(){return{priority:-1,restrict:"A",link:function(a,c,b){c.on("click",function(c){a.$eval(b.ngCancelClick)&&(c.stopImmediatePropagation(),c.preventDefault())})}}}]);k=function(a,c){n.directive(a,[function(){return{restrict:"A",link:function(b,f,d){var e=b.isSet(d[a+"Strict"]);f.on("click",function(f){e&&this!==f.target||c.test(f)&&b.$apply(function(){!1===b.$eval(d[a])&&(f.stopPropagation(),
f.preventDefault())})})}}}])};n.config(["$provide",function(a){a.decorator("ngClickDirective",["$delegate",function(a){a.shift();return a}])}]);k("ngClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});k("ngShiftClick",{test:function(a){return a.shiftKey&&!a.ctrlKey&&!a.metaKey&&!a.altKey}});k("ngControlClick",{test:function(a){return!a.shiftKey&&a.ctrlKey&&!a.metaKey&&!a.altKey}});k("ngMetaClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&a.metaKey&&!a.altKey}});
k("ngAltClick",{test:function(a){return!a.shiftKey&&!a.ctrlKey&&!a.metaKey&&a.altKey}});k("ngShiftOrAltClick",{test:function(a){return(a.shiftKey||a.altKey)&&!a.ctrlKey&&!a.metaKey}});n.directive("ngPhoneNumberInput",["d",function(a){return{priority:1,restrict:"A",link:function(c,b){a.restrictKeypresses(b,/\+|\d/)}}}]);n.directive("ngAmountInput",["$parse","d",function(a,c){return{priority:1,require:"ngModel",restrict:"A",link:function(b,f,d,e){var k=a(d.ngModel),m=parseFloat(d.max),z=parseFloat(d.min),
l=d.ngAmountInputMax&&a(d.ngAmountInputMax),p=d.ngAmountInputMin&&a(d.ngAmountInputMin),n=d.ngAmountInputDefault&&a(d.ngAmountInputDefault),G=b.isSet(d.ngAmountInputAllowEmpty),G=!d.required||G,x=function(){return n?n(b)/100:0},r=/[0-9]|\./;if(d.ngAmountInputPositive?!b.$eval(d.ngAmountInputPositive):1)r=/[0-9]|\.|\-/;c.restrictKeypresses(f,r);e.$parsers.push(function(a){if(_.isUndefined(a)||""===a||null===a){if(G)return"";e.$$lastCommittedViewValue=x().toString();return _.roundHalfToEven(100*x())}e.$setValidity("required",
!0);var c=p?Math.max(p(b)/100,z):z,f=l?Math.min(l(b)/100,m):m;!_.isNaN(c)&&a<c&&(a=c,e.$setValidity("min_value",!0));!_.isNaN(f)&&a>f&&(a=f,e.$setValidity("max_value",!0));return _.roundHalfToEven(100*a)});e.$formatters.unshift(function(a){return _.isUndefined(a)||""===a||null===a?G?"":x():_.roundHalfToEven(a/100,2).toFixed(2)});b.$watch(k,function(a,c){!G&&(_.isUndefined(a)&&_.isUndefined(c))&&k.assign(b,x())});f.on("blur",function(){g(e)})}}}]);n.directive("ngJsonInput",["$parse",function(a){var c=
/^(?!^[_\-])(?!.*[_\-]$)[a-zA-Z0-9_\-]+$/,b=function(a){try{_.parseJSON(a)}catch(b){return!1}return!0};return{require:"ngModel",restrict:"A",link:function(f,d,e,g){var k=a(e.ngModel);g.$parsers.push(function(a){a=$.trim(a);if(_.isUndefined(a)||""===a||null===a)return g.$setValidity("valid_json",!0),"";var f=a;c.test(f)&&(f='"'+f+'"');g.$setValidity("valid_json",b(f));return a});f.$watch(k,function(a){a&&('"'===a.charAt(0)&&'"'===a.slice(-1))&&(a=a.slice(1,a.length-1),(!a||c.test(a))&&k.assign(f,a))})}}}]);
n.directive("ngBindOnce",[function(){return{link:function(a,c,b){c.addClass("ng-binding").data("$binding",b.ngBindOnce);a=a.$eval(b.ngBindOnce)||"";c[0].textContent=a.toString()}}}]);n.directive("ngBindHtmlUnsafe",["clientOptions",function(a){return{link:function(c,b,f){b.addClass("ng-binding").data("$binding",f.ngBindHtmlUnsafe);a.reflectUrlsInHrefs(b);c.$watch(f.ngBindHtmlUnsafe,function(a){b.html(a||"")})}}}]);n.directive("ngBindHtmlUnsafeOnce",["clientOptions",function(a){return{link:function(c,
b,f){b.addClass("ng-binding").data("$binding",f.ngBindHtmlUnsafeOnce);a.reflectUrlsInHrefs(b);b.html(c.$eval(f.ngBindHtmlUnsafeOnce)||"")}}}]);var k=function(a,c,b){n.directive(a,["$compile","$filter","$injector","auth","navigation",function(f,d,e,g,k){var m=e.invoke(c.render),l=d("currencySymbol");return{restrict:"A",compile:function(c){c.addClass("notranslate amount");return function(c,h,d){var e,p,k=function(a,k){if(!(a===p&&k===e)){p=a;e=k;var q=c.$eval(d.ngAmountCurrency)||c.processorCurrency||
k;b=b||"viewAmounts";k&&!g.permissions.can(b,k)?(q=l(q,"short"),f('<span ng-tip="You don\'t have permission to see this amount">'+q+"?</span>")(c,function(a){h.empty().append(a)}),h.addClass("amount-hidden")):(q=m(c,d,p,k,q),h.text(q),h.addClass("amount-visible"));h.toggleClass("negative",0>p)}};c.$watch(d[a],function(b){k(b,c.$eval(d[a+"Company"])||c.company||null)});_.isUndefined(d[a+"Company"])||c.$watch(d[a+"Company"],function(b){k(c.$eval(d[a]),b||null)})}}}}])},a={render:["$filter",function(a){var c=
a("amount");return function(a,f,d,e,g){e=a.$eval(f.ngAmountHideCents)||!1;var k=!0;_.isUndefined(f.ngAmountShowCurrencySymbol)||(k=a.$eval(f.ngAmountShowCurrencySymbol));return c(d,g,e,k)}}]};k("ngAmount",a);k("ngInvoiceAmount",a,"viewInvoiceAmounts");k("ngAmountRate",{render:["$filter",function(a){var c=a("percentage");return function(a,f,d){return c(d)}}]});n.directive("ngFloatInput",function(){return{priority:1,require:"ngModel",link:function(a,c,b,f){a.$eval(b.ngFloatInput);var d=b.ngFloatInputMaxDigits?
a.$eval(b.ngFloatInputMaxDigits):null,e=b.ngFloatInputDecimalPlaces?a.$eval(b.ngFloatInputDecimalPlaces):null,g;if(c=b.ngFloatInputMin||b.min){var k=a.$eval(c);g=function(a){f.$setValidity("min_value",a>=k)}}var m;if(b=b.ngFloatInputMax||b.max){var l=a.$eval(b);m=function(a){f.$setValidity("max_value",a<=l)}}f.$parsers.push(function(a){"."===a&&(a="");if(null!==e){var b=a.indexOf(".");-1!==b&&a.length-(b+1)>e&&(a=a.slice(0,b+1)+a.slice(b+1,b+1+e))}null!==d&&(b=d,_.startsWith(a,"-")&&(b+=1),_.contains(a,
".")&&(b+=1),a.length>b&&(a=a.substring(0,b)));b=parseFloat(a);if(isNaN(b))return a;g&&g(b);m&&m(b);return b})}}});n.directive("ngBooleanSelect",function(){return{priority:1,require:"ngModel",link:function(a,c,b,f){f.$parsers.push(function(a){return _.contains([!0,"True","true","1"],a)?!0:_.contains([!1,"False","false","0"],a)?!1:a});f.$formatters.push(function(a){return!0===a?"True":!1===a?"False":a})}}});n.directive("ngIntInput",["$parse","d",function(a,c){return{require:"ngModel",priority:1,compile:function(b,
f){var d=a(f.ngIntInputMin),e=a(f.ngIntInputMax);return function(a,b,f,l){a.isSet(f.ngIntInput)&&(c.restrictKeypresses(b,/[-0-9]/),l.$parsers.push(function(b){var c=d(a),f=e(a);if(""===b)return b;var h=parseInt(b,10);if(isNaN(h))return b;_.isUndefined(c)||(h<c&&(h=c),l.$setValidity("min",!0));_.isUndefined(f)||(h>f&&(h=f),l.$setValidity("max",!0));return h}),b.on("blur",function(){g(l)}))}}}}]);n.directive("ngLoadTime",["$window",function(a){return{restrict:"A",link:function(){console.info("ng-load-time",
(new Date-a.$$loadTime)/1E3)}}}]);n.directive("ngPlaceholder",[function(){return function(a,c,b){b.$observe("ngPlaceholder",function(a){c.attr("placeholder",a);if("SELECT"===c[0].nodeName){var b=c.children("option").first();b.text()||(b.attr("label",a),b.text(a))}else a&&c.placeholder()})}}]);n.directive("ngDatepicker",["$parse","d","localization","moment","Pikaday",function(a,c,b,f,d){return{require:"ngModel",priority:1,restrict:"A",compile:function(e,k){var m=a(k.ngDatepickerYearRange),z=a(k.ngDatepickerMinDate);
return function(a,e,q,w){var n=a.isSet(q.ngDatepickerAllowEmpty),r=b.current().DATE_FORMATS.input||"MM-DD-YYYY",D=a.company&&a.company.features?a.company.features.isSundayBased:!0;_.isUndefined(k.ngDatepickerSundayBased)||(D=a.isSet(k.ngDatepickerSundayBased));var B=$(e);c.restrictKeypresses(e,/[0-9]|\/|\-/);var t=function(a,b){var c=f(a,b);return!c||!c.isValid()?n?"":f():c},y=new d({field:B[0],format:r,onSelect:function(){a.$apply(function(){w.$setViewValue(y.toString())})},minDate:z,yearRange:m,
onOpen:function(){var a=t(w.$modelValue,"YYYY-MM-DD");a&&y.setMoment(a)},firstDay:D?0:1}),L=function(a,b,c){return(a=t(a,b))?a.format(c):""};w.$parsers.push(function(a){return L(a,r,"YYYY-MM-DD")});w.$formatters.unshift(function(a){return L(a,"YYYY-MM-DD",r)});!a.$eval(q.ngModel)&&!n&&(q=w.$pristine,w.$pristine=!1,w.$setViewValue(f().format(r)),w.$render(),w.$pristine=q);e.on("blur",function(){g(w)});a.$on("$destroy",function(){y.destroy()});z&&a.$watch(z,function(a){y.config({minDate:a?a.toDate():
void 0});a&&0>f(w.$modelValue,"YYYY-MM-DD").diff(a)&&(w.$modelValue=a.format("YYYY-MM-DD"),w.$$writeModelToScope(),g(w))})}}}}]);n.directive("ngTimepicker",["$parse","$timeout","d","localization","moment",function(a,c,b,f,d){return{require:"ngModel",restrict:"A",link:function(a,e,k,m){var l=f.current().TIME_FORMATS.default;k=f.current().SERVER_TIME_FORMAT;var p=$(e);b.restrictKeypresses(e,/[0-9]|[:amp]/);var q=p.timepicker({timeFormat:k});e.on("selectTime",function(){a.$safeApply(function(){var a=
q.val();a!==m.$viewValue&&m.$setViewValue(a)})});var n=function(a,b,c){b=d(a,b);return!a||!b||!b.isValid()?"":b.format(c)};m.$parsers.push(function(a){return n(a,l,"HH:mm")});m.$formatters.unshift(function(a){var b=n(a,"HH:mm",l);c(function(){q.timepicker("setTime",b)});return b});e.on("blur",function(){g(m)});a.$on("$destroy",function(){q.timepicker("remove")})}}}]);n.directive("ngInternationalPhoneField",["$compile","$parse","$timeout","auth","localization","models","navigation",function(a,c,b,
f,d,e,g){return{require:"ngModel",restrict:"A",link:function(e,k,l,p){var m=c(l.ngModel),w=c(l.ngInternationalPhoneFieldPhoneCountryModel),m=m(e),n=w(e),r=$(k);k=e.$eval(l.ngInternationalPhoneFieldCountries)||[];var D=function(){return r.intlTelInput("getSelectedCountryData")},B=function(){var b=D(),c=r.siblings(".flag-container").find(".selected-flag");c.attr("ng-tip",function(){return"Country Code"+(_.isEmpty(b)?"":": +"+b.dialCode+" "+b.name)}).attr("ng-tip-classes","tip-indent").attr("title",
null);a(c)(e)},t=_.map(k,function(a){return a[0].toLowerCase()}),y=function(a){a=a?a.toLowerCase():"";return _.contains(t,a)},L=function(a){b(function(){w.assign(e,a.toUpperCase())},0)};k=[];if(1<t.length){f.currentUser.isAuthenticated||k.push(d.browser.ACCEPT_LANGUAGE_COUNTRY_CODE.toLowerCase());l=g.currentCompany;var J=l.country;if("US"===l.processorCountry||!l.country)J=l.processorCountry;k.push(J.toLowerCase());k=_.uniq(k);k=_.filter(k,function(a){return y(a)})}var s="";n&&y(n)?s=n.toLowerCase():
m||(k.length?s=k[0]:t.length&&(s=t[0]));r.intlTelInput({autoPlaceholder:"off",formatOnDisplay:!1,onlyCountries:t,preferredCountries:k,initialCountry:s});L(s);B();m&&r.intlTelInput("setNumber",m);e.$watch(w,function(a,b){r.parents(".international-phone-field").toggleClass("no-country",!a);if(a!==b)if(!a||y(a)){var c=a,c=c?c.toLowerCase():"";r.intlTelInput("setCountry",c)}else L(s)});r.on("countrychange",function(){e.$safeApply(function(){var a;a=D();a=!a||!a.iso2?"":a.iso2.toUpperCase();L(a);p.$setDirty();
p.$setViewValue(r.val());B()})});r.on("open:countrydropdown",function(){e.$safeApply(function(){var a=r.siblings(".flag-container").find(".country-list");a.length&&!a.hasClass("tb-flyout")&&a.addClass("tb-flyout")})});e.$on("$destroy",function(){r.intlTelInput("destroy")})}}}]);n.directive("ngSlideshow",["$animate","$compile","$templateCache","$timeout",function(a,c,b,f){return{restrict:"A",controller:["$scope","$element","$attrs",function(b,c,f){var d=b.$eval(f.ngSlideshowDelay)||4500,h,e,g=this;
g.isPlaying=!1;g.slides=[];g.currentSlide=null;g.addSlide=function(a){a={element:a};g.slides.push(a);return a};g.removeSlide=function(a){g.slides[e]===a&&(e+=1,e>=g.slides.length&&(e=0));_.overwriteWithout(g.slides,a);g.slides[e]||(e=void 0)};g.showSlide=function(b){if(g.slides.length){var c=_.indexOf(g.slides,b);0>c||(!_.isUndefined(e)&&g.slides[e]!==b&&(b=g.slides[e],g.currentSlide=null,a.removeClass(b.element,"slideshow-showing")),e=c,c=g.slides[e],g.currentSlide=c,a.addClass(c.element,"slideshow-showing"),
g.isPlaying&&g.play())}};g.next=function(){var a;_.isUndefined(e)?a=0:(a=e+1,a>=g.slides.length&&(a=0));g.showSlide(g.slides[a])};g.previous=function(){var a;_.isUndefined(e)?a=0:(a=e-1,0>a&&(a=g.slides.length-1));g.showSlide(g.slides[a])};g.pause=function(){a.removeClass("slideshow-playing");a.addClass("slideshow-paused");clearTimeout(h);g.isPlaying=!1};var k=function(){b.$safeApply(function(){h=null;g.slides.length&&g.next()})};g.play=function(a){g.isPlaying=!0;h&&clearTimeout(h);h=setTimeout(k,
a?0:d)}}],link:function(a,f,d,e){d=b.get("slideshow-dots");var g=b.get("slideshow-arrows");a=a.$new();a.slideshow=e;f.append(c(d)(a));f.append(c(g)(a));e.play(!0)}}}]);n.directive("ngSlideshowSlide",[function(){return{restrict:"A",require:"^ngSlideshow",link:function(a,c,b,f){c.addClass("slideshow-slide");f.slides.length||c.addClass("slideshow-showing");var d=f.addSlide(c);a.$on("$destroy",function(){f.removeSlide(d)})}}}]);n.directive("ngDiff",["diff",function(a){return{restrict:"A",link:function(c,
b,f){var d=c.$eval(f.ngDiff);c=c.$eval(f.ngDiffWith);if(_.isUndefined(d)||null===d)d="";if(_.isUndefined(c)||null===c)c="";b.addClass("diff");_.forEach(a.diffWords(c,d),function(a){var c=$("<span />");a.added?c.addClass("diff-added"):a.removed?c.addClass("diff-removed"):c.addClass("diff-unchanged");c.text(a.value);b.append(c)})}}}]);n.directive("ngMarkdownFileUpload",["$q","$window","filepicker","flash",function(a,c,b,f){return{require:"ngModel",restrict:"A",link:function(d,e,g,k){var m=function(){var f=
a.defer();b.pickAndStore({},{location:"S3"},function(a){d.$apply(function(){var b=a?_.first(a):"";if(b.url){var d=b.url.replace(c.slipstream.remoteFileDomain,c.slipstream.remoteFileCdnDomain),e=b.filename||"attachment",b=(b.mimetype||"").match(/^image\/\S+$/);f.resolve({url:d,fileName:e,isImage:b})}else f.reject()})},function(a){d.$apply(function(){a&&101===a.code?f.resolve():f.reject()})});return f.promise},l,p=_.first(e);e.bind("keyup click",function(){_.isUndefined(p.selectionStart)||(l=p.selectionStart)});
$(g.ngMarkdownFileUpload).on("click",function(){m().then(function(a){if(a){var b=k.$viewValue||"",c=_.isUndefined(l)?b.length:l,d=b.substr(0,c);d&&!d.match(/\s$/)&&(d+="\n");(b=b.substr(c))&&!b.match(/^\s/)&&(b="\n"+b);var c=a.url,e=a.fileName;a=a.isImage?"!["+(_.isUndefined(g.ngMarkdownImageDescription)?"Description of image":g.ngMarkdownImageDescription)+"]("+c+")":"[View "+e+"]("+c+")";k.$setViewValue(d+a+b);k.$render();f.success("Markdown updated")}},function(){f.error("File was not uploaded, please try again")})})}}}]);
n.directive("ngMarkdownPreview",["Showdown",function(a){return{require:"ngModel",restrict:"A",link:function(c,b,f,d){var e=new a.converter;c=$(f.ngMarkdownPreview);var g=$(f.ngMarkdownPreviewResult);c.on("click",function(){var a="",b=d.$viewValue;b&&(b=_.escape(b),a=e.makeHtml(b));g.html(a)})}}}]);n.directive("ngMailcheck",["Mailcheck",function(a){return{restrict:"A",scope:{email:"=ngMailcheck"},template:'<a ng-show="suggestedEmail">Did you mean <b>[[ suggestedEmail ]]</b>?</a>',link:function(c,b,
f,d){c.suggestedEmail="";c.$watch("email",function(b){b?a.run({email:b,suggested:function(a){c.suggestedEmail=a.full},empty:function(){c.suggestedEmail=""}}):c.suggestedEmail=""});b.on("click",function(){c.email=c.suggestedEmail})}}}]);k=function(a){return n.directive(a.name,[function(){return{restrict:"A",link:function(c,b,f){b="$"+a.name;var d=c[b],e;d&&(e=d.isEnabled,d.isEnabled=!1);if(c.hasOwnProperty(b))throw Error("lib.directives: multiple copies of "+a.name+" modifier in same scope");var g=
{isEnabled:!0};c[b]=g;var k=$(a.selector),m=a.get(k),l=m;f.$observe(a.name,function(b,c){g.isEnabled&&(l=b,a.set(k,b,c))});c.$on("$destroy",function(){a.set(k,m,l);d&&(d.isEnabled=e)})}}}])};k({name:"ngTitle",selector:"title",get:function(a){return document.title},set:function(a,c){return document.title=c}});k({name:"ngMetaViewport",selector:'meta[name="viewport"]',get:function(a){return a.attr("content")},set:function(a,c){return a.attr("content",c)}});n.directive("ngBodyClass",[function(){return{restrict:"A",
link:function(a,c,b){var f=$("body"),d="";a.$watch(function(){var c=a.$eval(b.ngBodyClass);return _.isObject(c)?_.mapObject(c,function(a){return!!a}):c},function(a){f.removeClass(d);var b="";_.isObject(a)?_.forEach(a,function(a,c){a&&(b+=c+" ")}):b=a;f.addClass(b);d=b},!0);a.$on("$destroy",function(){f.removeClass(d)})}}}]);n.directive("ngBodyClassOnce",[function(){return{restrict:"A",link:function(a,c,b){c=$("body");a=a.$eval(b.ngBodyClassOnce);var f="";_.isObject(a)?_.forEach(a,function(a,b){a&&
(f+=b+" ")}):f=a;c.addClass(f)}}}]);n.directive("ngInline",["$templateCache",function(a){return{restrict:"A",priority:400,compile:function(c,b){var f=b.ngInline,d=a.get(f);d?c.html(d):console.warn("ng-inline: invalid template",f)}}}]);n.directive("ngLink",["$compile","$templateCache",function(a,c){var b={};return{restrict:"A",priority:400,link:function(f,d,e){if(e=f.$interpolate(e.ngLink)){var g=b[e];if(!g){g=c.get(e);if(!g){console.warn("ng-link: invalid template",e);return}g=a(g);b[e]=g}g(f,function(a){d.empty().append(a)})}else console.warn("ng-link: invalid template name",
e)}}}]);n.directive("ngLoad",["$compile","$http","$templateCache",function(a,c,b){return{restrict:"A",priority:400,compile:function(f,d){var e="/"+d.ngLoad,g=b.get(e);if(g)console.info("ng-load: compiled load",e),f.html(g);else{(g=b.get("ng-load-spinner"))&&f.html(g);var k;return function(f,d,g){var m=function(){k(f,function(a){d.empty().append(a)})};g=function(c){c=c.data;b.put(e,c);console.info("ng-load: downloaded load",e);k=a(c);m()};k?(console.info("ng-load: linked load",e),m(f,d)):c.get(e).then(null,
function(){console.error("ng-load: unable failed to load, retrying...",e);return c.get(e)}).then(g,function(){console.error("ng-load: unable to load",e);var c=b.get("ng-load-error");d.empty().append(a(c)(f))})}}}}}]);n.directive("ngNewTransportation",["$parse",function(a){return{restrict:"A",require:"^?form",controller:"lib.shared.NewTransportationCtrl",link:{pre:function(a,b,c,d){if(d){d.$setValidity("loading-transportation",!1);var e=a.$watch("newTransportationCtrl.status",function(a){if("success"===
a||"error"===a)d.$setValidity("loading-transportation",!0),e()})}}}}}]);n.directive("ngPseudoPlaceholder",[function(){return{restrict:"A",link:function(a,c,b){var f=c.closest(".field");f.addClass("field-pseudo-input-placeholder");a.$watch(function(){return c.val()},function(a){f.toggleClass("showing-pseudo-placeholder",!a)})}}}]);n.directive("ngDebug",[function(){return{restrict:"A",link:function(a,c,b){debugger}}}]);n.directive("ngLog",[function(){return{restrict:"A",link:function(a,c,b){console.log("ng-log: link",
a.$eval(b.ngLog));a.$on("$destroy",function(){console.log("ng-log: $destroy",a.$eval(b.ngLog))})}}}]);n.directive("ngCurrentBlock",["$parse",function(a){return{restrict:"A",link:function(c,b,f){var d=a(f.ngCurrentBlockBlocks);c.$watch(f.ngCurrentBlockAffiliation,function(a){var b;a&&(b=d(c),b=_.find(b,function(b){return b.affiliation===a}));c.currentBlock=b})}}}]);n.directive("ngStartBooking",["navigation","postBook",function(a,c){return{priority:-1,restrict:"A",link:function(b,f,d){f.on("click",
function(){b.$apply(function(){var f;f=d.ngStartBooking?b.$interpolate(d.ngStartBooking):a.url;c.startBooking(f)})})}}}]);n.directive("ngDump",["$parse",function(a){return{restrict:"A",link:function(c,b,f){var d=a(f.ngDump);console.log("ng-dump: link",d(c));c.isSet(f.ngDumpWatch)&&c.$watch(function(){console.log("ng-dump: $watch",d(c))})}}}]);n.directive("ngQrCode",["$interpolate","QRCode",function(a,c){return{restrict:"A",compile:function(b,f){var d=a(f.ngQrCode);return function(a,b){var f=d(a);
new c(b[0],{text:f,width:256,height:256,colorDark:"#000000"})}}}}]);n.directive("ngModelDependencies",["$parse",function(a){return{restrict:"A",controller:function(){var a=this;a.dependents=[];a.addDependent=function(b){a.dependents.push(b)}},compile:function(c,b){var f=a(b.ngModelDependencies);return function(a,b,c,d){a.$watch(f,function(a){a?b.prop("disabled",!1):(b.prop("disabled",!0),_.forEach(d.dependents,function(a){a(!1)}))})}}}}]);n.directive("ngModel",["$parse",function(a){return{require:"^?ngModelDependencies",
link:function(c,b,f,d){if(d){console.info("adding dependent",f.ngModel);var e=a(f.ngModel);d.addDependent(function(a){return e.assign(c,a)})}}}}]);n.directive("ngSelectAll",["$parse",function(a){return{restrict:"A",templateUrl:"ng-select-all",scope:!0,compile:function(c,b){var f=a(b.ngSelectAll),d=a(b.ngSelectAllModel),e=b.ngSelectAllWhen?a(b.ngSelectAllWhen):_.always,g=a(b.ngSelectAllDefaults),k=a(b.ngSelectAllDefaultField);return function(a,c,h){var m=function(h){if(!c.parents("fieldset[disabled]").length){var g=
f(a);_.forEach(g,function(b){var c={$element:b};e(a,c)&&d.assign(a,h(b),c)});(g=a.$eval(b.ngSelectAllCallback))&&g()}};a.selectText=a.$interpolate(h.ngSelectAllText);a.selectAll=_.bind(m,null,_.constant(!0));a.selectNone=_.bind(m,null,_.constant(!1));a.allowDefaults=!!g(a);if(a.allowDefaults){var q=_.makeIteratee(k(a));a.selectDefaults=function(){var b=g(a);m(function(a){return!!b[q(a)]})}}}}}}]);n.directive("ngClearInput",["$parse",function(a){return{restrict:"A",compile:function(c,b){c.addClass("ng-clear-input");
var f=a(b.ngClearInput);return function(a,b){a.$watch(f,function(a){b.toggleClass("ng-hide",!a)});b.on("click",function(){b.prev().focus();a.$apply(function(){f.assign(a,"")})})}}}}]);n.directive("ngDjangoField",["$parse",function(a){return{restrict:"A",compile:function(c,b){var f=a(b.ngDjangoField),d=a(b.ngDjangoFieldModel),e=_.isUndefined(b.ngDjangoFieldRequired)?_.constant(!1):""===b.ngDjangoFieldRequired?_.constant(!0):a(b.ngDjangoFieldRequired),g=_.isUndefined(b.ngDjangoFieldDisabled)?_.constant(!1):
a(b.ngDjangoFieldDisabled);return{pre:function(a,b){b.addClass("field")},post:function(a,b){a.$watch(function(){var b=f(a)||{},c=d(a),h=e(a),k=g(a),c=""===c||_.isUndefined(c);return{"ng-pristine":b.$pristine,"ng-dirty":b.$dirty,"ng-invalid":b.$invalid||c&&h,"ng-disabled":k,"ng-required":h}},function(a){var c=_.map(a,function(a,b){if(a)return b});a=_.map(a,function(a,b){if(!a)return b});b.addClass(c.join(" ")).removeClass(a.join(" "))},!0)}}}}}]);n.directive("ngNoisyInvalidFields",[function(){return{restrict:"A",
require:"ngNoisyInvalidFields",controller:["$scope",function(a){var c=this;c.isShowing=!1;var b=function(){$("body").toggleClass("noisy-invalid-fields",c.isShowing)};c.show=function(a){c.isShowing=_.isUndefined(a)?!0:a;b()};c.hide=function(){c.isShowing=!1;b()};a.$on("$destroy",function(){c.hide()})}],controllerAs:"noisyInvalidFieldsCtrl"}}]);n.directive("ngFiltered",["$parse",function(a){return{restrict:"A",scope:!0,controller:["$scope","$attrs",function(c,b){var f=this,d=a(b.ngFiltered),e=a(b.ngFilteredObjects),
g;b.ngFilteredSearchDocument&&(g=a(b.ngFilteredSearchDocument));f.getObjects=function(){var a=e(c);if(!f.searchTerm)return a;var b;return _.filter(a,function(a){b=g?g(c,{$obj:a}):a;return _.contains(b.toLowerCase(),f.searchTerm.toLowerCase())})};c.$watch(d,function(a){f.searchTerm=a;f.objects=f.getObjects()})}],controllerAs:"filteredCtrl"}}]);n.directive("ngNegateCheckbox",[function(){return{require:"ngModel",link:function(a,c,b,f){f.$parsers.push(function(a){return!a});f.$formatters.push(function(a){return!a})}}}]);
n.directive("ngShortcutsOverlay",[function(){return{templateUrl:"lib.shortcutsOverlay"}}]);n.directive("ngSvg",[function(){return{compile:function(a,c){var b=document.getElementById(c.ngSvg);b?a[0].appendChild(b.cloneNode(!0)):console.warn("ng-svg: unable to find svg:",c.ngSvg)}}}]);n.directive("ngHoursBeforeMidnight",["$parse",function(a){return{templateUrl:"ng-hours-before-midnight",controllerAs:"hoursBeforeMidnightCtrl",controller:["$scope","$attrs",function(c,b){var f=this,d=a(b.ngHoursBeforeMidnight);
c.$watch(d,function(a){if(!(_.isUndefined(a)||""===a)){var b=moment().startOf("day").subtract(a,"hours");a=Math.ceil(a/24);var c;0<a?c="before":0===a?c="day of":(a=-a,c="after");f.time=b;f.days=a;f.before=c}})}]}}])})();
(function(){var n=angular.module("lib.filters",["lib.services"]);n.factory("filterFields",[function(){var c=[void 0,"",null,[],{}],g=function(g){return _.any(c,function(c){return _.isEqual(c,g)})};return{EMPTY_VALUES:c,isEmpty:g,isSet:function(c,e){return g(e)?!g(c):_.isArray(c)&&_.isArray(e)?!_.isEqual(c.sort(),e.sort()):!_.isEqual(c,e)}}}]);n.filter("isNumber",[function(){return _.isNumber}]);n.filter("isBoolean",[function(){return _.isBoolean}]);n.filter("humanize",["convert",function(c){return c.humanize}]);
n.filter("percentage",["localization",function(c){return function(g,k,e,d){_.isUndefined(e)&&(e=1);var m=c.current();if(e)g=g?100*(g/e):0;else return m.formatPercentage(100,0,!k);d?_.isNumber(d)||(d=0):d=4;d=parseFloat(g.toFixed(d));return m.formatPercentage(d,!k)}}]);n.filter("cssPercentage",[function(){return function(c){if(_.isUndefined(c))return"";c=Math.floor(1E4*c)/100;return c+"%"}}]);n.filter("pluralize",[function(){return function(c,g,k){k=k||"s";g=g||"";c=parseInt(c||"0",10);c=isNaN(c)?
0:c;return 1===c?g:k}}]).filter("capitalize",[function(){return function(c){return _.capitalize(c)}}]).filter("lowercase",[function(){return function(c){return c.toLowerCase()}}]).filter("uppercase",[function(){return function(c){return c.toUpperCase()}}]).filter("bracketWrap",[function(){return function(c){return"["+c+"]"}}]).filter("aOrAnBefore",[function(){var c=/[aeiouAEIOU]/;return function(g,k){return(g&&c.test(g.charAt(0))?k?"An":"an":k?"A":"a")+" "+g}}]).filter("css",[function(){return function(c){c=
(c||"").replace(/\s+/g,"-");c=c.replace(/-+/g,"-");c=c.replace(/[^-\w]/g,"");return c.toLowerCase()}}]).filter("addClassIf",[function(){return function(c,g,k){return c?g||"":k||""}}]).filter("addClasses",[function(){return function(c){var g=[];_.forEach(c,function(c,e){c&&g.push(e)});return g.join(" ")}}]).filter("isDefined",[function(){return function(c){return!_.isUndefined(c)}}]).filter("isUndefined",[function(){return function(c){return _.isUndefined(c)}}]).filter("map",[function(){return function(c,
g){return _.map(c,g)}}]).filter("any",[function(){return _.any}]).filter("exclude",[function(){return function(c,g){return _.filter(c,function(c){return!g(c)})}}]).filter("colonless",[function(){var c=/:+\s*$/;return function(g){return(g||"").replace(c,"")}}]).filter("commaSeparated",[function(){return function(c){return!c?"":_.filter(c).join(", ")}}]).filter("replaceAll",[function(){return _.replaceAll}]).filter("ageInYears",[function(){return function(c){return moment().diff(c,"years")}}]);n.factory("localization",
["$window","auth","convert","db","models","navigation",function(c,g,k,e,d,m){var a=e.slipstream("languageFormats"),q=function(a){if(!a)return"";a=a.toLowerCase().match(/^([a-z]{2}-)?([a-z]{2})$/);if(!a||3!==a.length)return"";a=a[2];return!a?"":a.toUpperCase()};c.ldmlnum.round=_.roundHalfToEven;var h=function(b){a[b]||(console.warn("localization: unsupported language",b),b="en-us");var f=a[b],d=_.extend({"export":"MM/YYYY"},f.client.month),e=_.extend({"default":f.client.date.short,"export":"YYYY-MM-DD"},
f.client.date);c.ldmlnum.locale.xx=c.ldmlnum.locale(f.groupSymbol,f.decimalSymbol,f.plusSignSymbol,f.minusSignSymbol);var h=c.ldmlnum(f.decimalPattern,"xx"),g=c.ldmlnum(f.currencyPattern,"xx"),l=RegExp("\\"+f.decimalSymbol+"0+");return{LANGUAGE:b,LANGUAGE_COUNTRY_CODE:q(b),formatNumber:h,formatCurrency:function(a,b,c){b=b||"";b=g(a).replace("\u00a4\u00a4\u00a4",b).replace("\u00a4\u00a4",b).replace("\u00a4",b);_.isInteger(a)&&c&&(b=b.replace(l,""));return b},formatPercentage:function(a,b){var c=h(a)+
f.percentSymbol;b&&(0<a&&-1===c.indexOf(f.plusSignSymbol))&&(c=f.plusSignSymbol+c);return c},PERCENT_SYMBOL:f.percentSymbol,VALID_DATETIME_FORMATS:"default short shortNoYear dayWithMonthAbbr long longNoYear export input".split(" "),TIME_SEPARATOR:" @ ",HTML_TIME_SEPARATOR:"<br/>@ ",RANGE_SEPARATOR:" - ",HTML_RANGE_SEPARATOR:"<br/>- ",TODAY:"Today",DAY_FORMAT:"dddd",DAYS_FORMATS:{"default":"[[ days ]] [days]"},ALL_DAY_FORMATS:{"default":"[All day]"},MONTH_FORMATS:d,DATE_FORMATS:e}},b=(e.slipstream("acceptLanguage")||
"").split(","),b=b.length?_.first(b):"",f=q(b),A=e.slipstream("currentLanguage");e=q(A);var w="",u={},n=function(b,c,f){f=f||{};f.server&&f.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__getTimeFormat()");var d;f.server?(d="server",f="exact"):(d="client",f=f.topOfHour?"topOfHour":"exact");var e=a[b];if(e){var h=e[d];if(h)if(h=h.time)if(h=h[f]){c=c||e[d].time[f].default;if(e=h.values)return(e=e[k.camelKey(c)])||console.warn("localization: failed to identify time format for:",
b,d,"time",f,"values",c),e;console.warn("localization: failed to identify time format for:",b,d,"time",f,"values")}else console.warn("localization: failed to identify time format for:",b,d,"time",f);else console.warn("localization: failed to identify time format for:",b,d,"time");else console.warn("localization: failed to identify time format for:",b,d)}else console.warn("localization: failed to identify time format for:",b)},z=d.Company,l=function(a,b){b=b||{};b.server&&b.topOfHour&&console.error("localization: unsupported use of `server` and `topOfHour` options in `__fallbackTimeFormat()");
return a===z.TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE?b.server?z.FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.topOfHour?z.FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:z.FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:b.server?z.FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:b.topOfHour?z.FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:z.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT},p=function(a,b){var c;if(g.currentUser.isAuthenticated){c=g.currentUser.company.isAdmin&&m.currentCompany?
m.currentCompany:g.currentUser.company;var f;f=c.timeFormatType===z.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?n(c.language,void 0,b):n(c.language,c.timeFormatType,b);f||(console.warn("localization: falling back for time format type:",c.timeFormatType,b),f=l(c.timeFormatType,b));return f}if(m.currentCompany)return c=m.currentCompany,f=c.anonymousTimeFormatType===z.ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE?n(a,void 0,b):c.anonymousTimeFormatType===z.COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE?n(c.language,
void 0,b):n(c.language,c.anonymousTimeFormatType,b),f||(console.warn("localization: falling back for anonymous time format type:",c.anonymousTimeFormatType,b),f=l(c.anonymousTimeFormatType,b)),f;console.warn("localization: falling back to 12-hour time for an anonymous user with no current company");return z.FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT};return{browser:{ACCEPT_LANGUAGE:b,ACCEPT_LANGUAGE_COUNTRY_CODE:f,LANGUAGE:A,LANGUAGE_COUNTRY_CODE:e},setLanguageForAnonymousUser:function(b){a[b]?
(console.log("localization: setting language for anonymous user",b),w=b):console.warn("localization: unsupported language",b)},current:function(){var a;a=g.currentUser.isAuthenticated?g.currentUser.language:w||A;u[a]=u[a]||h(a);var b=u[a];a={TIME_FORMATS:_.extend({"default":"h:mma","export":"hh:mma"},p(a)),TOP_OF_HOUR_TIME_FORMATS:_.extend({"default":"ha","export":"hh:mma"},p(a,{topOfHour:!0})),SERVER_TIME_FORMAT:p(a,{server:!0})};return _.extend({},b,a)}}}]);n.factory("dates",["$interpolate","localization",
function(c,g){var k=g.current,e=function(a,b,f,d){var e=b[f.format]||b["default"];if(!e)return console.warn("dates: invalid date format",f.format,"valid formats",b),"";_.isUndefined(d)||(e=c(e)(d));return!e?"":a.format(e)},d={format:"short",isRelative:!1,isRelativeTime:!1,isHtml:!1,endAt:null,hideDate:null},m=function(a,b,c,f){return f?b||"":b&&c?b+a+c:b||c},a=function(a,b){if(!moment.isMoment(a)||!moment.isMoment(b))return!1;var c=a.clone().startOf("day"),f=b.clone().startOf("day");return!c.diff(f)},
q=function(a){var b=a.clone().startOf("day");return!a.diff(b)},h=function(a){var b=a.clone().startOf("hour");return!a.diff(b)},b=function(a,b){if(b.isRelative&&b.isRelativeTime){var c=moment(),c=a.diff(c,"hours");if(b.isRelative&&0<=c&&6>c)return a.fromNow()}},f=function(a,c){c=c||d;var f=b(a,c);if(f)return f;if(c.endAt&&q(a)&&q(c.endAt)){f=Math.abs(c.endAt.diff(a,"days"));if(1<f)return e(a,k().DAYS_FORMATS,c,{days:f});if(1===f)return e(a,k().ALL_DAY_FORMATS,c)}return h(a)?e(a,k().TOP_OF_HOUR_TIME_FORMATS,
c):e(a,k().TIME_FORMATS,c)},A=function(b,c){c=c||d;return c.isRelative&&a(b,moment())?"Today":e(b,k().DATE_FORMATS,c)},w=function(c,e){e=e||d;if(e.endAt&&q(c)&&q(e.endAt))return A(c,e);var h=A(c,e),g=b(c,e);if(g)return g;g=_.extend({},e);delete g.endAt;return(g=f(c,g))&&e.isHideDate&&a(c,e.hideDate)?g:m(k().TIME_SEPARATOR,h,g)};return{options:function(a){var b=_.extend({},d);_.contains(a,"short")?console.warn("date: unnecessary short format specifier"):_.find(k().VALID_DATETIME_FORMATS,function(c){if(_.contains(a,
c))return b.format=c,!0});b.isRelative=_.contains(a,"relative");b.isRelativeTime=_.contains(a,"relative-time");b.isAlwaysHideDate=_.contains(a,"always-hide-date");b.isHideDate=b.isAlwaysHideDate||_.contains(a,"hide-date");b.isHtml=_.contains(a,"html");b.is12amPlus1=_.contains(a,"12am+1");_.forEach(a,function(c){moment.isMoment(c)&&(b.endAt?b.isHideDate?b.hideDate=c:console.warn("date: extra moments",a,skipEndAt):b.endAt=c)});return b},isSameDay:a,isMidnight:q,isTopOfHour:h,getMonth:function(a,b){b=
b||d;return e(a,k().MONTH_FORMATS,b)},getDay:function(b,c){c=c||d;return c.isRelative&&a(b,moment())?k().TODAY:e(b,k().DAY_FORMAT,c)},getDate:A,getDateRange:function(b,c,f){f=f||d;if(a(b,c))return A(b,f);var e=f.isHtml?k().HTML_RANGE_SEPARATOR:k().RANGE_SEPARATOR;return m(e,A(b,f),A(c,f))},getTime:f,getRelativeTime:b,getTimeRange:function(a,b,c){c=c||d;var h=c.isHtml?k().HTML_RANGE_SEPARATOR:k().RANGE_SEPARATOR,g=Math.abs(a.diff(b,"days"));if(0===a.diff(b))return f(a,c);if(q(a)&&q(b))return 1<g?e(a,
k().DAYS_FORMATS,c,{days:g}):e(a,k().ALL_DAY_FORMATS,c);c=null;return 0===g?m(h,f(a,c),f(b,c)):1===g?m(h,f(a,c),f(b,c)+" (next day)"):m(h,f(a,c),f(b,c)+" ("+g.toString()+" days later)")},getDatetime:w,getDatetimeRange:function(b,c,e){e=e||d;if(0===b.diff(c))return w(b,e);var h=e.isHtml?k().HTML_RANGE_SEPARATOR:k().RANGE_SEPARATOR;if(q(b)&&q(c))return 1<Math.abs(b.diff(c,"days"))?(c=c.clone(),c.subtract(1,"days"),m(h,A(b,e),A(c,e))):e.isAlwaysHideDate&&a(b,e.hideDate)?f(b,e):A(b,e);var g;if(g=e.is12amPlus1)if(g=
q(c)){g=b;var n=c;!moment.isMoment(g)||!moment.isMoment(n)?g=!1:(g=g.clone().startOf("day"),n=n.clone().startOf("day"),g=1===n.diff(g,"days"))}if(a(b,c)||g){c=m(k().RANGE_SEPARATOR,f(b,e),f(c,e));g&&(c+="+1");if(e.isHideDate&&a(b,e.hideDate))return c;b=A(b,e);e=e.isHtml?k().HTML_TIME_SEPARATOR:k().TIME_SEPARATOR;return m(e,b,c)}e.isHideDate?(g=_.defaults({isHideDate:!1,hideDate:null},e),e=e.isAlwaysHideDate?e:g):e=g=e;return m(h,w(b,e),w(c,g))}}}]);n.filter("dateOffset",["moment",function(c){return function(g,
k,e,d){if(!c.isMoment(g))return"";k=k||0;e=e||"minutes";g=g.clone();return d?g.add(k,e):g.subtract(k,e)}}]).filter("dateSubtract",["$filter",function(c){return function(g,k,e){return c("dateOffset")(g,k,e,!1)}}]).filter("dateAdd",["$filter",function(c){return function(g,k,e){return c("dateOffset")(g,k,e,!0)}}]);n.filter("dateRange",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments)),d=e.endAt;return!g.isMoment(k)||!g.isMoment(d)?(console.log("dateRange: invalid moments",
k,d,e),""):c.getDateRange(k,d,e)}}]).filter("datetimeRange",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments)),d=e.endAt;return!g.isMoment(k)||!g.isMoment(d)?(console.log("datetimeRange: invalid moments",k,d,e),""):c.getDatetimeRange(k,d,e)}}]).filter("timeRange",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments)),d=e.endAt;return!g.isMoment(k)||!g.isMoment(d)?(console.log("timeRange: invalid moments",k,d,e),""):c.getTimeRange(k,
d,e)}}]).filter("date",["dates","moment",function(c,g){return function(k){_.isString(k)&&(k=g(k));var e=c.options(_.rest(arguments));return!g.isMoment(k)?(console.log("date: invalid moment",k,e),""):c.getDate(k,e)}}]).filter("day",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments));return!g.isMoment(k)?(console.log("day: invalid moment",k,e),""):c.getDay(k,e)}}]).filter("month",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments));
return!g.isMoment(k)?(console.log("day: invalid moment",k,e),""):c.getMonth(k,e)}}]).filter("datetime",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments));return!g.isMoment(k)?(console.log("datetime: invalid moment",k,e),""):c.getDatetime(k,e)}}]).filter("datetimeWithTimezone",["dates","moment",function(c,g){return function(k,e){var d=c.options(_.slice(arguments,2));if(!g.isMoment(k))return console.log("datetimeWithTimezone: invalid moment",k,e,d),"";if(!_.isString(e))return console.log("datetimeWithTimezone: invalid timezone",
k,e,d),"";var m=g.tz(k.valueOf(),e);return c.getDatetime(m,d)}}]).filter("timeWithTimezone",["dates","moment",function(c,g){return function(k,e){var d=c.options(_.slice(arguments,2));if(!_.isString(e))return console.log("timeWithTimezone: invalid timezone",k,e,d),"";var m=g.tz(k.valueOf(),e);return c.getTime(m,d)}}]).filter("dateWithTimezone",["dates","moment",function(c,g){return function(k,e){var d=c.options(_.slice(arguments,2));if(!g.isMoment(k))return console.log("dateWithTimezone: invalid moment",
k,e,d),"";var m=g.tz(k.valueOf(),e);return c.getDate(m,d)}}]).filter("time",["dates","moment",function(c,g){return function(k){var e=c.options(_.rest(arguments));return!k||_.isString(k)&&(k=g(k,"HH:mm"),!g.isMoment(k))?"":c.getTime(k,e)}}]);n.filter("range",[function(){return function(c,g){return _.range(c,g)}}]);n.filter("safeHtml",[function(){return function(c){return c.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}}]);n.filter("firstLineOfMarkdown",[function(){var c=/^\s*$/,g=
/^#+/,k=/([*_]{1,3})(\S.*?\S?)\1/;return function(e){if(!e)return"";e=_.find(e.split("\n"),function(d){return!c.test(d)})||"";return _.trim(e.replace(g,"").replace(k,"$2").replace(k,"$2"))}}]);n.filter("encodeURIComponent",[function(){return function(c){return encodeURIComponent(c)}}]);n.filter("hostname",[function(){return function(c){if(!c)return"";var g=c.toLowerCase(),k=document.createElement("a");k.setAttribute("href",g);k=k.hostname;return!k||-1===g.indexOf(k)?c:k=k.replace(/^www./,"")}}]);
n.filter("withLineBreaks",[function(){return function(c){return c.replace(/\n+/g,"\n<br />\n")}}]);n.factory("phoneNumbers",[function(){var c=_.toTrueKeys([201,202,203,205,206,207,208,209,210,212,213,214,215,216,217,218,219,220,224,225,227,228,229,231,234,239,240,248,251,252,253,254,256,260,262,267,269,270,272,274,276,278,281,283,301,302,303,304,305,307,308,309,310,312,313,314,315,316,317,318,319,320,321,323,325,327,330,331,334,336,337,339,341,346,347,351,352,360,361,364,369,380,385,386,401,402,404,
405,406,407,408,409,410,412,413,414,415,417,419,423,424,425,430,432,434,435,440,442,443,447,458,464,469,470,475,478,479,480,484,501,502,503,504,505,507,508,509,510,512,513,515,516,517,518,520,530,531,534,539,540,541,551,557,559,561,562,563,564,567,570,571,573,574,575,580,582,585,586,601,602,603,605,606,607,608,609,610,612,614,615,616,617,618,619,620,623,626,627,628,629,630,631,636,641,646,650,651,657,659,660,661,662,667,669,678,679,681,682,689,701,702,703,704,706,707,708,712,713,714,715,716,717,718,
719,720,724,725,727,730,731,732,734,737,740,743,747,754,757,760,762,763,764,765,769,770,772,773,774,775,779,781,785,786,801,802,803,804,805,806,808,810,812,813,814,815,816,817,818,828,830,831,832,843,845,847,848,850,854,856,857,858,859,860,862,863,864,865,870,872,878,901,903,904,906,907,908,909,910,912,913,914,915,916,917,918,919,920,925,927,928,929,930,931,934,935,936,937,938,940,941,947,949,951,952,954,956,959,970,971,972,973,975,978,979,980,984,985,989]),g=function(c){return c?c.replace(/\D/g,
""):""},k=function(c){return!c?"":("+"===c[0]?"+":"")+g(c)},e=/^\+?\d{5,15}$/,d=function(d){d=g(d);11===d.length&&"1"===d[0]&&(d=d.slice(1));if(10===d.length){var a=d.slice(0,3);if(c[a])return{isUsPhoneNumber:!0,areaCode:a,exchange:d.slice(3,6),suffix:d.slice(6,10)}}return{isUsPhoneNumber:!1}};return{cleanPhoneNumber:k,digits:g,isPossiblyValid:function(c){return e.test(k(c))},parseUsPhoneNumber:d,formatUsPhoneNumber:function(c){c=c||"";if("+"===c[0])return c;var a=d(c);return!a.isUsPhoneNumber?c:
"("+a.areaCode+") "+a.exchange+"-"+a.suffix}}}]);n.filter("phone",["navigation","phoneNumbers",function(c,g){return function(c){return g.formatUsPhoneNumber(c)}}]);n.filter("contactPhone",["navigation",function(c){return function(g){var k=c.currentCompany,k=k.country||k.processorCountry;return!g.phoneCountry||g.phoneCountry===k?g.displayPhoneNational:g.displayPhoneInternational}}]);n.filter("currencyClass",[function(){return function(c){return(c=_.resolveCurrency(c))?"currency--"+c:""}}]);n.filter("currencySymbol",
["auth","db","localization",function(c,g,k){var e=g.slipstream("currencies");return function(d,g){d=_.resolveCurrency(d);var a=e[d];if(!a)return console.warn("currencySymbol filter: unsupported currency",d),"";c.currentUser.isAuthenticated&&c.currentUser.company.isAdmin&&(g="long");if("short"===g)return a.symbol;if("long"===g)return a.symbolLong;var q=a.symbolLongByLanguage;return(q?q[k.current().LANGUAGE]:"")||a.symbolLong}}]);n.filter("currencyDisplayName",["db","localization",function(c,g){var k=
c.slipstream("currencies");return function(c,d){c=_.resolveCurrency(c);var g=k[c];return!g?(console.warn("currencyDisplayName filter: unsupported currency",c),""):"short"==d?g.displayName:g.displayNameLong}}]);n.filter("amount",["$filter","db","localization","navigation",function(c,g,k,e){var d=g.slipstream("currencies"),m=c("currencySymbol");return function(a,c,h,b){if(!_.isNumber(a))return"";_.isBoolean(c)&&_.isUndefined(b)&&(b=!h,h=c,c=null);c=_.resolveCurrency(c);c||(e.currentCompany?(console.warn("amount filter: not passed currency, falling back to currentCompany"),
c=e.currentCompany.processorCurrency):(console.warn("amount filter: not passed currency, no currentCompany to fall back to"),c="",b=!1));_.isUndefined(b)&&(b=!0);var f=k.current(),g=d[c];g?g=g.decimalPlaces:(console.warn("amount filter: passed unsupported currency:",c),b=!1,g=2);a/=Math.pow(10,g);c=b?m(c,b):"";return f.formatCurrency(a,c,h)}}]);n.filter("count",["localization",function(c){return function(g,k){if(null===g||void 0===g)return"";Math.round(g)!==g&&(g=parseFloat(g.toFixed(k||4)));return c.current().formatNumber(g)}}]);
n.filter("stripNewlines",[function(){return function(c){return c.replace(/\r|\n/g,"").replace(/\s+/g," ")}}]);n.filter("yesno",[function(){return function(c,g,k){g=_.isUndefined(g)?"Yes":g;k=_.isUndefined(k)?"No":k;return c?g:k}}]);n.filter("name",[function(){return function(c,g){g=g||"";return _.isString(c)?c||g:_.isObject(c)?c.shortName||c.name||c.unicode||g:g}}]);n.filter("value",[function(){return function(c){return _.isString(c)?c:c.value}}]);n.filter("personalizeCompanyName",["auth",function(c){return function(g,
k,e){return!c.currentUser||c.currentUser.company!==g?e?k?"Them":"them":g.name:k?"You":"you"}}]);n.filter("lastNameFirst",[function(){return function(c){c=c.split(/\s+/);var g=c.pop();c.length&&(g+=",");c.unshift(g);return c.join(" ")}}]);n.filter("initials",[function(){return function(c){c=c.split(/\s+/);return 1<c.length?c[0][0]+c[c.length-1][0]:c[0][0]||""}}]);n.filter("onlineStatusClass",[function(){return function(c){return!c?"":c.isBookableOnlyByPhone?"icon-ava-phone":c.isBookable&&c.isUnlisted?
"icon-ava-unlisted":!c.isBookable&&(c.isResourcesAvailable||c.item.company.companyFeatures.isResourceBookableCapacityEnabled)?"icon-ava-lock":""}}]);n.filter("capacityIndicatorClass",[function(){return function(c){var g=_.contains(arguments,"filled"),k=_.contains(arguments,"large")?"icon-user":"icon-user-small";return c.companyFeatures.isResourceBookableCapacityEnabled?g?"cb-square filled":"cb-square":g?k+" full":k+" empty"}}]);n.filter("blockedCapacityClass",[function(){return function(c,g){return 0===
c?"ava-is-empty":c===g?"ava-is-full":c>g?"ava-is-overbooked":"ava-is-booked"}}]);n.filter("capacityClass",["models",function(c){return function(g,k,e){var d=g.customerCount,m=g.capacity;_.isUndefined(k)||(d=k);var a;_.isUndefined(e)&&(e=!0);if(g.cls===c.ItemGroup.cls)return 0<(g.bookingCount||0)?"ava-is-booked":"ava-is-empty";g.cls===c.Block.cls&&(a=g.reservedCapacity-d);g.cls===c.CustomerTypeRate.cls&&(a=m-d);if(g.cls===c.Availability.cls){a=e?"bookableCapacity":"blocksIncludedBookableCapacity";
e=e?"nonResourceBookableCapacity":"blocksIncludedNonResourceBookableCapacity";if(!d)return"ava-is-empty";if(g.company.companyFeatures.isResourceBookableCapacityEnabled){a=g[a];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",g.uri),"ava-is-empty";if(g.isOverusingResources||0>g[e])return"ava-is-overbooked"}else{a=g[e];if(_.isUndefined(a))return console.log("capacityClass: no capacity information for object",g.uri),"ava-is-empty";null!==a&&(a+=g.customerCount-
d)}}return 0>=d?"ava-is-empty":0>a?"ava-is-overbooked":0===a?"ava-is-full":null===a||0<a?"ava-is-booked":"ava-is-empty"}}]);n.filter("liveCapacityClass",["models",function(c){return function(c,k){if(!c||c.$fresh)return"ava-is-empty";var e=k.bookCountsCtrl.availabilityCustomerCount;if(!e)return"ava-is-empty";if(0===k.bookCountsCtrl.customerCount&&(k.availability.isOverbooked||k.availability.isOverusingResources)||c.isOverbookingAvailability||c.isOverusingResources)return"ava-is-overbooked";if(0===
c.availabilityLiveBookableCapacity)return"ava-is-full";if(0<e&&(null===c.availabilityLiveBookableCapacity||0<c.availabilityLiveBookableCapacity))return"ava-is-booked";console.log("liveCapacityClass: no capacity information.",c,e);return"ava-is-empty"}}]);n.filter("availableClass",[function(){return function(c,g){var k=c.capacity-c.customerCount;_.isUndefined(g)||(k=g);return 0>=k?"ava-is-unbookable":"ava-is-bookable"}}]);n.filter("hasCustomersClass",[function(){return function(c){return 0<c.customerCount?
"ava-is-booked":"ava-is-empty"}}]);n.filter("abs",[function(){return function(c){return Math.abs(c||0)}}]);n.filter("isAllDay",["dates",function(c){return function(g){return!g?(console.warn("isAllDay: invalid range"),!1):!g.startAt||!g.endAt||+g.startAt===+g.endAt?!1:c.isMidnight(g.startAt)&&c.isMidnight(g.endAt)}}]);n.filter("isMidnight",["dates","moment",function(c,g){return function(k){return!g.isMoment(k)?(console.warn("isMidnight: invalid date",k),!1):c.isMidnight(k)}}]);n.filter("contains",
[function(){return function(c,g){return _.contains(c,g)}}]);n.filter("bookingUrl",["auth","navigation","urls",function(c,g,k){return function(e){return c.permissions.can("viewDashboardSection",e.company)?e.$url(k.dashboard.overlay.contact.booking):e.affiliation&&c.permissions.can("viewDashboardSection",e.affiliation.affiliateCompany)?e.$url(k.dashboard.bookings.contact.affiliateBookingPermalink):e.$url(k.company.item.booking)}}]);n.filter("orderUrl",["auth","navigation","urls",function(c,g,k){return function(e){if(c.permissions.can("viewDashboardSection",
e.company))return e.$url(k.dashboard.overlay.contact.order);var d=_.filter(e.allBookings,function(d){return d.affiliation&&c.permissions.can("viewDashboardSection",d.affiliation.affiliateCompany)});return 0<d.length?k.populate(k.dashboard.bookings.contact.affiliateOrderPermalink,{affiliateShortname:d[0].affiliation.affiliateCompany.shortname,shortname:e.company.shortname,contactPk:e.contact.pk,orderUuid:e.uuid}):e.$url(k.company.order.index)}}]);n.filter("contactUrl",["auth","navigation","urls","require",
function(c,g,k,e){return function(d){if(c.permissions.can("viewDashboardSection",d.company))return d.$url(k.dashboard.overlay.contact.index);var e=_.findWhere(c.currentUser.company.partners,{company:d.company});return e&&e.affiliateGroup&&c.permissions.can("viewDashboardSection",c.currentUser.company)?k.populate(k.dashboard.bookings.contact.affiliateContactPermalink,{affiliateShortname:c.currentUser.company.shortname,shortname:d.company.shortname,contactPk:d.pk}):d.$url(k.company.index)}}]);n.filter("availabilityUrl",
["auth","models","urls",function(c,g,k){return function(e){return c.permissions.can("viewDashboardSection",e.item.company)?e.$url(k.dashboard.overlay.availability.index):e.$url(k.company.item.book)}}]);n.filter("itemGroupUrl",["auth","flows","models","urls",function(c,g,k,e){return function(d,k){var a=c.permissions.can("viewDashboardSection",d.item.company)?e.dashboard.overlay.item.date:e.company.item.date,a=e.populate(a,{shortname:d.item.company.shortname,itemPk:d.item.pk,date:k.format("YYYY-MM-DD")});
return a=g.extendWithFlow(a)}}]);n.filter("itemUrl",["auth","urls",function(c,g){return function(k){return c.permissions.can("viewItemsSection",k.company)?k.$url(g.dashboard.items.item.index):k.$url(g.company.item.index)}}]);n.filter("checkinUrl",["db","urls",function(c,g){return function(k){return!k?"":c.slipstream("checkinDomain")+g.populate(g.embeds.checkin.qr,{encodedCustomerPk:k.encodedPk})}}]);n.filter("waiverUrl",[function(){return function(c,g){return c.company.smartwaiverUrl+"?auto_waiverid="+
c.waiverUuid+"&auto_tag=fh_id_"+g.pk}}]);n.filter("invoiceUrl",["auth","navigation","urls",function(c,g,k){return function(e,d){d=d||"index";var g;g=c.permissions.can("viewDashboardSection",e.company)?k.dashboard.reports.invoices.invoice[d]:e.affiliation&&c.permissions.can("viewDashboardSection",e.affiliation.affiliateCompany)?k.dashboard.reports.invoices.partnerInvoice[d]:k.company.invoice.index;if(!g)throw Error("invoiceUrl: invalid view "+d);return e.$url(g)}}]);n.filter("uploadUrl",["navigation",
"urls",function(c,g){return function(k){return g.populate(g.dashboard.reports.accounts.upload,{shortname:c.currentCompany.shortname,uploadPk:k.pk})}}]);n.filter("companyDefaultIntegrationsUrl",["navigation","urls","auth","models",function(c,g,k,e){return function(c){var m={shortname:c.shortname};return k.permissions.canList(e.ResellerCompany,c)?c.isAdmin?g.populate(g.dashboard.settings.reseller.apps.index,m):g.populate(g.dashboard.settings.reseller.index,m):g.populate(g.dashboard.settings.integrations.subscribe,
m)}}]);n.filter("key",[function(){return function(c){return c.cls+"."+c.pk}}]);n.filter("summary",[function(){return function(c,g,k){return _.reduce(c,function(c,d){return c+(_.getDotted(d,g)||0)},k||0)}}]);n.filter("uniqueCount",["$filter",function(c){var g=c("pluralize");return function(c,e,d,m){var a={};_.forEach(c,function(c){c=_.get(c,e);_.isObject(c)&&c.uri&&(c=c.uri);a[c]=1});c=_.sum(a);return d||m?c.toString()+" "+g(c,d,m):c}}]);n.filter("uncamel",[function(){var c=/([a-z])([A-Z])/g,g=function(c,
e,d){return e+" "+d};return function(k){return k.replace(c,g)}}]);n.filter("activityChange",["$filter","models",function(c,g){var k=c("amount"),e=c("percentage"),d=function(a){moment.isMoment(a)||(a=moment.parseZone(a));return a},m={AmountField:k,PositiveAmountField:k,PercentField:e,PositivePercentField:e,DateTimeField:function(a){return c("datetime")(d(a))},DateField:function(a){return c("date")(d(a))},ColumnWidthField:function(a){return g.FlowNode.WIDTH_LABELS[a]||a}};return function(a,d){var e=
m[d];return e?e(a):_.isObject(a)?c("name")(a):a}}]);n.filter("defaultIfUndefined",[function(){return function(c,g){return _.isUndefined(c)?g:c}}]);n.filter("fieldOrBoolean",["$filter",function(c){return function(g){return!0===g?"is set":!1===g?"is empty":_.isObject(g)?c("name")(g):g}}]);n.filter("names",["$filter",function(c){return function(g){return _.map(g,c("name")).join(", ")}}]);n.filter("isEmptyFilter",["filterFields",function(c){return function(g){return _.any(c.EMPTY_VALUES,function(c){return _.isEqual(c,
g)})}}]);n.filter("defaults",[function(){return _.defaults}]);n.filter("parsePresetDateRange",["dateUtils",function(c){return function(g,k){return c.dateRange(g,k)}}]);n.filter("colorClass",["models",function(c){return function(g,k,e){k=k||"";e=e||"";if(!g)return e;g.cls===c.Booking.cls?g=g.availability.item:g.item&&(g=g.item);g.color&&(g=g.color);if(!g||!_.isNumber(g))return e;if(!c.Item.isValidColor(g))return console.warn("colorClass filter: unsupported color:",g),e;k&&"-"!==k.charAt(0)&&(k=" "+
k);return"color-"+g+k}}]);n.filter("approximate",["$filter",function(c){return function(g,k){var e,d=1,m=k?"+":"";if(1E3<=g)e=100,d=1E3,m="k"+m;else if(100<=g)e=100;else if(10<=g)e=10;else return g;return c("count")((g-g%e)/d,1)+m}}])})();
(function(){var n=angular.module("lib.services",["flash.services","lib.factories","lib.filters","lib.models","lib.processors"]);n.factory("sessionStorage",[function(){var c=function(){var c={};return{get:function(e){e=c[e];if(!_.isUndefined(e))return _.parseJSON(e)},set:function(e,d){c[e]=_.stringifyJSON(d)},del:function(e){delete c[e]},clear:function(){c={}}}},g=c();g.create=c;return g}]);n.factory("storage",["$window","sessionStorage",function(c,g){var k;try{window.localStorage.setItem("$test",
"$test"),window.localStorage.removeItem("$test"),k=!0}catch(e){k=!1}var d;k?(d={key:function(d){try{return c.localStorage.key(d)}catch(a){}},get:function(d){try{var a=c.localStorage.getItem(d);if(_.isString(a))return _.parseJSON(a)}catch(e){}},set:function(d,a){try{c.localStorage.setItem(d,_.stringifyJSON(a))}catch(e){}},del:function(d){try{c.localStorage.removeItem(d)}catch(a){}},clear:function(){try{c.localStorage.clear()}catch(d){}}},Object.defineProperty(d,"length",{get:function(){try{return c.localStorage.length}catch(d){return 0}},
configurable:!1,enumerable:!1})):d=g.create();d.isPersistent=function(){return k};return d}]);n.factory("persistentStorage",["$q","$rootScope","clientOptions","db","events","navigation","require","storage",function(c,g,k,e,d,m,a,q){_.isValidUuid(k.userIdentifier)||(c=q.get("persistentStorageIdentifier"),k.userIdentifier=_.isValidUuid(c)?c:_.uuid());q.set("persistentStorageIdentifier",k.userIdentifier);var h=k.userIdentifier;console.log("persistentStorage: identified user:",k.userIdentifier);var b=
function(b){a.notNull(m.currentCompany,"shortname","persistentStorage needs currentCompany");var c={identifier:k.userIdentifier,shortname:m.currentCompany.shortname};b&&(c.key=b);return c},f={getIdentifier:function(){return k.userIdentifier},setIdentifier:function(a){q.set("persistentStorageIdentifier",a);k.userIdentifier=a;console.log("persistentStorage: re-identified user:",a);d.broadcast("persistentStorage.reIdentifiedUser")},restoreIdentifier:function(){f.setIdentifier(h)},regenerateIdentifier:function(){f.setIdentifier(_.uuid())},
get:function(a){a=b(a);var c=e.persistentStoreItem(a);return c.$promise.then(function(a){return c})},set:function(a,c){var f=b(a),d=e.persistentStoreItem.update(f,c);return d.$promise.then(function(){return d})},del:function(a){a=b(a);return e.persistentStoreItem.remove(a).$promise},clear:function(){var a=b();return e.persistentStoreForCompany.remove(a).$promise},getForAllCompanies:function(a){var b=e.persistentStore({identifier:k.userIdentifier});return b.$promise.then(function(){var c={};_.forEach(b,
function(b){c[b.company.shortname]={company:b.company};c[b.company.shortname][a]=b[a]});return c})}};d.on(g,"auth.logout",f.regenerateIdentifier);d.on(g,"auth.login",f.regenerateIdentifier);return f}]);n.factory("translate",["$rootScope","$window","db",function(c,g,k){var e,d=function(a){0>=a?console.warn("translate: failed to load Google Translate"):!g.google||!g.google.translate||!g.google.translate.TranslateElement?(console.info("translate: not yet loaded, retrying..."),setTimeout(_.bind(d,_,a-
1),1E3)):(console.info("translate: loaded"),c.$apply(function(){m.isReady=!0}))},m={isReady:!1,initialize:function(a){m.isReady?e?a.append(e):(e=$('<div id="google-translate"></div>'),a.append(e),new g.google.translate.TranslateElement({pageLanguage:"en"},e[0])):console.warn("translate: attempting to initialize before load")}};k.slipstream("isAnonymous")&&d(3);return m}]);n.factory("postBook",["$filter","auth","navigation","require",function(c,g,k,e){return{startBooking:function(c){console.log("postBook: start booking",
c);g.sessionStorage.set("postBook.path",c)},stopBooking:function(d){e.assert(d,"postBook: expected booking");var m=c("bookingUrl")(d),a=g.sessionStorage.get("postBook.path");g.sessionStorage.del("postBook.path");console.log("postBook: stop booking",d,m,a);if(!a)return m;d=k.parseMultiUrl(m);if(!d||0!==a.indexOf(d.path))return m;m={};m[d.key]=d.multiPath;_.extend(m,d.search);return k.extendQuery(a,m)}}}]);n.constant("Showdown",window.Showdown);n.constant("Mailcheck",window.Mailcheck);n.constant("moment",
window.moment);n.constant("Pikaday",window.Pikaday);n.constant("QRCode",window.QRCode);n.factory("filepicker",function(){return window.filepicker||null});n.factory("d3",function(){return window.d3});n.factory("Raven",function(){return window.Raven||{}});n.factory("diff",function(){return window.JsDiff});n.factory("exporter",["$q","$rootScope","$window","filepicker",function(c,g,k,e){var d=document.createElement("a"),m="download"in d&&"Blob"in window,a=function(a,f,d){var h=c.defer();e.store(a,{filename:f,
mimetype:d},function(a){g.$safeApply(function(){h.resolve(a.url)})},function(){g.$safeApply(function(){h.reject()})});return h.promise},q=function(b,f,h){h=h||{};var g=c.defer();if(m)h=new Blob([b],{type:h.mediaType}),h=URL.createObjectURL(h),d.setAttribute("href",h),d.setAttribute("download",f),document.body.appendChild(d),d.click(),document.body.removeChild(d),g.resolve();else if(h.openWindow)f=encodeURIComponent(b),window.open("data:"+h.mediaType+";charset=utf-8,"+f),g.resolve();else{if(!e||e._queue)return g.reject(),
g.promise;a(b,f,"application/octet-stream").then(function(a){k.location.href=a;g.resolve()},function(){g.reject()})}return g.promise},h=function(a){var c="\ufeff";_.forEach(a,function(a){a=_.map(a,function(a){_.isUndefined(a)?a="":_.isString(a)&&(a=a.replace(/^\s+|\s+$/g,""),a=a.replace(/\s+/g," "),a=a.replace(/,$/,""),a=a.replace(/"/g,'""'),a='"'+a+'"');return a});c+=a.join(",")+"\n"});return c};return{exportToCsvFile:function(a,c,d){d=d||{};d.mediaType="text/csv";a=h(a);return q(a,c,d)},isDownloadSupported:m}}]);
n.factory("xmessage",["$window","db",function(c,g){return{broadcast:function(k,e,d){k={type:k};_.extend(k,e);d=d||"*";e="";try{e=_.stringifyJSON(k),g.slipstream("isDebug")&&console.info("xmessage: broadcast",e),c.parent.postMessage(e,d)}catch(m){console.error("xmessage: unable to broadcast",e)}},on:function(k,e,d,m){m=m||"*";var a=function(a){try{var b=_.parseJSON(a.data);_.isObject(b)&&(g.slipstream("isDebug")&&console.info("xmessage: on",b),e&&b.type===e&&("*"!==m&&(!m||m!==b.origin)||d(b.data)))}catch(c){}};
c.addEventListener("message",a);var q=function(){c.removeEventListener("message",a)};k.$on("$destroy",function(){q()});return q}}}]);n.factory("events",["$rootScope",function(c){return{on:function(c,k,e){return c.$on(k,e)},broadcast:function(){c.$broadcast.apply(c,arguments)}}}]);n.factory("require",function(){var c=function(c,k){c="require: "+c;return k?c+" ("+k+")":c};return{assert:function(g,k){if(!g)throw Error(c("expected '"+g+"' to be true",k));},assertDefined:function(g,k){if(_.isUndefined(g))throw Error(c("expected '"+
g+"' to be defined",k));},notNull:function(g,k,e){if(null===g[k])throw Error(c("expected '"+k+"' not to be null",e));},defined:function(g,k,e){if(_.isUndefined(g[k]))throw Error(c("expected '"+k+"' to be defined",e));},unDefined:function(g,k,e){if(!_.isUndefined(g[k]))throw Error(c("expected '"+k+"' to be undefined",e));},inScope:function(g,k,e){if(_.isUndefined(_.getDotted(g,k)))throw Error(c("expected '"+k+"' to be in scope",e));},notInScope:function(g,k,e){if(!_.isUndefined(g[k]))throw Error(c("expected '"+
k+"' not to be in scope",e));}}});n.provider("convert",["moment",function(c){var g=/_([a-z0-9])/g,k=function(a){a=a||"";return"/"===a[0]?a:a.replace(g,function(a,b){return b.toUpperCase()})},e=function(a,b){if(!a)return null;var f=c(a,"YYYY-MM-DDTHH:mm:ssZZ",!0);if(f.isValid())return f;f=c(a,"YYYY-MM-DDTHH:mm:ss",!0);if(f.isValid())return f;f=c(a,"YYYY-MM-DD",!0);if(f.isValid())return f;throw Error("convert: invalid date "+b+": "+a);},d=/_at$/,m=function(a){if(_.isArray(a))for(var b=0,c=a.length;b<
c;b++)m(a[b]);else if(_.isObject(a))for(b in a)if(a.hasOwnProperty(b)){c=a[b];delete a[b];var f=k(b);d.test(b)||"at"===b?a[f]=e(c,f):a[f]=m(c)}return a},a=function(a,b,c){return b+"_"+c.toLowerCase()},q=/([a-z])([A-Z0-9])/g,h=/([0-9])([a-zA-Z])/g,b=function(b){b=b.replace(q,a);return b.replace(h,a)},f=function(a){var d,e;if(c.isMoment(a))d=a.format();else{if(_.isDate(a))throw Error("convert: expected moment, not date "+a);if(_.isArray(a)){d=[];e=0;for(var h=a.length;e<h;e++)d.push(f(a[e]))}else if(_.isObject(a))for(h in d=
{},a)h&&(a.hasOwnProperty(h)&&"$"!==h[0])&&(e=b(h),d[e]=f(a[h]));else d=a}return d},n=function(a,b,c){return b+" "+c},w=function(a,b){a=a.toString();a=a.replace(q,n);a=a.replace(h,n);a=a.replace(/-/g," ");return _[b?"titleize":"capitalize"](a.toLowerCase())};this.serverResponse=m;this.clientRequest=f;this.$get=function(){return{serverResponse:m,clientRequest:f,camelKey:k,unCamelKey:b,humanize:w}}}]);n.factory("shortcutsOverlay",["$rootScope","auth","events",function(c,g,k){var e={isShowing:!1,shouldConfirmClose:!1,
show:function(){e.isShowing=!0},hide:function(){e.isShowing=!1},confirmClose:function(c){e.shouldConfirmClose=c}},d;k.on(c,"navigation.company.updated",function(c,a){var k=a.company;k&&d!==k&&(d=k,k.adminNotes&&g.permissions.canAdminUpdate(k)&&e.show())});return e}]);n.factory("shortcuts",["$document","auth","d",function(c,g,k){var e=[],d={"delete":8,tab:9,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,
"\\":220,"]":221,"'":222},m=function(a,c){for(var e=a.length,h=0;h<e;h++)d[a[h]]=c+h};m("1234567890",49);m("abcdefghijklmnopqrstuvwxyz",65);var a={};_.forEach(d,function(b,c){a[b]=c});var q={shift:"shift",ctrl:"ctrl",meta:"meta",alt:"alt"},h=function(a){a=a.split("+");var c={};_.forEach(q,function(a){c[a]=!1});_.forEach(a,function(a){var b=q[a];b?c[b]=!0:c.keyCode=d[a]});return c};c.on("keydown",function(b){if(g.currentUser.isAuthenticated){var c=$(b.target);if(!k.isTextInput(c)&&!c.is(".js-disable-shortcuts, select")){c=
{};c.keyCode=d[a[b.which]];c.meta=b.metaKey||!1;c.alt=b.altKey||!1;c.ctrl=b.ctrlKey||!1;c.shift=b.shiftKey||!1;for(var h,m=e.length-1;0<=m;m--)if(h=e[m],c&&h.keys&&c.keyCode===h.keys.keyCode&&c.ctrl===h.keys.ctrl&&c.alt===h.keys.alt&&c.meta===h.keys.meta&&c.shift===h.keys.shift){b.preventDefault();h.action();break}}}});return{shortcuts:e,register:function(a){a.keys=h(a.keySet);if(a.keys)return e.push(a),a},unregister:function(a){_.overwriteWithout(e,a)}}}]);n.factory("toggles",["$document","$rootScope",
function(c,g){$("html").on("click",function(e){var d=$(e.target);d.closest("[ng-toggle], [ng-toggled], [ng-toggled-show]").length||$.contains(c[0].documentElement,e.target)&&(d.closest(".select2-container").length||g.$apply(function(){_.forEach(k.toggles,function(c,a){if(c.autoClose&&(!c.group||c.isCloseableGroup))c.state=!1})}))});var k={toggles:{},create:function(c,d){var m=k.toggles[c];m?(m.state=d.defaultState||m.state||!1,m.count+=1):(m={autoClose:d.autoClose||!1,state:d.defaultState||!1,group:d.group||
null,isCloseableGroup:d.isCloseableGroup||!1,when:d.when||_.always,count:1},k.toggles[c]=m,m.group&&(m.deregisterGroupWatch=g.$watch(function(){return m.state},function(a){a&&_.forEach(k.toggles,function(a,c){m!==a&&m.group===a.group&&(a.state=!1)})})))},destroy:function(c){var d=k.toggles[c];d?(d.count-=1,d.count||(d.deregisterGroupWatch&&d.deregisterGroupWatch(),delete k.toggles[c])):console.warn("invalid toggle",c)},toggle:function(c,d){var g=k.toggles[c];g?g.when()?(d=_.isUndefined(d)?!g.state:
!!d,g.state=g.group?g.isCloseableGroup?d:!0:d):console.info("toggles: disabled toggle",c):console.warn("toggles: invalid toggle",c)},state:function(c){c=k.toggles[c];return!c?!1:c.state},closeAll:function(){_.forEach(k.toggles,function(c){c.state=!1})}};return k}]);angular.module("lib.services.interpolate",[]).provider("$interpolate",[function(){var c="{{",g="}}",k="{!",e="!}";this.startSymbol=function(d){return d?(c=d,this):c};this.endSymbol=function(c){return c?(g=c,this):g};this.staticStartSymbol=
function(c){return c?(k=c,this):k};this.staticEndSymbol=function(c){return c?(e=c,this):e};this.$get=["$parse","$exceptionHandler","$sce",function(d,m,a){var q=c.length,h=g.length,b=k.length,f=e.length;m=function(m,w,n){for(var C,z,l=0,p=[],F=m.length,G=!1,x,r,D,B,t=[];l<F;)-1!=(C=m.indexOf(c,l))&&-1!=(z=m.indexOf(g,C+q))?(l!=C&&p.push(m.substring(l,C)),p.push({fn:d(x=m.substring(C+q,z)),exp:x,"static":!1}),l=z+h,G=!0):-1!=(C=m.indexOf(k,l))&&-1!=(z=m.indexOf(e,C+b))?(l!=C&&p.push(m.substring(l,C)),
p.push({fn:d(x=m.substring(C+b,z)),exp:x,"static":!0}),l=z+f,G=!0):(l!=F&&p.push(m.substring(l)),l=F);if(!(F=p.length))p.push(""),F=1;if(n&&1<p.length)throw Error("$interpolate: error while interpolating: SCE violation");if(!w||G)return t.length=F,B=function(b){if("undefined"!==typeof B.value)return B.value;try{for(var c=0,f=0,d=F,e;f<d;f++)e=p[f],"object"===typeof e?(r=e.fn(b),r=n?a.getTrusted(n,r):a.valueOf(r),D=typeof r,null===r||"undefined"===D?r="":"number"===D?r=""+r:"string"!==D&&(r=angular.toJson(r)),
e.static?p[f]=r:c++):r=e,t[f]=r;var h=t.join("");c||(B.value=h);return h}catch(g){console.error("unable to interpolate",m,"error",g)}},B.exp=m,B.parts=p,B};m.startSymbol=function(){return c};m.endSymbol=function(){return g};m.staticStartSymbol=function(){return k};m.staticEndSymbol=function(){return e};return m}]}]);n.factory("selectedItems",["navigation",function(c){return{extendUrl:function(g,k){if(k.length){var e={"selected-items":_.pluck(k,"pk").join(",")};return c.compose(g,e)}return g}}}]);
n.factory("parseAttrsForScope",["$parse",function(c){return function(g,k,e,d){var m={},a=_.isString(d)?function(a){return d+_.capitalize(a.slice(0,1))+a.slice(1)}:function(a){return a};_.forEach(e,function(d,e){var b=a(e);"@"===d?m[e]=g[b]:"="===d?m[e]=k.$eval(g[b]):"&"===d&&(m[e]=c(g[b]).bind(null,k))});return m}}]);n.factory("tableHeaders",["$parse",function(c){return{parsePredicate:function(g,k,e,d){d=d||"$row";var m=_.choose(k.split(";"),function(a){if(a)return c(a)}),m=_.map(m,function(a,c){return function(c){var b=
{};b[d]=c;b=a(g,b);moment.isMoment(b)&&(b=b.unix());return _.isUndefined(b)?(console.warn("ng-table-header: predicate returned undefined",k,c),0):b}});1===m.length&&(m=m[0]);m.source=k;m.isDefault=e||!1;return m}}}]);n.factory("autoExport",["$filter","$timeout","exporter","flash",function(c,g,k,e){var d=c("stripNewlines"),m=function(a){return a.replace(/\u2011/g,"-")},a=function(b){return _.map(b.contents(),function(b){var c=$(b);if(3===b.nodeType)return c.text();if(c.is(":visible"))return a(c)}).join(" ")},
q=function(a){a=!_.isUndefined(a)?a:1;return _.map(_.range(a),_.constant(""))},h=function(a){if(!a||!a.length)console.warn("autoExport: no exports found");else{if(1===a.length)return a[0];var b={rows:a[0].rows,filename:a[0].filename};_.forEach(_.rest(a),function(a){b.rows.push(q());_.ref.append(b.rows,a.rows)});return b}},b=function(b,c){var f=c?"> .td":"> td",e=[];_.forEach(b.find(c?"> thead > .tr, > .tbody > .tr, > .tfoot > .tr":"> thead > tr, > tbody > tr, > tfoot > tr"),function(b){b=$(b);var c;
if(!(c=b.data().ngAutoExportSkip)||!c()){var h=[];_.forEach(b.find(f),function(b){b=$(b);var c=b.data(),f;if(!(f=c.ngAutoExportSkip)||!f()){var e;f=(e=c.ngAutoExportValue)?e():a(b);h.push(m(d(f).trim()));e=(e=b.prop("colspan"))?parseInt(e,10):1;_.ref.append(h,q(e-1))}});e.push(h)}});return{rows:e}},f={},n={status:"ready",autoExport:function(a,c,d){a=a||"default";c=c||a;if("ready"!==n.status)console.warn("autoExport: not ready");else{var m=f[a]||[];m.length?(n.status="processing",g(function(){var a=
[];_.forEach(m,function(c){var f=c.process;f?a.push({rows:f()}):(c=c.element,c.is("table")||(c=c.find("table")),_.forEach(c,function(c){a.push(b($(c)))}))});var f=h(a);n.status="exporting";k.exportToCsvFile(f.rows,c,d).then(function(){n.status="ready"},function(){n.status="ready";e.error("Error exporting "+c)})})):console.warn("autoExport: no exports")}},addExport:function(a,b,c){a=a||"default";var d=f[a]=f[a]||[];a={element:b,namespace:a};_.extend(a,c||{});d.push(a);return a},removeExport:function(a){var b=
f[a.namespace]=f[a.namespace]||[];_.ref.remove(b,a)},isDownloadSupported:k.isDownloadSupported,canExport:function(a){return f[a]?0<f[a].length:!1}};return n}]);n.factory("scrollbar",[function(){var c={width:null,getWidth:function(){if(null!==c.width)return c.width;var g=document.createElement("p");g.style.width="100%";g.style.height="200px";var k=document.createElement("div");k.style.position="absolute";k.style.top="0px";k.style.left="0px";k.style.visibility="hidden";k.style.width="200px";k.style.height=
"150px";k.style.overflow="hidden";k.appendChild(g);document.body.appendChild(k);var e=g.offsetWidth;k.style.overflow="scroll";g=g.offsetWidth;e==g&&(g=k.clientWidth);document.body.removeChild(k);c.width=Math.max(e-g,0);return c.width}};return c}]);n.factory("dateUtils",["moment","models",function(c,g){var k=/^\d\d:\d\d$/,e=function(a){return _.isUndefined(a)?c():c().tz(a)},d=function(a,b){return function(c){return[e(c).subtract(1,a+"s").startOf(a),b?e(c).subtract(1,a+"s"):e(c).subtract(1,a+"s").endOf(a)]}},
m=function(a,b){return function(c){return[e(c).startOf(a),b?e(c):e(c).endOf(a)]}},a=function(a){return function(b){return[e(b).add(1,a+"s").startOf(a),e(b).add(1,a+"s").endOf(a)]}},q=function(a){return function(b){return[e(b).startOf("day"),e(b).add(a-1,"days").endOf("day")]}},h=function(a){return function(b){return[e(b).subtract(a-1,"days").startOf("day"),e(b).endOf("day")]}},b=g.Report,f={};f[b.TODAY_DATE_RANGE]=m("day");f[b.THIS_WEEK_DATE_RANGE]=m("week");f[b.THIS_WEEK_TO_DATE_DATE_RANGE]=m("week",
!0);f[b.THIS_MONTH_DATE_RANGE]=m("month");f[b.THIS_MONTH_TO_DATE_DATE_RANGE]=m("month",!0);f[b.THIS_QUARTER_DATE_RANGE]=m("quarter");f[b.THIS_QUARTER_TO_DATE_DATE_RANGE]=m("quarter",!0);f[b.THIS_YEAR_DATE_RANGE]=m("year");f[b.THIS_YEAR_TO_DATE_DATE_RANGE]=m("year",!0);f[b.YESTERDAY_DATE_RANGE]=d("day");f[b.LAST_WEEK_DATE_RANGE]=d("week");f[b.LAST_WEEK_TO_DATE_DATE_RANGE]=d("week",!0);f[b.LAST_MONTH_DATE_RANGE]=d("month");f[b.LAST_MONTH_TO_DATE_DATE_RANGE]=d("month",!0);f[b.LAST_QUARTER_DATE_RANGE]=
d("quarter");f[b.LAST_QUARTER_TO_DATE_DATE_RANGE]=d("quarter",!0);f[b.LAST_YEAR_DATE_RANGE]=d("year");f[b.LAST_YEAR_TO_DATE_DATE_RANGE]=d("year",!0);f[b.TOMORROW_DATE_RANGE]=a("day");f[b.NEXT_WEEK_DATE_RANGE]=a("week");f[b.NEXT_MONTH_DATE_RANGE]=a("month");f[b.NEXT_YEAR_DATE_RANGE]=a("year");f[b.LAST_SEVEN_DAYS_DATE_RANGE]=h(7);f[b.LAST_THIRTY_DAYS_DATE_RANGE]=h(30);f[b.NEXT_SEVEN_DAYS_DATE_RANGE]=q(7);f[b.NEXT_THIRTY_DAYS_DATE_RANGE]=q(30);return{DATE_RANGES:f,dateRange:function(a,c){var d=f[a];
d||(d=f[b.TODAY_DATE_RANGE]);return d(c)},isInvertedRange:function(a){if(!a[0]||!a[1])return!1;var b=k.test(a[0]),f=b?"HH:mm":null;if(b&&"00:00"===a[1])return!1;b=c(a[0],f);a=c(a[1],f);return b.isValid()&&a.isValid()&&b>a}}}]);n.factory("searchTerms",[function(){return{}}]);n.factory("flows",["$rootScope","$q","availabilityCalendarController","cache","db","models","navigation","require","urls",function(c,g,k,e,d,m,a,q,h){var b=m.FlowNode,f=a.getPks("selected-items"),n=function(a,c){!a.children.length&&
c&&(a.emptyPageChildren=_.map(c,function(c){return{cls:b.cls,uri:"",pk:null,company:a.company,type:b.ITEM_TYPE,parent:a,item:c,properties:{},unicode:c.unicode}}))},w,u=function(a,b){var c=d.defaultFlowPage({shortname:a});c.$promise.then(function(){b.resolve();C.initialFlowNode=c.flowNode},b.reject)},C={wrapEndpoint:function(a,b){return function(c,e,h,g,k){g=g||{};f.length&&(g.selectedItems=f.join(","));b||(g.isPage=!0);k=k||{};k.ignoreQueryParamsInCacheUri=!0;k.sideKeys=["emptyPageItems"];c=a(c,e,
h,g,k);c.$promise.then(function(a){a!==d.CANCELLED&&n(b?a.primaryData.flowNode:a.primaryData,a.emptyPageItems)});return c}},isNoFlow:function(){return C.initialFlowNode===b.NO_FLOW},currentFlowNodePk:function(){var c=a.get(b.FLOW_QUERY);return"no"===c?!1:c?_.int(c):null},currentFlowNodeUrl:function(a,b){var c=C.currentFlowNodePk();if(!1===c)return null;var f;if(c)return f=b?h.company.flowNode.calendar:h.company.flowNode.index,h.populate(f,{flowNodePk:c,shortname:a.shortname});f=b?h.company.items.calendar:
h.company.items.index;return a.$url(f)},currentFlowNodeFromCache:function(a){q.assert(C.initialFlowNode,"flows must be initialized");var b=C.currentFlowNodePk();if(b){a={shortname:a,flowNodePk:b};b=h.populate(h.api.flowNode,a);b=e.cache[b];if(!b||!b.breadcrumbs)b=d.flowNode(a);return b}return C.initialFlowNode},initialFlowNode:void 0,initialItemBindings:void 0,initialize:function(c){if(w)return console.log("flows: already initialized"),w;var f=g.defer();w=f.promise;var e=C.currentFlowNodePk();if(!1===
e){var k=a.pathStartsWith(h.company.item.index);if(k)return C.initialItemBindings=k,C.initialFlowNode=b.NO_FLOW,f.resolve(),w;a.clear(b.FLOW_QUERY,!0)}if(a.get(b.IS_SUGGESTED_QUERY))k=[],k.push(d.defaultFlowPage({shortname:c}).$promise),e&&!C.isOnFlowNodePage()&&k.push(d.flowNode({shortname:c,flowNodePk:e}).$promise),g.all(k).then(function(a){C.initialFlowNode=a[0].primaryData.flowNode;f.resolve()},f.reject);else if(e){var m=d.flowNode({shortname:c,flowNodePk:e});m.$promise.then(function(){C.initialFlowNode=
m;f.resolve()},function(d){a.clear(b.FLOW_QUERY,!0);u(c,f)})}else u(c,f);return w},initialUrl:function(){q.assert(C.initialFlowNode,"flows must be initialized");return C.initialFlowNode===b.NO_FLOW?h.populate(h.company.item.index,C.initialItemBindings):C.initialFlowNode.$url(h.company.flowNode.index)},extendWithFlow:function(c){var f=b.FLOW_QUERY,d=a.get(f);if(_.isUndefined(d))return c;var e={};e[f]=d;return a.compose(c,e,!0)},calendarController:function(a,c,e){var h,g;b.isAllItems(c)&&!f.length?
(h=null,g=d.company.calendar):(h=b.calendarItems(c),g=d.items.calendar);return k(a,_.extend({url:e.url,company:c.company,items:h,endpoint:g,params:{shortname:c.company.shortname},queryParams:{allowGrouped:"yes"}},e))},rootOf:function(a){q.assert(a.breadcrumbs,"expected full cached flowNode");return _.first(a.breadcrumbs)||a},showInitialFlowNodeLink:function(a){return!C.initialFlowNode||C.initialFlowNode===b.NO_FLOW||C.rootOf(C.initialFlowNode)===C.rootOf(a)?!1:!0},isOnInitialFlowNode:function(){q.assert(C.initialFlowNode,
"flows must be initialized");var a=C.currentFlowNodePk();return null===a||a===C.initialFlowNode.pk},isOnFlowNodePage:function(){return!(!a.pathEquals(h.company.items.index)&&!a.pathStartsWith(h.company.items.calendar))},initialFlowNodeUrl:function(){var c={};c[b.IS_SUGGESTED_QUERY]="";return a.compose(C.initialFlowNode.$url(h.company.flowNode.index),c)}};return C}]);n.run(["$rootScope","flows","searchTerms","shortcutsOverlay","toggles","translate",function(c,g,k,e,d,m){c.toggles=d;c.translate=m;c.searchTerms=
k;c.shortcutsOverlay=e;c.flows=g}])})();
(function(){var n=angular.module("lib.controllers",["auth.services","db.services","lib.services"]);n.controller("lib.shared.CompanyAdminNotesEditableCtrl",["$scope","auth","controllers","db","models","require","shortcutsOverlay",function(c,g,k,e,d,m,a){m.inScope(c,"company");k.editController(c,{collectionKey:"companies",elementKey:"company",modelKey:"editableCompany",update:e.company.adminNotes.update,editCallback:_.partial(a.confirmClose,!0),cancelCallback:_.partial(a.confirmClose,!1),successCallback:function(){c.editCtrl.editing=
!1;a.confirmClose(!1)},params:function(){return{shortname:c.company.shortname}}})}]);n.controller("lib.shared.NewTransportationCtrl",["$scope","$attrs","$injector","$interpolate","$parse","auth","controllers","convert","db","require","models",function(c,g,k,e,d,m,a,q,h,b,f){b.inScope(c,"customField","lib.shared.NewTransportationCtrl");var n=k.get("plusbook"),w=k.get("rebook"),u=d(g.ngNewTransportation),C=u(c);C&&_.isString(C)&&(C=q.serverResponse(_.parseJSON(C)));var z=function(a){c.newTransportationCtrl.data=
a;a.lodging?(c.newTransportationCtrl.currentLodging=_.find(c.newTransportationCtrl.lodgings,function(b){return b.pk===a.lodging}),c.newTransportationCtrl.currentLodging||(a.lodging="")):c.newTransportationCtrl.currentLodging=null;a.route&&!n.currentSourceBooking&&!p()?(c.newTransportationCtrl.currentRoute=_.find(c.newTransportationCtrl.routes,function(b){return b.pk===a.route}),c.newTransportationCtrl.currentRoute||(a.route="")):c.newTransportationCtrl.currentRoute=null;a.stop&&c.newTransportationCtrl.currentRoute?
(c.newTransportationCtrl.currentStop=_.find(c.newTransportationCtrl.currentRoute.stops,function(b){return b.pk===a.stop}),c.newTransportationCtrl.currentStop||(a.stop="")):(a.route="",c.newTransportationCtrl.currentRoute=null,a.stop="",c.newTransportationCtrl.currentStop=null);c.newTransportationCtrl.needsTransportation=!!c.newTransportationCtrl.currentStop||c.customFieldPricing.visibility.isRequired;c.newTransportationCtrl.needsTransportation&&w.currentBooking&&l()},l=function(){c.newTransportationCtrl.rebookingTransportation=
!0;c.newTransportationCtrl.rebookTransportationOptions=[];c.newTransportationCtrl.rebookTransportationOption=null;var a=function(a){_.find(c.newTransportationCtrl.rebookTransportationOptions,function(b){return b.route===a.route&&b.stop===a.stop})||(c.newTransportationCtrl.rebookTransportationOptions.push(a),c.newTransportationCtrl.rebookTransportationOption||(c.newTransportationCtrl.rebookTransportationOption=a))};if(c.availability.defaultRoute){if(w.currentBooking.stop){var b=_.find(c.availability.defaultRoute.stops,
function(a){return a.pickup===w.currentBooking.stop.pickup});b&&a({text:"Match pickup location",tip:"Move to route of new availability but keep same pickup location",route:c.availability.defaultRoute,stop:b})}(b=_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(a){return _.find(c.availability.defaultRoute.stops,function(b){if(b.pickup===a.pickup)return b})}))&&a({text:"Use new availability's default",tip:"Use the lodging's preferred stop on the default route",route:c.availability.defaultRoute,
stop:b})}c.newTransportationCtrl.currentRoute&&c.newTransportationCtrl.currentStop&&a({text:"Keep old booking's options",route:c.newTransportationCtrl.currentRoute,stop:c.newTransportationCtrl.currentStop});if(c.newTransportationCtrl.canOverrideTransportation){var f={text:"Pick new options",route:c.availability.defaultRoute||"",stop:""};a(f)}c.newTransportationCtrl.rebookTransportationOption&&(c.newTransportationCtrl.data.route=c.newTransportationCtrl.rebookTransportationOption.route.pk,c.newTransportationCtrl.currentRoute=
c.newTransportationCtrl.rebookTransportationOption.route,c.newTransportationCtrl.data.stop=c.newTransportationCtrl.rebookTransportationOption.stop.pk,c.newTransportationCtrl.currentStop=c.newTransportationCtrl.rebookTransportationOption.stop);var d=!1;c.$watch("newTransportationCtrl.data",function(a,b){var e=_.find(c.newTransportationCtrl.rebookTransportationOptions,function(b,c){return b.route.pk===a.route&&b.stop.pk===a.stop}),e=e||f;e!==c.newTransportationCtrl.rebookTransportationOption&&(c.newTransportationCtrl.rebookTransportationOption=
e,d=!0,c.$evalAsync(function(){d=!1}))},!0);c.$watch("newTransportationCtrl.rebookTransportationOption",function(a,b){a&&a!==b&&!d&&(a.route&&(c.newTransportationCtrl.data.route=a.route.pk,c.newTransportationCtrl.currentRoute=a.route),c.$evalAsync(function(){c.newTransportationCtrl.data.stop=a.stop?a.stop.pk:"";c.newTransportationCtrl.currentStop=a.stop||null}))})};c.availability||(c.availability={company:c.company,startAt:moment()});c.newTransportationCtrl={canOverrideTransportation:m.permissions.can("overrideTransportation",
f.Booking,c.availability.company),needsTransportation:void 0,rebookingTransportation:!1,rebookingTransportationOptions:[],rebookingTransportationOption:null,data:{lodging:"",lodgingRoomNumber:"",selfLodgingAddress:"",route:"",stop:""},status:"loading"};c.newTransportationCtrl.needsTransportation=c.customFieldPricing.visibility.isRequired?!0:c.newTransportationCtrl.canOverrideTransportation?!1:void 0;var p=function(){return c.newTransportationCtrl.canOverrideTransportation&&!c.booking&&!c.availability.defaultRoute};
c.newTransportationCtrl.showSelfTransportation=function(){return p()||!c.newTransportationCtrl.currentLodging?!1:!c.newTransportationCtrl.isTransportationAvailable()||!1===c.newTransportationCtrl.needsTransportation};c.newTransportationCtrl.isTransportationAvailable=function(){if(p()||!c.newTransportationCtrl.routes.length||!c.newTransportationCtrl.currentLodging)return!1;var a;if(a=!c.newTransportationCtrl.canOverrideTransportation)if(a=!c.customFieldPricing.visibility.isRequired)a=G(),a=!r(a);return a?
!1:!0};c.newTransportationCtrl.showRoutes=function(){return 1>=c.newTransportationCtrl.routes.length?!1:c.newTransportationCtrl.canOverrideTransportation};c.newTransportationCtrl.showStops=function(){return 0>=c.newTransportationCtrl.stops.length?!1:c.newTransportationCtrl.canOverrideTransportation?!0:!r(c.newTransportationCtrl.currentRoute)};c.newTransportationCtrl.showNeedsTransportation=function(){return c.customFieldPricing.visibility.isRequired?!1:c.newTransportationCtrl.isTransportationAvailable()};
c.newTransportationCtrl.showTransportationPrice=function(){return!c.customField.isPricingHidden&&(f.PriceLine.showOffset(c.customFieldPricing)||f.PriceLine.showRate(c.customFieldPricing))};var F=function(){c.newTransportationCtrl.stops=c.newTransportationCtrl.currentRoute?c.newTransportationCtrl.currentRoute.stops:[]},G=function(){return 1===c.newTransportationCtrl.routes.length?c.newTransportationCtrl.routes[0]:c.availability.defaultRoute?c.availability.defaultRoute:null},x=function(){var a=G();
a?(c.newTransportationCtrl.data.route=a.pk,c.newTransportationCtrl.currentRoute=a):(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null)},r=function(a){if(c.newTransportationCtrl.currentLodging&&a)return 1===c.newTransportationCtrl.stops.length&&(c.newTransportationCtrl.canOverrideTransportation||c.customFieldPricing.visibility.isRequired)?c.newTransportationCtrl.stops[0]:_.chooseFirst(c.newTransportationCtrl.currentLodging.preferredPickups,function(b){return _.chooseFirst(a.stops,
function(a){if(a.pickup===b.pickup)return a})})},D=function(){var a=r(c.newTransportationCtrl.currentRoute);if(a)return c.newTransportationCtrl.data.stop=a.pk,c.newTransportationCtrl.currentStop=a,!0;c.newTransportationCtrl.data.stop="";c.newTransportationCtrl.currentStop=null;!c.newTransportationCtrl.canOverrideTransportation&&!c.customFieldPricing.visibility.isRequired&&(c.newTransportationCtrl.data.route="",c.newTransportationCtrl.currentRoute=null);return!1},B=function(a){return{route:a,run:{capacity:a.capacity,
customerCount:0,bookingCount:0},pk:a.pk}};c.newTransportationCtrl.routeSelectionText=function(a){var b=a.route;a=a.run;if(!c.newTransportationCtrl.canOverrideTransportation||!a.customerCount)return b.name;var f=a.customerCount.toString();null!==a.capacity&&(f+=" of "+a.capacity.toString());return b.name+" "+("("+f+" people booked so far)")};var t,y,L,J=function(){t=h.lodgings({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0});y=c.newTransportationCtrl.canOverrideTransportation?
h.routes({shortname:c.availability.company.shortname},null,null,null,{tagAlong:!0}):c.availability.defaultRoute?h.route({shortname:c.availability.company.shortname,routePk:c.availability.defaultRoute.pk},null,null,null,{tagAlong:!0}):[];L=c.newTransportationCtrl.canOverrideTransportation?h.runs.searchByDate({shortname:c.availability.company.shortname,date:c.availability.startAt.format("YYYY-MM-DD")},null,null,null,{tagAlong:!0}):[];a.dataController(c,{promises:[t.$promise,y.$promise,L.$promise],successCallback:s,
errorCallback:function(){c.newTransportationCtrl.status="error"}})},s=function(){c.newTransportationCtrl.status="success";c.newTransportationCtrl.lodgings=t;c.newTransportationCtrl.routes=_.isArray(y)?y:[y];c.newTransportationCtrl.routeSelections=_.map(c.newTransportationCtrl.routes,B);_.forEach(L,function(a){var b=_.find(c.newTransportationCtrl.routeSelections,function(b){return b.route===a.route});b&&(b.run=a)});C&&z(C);c.$watch("customFieldPricing.visibility.isRequired",function(a){a&&(c.newTransportationCtrl.needsTransportation=
!0)});c.$watch("newTransportationCtrl.currentLodging",function(a,b){a&&c.newTransportationCtrl.needsTransportation&&(c.newTransportationCtrl.currentRoute||x(),a!==b&&D(),a===b&&(!c.newTransportationCtrl.canOverrideTransportation&&!c.newTransportationCtrl.currentStop)&&(F(),D()))});c.$watch("newTransportationCtrl.currentRoute",function(a,b){F();a!==b&&a&&D()});c.$watch("newTransportationCtrl.needsTransportation",function(a,b){a!==b&&(a?(c.newTransportationCtrl.currentRoute||x(),D()):(c.newTransportationCtrl.data.route=
"",c.newTransportationCtrl.currentRoute=null,c.newTransportationCtrl.data.stop="",c.newTransportationCtrl.currentStop=null))});c.$watch("newTransportationCtrl.data",function(){c.newTransportationCtrl.data.lodging?u.assign(c,_.stringifyJSON(q.clientRequest(c.newTransportationCtrl.data))):u.assign(c,"")},!0)};c.availability.pk&&_.isUndefined(c.availability.defaultRoute)?h.availability({shortname:c.availability.company.shortname,itemPk:c.availability.item.pk,availabilityPk:c.availability.pk}).$promise.then(function(){J()}):
J()}])})();
(function(){var n=angular.module("lib.factories",[]);n.factory("dataController",["$q","cache","db",function(c,g,k){var e={};return function(d,m){m=m||{};var a=m.successCallback||_.ignore,q=m.errorCallback||_.ignore;d.dataCtrl={STALE:e,status:"loading",isStale:!1};var h=!1;d.$on("$destroy",function(){_.forEach(m.promises,function(a){a&&a.cancel&&a.cancel()});h=!0});var b=function(a){if(a){var b=k.errorStatus(a.status);b&&(q(a),d.dataCtrl.status=b,d.dataCtrl.isStale=!1)}},f=function(b){if(!h)return a(),d.dataCtrl.status=
"success",d.dataCtrl.isStale=!1,b},n=function(){d.dataCtrl.status="loading";var e=_.choose(m.promises||[]);if(!e.length)return f();m.stale&&_.every(m.stale,function(a){return!_.isUndefined(a)&&!g.fresh(a)})&&(a(d.dataCtrl.STALE),d.dataCtrl.isStale=!0,d.dataCtrl.status="success");c.all(e).then(f,b)};d.dataCtrl.showLoading=function(){d.dataCtrl.status="loading"};d.dataCtrl.showComplete=function(){d.dataCtrl.status="success"};m.retry&&(d.retry=function(){n()});n();return d}}]);n.factory("navigationController",
["navigation",function(c){return function(g,k){g.navigationCtrl={entries:k.entries||[]};_.forEach(g.navigationCtrl.entries,function(e){_.isUndefined(e.isCurrent)&&(e.isCurrent=function(){var d=e.navigationUrl||e.url;return!d?!1:(e.equals?c.pathEquals:c.pathStartsWith)(d)})});g.navigationCtrl.isVisible=function(c){return _.isUndefined(c.isVisible)?!0:_.isFunction(c.isVisible)?c.isVisible():c.isVisible};return g}}]);n.factory("headerController",["$timeout","auth","models","navigation","navigationController",
"urls",function(c,g,k,e,d,m){return function(a,q){a.headerCtrl={};a.headerCtrl.logout=function(){a.headerCtrl.company?e.navigate(a.headerCtrl.company.$url(m.company.login)):e.navigate(m.index);c(function(){g.logout()})};g.currentUser.isAuthenticated&&(a.headerCtrl.relatedCompanies=g.relatedCompanies());a.$watch(q.companyFn,function(c){a.headerCtrl.company=c;d(a,{entries:[{text:"Admin",url:c.$url(m.dashboard.admin.index),isVisible:function(){return c.isAdmin&&g.permissions.can("viewAdminSection",c)},
shortcut:"shift+a",shortcutDescription:"Show Admin."},{text:"Bookings",url:c.$url(m.dashboard.bookings.index),isVisible:function(){return(c.isCharter||c.isAffiliate)&&g.permissions.can("viewBookingsSection",c)},shortcut:"shift+b",shortcutDescription:"Show Bookings calendar."},{text:"Manifest",url:c.$url(m.dashboard.manifest.index),isVisible:function(){return c.isCharter&&g.permissions.can("viewManifestSection",c)},shortcut:"shift+m",shortcutDescription:"Show Manifest."},{text:"Reports",url:c.$url(m.dashboard.reports.index),
isVisible:function(){return g.permissions.canList(k.Report,c)},shortcut:"shift+r",shortcutDescription:"Show Reports."},{text:"Items",url:c.$url(m.dashboard.items.index),isVisible:function(){return c.isCharter&&g.permissions.can("viewItemsSection",c)},shortcut:"shift+i",shortcutDescription:"Show Items.",isCurrent:function(){return e.pathStartsWith(m.dashboard.items.index)||e.pathStartsWith(m.dashboard.resources.index)}},{text:"Settings",url:c.$url(m.dashboard.settings.index),shortcut:"shift+s|shift+e",
shortcutDescription:"Show Settings."},{text:"Website Admin",url:"https://content.fareharbor.me/wp-admin/",isVisible:_.getter(c,"isAdmin"),isOutbound:!0},{text:"Help",url:c.$url(m.root.help),isOutbound:!0}]})});return a}}]);n.factory("cannedMessagesController",["auth","db","models","navigation","require",function(c,g,k,e,d){return function(m,a){d.defined(a,"modelKey");d.defined(a,"noteField");m.cannedMessagesCtrl={};var q=function(a){if(c.permissions.canList(k.CannedMessage,a)){var f=g.cannedMessages({shortname:a.shortname});
m.cannedMessagesCtrl.promises.push(f.$promise);f.$promise.then(function(){m.cannedMessagesCtrl.cannedMessages=m.cannedMessagesCtrl.cannedMessages.concat(f);_.forEach(f,function(a){_.contains(m.cannedMessagesCtrl.TYPES,a.type)&&m.cannedMessagesCtrl.cannedMessagesByType[a.type].push(a)})})}};m.cannedMessagesCtrl.select=function(b){var c=m[a.modelKey][a.noteField]||"",c=c.replace(/\s+$/g,"");""!==c&&(c=c.concat("\n\n"));m[a.modelKey][a.noteField]=c.concat(b.message)};m.cannedMessagesCtrl.TYPES=a.types||
k.CannedMessage.TYPES;m.cannedMessagesCtrl.displayType=k.CannedMessage.displayType;m.cannedMessagesCtrl.cannedMessagesByType={};_.forEach(m.cannedMessagesCtrl.TYPES,function(a){m.cannedMessagesCtrl.cannedMessagesByType[a]=[]});m.cannedMessagesCtrl.cannedMessages=[];m.cannedMessagesCtrl.promises=[];var h=[e.currentCompany];c.currentUser.company&&h.push(c.currentUser.company);a.company&&h.push(a.company);h=_.unique(h);_.forEach(h,function(a){q(a)});return m}}]);n.factory("imageUploadController",["$q",
"filepicker","require",function(c,g,k){return function(e,d){k.defined(d,"modelKey");var m=d.id||"image",a=d.field||"imageUrl",q=d.width||2560,h=d.height||2560,b=_.isUndefined(d.resetAfterSubmit)?!0:d.resetAfterSubmit,f=function(){_.extend(e.imageUploadCtrl[m],{url:"",urls:{},initialUrls:{},isSelected:!1,isPristine:!0,isUploading:!1,isCropping:!1,isSavingCrop:!1,crop:{},unCroppedUrl:null})},n=function(a){var b=c.defer();g.store({url:a},{location:"S3"},function(a){console.log("imageUploadCtrl: stored image ",
a.url);b.resolve(a)},function(a){console.error("imageUploadCtrl: unable to store image",a);b.reject(a)});return b.promise},w=function(a){var b=c.defer(),f={height:h,width:q,fit:"max"};g.convert(a,f,function(a){e.$safeApply(function(){console.log("imageUploadCtrl: converted image",a.url,f);b.resolve(a)})},function(a){e.$safeApply(function(){console.error("imageUploadCtrl: unable to convert image",a);b.reject(a)})});return b.promise};if(!e.imageUploadCtrl||e.imageUploadCtrl.scope!==e)e.imageUploadCtrl=
{scope:e,ids:[]},e.imageUploadCtrl.isPristine=function(){return _.every(e.imageUploadCtrl.ids,function(a){return e.imageUploadCtrl[a].isPristine})},e.imageUploadCtrl.isUploading=function(){return _.some(e.imageUploadCtrl.ids,function(a){return e.imageUploadCtrl[a].isUploading})};e.imageUploadCtrl.ids.push(m);e.imageUploadCtrl[m]={};e.imageUploadCtrl[m].clear=function(){e.imageUploadCtrl[m].urls[a]="";e[d.modelKey][a]="";_.extend(e.imageUploadCtrl[m],{url:"",isSelected:!1,isPristine:!1,crop:{},unCroppedUrl:null})};
e.imageUploadCtrl[m].select=function(){e.imageUploadCtrl[m].isUploading=!0;g.pick({mimetypes:["image/*"],services:["COMPUTER","WEBCAM","FACEBOOK","INSTAGRAM","URL"]},function(b){e.$apply(function(){w(b).then(function(b){e.imageUploadCtrl[m].urls[a]=b.url;e[d.modelKey][a]=b.url;_.extend(e.imageUploadCtrl[m],{url:b.url,isSelected:!0,isPristine:!1,isUploading:!1,crop:{},unCroppedUrl:null})},function(a){console.error("imageUploadCtrl.select: unable to convert image",a);e.imageUploadCtrl[m].isUploading=
!1})})},function(a){e.$apply(function(){101!==a.code&&console.error("imageUploadCtrl.select: unable to pick image",a);e.imageUploadCtrl[m].isUploading=!1})})};e.imageUploadCtrl[m].edit=function(){k.defined(d,"elementKey");var b=e[d.elementKey][a];e.imageUploadCtrl[m].urls[a]=b;e.imageUploadCtrl[m].initialUrls[a]=b;e[d.modelKey][a]=b;_.extend(e.imageUploadCtrl[m],{url:b,isSelected:!!b,crop:{},unCroppedUrl:null})};e.imageUploadCtrl[m].submit=function(){var d=e.imageUploadCtrl[m].urls[a],d=e.imageUploadCtrl[m].initialUrls[a]!==
d&&d?n(d):c.reject();e.imageUploadCtrl[m].isPristine=!0;b&&f();return d};e.imageUploadCtrl[m].cancel=function(){f()};e.imageUploadCtrl[m].saveCrop=function(){e.imageUploadCtrl[m].isSavingCrop=!0;var b={fit:"crop",crop:[e.imageUploadCtrl[m].crop.x,e.imageUploadCtrl[m].crop.y,e.imageUploadCtrl[m].crop.width,e.imageUploadCtrl[m].crop.height],format:"jpg",quality:90},c=e.imageUploadCtrl[m].url;g.stat({url:c},function(f){f.url=c;g.convert(f,b,function(b){e.$safeApply(function(){e[d.modelKey][a]=b.url;
e.imageUploadCtrl[m].urls[a]=b.url;_.extend(e.imageUploadCtrl[m],{url:b.url,isPristine:!1,isCropping:!1,isSavingCrop:!1,unCroppedUrl:c})})},function(a){console.error("imageUploadCtrl.saveCrop: unable to crop image",a)})})};e.imageUploadCtrl[m].startCropping=function(){e.imageUploadCtrl[m].unCroppedUrl&&(e.imageUploadCtrl[m].url=e.imageUploadCtrl[m].unCroppedUrl);e.imageUploadCtrl[m].isCropping=!0};e.imageUploadCtrl[m].cancelCrop=function(){e.imageUploadCtrl[m].isCropping=!1;e.imageUploadCtrl[m].url=
e[d.modelKey][a]};f();return e}}]);n.factory("splitPaymentController",["require","toggles",function(c,g){return function(c,e){c.splitPaymentCtrl={customerCount:e.customerCount(),amount:e.amount(),divideByPeople:1,payForPeople:1,splitAmount:0};c.$watch(function(){return e.amount()},function(d){c.splitPaymentCtrl.amount=d});c.$watch(e.customerCount,function(d){d=Math.max(1,d);c.splitPaymentCtrl.customerCount=d;c.splitPaymentCtrl.divideByPeople=d;c.splitPaymentCtrl.payForPeople=Math.min(c.splitPaymentCtrl.divideByPeople,
c.splitPaymentCtrl.payForPeople)});c.$watch(function(){var d=_.roundHalfToEven(c.splitPaymentCtrl.amount*c.splitPaymentCtrl.payForPeople/c.splitPaymentCtrl.divideByPeople);isFinite(d)||(d=0);return d},function(d){c.splitPaymentCtrl.splitAmount=d});c.splitPaymentCtrl.useSplitAmount=function(){var d=Math.min(c.splitPaymentCtrl.splitAmount,e.max());0>=d||(e.amount(d),g.toggle("splitPaymentCalc",!1))}}}]);n.factory("reorderController",["$window","db","flash",function(c,g,k){return function(e,d){var m=
d.reorderCallback||_.ignore,a=d.reorderConfirm,q=d.reorderConfirmWhen||(a?_.always:_.never);e=e||{};e.reorderCtrl={};e.reorderCtrl.reorder=function(h,b,f){var n={},w=0;b&&(n.previousPk=b.pk,w=(b.sortableIndex||0)+0.1);f&&(n.nextPk=f.pk,w=(f.sortableIndex||0)-0.1);var u;d.collectionKey?u=_.get(e,d.collectionKey):d.collectionFn&&(u=d.collectionFn(h));if(u){if(q(h,b,f)&&!c.confirm(a||"Are you sure you want to reorder this list?"))return!1;h.sortableIndex=w;_.ref.reorder(u,h,b,f);h=g.reorder({shortname:(h.company?
h.company:d.company).shortname,objectCls:h.cls?h.cls:d.cls,objectPk:h.pk},{},null,n);m(h);h.$promise.then(function(){k.success("Sort order saved.")},function(){k.error("Sort order not saved, please try again.")})}};return e}}]);n.factory("listController",["reorderController","urls","events",function(c,g,k){return function(e,d){var m=d.get,a=d.create||m&&m.create,q=d.remove,h=d.successCallback||_.ignore,b=d.errorCallback||_.ignore,f=d.submitCallback||_.ignore,n=d.removeCallback||_.ignore,w=_.isFunction(d.params)?
d.params:_.constant(d.params||{}),u=g.extract,C=_.isUndefined(d.reset)?!0:d.reset,z=d.defaultModel||{};_.isFunction(z)||(z=_.constant(z));e[d.modelKey]=_.extend({},z());m&&(d.collectionKey&&!_.isArray(_.get(e,d.collectionKey)))&&_.set(e,d.collectionKey,m(w()));e.listCtrl={};e.listCtrl.submit=function(c){var g=e[d.modelKey],m=f(c);m&&(g=_.extend({},g,m));var q=(d.createFn?d.createFn():a)(w(),g,c);q.$promise.then(function(){if(d.collectionKey){var a=_.get(e,d.collectionKey);a&&(_.isArray(q)?d.overwrite?
_.overwrite(a,q):_.ref.append(a,q):a.push(q))}e.listCtrl.cancel(c);d.refreshActivities&&k.broadcast("dashboard.shared.ActivitiesCtrl.refresh");h(q,c)},function(a){b(a,c)})};e.listCtrl.adding=d.adding||!1;e.listCtrl.cancel=function(a){e.listCtrl.adding=!1;C&&(e[d.modelKey]=_.extend({},z()));a.$setPristine()};e.listCtrl.add=function(){e.listCtrl.adding=!0};e.listCtrl.toggle=function(){e.listCtrl.adding=!e.listCtrl.adding};d.sortable&&d.collectionKey&&(e.listCtrl.reorder=c(e,{collectionKey:d.collectionKey,
reorderCallback:d.reorderCallback,reorderConfirm:d.reorderConfirm,reorderConfirmWhen:d.reorderConfirmWhen,company:d.company}).reorderCtrl.reorder);d.remove&&(e.listCtrl.remove=function(a,b){e.listCtrl.status="removing";q(u(a),{},b).$promise.then(function(){e.listCtrl.status="success";b&&_.overwrite(b,{});d.collectionKey&&_.overwriteWithout(_.get(e,d.collectionKey),_.isReferenceEqualTo(a));d.refreshActivities&&k.broadcast("dashboard.shared.ActivitiesCtrl.refresh");n(a)})});return e}}]);n.factory("createController",
[function(){return function(c,g){var k=g.get||{},e=g.create||k.create,d=g.successCallback||_.ignore,m=g.errorCallback||_.ignore,a=g.submitCallback||_.ignore,q=_.isFunction(g.params)?g.params:_.constant(g.params||{}),h=_.isUndefined(g.reset)?!0:g.reset,b=g.defaultModel||{},f=function(a){return _.set(c,g.modelKey,a)};f(_.extend({},b));c.createCtrl={};c.createCtrl.creating=!1;c.createCtrl.submit=function(b){a(b);var f=e(q(),_.get(c,g.modelKey),b);f.$promise.then(function(){c.createCtrl.cancel(b);d(f,
b)},function(a){m(a,b)})};c.createCtrl.cancel=function(a){h&&f(_.extend({},b));a.$setPristine();c.createCtrl.creating=!1};return c}}]);n.factory("removeController",[function(){return function(c,g){var k=g.remove||g.get.remove,e=g.removeCallback||_.ignore,d=_.isFunction(g.params)?g.params:_.constant(g.params||{});c.removeCtrl={status:"success"};c.removeCtrl.remove=function(m){c.removeCtrl.status="removing";k(d(),{},m).$promise.then(function(){c.removeCtrl.status="success";m&&_.overwrite(m,{});g.collectionKey&&
_.overwriteWithout(c[g.collectionKey],_.isReferenceEqualTo(c[g.elementKey]));e(c[g.elementKey],m)},function(){c.removeCtrl.status="error"})};return c}}]);n.factory("editController",["events","navigation","flash",function(c,g,k){return function(e,d){var m=d.get||_.ignore,a=d.update||m.update,q=d.remove||m.remove,h=d.successCallback||_.ignore,b=d.errorCallback||_.ignore,f=d.editCallback||_.ignore,n=d.removeCallback||_.ignore,w=d.cancelCallback||_.ignore,u=d.submitCallback||_.ignore,C=_.isFunction(d.params)?
d.params:_.constant(d.params||{}),z=d.jsonFieldKeys||[];e.editCtrl={};e.editCtrl.editing=!1;e.editCtrl.status="success";if(!_.isUndefined(_.get(e,d.collectionKey))||d.remove)e.editCtrl.remove=function(a){e.editCtrl.status="removing";q(C(),{},a).$promise.then(function(){e.editCtrl.status="success";a&&_.overwrite(a,{});var b=_.get(e,d.collectionKey);b&&_.overwriteWithout(b,_.isReferenceEqualTo(e[d.elementKey]));d.refreshActivities&&c.broadcast("dashboard.shared.ActivitiesCtrl.refresh");d.flashAfterRemove&&
(b=_.isString(d.flashAfterRemove)?d.flashAfterRemove:"Deleted "+e[d.elementKey].unicode+".",k.success(b));d.navigateAfterRemove&&g.navigate(d.navigateAfterRemove);n(e[d.elementKey],a)},function(){e.editCtrl.status="error"})};var l=function(){var a={};_.forEach(e[d.elementKey],function(b,c){if(!_.isObject(b)||_.includes(z,c))a[c]=b});d.modelFields&&(a=_.pick(a,d.modelFields));e[d.modelKey]=a};e.editCtrl.edit=function(a,b){b||l();e.editCtrl.editing=!0;f(a)};e.editCtrl.cancel=function(a){e.editCtrl.editing=
!1;l();w(a);a&&a.$setPristine();d.editing&&e.editCtrl.edit(a)};e.editCtrl.submit=function(f){var g=e[d.modelKey],k=u(f);k&&(g=_.extend({},g,k));e.editCtrl.status="submitting";var l=a(C(),g,f);l.$promise.then(function(){e.editCtrl.status="success";f.$setPristine();e.editCtrl.editing=!1;d.refreshActivities&&c.broadcast("dashboard.shared.ActivitiesCtrl.refresh");h(l,f);d.editing&&e.editCtrl.edit(f)},function(a){e.editCtrl.status="error";b(a,f);d.editing&&e.editCtrl.edit(f,d.skipResetAfterError)})};d.editing&&
e.editCtrl.edit();return e}}]);n.factory("calendarController",["$filter","$injector","auth","cache","db","events","localization","navigation","require","urls",function(c,g,k,e,d,m,a,q,h,b){return function(c,h){var n=g.get("flows"),u=b.calendarUrls(h.url),C=_.isFunction(h.params)?h.params:_.constant(h.params||{}),z=_.isFunction(h.queryParams)?h.queryParams:_.constant(h.queryParams||{}),l=h.endpoint,p=h.beforeRequest||_.ignore,F=h.largeDaySelected||_.ignore,G=h.smallDaySelected||_.ignore,x=_.isFunction(h.isSundayBased)?
h.isSundayBased:_.isBoolean(h.isSundayBased)?_.constant(h.isSundayBased):_.constant(h.company?h.company.features.isSundayBased:!0);c.calendarCtrl={status:"uninitialized",company:h.company||null,isSundayBased:x,calendar:{},isRetrieving:!1,isEmptyAllowed:h.isEmptyAllowed||!1,date:moment().startOf("day"),isCalendarEmpty:h.isCalendarEmpty||_.ignore,isWeekEmpty:h.isWeekEmpty||_.ignore,isDayEmpty:h.isDayEmpty||_.ignore,isDayUsed:h.isDayUsed||_.ignore,isEditable:h.isEditable||!1,editDay:h.editDay||_.ignore};
var r=moment().startOf("day");c.calendarCtrl.dropdownMonths=_.map("January February March April May June July August September October November December".split(" "),function(a,b){return{value:b,text:a}});c.calendarCtrl.dropdownYears=_.map(_.range(r.year()-2,r.year()+5),function(a){return{value:a,text:a}});var D=!1,B,t,y=c.calendarCtrl.refresh=function(a){D=!1;if(!1!==p()){var b=_.extend({year:c.calendarCtrl.date.format("YYYY"),month:c.calendarCtrl.date.format("MM")},C()),h=z();if(a||!angular.equals([b,
h],[B,t]))B=b,t=h,c.calendarCtrl.status="loading",J={},c.calendarCtrl.calendar.$promise&&c.calendarCtrl.calendar.$promise.cancel(),c.calendarCtrl.calendar=l(_.extend({},b),{},null,h),e.fresh(c.calendarCtrl.calendar)?c.calendarCtrl.isRetrieving=!0:O(),c.calendarCtrl.calendar.$promise.then(function(a){a!==d.CANCELLED&&(O(),c.calendarCtrl.status="success",c.calendarCtrl.isRetrieving=!1)},function(){c.calendarCtrl.status="error";c.calendarCtrl.isRetrieving=!1})}},L=function(a,b){var c=r-a.at;return 0===
c?b.current||"":0<c?b.past||"":b.future||""};c.calendarCtrl.dayPastPresentFutureClass=function(a){return L(a,{past:"past-day",current:"current-day"})};c.calendarCtrl.isPastWeek=function(a){return L(_.last(a.days),{past:!0})};var J={},s=r.clone().startOf("month");c.calendarCtrl.showingPastWeek=function(a){return 0!==c.calendarCtrl.date.clone().startOf("month").diff(s)||J[a.number]};c.calendarCtrl.showPastWeek=function(a){J[a.number]=!0};q.watch(c,function(a){if(q.pathEquals(u.index))q.redirect(b.populate(u.month,
{year:c.calendarCtrl.date.format("YYYY"),month:c.calendarCtrl.date.format("MM")}));else{var d;(d=q.pathEquals(u.month))?(a=d.year,d=d.month-1,a=moment({year:a,month:d,day:1}),c.calendarCtrl.style="month",c.calendarCtrl.date=a,c.calendarCtrl.monthDropdown=a.month(),c.calendarCtrl.yearDropdown=a.year(),m.broadcast("lib.shared.CalendarCtrl.month",{date:c.calendarCtrl.date}),y()):console.warn("calendarController: invalid calendar url",a)}});var H=c.calendarCtrl.monthUrl=function(a){return b.populate(u.month,
{year:a.format("YYYY"),month:a.format("MM")})};c.calendarCtrl.nextMonthUrl=function(){var a=c.calendarCtrl.date.clone();a.add(1,"months");return H(a)};c.calendarCtrl.currentMonthUrl=function(){return H(r)};c.calendarCtrl.previousMonthUrl=function(){var a=c.calendarCtrl.date.clone();a.add(-1,"months");return H(a)};c.$watch("calendarCtrl.yearDropdown",function(a,b){if(!_.isUndefined(b)&&a!==b){var d=c.calendarCtrl.date.clone();d.year(a);d=H(d);q.pathEquals(d)||q.navigate(n.extendWithFlow(d))}});c.$watch("calendarCtrl.monthDropdown",
function(a,b){if(!_.isUndefined(b)&&a!==b){var d=c.calendarCtrl.date.clone();d.month(a);d=H(d);q.pathEquals(d)||q.navigate(n.extendWithFlow(d))}});c.calendarCtrl.isCurrentMonth=function(){return c.calendarCtrl.date.year()===r.year()&&c.calendarCtrl.date.month()===r.month()};m.on(c,"lib.shared.CalendarCtrl.refresh",function(){y(!0)});var v=function(a){var b=c.calendarCtrl.calendar.weeks;if(!b)return null;var d=null;_.some(b,function(b){return _.some(b.days,function(b){return b.at.isSame(a,"day")?(d=
b,!0):!1})});return d};c.calendarCtrl.goToToday=function(){q.navigate(c.calendarCtrl.currentMonthUrl());c.calendarCtrl.selectedDay=v(moment());J={}};c.calendarCtrl.selectLargeDay=function(a){c.calendarCtrl.selectedDay=a;F(a)};c.calendarCtrl.dayLabel=function(b,d){return d===c.calendarCtrl.calendar.weeks[0]&&b===d.days[0]?b.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):1===b.number?b.at.format(a.current().DATE_FORMATS.dayWithMonthAbbr):b.number};c.calendarCtrl.selectSmallDay=function(a){c.calendarCtrl.selectedDay=
a;G(a);D=!0};var O=function(){if(k.currentUser.isAuthenticated){var a;a=D?c.calendarCtrl.selectedDay.at:c.calendarCtrl.date.year()===r.year()&&c.calendarCtrl.date.month()===r.month()?r:c.calendarCtrl.date;c.calendarCtrl.selectedDay=v(a)}else c.calendarCtrl.selectedDay=null};c.calendarCtrl.debouncedRefresh=_.debounce(function(a){c.$safeApply(function(){c.calendarCtrl.refresh(a)})},1E3,{leading:!0});c.calendarCtrl.effectiveRange=function(a,b){var c=a.startAt,d=a.endAt;c<b.at&&(c=b.at);d>b.at+864E5&&
(d=b.at.clone().add(1,"day").startOf("day"));return{startAt:c,endAt:d}};return c}}]);n.factory("availabilityCalendarController",["$filter","auth","calendarController","events","navigation",function(c,g,k,e,d){return function(g,a){var q=_.isFunction(a.params)?a.params:_.constant(a.params||{}),h=a.beforeRequest||_.ignore,b=_.isUndefined(a.autoOpenItemGroups)?!0:a.autoOpenItemGroups,f=a.openLightframe?a.openLightframe:d.navigate,n=a.items||null;e.on(g,"dashboard.bookings.NavigationCtrl.calendarFilter.items",
function(a,b){var c=b.items||[],d=_.difference(c,g.calendarCtrl.items).length;g.calendarCtrl.items=c;d&&g.calendarCtrl.debouncedRefresh(!0)});e.on(g,"dashboard.bookings.NavigationCtrl.filterChoicesUpdated",function(a,b){b&&(g.calendarCtrl.items=b.filteredItems||[]);g.calendarCtrl.refresh()});_.extend(a,{isCalendarEmpty:function(){return!g.calendarCtrl.calendar.availabilityCount},isWeekEmpty:function(a){return!a.availabilityCount},isDayEmpty:function(a){var b=a.availabilities;a=a.itemGroups||[];return!b.length&&
!a.length?!0:g.isCalendarFiltered?_.all(b,g.isCalendarFiltered)&&_.all(a,g.isCalendarFiltered):!1},isDayUsed:function(a){var b=a.availabilities;a=a.itemGroups||[];g.isCalendarFiltered&&(b=_.reject(b,g.isCalendarFiltered),a=_.reject(a,g.isCalendarFiltered));b=_.sum(_.pluck(b,"customerCount"));a=_.sum(_.pluck(a,"customerCount"));return 0<b+a},smallDaySelected:function(a){var d=a.availabilities,e=a.itemGroups||[];b&&(!d.length&&1===e.length)&&(a=c("itemGroupUrl")(e[0],a.at),f(a))},beforeRequest:function(){return g.calendarCtrl.items&&
!g.calendarCtrl.items.length?!1:h()},params:function(){var a=_.extend({},q());if(g.calendarCtrl.items){var b=_.pluck(g.calendarCtrl.items,"pk").join(",");a.itemPks=b}return a}});k(g,a);_.extend(g.calendarCtrl,{items:n,nextBookableMonthUrl:function(){var a=g.calendarCtrl.calendar.nextBookableStartAt;if(a)return g.calendarCtrl.monthUrl(a)},alreadyRedirectedToNextBookableMonth:!1,redirectToNextBookableMonth:function(){g.calendarCtrl.alreadyRedirectedToNextBookableMonth||(g.calendarCtrl.alreadyRedirectedToNextBookableMonth=
!0,d.redirect(g.calendarCtrl.nextBookableMonthUrl()))}});return g}}]);n.factory("emailPreviewController",["convert","models","navigation","urls",function(c,g,k,e){var d={type:"type",emails:"emails",subject:"subject",note:"note"};return function(m,a){var q=_.extend({},d,a.fields),h=_.isFunction(a.params)?a.params:_.constant(a.params||{}),b;a.data&&(b=_.isFunction(a.data)?a.data:function(){return a.data});m.emailPreviewCtrl={};m.emailPreviewCtrl.previewUrl=function(){var d={};_.forEach(q,function(b,
c){b&&(d[c]=m[a.modelKey][b]||"")});b&&_.extend(d,c.clientRequest(b()));var f=e.populate(a.url,h(d.type));return k.compose(f,d)};var f=_.isFunction(a.isPreviewable)?a.isPreviewable:_.constant(a.isPreviewable);m.emailPreviewCtrl.isPreviewable=function(){var b=m[a.modelKey][q.type],c=m[a.modelKey][q.emails],d=m[a.modelKey][q.subject];if(!b||!c||!d)return!1;c=f(b);return!_.isUndefined(c)?c:g.Notification.isPreviewable(b)};return m}}]);n.factory("affiliationController",["$q","auth","cache","db","editController",
"events","models",function(c,g,k,e,d,m,a){return function(q,h){var b=function(a){return(h.prefix?h.prefix+"-":"")+"voucher-"+a};q.affiliationCtrl={status:"success",substatus:"success",showDesks:!1};q.affiliationCtrl.agentName=function(b){return b===a.Agent.OTHER_AGENT?b.name:b.name+" (#"+b.pk+")"};q[h.modelKey][b("agent")]="";q[h.modelKey][b("agentName")]="";q[h.modelKey][b("desk")]="";q[h.modelKey][b("deskName")]="";var f=function(b){q.affiliationCtrl.agents=[];q.affiliationCtrl.desks=[];q.affiliationCtrl.showDesks=
!1;if(b){var d={agents:g.permissions.canCreate(a.Agent,b),desks:g.permissions.canCreate(a.Desk,b)},f={agents:a.Agent.OTHER_AGENT,desks:a.Desk.OTHER_DESK},h=function(a,b){_.overwrite(q.affiliationCtrl[a],b);d[a]&&q.affiliationCtrl[a].push(f[a])},l=[];if(g.permissions.canList(a.Agent,b.affiliateCompany)){var p=e.agents({shortname:b.affiliateCompany.shortname}),m=p.$promise.then(function(){h("agents",p)});k.fresh(p)?l.push(m):h("agents",p)}if(g.permissions.canList(a.Desk,b.affiliateCompany)){var n=e.desks({shortname:b.affiliateCompany.shortname});
b=n.$promise.then(function(){q.affiliationCtrl.showDesks=0<n.length;h("desks",n)});k.fresh(n)?l.push(b):(q.affiliationCtrl.showDesks=0<n.length,h("desks",n))}l.length&&(q.affiliationCtrl.substatus="loading",c.all(l).then(function(){q.affiliationCtrl.substatus="success"}))}};q.$watch(h.affiliateModelKey+".currentAffiliation",function(a,c){f(a);if(a&&c&&a!==c||!a)q[h.modelKey][b("agent")]="",q[h.modelKey][b("agentName")]="",q[h.modelKey][b("desk")]="",q[h.modelKey][b("deskName")]=""});var n=function(b){var c=
h.booking?h.booking.company:h.company;g.permissions.canList(a.Affiliation,c)?c.affiliatesCount>a.Affiliation.MAX_SELECTABLE_AFFILIATES?(q.affiliationCtrl.affiliatesNgDropdownEndpoint=e.searchEndpoint(e.affiliates.pickable,{shortname:c.shortname}),q.affiliationCtrl.status="success"):(q.affiliationCtrl.affiliations=e.affiliates.pickable({shortname:c.shortname},null,null,null,{flashError:!!h.booking}),q.affiliationCtrl.status=k.fresh(q.affiliationCtrl.affiliations)?"loading":"stale",q.affiliationCtrl.affiliations.$promise.then(function(){q.affiliationCtrl.status=
"success";h.booking&&h.booking.affiliation&&!_.contains(q.affiliationCtrl.affiliations,h.booking.affiliation)&&q.affiliationCtrl.affiliations.unshift(h.booking.affiliation)},function(){h.booking&&q.editCtrl.cancel(b)})):q.affiliationCtrl.status="success"};h.booking?d(q,{elementKey:"affiliation",modelKey:h.modelKey,update:e.booking.affiliation.update,editCallback:function(a){n(a);q[h.modelKey].isBlockable=h.booking.isBlockable;q[h.modelKey].affiliation=h.booking.affiliation?h.booking.affiliation.pk:
"";q[h.modelKey][b("agent")]=h.booking.agent?h.booking.agent.pk:"";q[h.modelKey][b("desk")]=h.booking.desk?h.booking.desk.pk:"";q[h.modelKey][b("voucherNumber")]=h.booking.voucherNumber;q[h.affiliateModelKey].currentAffiliation=h.booking.affiliation||null},successCallback:function(a){var c=-1==q[h.modelKey][b("agent")],d=-1==q[h.modelKey][b("desk")];(c||d)&&f(a.booking.affiliation);m.broadcast("dashboard.shared.ActivitiesCtrl.refresh")},params:function(){return{shortname:h.booking.company.shortname,
bookingUuid:h.booking.uuid}}}):n()}}]);n.factory("controllers",["affiliationController","calendarController","cannedMessagesController","createController","dataController","editController","emailPreviewController","headerController","imageUploadController","listController","navigationController","removeController","reorderController","splitPaymentController",function(c,g,k,e,d,m,a,q,h,b,f,n,w,u){return{affiliationController:c,calendarController:g,cannedMessagesController:k,createController:e,dataController:d,
editController:m,emailPreviewController:a,headerController:q,imageUploadController:h,listController:b,navigationController:f,removeController:n,reorderController:w,splitPaymentController:u}}])})();
(function(){var n=angular.module("lib.models",[]);n.factory("models",["$filter","$injector","convert","require",function(c,g,k,e){var d=c("orderBy"),m=c("pluralize"),a=c("name"),q=[["US","USA"],["AF","Afghanistan"],["AL","Albania"],["DZ","Algeria"],["AS","American Samoa"],["AD","Andorra"],["AO","Angola"],["AI","Anguilla"],["AQ","Antarctica"],["AG","Antigua & Barbuda"],["AR","Argentina"],["AM","Armenia"],["AW","Aruba"],["AU","Australia"],["AT","Austria"],["AZ","Azerbaijan"],["BS","Bahama"],["BH","Bahrain"],
["BD","Bangladesh"],["BB","Barbados"],["BY","Belarus"],["BE","Belgium"],["BZ","Belize"],["BJ","Benin"],["BM","Bermuda"],["BT","Bhutan"],["BO","Bolivia"],["BA","Bosnia and Herzegovina"],["BW","Botswana"],["BV","Bouvet Island"],["BR","Brazil"],["IO","British Indian Ocean Territory"],["VG","British Virgin Islands"],["BN","Brunei Darussalam"],["BG","Bulgaria"],["BF","Burkina Faso"],["BI","Burundi"],["KH","Cambodia"],["CM","Cameroon"],["CA","Canada"],["CV","Cape Verde"],["KY","Cayman Islands"],["CF","Central African Republic"],
["TD","Chad"],["CL","Chile"],["CN","China"],["CX","Christmas Island"],["CC","Cocos (Keeling) Islands"],["CO","Colombia"],["KM","Comoros"],["CG","Congo"],["CK","Cook Iislands"],["CR","Costa Rica"],["HR","Croatia"],["CU","Cuba"],["CY","Cyprus"],["CZ","Czech Republic"],["DK","Denmark"],["DJ","Djibouti"],["DM","Dominica"],["DO","Dominican Republic"],["TP","East Timor"],["EC","Ecuador"],["EG","Egypt"],["SV","El Salvador"],["GQ","Equatorial Guinea"],["ER","Eritrea"],["EE","Estonia"],["ET","Ethiopia"],["FK",
"Falkland Islands (Malvinas)"],["FO","Faroe Islands"],["FJ","Fiji"],["FI","Finland"],["FR","France"],["FX","France, Metropolitan"],["GF","French Guiana"],["PF","French Polynesia"],["TF","French Southern Territories"],["GA","Gabon"],["GM","Gambia"],["GE","Georgia"],["DE","Germany"],["GH","Ghana"],["GI","Gibraltar"],["GR","Greece"],["GL","Greenland"],["GD","Grenada"],["GP","Guadeloupe"],["GU","Guam"],["GT","Guatemala"],["GN","Guinea"],["GW","Guinea-Bissau"],["GY","Guyana"],["HT","Haiti"],["HM","Heard & McDonald Islands"],
["HN","Honduras"],["HK","Hong Kong"],["HU","Hungary"],["IS","Iceland"],["IN","India"],["ID","Indonesia"],["IQ","Iraq"],["IE","Ireland"],["IR","Islamic Republic of Iran"],["IL","Israel"],["IT","Italy"],["CI","Ivory Coast"],["JM","Jamaica"],["JP","Japan"],["JO","Jordan"],["KZ","Kazakhstan"],["KE","Kenya"],["KI","Kiribati"],["KP","Korea, Democratic People's Republic of"],["KR","Korea, Republic of"],["KW","Kuwait"],["KG","Kyrgyzstan"],["LA","Lao People's Democratic Republic"],["LV","Latvia"],["LB","Lebanon"],
["LS","Lesotho"],["LR","Liberia"],["LY","Libyan Arab Jamahiriya"],["LI","Liechtenstein"],["LT","Lithuania"],["LU","Luxembourg"],["MO","Macau"],["MG","Madagascar"],["MW","Malawi"],["MY","Malaysia"],["MV","Maldives"],["ML","Mali"],["MT","Malta"],["MH","Marshall Islands"],["MQ","Martinique"],["MR","Mauritania"],["MU","Mauritius"],["YT","Mayotte"],["MX","Mexico"],["FM","Micronesia"],["MD","Moldova, Republic of"],["MC","Monaco"],["MN","Mongolia"],["MS","Monserrat"],["MA","Morocco"],["MZ","Mozambique"],
["MM","Myanmar"],["NA","Namibia"],["NR","Nauru"],["NP","Nepal"],["NL","Netherlands"],["AN","Netherlands Antilles"],["NC","New Caledonia"],["NZ","New Zealand"],["NI","Nicaragua"],["NE","Niger"],["NG","Nigeria"],["NU","Niue"],["NF","Norfolk Island"],["MP","Northern Mariana Islands"],["NO","Norway"],["OM","Oman"],["PK","Pakistan"],["PW","Palau"],["PA","Panama"],["PG","Papua New Guinea"],["PY","Paraguay"],["PE","Peru"],["PH","Philippines"],["PN","Pitcairn"],["PL","Poland"],["PT","Portugal"],["PR","Puerto Rico"],
["QA","Qatar"],["RE","Reunion"],["RO","Romania"],["RU","Russian Federation"],["RW","Rwanda"],["LC","Saint Lucia"],["WS","Samoa"],["SM","San Marino"],["ST","Sao Tome & Principe"],["SA","Saudi Arabia"],["SN","Senegal"],["SC","Seychelles"],["SL","Sierra Leone"],["SG","Singapore"],["SK","Slovakia"],["SI","Slovenia"],["SB","Solomon Islands"],["SO","Somalia"],["ZA","South Africa"],["GS","South Georgia and the South Sandwich Islands"],["ES","Spain"],["LK","Sri Lanka"],["SH","St. Helena"],["KN","St. Kitts and Nevis"],
["PM","St. Pierre & Miquelon"],["VC","St. Vincent & the Grenadines"],["SD","Sudan"],["SR","Suriname"],["SJ","Svalbard & Jan Mayen Islands"],["SZ","Swaziland"],["SE","Sweden"],["CH","Switzerland"],["SY","Syrian Arab Republic"],["TW","Taiwan"],["TJ","Tajikistan"],["TZ","Tanzania, United Republic of"],["TH","Thailand"],["TG","Togo"],["TK","Tokelau"],["TO","Tonga"],["TT","Trinidad & Tobago"],["TN","Tunisia"],["TR","Turkey"],["TM","Turkmenistan"],["TC","Turks & Caicos Islands"],["TV","Tuvalu"],["UG","Uganda"],
["UA","Ukraine"],["AE","United Arab Emirates"],["GB","United Kingdom (Great Britain)"],["UM","United States Minor Outlying Islands"],["VI","United States Virgin Islands"],["US","USA"],["ZZ","Unknown or unspecified country"],["UY","Uruguay"],["UZ","Uzbekistan"],["VU","Vanuatu"],["VA","Vatican City State (Holy See)"],["VE","Venezuela"],["VN","Viet Nam"],["WF","Wallis & Futuna Islands"],["EH","Western Sahara"],["YE","Yemen"],["YU","Yugoslavia"],["ZR","Zaire"],["ZM","Zambia"],["ZW","Zimbabwe"]],h=function(a){var b=
g.get("db").slipstream("currencyChoices");return _.isUndefined(b)?(console.warn("getCurrencyChoices: currency choices undefined"),[]):!a?b:_.filter(b,function(b){return _.contains(a,b[0])})},b={NETWORK_FILTER:"#network",COMPANY_FILTER:"#company",ADMIN_FILTER:{},filterUrl:function(a){return a===b.COMPANY_FILTER?"":a===b.ADMIN_FILTER?"admin/":a===b.NETWORK_FILTER?"network/":"network/"+a.shortname+"/"}};c=function(a,b,c,d){return function(f){return f[a]===b?f[c]:d}};var f={ADMIN_TYPE:"admin",CHARTER_TYPE:"charter",
AFFILIATE_TYPE:"affiliate",CALL_CENTER_SHORTNAME:"fhcallcenter",NO_FEE_TYPE:"no-fee",PERCENTAGE_FEE_TYPE:"percentage-fee",FLAT_FEE_TYPE:"flat-fee",TIERED_FEE_TYPE:"tiered-fee",WATERFALL_FEE_TYPE:"waterfall-fee",ROLLING_WINDOW_PERIOD_TYPE:"rolling-window-period",IMMEDIATE_PERIOD_TYPE:"immediate-period",ADMIN_SHORTNAME:"admin",isAdmin:function(a){return a&&a.shortname===f.ADMIN_SHORTNAME},MONTH_VIEW:"month",DAY_VIEW:"day",AGENDA_VIEW:"agenda",GRID_VIEW:"grid",TIMELINE_VIEW:"timeline",AVAILABILITY_TIMELINE:"availability",
RESOURCE_TIMELINE:"resource",MANIFEST_AVAILABILITIES_VIEW:"availabilities",MANIFEST_ITEMS_VIEW:"items",MANIFEST_BOOKINGS_VIEW:"bookings",MANIFEST_RUNS_VIEW:"runs",MANIFEST_RESOURCES_VIEW:"resources",TAKE_PAYMENT_PREFERENCE:"take",INFO_PAYMENT_PREFERENCE:"info",SKIP_PAYMENT_PREFERENCE:"skip",NO_INDEX_COMPANIES:["furycat"],DEFAULT_TIERED_FEE_SCHEDULE:[{cutoff:0,rate:"0.06"}],forObject:function(a){if(a)return a.cls===f.cls?a:a.company},INVOICE_FEE_RATE:1.9,INVOICE_FLAT_FEE:30,COUNTRIES:q,getCurrencyChoices:h,
getCurrencyCodes:function(){var a=g.get("db").slipstream("currencies");return _.isUndefined(a)?(console.warn("getCurrencyCodes: currency data undefined"),[]):_.keys(a)},DEFAULT_LANGUAGE:"en-us",DEFAULT_INCLUDED_TAX_PERCENTAGE_BY_COUNTRY:{AU:10},DEFAULT_TAX_DISPLAY_NAME:"Taxes",DEFAULT_TAX_DISPLAY_NAMES:{AU:"GST"},taxDisplayName:function(a){return a.features.taxDisplayName?a.features.taxDisplayName:f.DEFAULT_TAX_DISPLAY_NAMES[a.processorCountry]||f.DEFAULT_TAX_DISPLAY_NAME},COMPANY_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"company_locale_default",
ANONYMOUS_USER_LOCALE_DEFAULT_TIME_FORMAT_TYPE:"user_locale_default",TWELVE_HOUR_TIME_FORMAT_TYPE:"12_hour",TWENTY_FOUR_HOUR_TIME_FORMAT_TYPE:"24_hour",FALLBACK_SERVER_EXACT_TWELVE_HOUR_TIME_FORMAT:"g:iA",FALLBACK_SERVER_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"H:i",FALLBACK_CLIENT_EXACT_TWELVE_HOUR_TIME_FORMAT:"h:mma",FALLBACK_CLIENT_EXACT_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm",FALLBACK_CLIENT_TOP_OF_HOUR_TWELVE_HOUR_TIME_FORMAT:"ha",FALLBACK_CLIENT_TOP_OF_HOUR_TWENTY_FOUR_HOUR_TIME_FORMAT:"HH:mm"},n=_.map([f.MONTH_VIEW,
f.DAY_VIEW,f.AGENDA_VIEW,f.GRID_VIEW,f.TIMELINE_VIEW],function(a){return[a,_.capitalize(a)]}),w=_.filter(n,function(a){return a[0]!==f.DAY_VIEW});f.dashboardBookingsViewChoices=function(a){return a?n:w};f.rollingWindowDays=c("payoutPeriodType",f.ROLLING_WINDOW_PERIOD_TYPE,"rollingWindowDays",0);f.flatFee=c("feeType",f.FLAT_FEE_TYPE,"flatFee",0);f.percentageFeeRate=c("feeType",f.PERCENTAGE_FEE_TYPE,"percentageFeeRate",0);var u={BOOKING_TYPE:"booking",CUSTOMERS_TYPE:"customers",FOR_ALL_CUSTOMER_PROTOTYPES:"Every customer",
forCustomerPrototypes:function(a){return a.type===u.BOOKING_TYPE?"Whole booking":!a.customerPrototypeRequirements.length?u.FOR_ALL_CUSTOMER_PROTOTYPES:_.map(a.customerPrototypeRequirements,function(a){a=a.customerPrototype;return a.name||a.customerType.name}).join(", ")}},C={MAX_COLOR:12,DEFAULT_RECEIPT_FOOTER:"Thanks for your order!",isValidColor:function(a){return _.isNumber(a)&&0<=a&&a<=C.MAX_COLOR},checklistName:function(a){var b=a.name;a.isPrivate?b="<span class='badge badge-lock ghost'>Private</span> "+
b:a.isUnlisted&&(b="<span class='badge'>Unlisted</span> "+b);a.shortName&&(b=b+" <span class='fh-grey'>("+a.shortName+")</span>");return b},verboseName:"item",verboseNamePlural:"items",publicItems:function(a){return _.filter(a,function(a){return!a.isPrivate})}},z={NO_FLOW:{pk:!1,name:"None"},PAGE_TYPE:"page",LINK_TYPE:"link",ITEM_TYPE:"item",FLOW_QUERY:"flow",IS_SUGGESTED_QUERY:"suggested-flow",verboseName:"flow page",verboseNamePlural:"flow pages",WIDTH_ONE_THIRD:"1-3",WIDTH_HALF:"1-2",WIDTH_TWO_THIRDS:"2-3",
WIDTH_FULL:"1-1",HEIGHT_1:1,HEIGHT_2:2,HEIGHT_3:3,singleItemRedirect:function(a){return a&&a!==z.NO_FLOW&&z.isAllItems(a)&&a.emptyPageChildren&&1===a.emptyPageChildren.length?a.emptyPageChildren[0].item:null},effectiveChildren:function(a){var b=a.children;z.isAllItems(a)&&(b=a.emptyPageChildren);return b||[]},childItems:function(a){return _.compact(_.pluck(z.effectiveChildren(a),"item"))},childPages:function(a){return _.filter(a.children,{type:z.PAGE_TYPE})},calendarItems:function(a){var b=z.childItems(a);
z.isAllItems(a)||(b=_.reject(b,"isRetail"));return b},isCalendarIncluded:function(a){return a.isCalendarIncluded&&0<z.calendarItems(a).length},breadcrumbName:function(a){return a.shortName||a.name},isAllItems:function(a){return 0===a.childrenCount},isSingleLevelFlow:function(a){e.assert(a.children&&a.breadcrumbs,"Flow node must be fully loaded");return 0<a.breadcrumbs.length||0<z.childPages(a).length?!1:!0},gridColumnCount:function(a){a=z.effectiveChildren(a).length;return 6<=a||3===a?3:4<=a||2===
a?2:1},defaultBlockWidth:function(a){if(!z.isAllItems(a))return z.WIDTH_ONE_THIRD;a=z.gridColumnCount(a);return 3===a?z.WIDTH_ONE_THIRD:2===a?z.WIDTH_HALF:z.WIDTH_FULL},emptyGridBlockCount:function(a){if(!z.isAllItems(a))return 0;var b=z.gridColumnCount(a);return(a=z.effectiveChildren(a).length%b)?b-a:0},heading:function(a){return a.properties.heading||(a.item?a.item.name:a.name)},subheading:function(a){return a.properties.subheading?a.properties.subheading:a.item?a.item.headline:""},imageUrl:function(a){return a.imageCdnUrl?
a.imageCdnUrl:a.item?a.item.imageCdnUrl:null},imageMaxWidth:function(a){return!a.properties.width?550:z.isTallBlock(a)?null:z.imageMinWidth(a)},imageMaxHeight:function(a){return!a.properties.width?null:z.isTallBlock(a)?z.imageMinHeight(a):null},imageMinWidth:function(a){switch(a.properties.width){case z.WIDTH_ONE_THIRD:return 604;case z.WIDTH_HALF:return 920;case z.WIDTH_TWO_THIRDS:return 1236;case z.WIDTH_FULL:return 1868;default:return 0}},imageMinHeight:function(a){switch(a.properties.height){case z.HEIGHT_1:return 332;
case z.HEIGHT_2:return 692;case z.HEIGHT_3:return 1052;default:return 0}},isTallBlock:function(a){return a.properties.height>z.HEIGHT_1&&(a.properties.width===z.WIDTH_ONE_THIRD||a.properties.width===z.WIDTH_HALF)||a.properties.width===z.WIDTH_TWO_THIRDS&&a.properties.height===z.HEIGHT_3},WIDTH_LABELS:{}};z.WIDTH_LABELS[z.WIDTH_ONE_THIRD]="one-third";z.WIDTH_LABELS[z.WIDTH_HALF]="half";z.WIDTH_LABELS[z.WIDTH_TWO_THIRDS]="two-thirds";z.WIDTH_LABELS[z.WIDTH_FULL]="full";var l={find:function(a,b,c){var d;
c||(d=_.find(a,function(a){return a.customerPrototype===b.customerPrototype}));d||(d=_.find(a,function(a){return a.customerPrototype.customerType===b.customerPrototype.customerType}));return d}},p={ANY_CONDITIONS_TYPE:"any",ALL_CONDITIONS_TYPE:"all",isVisibleWhenBooking:function(a,b,c){return a.isHidden?!1:!a.customFieldInstanceConditions.length?!0:(a.conditionsType===p.ANY_CONDITIONS_TYPE?_.any:_.all)(a.customFieldInstanceConditions,function(a){return F.isMatch(a,b,c)})},find:function(a,b){return _.contains(a,
b)?b:_.find(a,{customField:b.customField})}},F={SELECTED_TYPE:"selected",NOT_SELECTED_TYPE:"not-selected",EXACT_TYPE:"exact",NOT_EXACT_TYPE:"not-exact",SELECTED_NOT_EXACT_TYPE:"selected-ne",SELECTED_OPTIONS:[{name:"is not empty",value:"selected"},{name:"is empty",value:"not-selected"}],EXACT_OPTIONS:[{name:"is not empty",value:"selected"},{name:"is empty",value:"not-selected"},{name:"is:",value:"exact"},{name:"is not:",value:"selected-ne"},{name:"is empty or not:",value:"not-exact"}],isValidParent:function(a){return _.contains([y.SHORT_TYPE,
y.YES_NO_TYPE,y.CODE_GENERATOR_TYPE,y.EXTENDED_OPTION_TYPE,y.MULTI_CAMPAIGN_TYPE,y.COUNT_TYPE],a.customField.type)},types:function(a){return F.needsExactValue(a)?F.EXACT_OPTIONS:F.SELECTED_OPTIONS},needsExactValue:function(a){return _.contains([y.SHORT_TYPE,y.EXTENDED_OPTION_TYPE,y.COUNT_TYPE],a.customField.type)},needsCustomField:function(a){return _.contains([F.EXACT_TYPE,F.NOT_EXACT_TYPE,F.SELECTED_NOT_EXACT_TYPE],a.type)},isMatch:function(a,b,c){c=c||{};var d=c[a.uri];if(!_.isUndefined(d))return d;
c[a.uri]=!1;var f=a.parentCustomFieldInstance;if(!f||f.isHidden||!p.isVisibleWhenBooking(f,b,c))return!1;d=a.type;b=b(f);d=d===F.SELECTED_TYPE?!!b:d===F.NOT_SELECTED_TYPE?!b:d===F.EXACT_TYPE?a.exactValue===b:d===F.NOT_EXACT_TYPE?!b||a.exactValue!==b:d===F.SELECTED_NOT_EXACT_TYPE?!!b&&a.exactValue!==b:!1;return c[a.uri]=d}},G={CHECKED_IN_TYPE:"checked-in",NO_SHOW_TYPE:"no-show",MIXED_CHECKIN_STATUS:{pk:"mixed",name:"Set check-in per customer...",type:"mixed"},EMPTY_CHECKIN_STATUS:{pk:"",name:"Not yet checked in"},
isCheckedIn:function(a){return a&&a.type===G.CHECKED_IN_TYPE},isNoShow:function(a){return a&&a.type===G.NO_SHOW_TYPE},isMixed:function(a){return a===G.MIXED_CHECKIN_STATUS},bookingCheckinStatus:function(a){if(a&&a.customers&&a.customers.length){var b=a.customers[0]?a.customers[0].checkinStatus:null;return _.every(a.customers,{checkinStatus:b})?b:G.MIXED_CHECKIN_STATUS}},bookingCheckinStatusObject:function(a){return G.bookingCheckinStatus(a)||G.EMPTY_CHECKIN_STATUS},bookingCheckinBreakdown:function(a){var b=
{};_.forEach(a.customers,function(a){var c=a.customerTypeRate.customerPrototype.customerType,d=a.checkinStatus||null;a=c.uri+":"+(d?d.uri:"");c=b[a]||{count:0,customerType:c,checkinStatus:d};c.count+=1;b[a]=c});a=d(_.values(b),function(a){return!a.checkinStatus?[1,2,0,a.customerType.sortableIndex]:[0,a.checkinStatus.type===Q.CheckinStatus.NOT_CHECKED_IN_TYPE?1:0,a.checkinStatus.sortableIndex,a.customerType.sortableIndex]});return _.map(a,function(a){var b=a.customerType.shortName||m(a.count,a.customerType.singular,
a.customerType.plural);return a.count.toString()+"\u00a0"+b+"\u00a0"+(a.checkinStatus?a.checkinStatus.name:"not checked in")}).join(", ")},checkinStatusClass:function(a){return a?a.type:"not-checked-in"},checkinStatusSort:function(a){return[!!a,G.isCheckedIn(a),G.isMixed(a),G.isNoShow(a),a?a.sortableIndex:0]}};c=function(a){return function(b){return x.effectiveBookingRestriction(b,a)}};var x={AUTO_STATUS:"auto",OPEN_STATUS:"open",CALL_STATUS:"call",CLOSED_STATUS:"closed",DISPLAY_STATUS_BY_STATUS:{auto:"Auto close",
open:"Open",call:"Closed & Call to book",closed:"Closed & hidden"},displayStatus:function(a){return x.DISPLAY_STATUS_BY_STATUS[a]},cutoffReachedStart:function(a){var b=x.cutoffReachedKind(a),c=x.cutoffReachedHours(a);return ba.cutoffStart(b,c,a.utcStartAt)},cutoffUnreachedStart:function(a){var b=x.cutoffUnreachedKind(a),c=x.cutoffUnreachedHours(a);return ba.cutoffStart(b,c,a.utcStartAt)},effectiveBookingRestriction:function(a,b){return a.bookingRestriction?a.bookingRestriction[b]:a.item.bookingRestriction?
a.item.bookingRestriction[b]:a.item[b]},soldOutText:c("soldOutText"),isBookableEverByPhone:c("isBookableEverByPhone"),cutoffReachedKind:c("cutoffReachedKind"),cutoffReachedHours:c("cutoffReachedHours"),cutoffUnreachedKind:c("cutoffUnreachedKind"),cutoffUnreachedHours:c("cutoffUnreachedHours"),isInPast:function(a){var b=a.utcEndAt;a=a.customerCount?x.cutoffReachedStart(a):x.cutoffUnreachedStart(a);b=Math.max(b.unix(),a.unix());a=moment().unix();return b<a},minimumPartySize:function(a){return a.customerCount?
x.effectiveBookingRestriction(a,"minimumSubsequentPartySize"):x.effectiveBookingRestriction(a,"minimumInitialPartySize")},maximumPartySize:function(a){return a.customerCount?x.effectiveBookingRestriction(a,"maximumSubsequentPartySize"):x.effectiveBookingRestriction(a,"maximumInitialPartySize")},blockedCustomerCount:function(a){return _.sum(a.blocks,"customerCount")},reservedCapacity:function(a){return _.sum(a.blocks,"reservedCapacity")}},r={items:function(a){return D.uniqueItems(a.allBookings)},isNoTax:function(a){return _.all(a.contributingBookings,
"availability.item.isNoTax")},receiptFooter:function(a){a=_.uniq(_.map(r.items(a),"receiptFooter"));return 1===a.length&&a[0]?a[0]:C.DEFAULT_RECEIPT_FOOTER}};c={COUNTRIES:q};var D={CANCELLED_STATUS:"cancelled",UNCANCELLED_STATUS:"uncancelled",PAID_PAID_STATUS:"paid",UNPAID_PAID_STATUS:"unpaid",OVERPAID_PAID_STATUS:"overpaid",UNDERPAID_PAID_STATUS:"underpaid",adjustBookingFee:function(a,b,c,d){b+=c;return!b||!d?a:d<b?_.roundHalfToEven(a*((b-d)/b)):0},affiliateCompany:function(a){return a.affiliation?
a.affiliation.affiliateCompany:void 0},newTransportation:function(a){if(a.customFieldValues)return _.find(a.customFieldValues,function(a){return a.customFieldInstance.customField.type===y.NEW_TRANSPORTATION_TYPE});console.warn("models.Booking.newTransportation: booking has no custom field values")},waiverCustomFields:function(a){var b=[],c=function(a){return a.customFieldInstance.customField.type===y.WAIVER_TYPE},d=function(a){return a.customFieldInstance.customField},f=_.map(_.filter(a.customFieldValues,
c),d),e=[];_.forEach(a.customers,function(a){e.push(_.map(_.filter(a.customFieldValues,c),d))});e=_.flatten(e);b=b.concat(e,f);if(b.length)return _.uniq(b,"pk");console.warn("models.Booking.waivers: booking has no waiver custom fields")},generatedCustomFields:function(a){var b={};_.forEach(a.generatedCodes,function(a){var c=a.generatingCampaign,d=c.customField,f=b[d.uri]||{customField:d,generatedCampaigns:{}};b[d.uri]=f;d=f.generatedCampaigns[c.uri]||{generatingCampaign:c,generatedCodes:[]};f.generatedCampaigns[c.uri]=
d;d.generatedCodes.push(a)});a=_.sortBy(_.values(b,function(a){return a.customField.name}));_.forEach(a,function(a){a.generatedCampaigns=_.sortBy(_.values(a.generatedCampaigns,function(a){return a.generatingCampaign.campaign.name}))});return a},isCountedTowardsOrderTotal:function(a){return a.status!==D.CANCELLED_STATUS||a.receipt&&a.receipt.gross},isEligibleForAutoFollowUpEmail:function(a){return a.item.isFollowUpEnabled&&a.contact.email},isEligibleForAutoReminderEmail:function(a){return a.item.isReminderEnabled&&
a.contact.email},isEligibleForAutoReminderSms:function(a){return a.company.isSmsEnabled&&a.item.isSmsReminderEnabled&&a.isSmsEnabled&&H.isEligiblePhoneNumber(a.contact.phone,a.contact.phoneCountry,a.contact.company)},isEligibleForReviewExpress:function(a){return a.item.isReviewExpressEnabled&&a.contact.email},isEligibleForOnlineCancellation:function(a){var b="paid"===a.paidStatus,c=_.filter(a.payments,function(a){return!a.isRefunded&&!a.isAnyCreditCardType});return!x.isInPast(a.availability)&&!a.isCancelled&&
a.company.features.isCancellationPoliciesEnabled&&a.company.features.isOnlineCancellationEnabled&&!!a.effectiveCancellationRule&&a.effectiveCancellationRule.isCancellationAllowed&&b&&!c.length},charterInvoiceRevenue:function(a){return!a.affiliation?null:a.invoicedToCharter+a.invoiceableToCharter},charterInvoiceOwed:function(a){return!a.affiliation?null:a.invoicedToAffiliate+a.invoiceableToAffiliate},isEligibleForCancellation:function(a,b){if(!a.company.features.isCancellationPoliciesEnabled||!a.effectiveCancellationRule||
!a.effectiveCancellationRule.isCancellationAllowed)return!1;var c=b?b.company:null;return a.affiliation&&a.affiliation.affiliateCompany===c&&_.any(a.payments,function(a){return!a.isDeferred&&!a.isCollectedByAffiliate})?!1:!0},isEligibleForRebook:function(a,b){return D.isEligibleForCancellation(a,b)},itemsInOrder:function(a){return a.isOrder?_.uniq(_.pluck(a.order.allBookings,"item")):[a.item]},hasEmailableDisputes:function(a){return _.some(a.payments,function(a){return E.isOpenDisputeStatus(a)})},
customerTypeRateCountKey:function(a){return"customerTypeRate"+a.pk+"-count"},customFieldInstanceKey:function(a,b,c){b=_.isObject(b)?b.cls===l.cls?b.pk.toString()+"-"+c.toString():b.key:_.isString(b)?b:"Booking";return"customFieldInstance"+a.pk+"For"+b+"-value"},uniqueItems:function(a){return _.uniq(_.map(a,"item"))}},B={PERCENTAGE_COMMISSION_TYPE:"percentage",FLAT_COMMISSION_TYPE:"flat",AFFILIATE_TAKE_PAYMENT_PREFERENCE:"affiliate-take",CARD_ON_FILE_PAYMENT_PREFERENCE:"card-on-file",TAKE_PAYMENT_PREFERENCE:f.TAKE_PAYMENT_PREFERENCE,
INFO_PAYMENT_PREFERENCE:f.INFO_PAYMENT_PREFERENCE,SKIP_PAYMENT_PREFERENCE:f.SKIP_PAYMENT_PREFERENCE,MAX_SELECTABLE_AFFILIATES:400,isOnlineBookingEnabled:function(a){return(a=a.affiliateGroup&&a.affiliateGroup.groupPermissions)&&a.canCreateBookings},verboseName:"affiliate",verboseNamePlural:"affiliates",name:function(a){return!a?"":!a.affiliateCompany?a.unicode:a.affiliateCompany.name}},t={NEW_STATUS:"new",PENDING_STATUS:"pending",RUNNING_STATUS:"running",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",
CANCELLED_STATUS:"cancelled",ALL_PARTNER_FILTER_OPTION:"all",DIRECT_PARTNER_FILTER_OPTION:"direct",ALL_AFFILIATE_FILTER_OPTION:"all",DIRECT_AFFILIATE_FILTER_OPTION:"direct",ALL_ITEM_FILTER_OPTION:"all",ALL_USER_FILTER_OPTION:"all",ONLINE_USER_FILTER_OPTION:"online",ORIGINAL_USER_TYPE_FILTER_OPTION:"original",CURRENT_USER_TYPE_FILTER_OPTION:"current",ALL_CANCELLED_BOOKINGS_FILTER_OPTION:"all",NO_CANCELLED_BOOKINGS_FILTER_OPTION:"none",NON_REFUNDED_CANCELLED_BOOKINGS_FILTER_OPTION:"non-refunded",ONLY_CANCELLED_BOOKINGS_FILTER_OPTION:"only",
AVAILABILITY_DATE_TYPE:"availability",BOOKING_DATE_TYPE:"booking",BOOKING_ORIGINAL_DATE_TYPE:"booking-original",DISPUTE_DATE_TYPE:"dispute",PAYMENT_DATE_TYPE:"payment",PAYMENT_OR_REFUND_DATE_TYPE:"payment-or-refund",PAYMENT_OR_REFUND_ACCRUAL_DATE_TYPE:"payment-or-refund-accrual",LINE_ITEM_DATE_TYPE:"line-item",ALL_TRANSACTION_TAG_FILTER_OPTION:"all",ALL_SALESPERSON_FILTER_OPTION:"all",ALL_DISPUTE_STATUS_FILTER_OPTION:"all",ALL_CLOSED_DISPUTE_STATUS_FILTER_OPTION:"all-closed",ALL_OPEN_DISPUTE_STATUS_FILTER_OPTION:"all-open",
ALL_CURRENCY_FILTER_OPTION:"all",UNCANCELLED_FILTER_OPTION:"uncancelled",REFUNDED_CANCELLED_FILTER_OPTION:"refunded",UNREFUNDED_CANCELLED_FILTER_OPTION:"unrefunded",ADVANCED_TYPE:"advanced",emptyFilters:function(){return _.mapValues(Q.Report.MODELS,function(){return[]})},emptyColumns:function(){return _.mapValues(Q.Report.MODELS,function(){return{}})},emptyCompanyOptions:function(a){return _.keyBy(a,"pk",function(a){var b={};a.isCharter&&(b.filters=t.emptyFilters());a.isAffiliate&&(b.selectedAllPartners=
void 0,b.allPartnerFilters=t.emptyFilters(),b.partners={},b.selectedPartners={});return b})},emptyReportOptions:function(a){return{modelName:"",presetDateRange:"",startDate:"",endDate:"",dateType:"",filters:t.emptyFilters(),companies:t.emptyCompanyOptions(a),selectedCharters:{},selectedAffiliates:{},groups:[],isDetailed:"",columns:t.emptyColumns(),isOpened:!1,customFieldValueModel:""}},defaultGroups:function(){return[t.ITEM_GROUP]},defaultBookingCancelledStatusFilter:function(){return{type:t.CANCELLED_STATUS_FILTER_TYPE,
data:{value:[t.UNCANCELLED_FILTER_OPTION,t.UNREFUNDED_CANCELLED_FILTER_OPTION]}}},defaultFilters:function(){return _.extend(t.emptyFilters(),{Booking:[t.defaultBookingCancelledStatusFilter()]})},defaultBookingColumns:function(){return _.toTrueKeys([t.BOOKING_COUNT_COLUMN,t.BOOKING_ID_COLUMN,t.BOOKING_BOOKED_BY_COLUMN,t.CREATED_AT_COLUMN,t.AVAILABILITY_DATETIME_COLUMN,t.TOTAL_COST_PRICE_COLUMN,t.TOTAL_COST_TAX_COLUMN,t.TOTAL_COST_TOTAL_COLUMN,t.CONTACT_NAME_COLUMN,t.CUSTOMER_COUNT_COLUMN,t.AFFILIATE_COLUMN,
t.VOUCHER_NUMBER_COLUMN,t.INVOICEABLE_TO_CHARTER_COLUMN,t.INVOICEABLE_TO_AFFILIATE_COLUMN,t.RECEIPT_PROCESSING_FEE_COLUMN,t.COLLECTED_TOTAL_COST_TOTAL_COLUMN,t.RECEIPT_NET_COLUMN])},defaultCustomerColumns:function(){return _.toTrueKeys([t.CUSTOMER_COUNT_COLUMN,t.TOTAL_COST_PRICE_COLUMN,t.TOTAL_COST_TAX_COLUMN,t.TOTAL_COST_TOTAL_COLUMN,t.COLLECTED_TOTAL_COST_PRICE_COLOUMN,t.COLLECTED_TOTAL_COST_TAX_COLOUMN,t.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultCustomFieldValueColumns:function(){return _.toTrueKeys([t.USE_COUNT_COLUMN,
t.TOTAL_COST_PRICE_COLUMN,t.TOTAL_COST_TAX_COLUMN,t.TOTAL_COST_TOTAL_COLUMN,t.COLLECTED_TOTAL_COST_PRICE_COLOUMN,t.COLLECTED_TOTAL_COST_TAX_COLOUMN,t.COLLECTED_TOTAL_COST_TOTAL_COLUMN])},defaultLineItemColumns:function(){return _.toTrueKeys([t.CREATED_AT_COLUMN,t.TOTAL_COST_PRICE_COLUMN,t.TOTAL_COST_TAX_COLUMN,t.TOTAL_COST_TOTAL_COLUMN,t.LINE_ITEM_DESCRIPTION_COLUMN])},defaultPaymentColumns:function(){return _.toTrueKeys([t.CREATED_AT_COLUMN,t.PAYMENT_OR_REFUND_COLUMN,t.PAYMENT_OR_REFUND_ID_COLUMN,
t.PAYMENT_TYPE_COLUMN,t.PAYMENT_AND_REFUND_GROSS_COLUMN,t.PAYMENT_AND_REFUND_PROCESSING_FEE_COLUMN,t.PAYMENT_AND_REFUND_NET_COLUMN,t.PAYMENT_COUNT_COLUMN,t.REFUND_COUNT_COLUMN,t.PAYMENT_TOTAL_TAX_COLUMN,t.REFUND_TOTAL_PRICE_COLUMN])},defaultPaymentColumnsWithTax:function(){return _.extend(t.defaultPaymentColumns(),_.toTrueKeys([t.PAYMENT_AND_REFUND_TOTAL_TAX_COLUMN]))},defaultCustomerReportColumns:function(){return _.extend(t.emptyColumns(),{Customer:t.defaultCustomerColumns(),Booking:_.toTrueKeys([t.BOOKING_ID_COLUMN,
t.BOOKING_COUNT_COLUMN,t.CUSTOMER_COUNT_COLUMN,t.TOTAL_COST_TOTAL_COLUMN])})},defaultColumns:function(){return _.extend(t.emptyColumns(),{Booking:t.defaultBookingColumns(),Customer:t.defaultCustomerColumns(),CustomFieldValue:t.defaultCustomFieldValueColumns(),LineItem:t.defaultLineItemColumns()})},defaultReportOptions:function(a){var b=_.defaults({dateType:t.AVAILABILITY_DATE_TYPE,presetDateRange:t.YESTERDAY_DATE_RANGE,isDetailed:!1,groups:t.defaultGroups(),columns:t.defaultColumns(),filters:t.defaultFilters(),
customFieldValueModel:X.cls},t.emptyReportOptions(a));a=a[0];b.selectedCharters[a.pk]=a.isCharter;b.selectedAffiliates[a.pk]=!a.isCharter&&a.isAffiliate;return b}},y={STACK_PRICING_TYPE:"stack",CURRENT_PRICING_TYPE:"current",INITIAL_PRICING_TYPE:"initial",ZERO_PRICING_TYPE:"zero",SHORT_TYPE:"short",LONG_TYPE:"long",YES_NO_TYPE:"yes-no",OPTION_TYPE:"option",EXTENDED_OPTION_TYPE:"extended-option",HEADER_TYPE:"header",NOTE_TYPE:"note",TRANSPORTATION_TYPE:"transportation",NEW_TRANSPORTATION_TYPE:"new-transportation",
CODE_TYPE:"code",MULTI_CAMPAIGN_TYPE:"multi-campaign",CODE_GENERATOR_TYPE:"code-generator",CARD_GENERATOR_TYPE:"card-generator",COUNT_TYPE:"count",WAIVER_TYPE:"waiver",DISPLAY_ONLY_TYPES:["note","header"],suggestedAmounts:function(a){if(a.type!==y.CARD_GENERATOR_TYPE)return[];a=a.cardSuggestedAmount||2500;return[a,2*a,4*a]},isDisplayOnly:function(a){return _.contains(y.DISPLAY_ONLY_TYPES,a.type)},isManifestField:function(a){return y.isDisplayOnly(a)?!1:!_.contains([y.NEW_TRANSPORTATION_TYPE,y.CODE_GENERATOR_TYPE,
y.WAIVER_TYPE],a.type)},isAggregatable:function(a){return _.contains([Q.CustomField.EXTENDED_OPTION_TYPE,Q.CustomField.OPTION_TYPE,Q.CustomField.CODE_TYPE,Q.CustomField.MULTI_CAMPAIGN_TYPE,Q.CustomField.YES_NO_TYPE,Q.CustomField.TRANSPORTATION_TYPE,Q.CustomField.COUNT_TYPE],a.type)},usesCheckbox:function(a){return _.contains([y.YES_NO_TYPE,y.CODE_GENERATOR_TYPE],a.type)},needsRequired:function(a){return y.isDisplayOnly(a)?!1:!_.contains([y.TRANSPORTATION_TYPE,y.COUNT_TYPE],a.type)},needsPricing:function(a){return _.contains([y.YES_NO_TYPE,
y.OPTION_TYPE,y.CODE_TYPE,y.CODE_GENERATOR_TYPE,y.CARD_GENERATOR_TYPE,y.NEW_TRANSPORTATION_TYPE,y.COUNT_TYPE],a.type)},needsAlwaysPerCustomer:function(a){return y.needsPricing(a)||_.contains([y.EXTENDED_OPTION_TYPE],a.type)},pricedByValue:function(a){return a.type===y.CARD_GENERATOR_TYPE},pricedByOptions:function(a){return _.contains([y.EXTENDED_OPTION_TYPE,y.MULTI_CAMPAIGN_TYPE],a.type)},needsBookingNotes:function(a){return _.contains([y.OPTION_TYPE,y.CODE_TYPE,y.CODE_GENERATOR_TYPE,y.CARD_GENERATOR_TYPE,
y.MULTI_CAMPAIGN_TYPE,y.YES_NO_TYPE,y.TRANSPORTATION_TYPE,y.NEW_TRANSPORTATION_TYPE,y.EXTENDED_OPTION_TYPE,y.COUNT_TYPE],a.type)},needsHint:function(a){return _.contains([y.SHORT_TYPE,y.LONG_TYPE,y.CODE_TYPE,y.NEW_TRANSPORTATION_TYPE,y.MULTI_CAMPAIGN_TYPE],a.type)},hasExtraOptions:function(a){return _.contains([y.EXTENDED_OPTION_TYPE,y.TRANSPORTATION_TYPE,y.MULTI_CAMPAIGN_TYPE],a.type)},isDefaultValueAllowed:function(a){return _.contains(y.DEFAULT_VALUE_TYPES,a.type)},isValidRawValue:function(a,b){return a.type===
y.EXTENDED_OPTION_TYPE?""===b?!0:_.isNumber(b)&&_.find(a.extendedOptions,{pk:b}):a.type===y.COUNT_TYPE?_.isNumber(b)&&b>=a.countMin&&b<=a.countMax:!0},displayForRawValue:function(b,c){if(b.type===y.EXTENDED_OPTION_TYPE){if(""===c)return"";var d=_.find(b.extendedOptions,{pk:c});return d?a(d):"Deleted option"}return b.type===y.YES_NO_TYPE?c?"Yes":"No":_.isUndefined(c)||null===c?"":c.toString()},isOptionAvailable:function(a,b){if(""===b)return!0;var c=a.type;return c===y.OPTION_TYPE?_.contains(a.options,
b):c===y.EXTENDED_OPTION_TYPE?_.some(a.extendedOptions,function(a){return a.pk===b}):c===y.TRANSPORTATION_TYPE?_.some(a.transportationOptions,function(a){return a.pk===b}):c===y.COUNT_TYPE?b>=a.countMin&&b<=a.countMax:!0},autofillValue:function(a,b,c){if(!_.isUndefined(b)&&(a=a.customField,y.isOptionAvailable(a,b)))return c&&a.type===y.NEW_TRANSPORTATION_TYPE&&(b=void 0),_.clone(b)},verboseName:"custom field",verboseNamePlural:"custom fields",dropdownName:function(a){return"["+a.shortDisplayType+
"] "+a.name}};_.extend(y,{GROUPED_TYPES:{text:[y.SHORT_TYPE,y.LONG_TYPE],checkbox:[y.YES_NO_TYPE,y.CODE_GENERATOR_TYPE],dropdown:[y.EXTENDED_OPTION_TYPE,y.OPTION_TYPE],quantity:[y.COUNT_TYPE],transportation:[y.NEW_TRANSPORTATION_TYPE,y.TRANSPORTATION_TYPE],code:[y.MULTI_CAMPAIGN_TYPE,y.CODE_TYPE],label:[y.HEADER_TYPE],waiver:[y.WAIVER_TYPE],"gift-card":[y.CARD_GENERATOR_TYPE]},groupedType:function(a){return _.findKey(y.GROUPED_TYPES,function(b){return _.contains(b,a)})},DEFAULT_VALUE_TYPES:[y.SHORT_TYPE,
y.YES_NO_TYPE,y.CODE_GENERATOR_TYPE,y.EXTENDED_OPTION_TYPE,y.COUNT_TYPE]});var L=function(a){return _.some(a.payments,function(a){return a.type===E.AFFILIATE_TYPE?!1:!a.isDeferred&&!a.isRefunded})},J=function(a){return _.some(a.payments,function(a){return a.type===E.AFFILIATE_TYPE?!1:!a.isDeferred&&!!a.refundCount})},s={AVAILABILITY_MANIFEST_TYPE:"availability-manifest",ORDER_CONFIRMATION_TYPE:"order-confirmation",ORDER_CANCELLATION_TYPE:"order-cancellation",ORDER_RECEIPT_TYPE:"order-receipt",ORDER_REFUNDED_TYPE:"order-refunded",
ORDER_SHARE_TYPE:"order-share",BOOKING_CANCELLATION_TYPE:"booking-cancellation",BOOKING_CONFIRMATION_TYPE:"booking-confirmation",BOOKING_FOLLOW_UP_TYPE:"booking-follow-up",BOOKING_MESSAGE_TYPE:"booking-message",BOOKING_RECEIPT_TYPE:"booking-receipt",BOOKING_REBOOKED_TYPE:"booking-rebooked",BOOKING_REFUNDED_TYPE:"booking-refunded",BOOKING_REMINDER_TYPE:"booking-reminder",BOOKING_SHARE_TYPE:"booking-share",NOTIFICATION_FAILURE_TYPE:"notification-failure",CREW_CHANGE_TYPE:"crew-change",CREW_REMINDER_TYPE:"crew-reminder",
DAILY_MANIFEST_TYPE:"daily-manifest",DISPUTE_TYPE:"dispute",INVOICE_PAYMENT_REQUEST_TYPE:"invoice-payment-request",INVOICE_UPLOAD_STATUS_UPDATE_TYPE:"invoice-upload-status-update",STORED_VALUE_CARD_TYPE:"stored-value-card",DEFAULT_SUBJECT_BY_TYPE:{"booking-cancellation":"Your booking has been cancelled","booking-confirmation":"Booking Confirmation","booking-follow-up":"Thank you!","booking-message":"","booking-receipt":"Your payment has been processed","booking-rebooked":"You've been rebooked","booking-refunded":"You've been refunded",
"booking-reminder":"Booking Reminder","booking-share":"Booking Confirmation Share","order-cancellation":"Your order has been updated","order-confirmation":"Order Confirmation","order-share":"Order Confirmation Share","order-receipt":"Your payment has been processed","order-refunded":"You've been refunded"},displayType:function(a){a=a.replace("booking-","").replace("order-","");return _.capitalize(a)},notificationTypesForOrder:function(a){var b=[];a.contributingBookingCount&&b.push(s.ORDER_CONFIRMATION_TYPE);
_.any(a.allBookings,L)&&b.push(s.ORDER_RECEIPT_TYPE);_.any(a.allBookings,J)&&b.push(s.ORDER_REFUNDED_TYPE);_.any(a.allBookings,"isCancelled")&&b.push(s.ORDER_CANCELLATION_TYPE);return b},notificationTypesForBooking:function(a){if(a.rebookedTo)return[];var b=[];a.isCancelled?b.push(s.BOOKING_CANCELLATION_TYPE):a.rebookedFrom?(b.push(s.BOOKING_REBOOKED_TYPE),b.push(s.BOOKING_REMINDER_TYPE),b.push(s.BOOKING_CONFIRMATION_TYPE)):(b.push(s.BOOKING_CONFIRMATION_TYPE),b.push(s.BOOKING_REMINDER_TYPE));L(a)&&
b.push(s.BOOKING_RECEIPT_TYPE);J(a)&&b.push(s.BOOKING_REFUNDED_TYPE);b.push(s.BOOKING_MESSAGE_TYPE);b.push(s.BOOKING_FOLLOW_UP_TYPE);return b},isPreviewable:function(a){return _.contains([s.ORDER_CANCELLATION_TYPE,s.ORDER_CONFIRMATION_TYPE,s.BOOKING_CANCELLATION_TYPE,s.BOOKING_CONFIRMATION_TYPE,s.BOOKING_FOLLOW_UP_TYPE,s.BOOKING_MESSAGE_TYPE,s.BOOKING_REMINDER_TYPE,s.INVOICE_PAYMENT_REQUEST_TYPE],a)},isSubjectEditable:function(a){return _.contains([s.BOOKING_CANCELLATION_TYPE,s.BOOKING_FOLLOW_UP_TYPE,
s.BOOKING_MESSAGE_TYPE,s.BOOKING_REBOOKED_TYPE,s.BOOKING_RECEIPT_TYPE,s.BOOKING_REFUNDED_TYPE,s.DISPUTED_TYPE,s.ORDER_RECEIPT_TYPE,s.ORDER_REFUNDED_TYPE],a)},filterByType:function(a,b){return _.filter(a,function(a){return a.type===b})},bookingConfirmationNotifications:function(a){return s.filterByType(a,s.BOOKING_CONFIRMATION_TYPE)},bookingFollowUpNotifications:function(a){return s.filterByType(a,s.BOOKING_FOLLOW_UP_TYPE)},bookingRebookedNotifications:function(a){return s.filterByType(a,s.BOOKING_REBOOKED_TYPE)},
bookingReminderNotifications:function(a){return s.filterByType(a,s.BOOKING_REMINDER_TYPE)},invoicePaymentRequestNotifications:function(a){return s.filterByType(a,s.INVOICE_PAYMENT_REQUEST_TYPE)},UNKNOWN_STATUS:"unknown",PROCESSED_STATUS:"processed",DEFERRED_STATUS:"deferred",DELIVERED_STATUS:"delivered",USER_OPENED_STATUS:"open",USER_CLICKED_URL_STATUS:"click",BOUNCE_STATUS:"bounce",DROPPED_STATUS:"dropped",USER_REPORTED_SPAM_STATUS:"spamreport",USER_UNSUBSCRIBED_STATUS:"unsubscribe",isOpened:function(a){return _.contains([s.USER_OPENED_STATUS,
s.USER_CLICKED_URL_STATUS,s.USER_REPORTED_SPAM_STATUS,s.USER_UNSUBSCRIBED_STATUS],a)},isFailed:function(a){return _.contains([s.BOUNCE_STATUS,s.DROPPED_STATUS],a)},subjectForDisputeType:function(a){return"[Response Needed] New Dispute for Booking #"+a.pk+" ("+a.contact.name+")"}},H={US_COUNTRY_CODE:"US",INTERNATIONAL_ENABLED_COUNTRIES:q,INTERNATIONAL_DISABLED_COUNTRIES:[["US","USA"]],TEST_NUMBERS:"+15005550001 +15005550002 +15005550003 +15005550004 +15005550006 +15005550009".split(" "),INTERNATIONAL_ENABLED_NUMBER_REGEX:/^\+?\d{5,15}$/,
INTERNATIONAL_DISABLED_NUMBER_REGEX:/^(\+1|1)?\d{10}$/,INTERNATIONAL_ENABLED_NUMBER_MAX_LENGTH:16,INTERNATIONAL_DISABLED_NUMBER_MAX_LENGTH:12,isTestNumber:function(a){a="+"+g.get("phoneNumbers").digits(a);return _.contains(H.TEST_NUMBERS,a)},isTestNumberAllowed:function(){return window.slipstream&&"production"!=window.slipstream.configuration&&window.slipstream.isTwilioTestAccountEnabled},isEligiblePhoneNumber:function(a,b,c){if(H.isTestNumberAllowed()&&H.isTestNumber(a))return!0;var d=g.get("phoneNumbers");
return!d.isPossiblyValid(a)?!1:b?"US"===b?d.parseUsPhoneNumber(a).isUsPhoneNumber:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled:d.parseUsPhoneNumber(a).isUsPhoneNumber?!0:!c?(console.warn("SmsNotification.isEligiblePhoneNumber: company not provided"),!1):c.features.isInternationalSmsEnabled}},v={AVAILABILITY_MANIFEST_TYPE:s.AVAILABILITY_MANIFEST_TYPE,BOOKING_CONFIRMATION_TYPE:s.BOOKING_CONFIRMATION_TYPE,BOOKING_CANCELLATION_TYPE:s.BOOKING_CANCELLATION_TYPE,
NOTIFICATION_FAILURE_TYPE:s.NOTIFICATION_FAILURE_TYPE,CREW_CHANGE_TYPE:s.CREW_CHANGE_TYPE,CREW_REMINDER_TYPE:s.CREW_REMINDER_TYPE,DAILY_MANIFEST_TYPE:s.DAILY_MANIFEST_TYPE,DISPUTE_TYPE:s.DISPUTE_TYPE,INVOICE_UPLOAD_STATUS_UPDATE_TYPE:s.INVOICE_UPLOAD_STATUS_UPDATE_TYPE,DIRECT_BOOKING_OPTION:"isDirect",ONLINE_BOOKING_OPTION:"isOnline",AFFILIATE_BOOKING_OPTION:"isAffiliate",REBOOKED_BOOKING_OPTION:"isRebooked",isTypeSupported:function(a,b){return b===v.INVOICE_UPLOAD_STATUS_UPDATE_TYPE?(a.isAffiliate||
a.isCharter)&&a.isInvoicingEnabled:a.isCharter},isAnyTypeSupported:function(a){return _.some(v.TYPES,function(b){return v.isTypeSupported(a,b)})},isUserSubscribed:function(a,b,c){return _.some(a,function(a){return a.user===b&&a.type===c})}};v.TYPES=[v.AVAILABILITY_MANIFEST_TYPE,v.BOOKING_CANCELLATION_TYPE,v.BOOKING_CONFIRMATION_TYPE,v.NOTIFICATION_FAILURE_TYPE,v.CREW_CHANGE_TYPE,v.CREW_REMINDER_TYPE,v.DAILY_MANIFEST_TYPE,v.DISPUTE_TYPE,v.INVOICE_UPLOAD_STATUS_UPDATE_TYPE];v.ITEM_SUBSCRIPTION_TYPES=
[v.AVAILABILITY_MANIFEST_TYPE,v.BOOKING_CONFIRMATION_TYPE,v.BOOKING_CANCELLATION_TYPE,v.NOTIFICATION_FAILURE_TYPE,v.CREW_CHANGE_TYPE,v.CREW_REMINDER_TYPE];v.HOURS_BEFORE_SUBSCRIPTION_TYPES=[v.AVAILABILITY_MANIFEST_TYPE,v.CREW_REMINDER_TYPE,v.DAILY_MANIFEST_TYPE];v.HOURS_BEFORE_DEFAULTS={};v.HOURS_BEFORE_DEFAULTS[v.AVAILABILITY_MANIFEST_TYPE]=24;v.HOURS_BEFORE_DEFAULTS[v.CREW_REMINDER_TYPE]=24;v.HOURS_BEFORE_DEFAULTS[v.DAILY_MANIFEST_TYPE]=-6;v.CREW_AVAILABILITIES_ONLY_TYPES=[v.AVAILABILITY_MANIFEST_TYPE,
v.BOOKING_CONFIRMATION_TYPE];v.BOOKING_OPTION_TYPES=[v.BOOKING_CANCELLATION_TYPE,v.BOOKING_CONFIRMATION_TYPE];v.BOOKING_OPTIONS=[v.DIRECT_BOOKING_OPTION,v.ONLINE_BOOKING_OPTION,v.AFFILIATE_BOOKING_OPTION,v.REBOOKED_BOOKING_OPTION];v.BOOKING_OPTIONS_BY_TYPE={};v.BOOKING_OPTIONS_BY_TYPE[v.BOOKING_CANCELLATION_TYPE]=[v.DIRECT_BOOKING_OPTION,v.ONLINE_BOOKING_OPTION,v.AFFILIATE_BOOKING_OPTION];v.BOOKING_OPTIONS_BY_TYPE[v.BOOKING_CONFIRMATION_TYPE]=[v.DIRECT_BOOKING_OPTION,v.ONLINE_BOOKING_OPTION,v.AFFILIATE_BOOKING_OPTION,
v.REBOOKED_BOOKING_OPTION];var q={ORDER_CONFIRMATION_TYPE:s.ORDER_CONFIRMATION_TYPE,CANCELLATION_TYPE:s.BOOKING_CANCELLATION_TYPE,CONFIRMATION_TYPE:s.BOOKING_CONFIRMATION_TYPE,FOLLOW_UP_TYPE:s.BOOKING_FOLLOW_UP_TYPE,MESSAGE_TYPE:s.BOOKING_MESSAGE_TYPE,RECEIPT_TYPE:s.BOOKING_RECEIPT_TYPE,REBOOKED_TYPE:s.BOOKING_REBOOKED_TYPE,REFUNDED_TYPE:s.BOOKING_REFUNDED_TYPE,INVOICE_PAYMENT_REQUEST_TYPE:s.INVOICE_PAYMENT_REQUEST_TYPE,TYPES:[s.BOOKING_CANCELLATION_TYPE,s.BOOKING_CONFIRMATION_TYPE,s.BOOKING_FOLLOW_UP_TYPE,
s.BOOKING_MESSAGE_TYPE,s.BOOKING_RECEIPT_TYPE,s.BOOKING_REBOOKED_TYPE,s.BOOKING_REFUNDED_TYPE,s.INVOICE_PAYMENT_REQUEST_TYPE],BOOKING_TYPES:[s.BOOKING_CANCELLATION_TYPE,s.BOOKING_CONFIRMATION_TYPE,s.BOOKING_FOLLOW_UP_TYPE,s.BOOKING_MESSAGE_TYPE,s.BOOKING_RECEIPT_TYPE,s.BOOKING_REBOOKED_TYPE,s.BOOKING_REFUNDED_TYPE],ORDER_TYPES:[s.BOOKING_CANCELLATION_TYPE,s.BOOKING_CONFIRMATION_TYPE,s.BOOKING_MESSAGE_TYPE,s.BOOKING_RECEIPT_TYPE,s.BOOKING_REFUNDED_TYPE],displayType:s.displayType},O={PENDING_STATUS:"pending",
DISPUTED_STATUS:"disputed",WON_STATUS:"won",LOST_STATUS:"lost",REFUNDED_STATUS:"refunded",displayStatus:function(a){return _.capitalize(a)}};O.OPEN_STATUSES=[O.PENDING_STATUS,O.DISPUTED_STATUS];O.CLOSED_STATUSES=[O.WON_STATUS,O.LOST_STATUS,O.REFUNDED_STATUS];O.STATUSES=O.OPEN_STATUSES.concat(O.CLOSED_STATUSES);var E={CC_TYPE:"balanced-cc",LEGACY_CC_TYPE:"cc",IN_STORE_TYPE:"in-store",AFFILIATE_TYPE:"affiliate",STORED_VALUE_CARD_TYPE:"stored-value-card",MIN_CHARGE_AMOUNT:50,PENDING_DISPUTE_STATUS:"pending",
DISPUTED_DISPUTE_STATUS:"disputed",WON_DISPUTE_STATUS:"won",LOST_DISPUTE_STATUS:"lost",REFUNDED_DISPUTE_STATUS:"refunded",isOpenDisputeStatus:function(a){return _.contains(E.OPEN_DISPUTE_STATUES,a.disputeStatus)},isClosedDisputeStatus:function(a){return _.contains(E.CLOSED_DISPUTE_STATUSES,a.disputeStatus)},isDisputedAndNonRefundable:function(a){return a.disputeStatus===E.DISPUTED_DISPUTE_STATUS||a.disputeStatus===E.LOST_DISPUTE_STATUS||a.disputeStatus===E.REFUNDED_DISPUTE_STATUS},isEmv:function(a){return a.type===
E.CC_TYPE&&a.metadata&&a.metadata.isEmv},isEmvSignatureRequired:function(a){return E.isEmv(a)&&a.metadata.isEmvSignatureRequired},emvDetails:function(a){if(!E.isEmv(a))return[];var b=_.toTrueKeys("Date;Time;Amount;Description;Name;Address;Zip;City;Country;Contact;Additional Information;Account".split(";"));return _.filter(a.metadata.emvDetails,function(a){return!b[a.key]})},isPartialRefundAllowed:function(a){return!E.isAnyCreditCardType(a)||!a.isDisputed||a.disputeStatus===E.WON_DISPUTE_STATUS},COUNTRIES_WITH_POSTAL_CODES:["US"],
DEMO_CARD_NUMBERS:["4111111111111111","5105105105105100","341111111111111","4242424242424242"],isNotCardOnFileCreditCardType:function(a){return E.isAnyCreditCardType(a)&&!a.isCardOnFile},isAnyCreditCardType:function(a){return a.type===E.CC_TYPE||a.type===E.LEGACY_CC_TYPE},isDemoCardNumber:function(a){return _.contains(E.DEMO_CARD_NUMBERS,a)},needsPostalCode:function(a){return _.contains(E.COUNTRIES_WITH_POSTAL_CODES,a)},cardPayments:function(a,b){var c={};_.forEach(a,function(a){if(!b&&a.type===E.CC_TYPE||
b&&E.isAnyCreditCardType(a)){var d=a.cardType+"-"+a.cardLast4;c[d]||(c[d]=a)}});return _.values(c)},relatedCardPayments:function(a,b){return _.union.apply(null,_.map(a.contact.relatedBookings,function(a){return E.cardPayments(a.payments,b)}))},isGratuityEnabled:function(a){return _.any(_.map(a.bookings?a.bookings:[a.booking],"item"),{isGratuityEnabled:!0})},receiptFooters:function(a){return _.filter(_.map(E.items(a),"receiptFooter"))},order:function(a){return a.bookings&&a.bookings.length?a.bookings[0].order:
null},hasMultipleVisibleContributingBookings:function(a){return!a.bookings?!1:1<a.bookings.length+ +!!a.invisibleBookingCount},items:function(a){return a.booking?[a.booking.item]:D.uniqueItems(a.bookings)},sortByCreatedAt:function(a){return _.sortByOrder(a,function(a){return moment.isMoment(a.createdAt)?a.createdAt.unix():0},!1)},printablePayments:function(a){a=_.map(a,function(a){return a.aggregatedPayment&&a.aggregatedPayment.isAggregated?a.aggregatedPayment:a});return _.filter(a,function(a){return!a.isDeferred&&
a.type!==E.AFFILIATE_TYPE})}};E.OPEN_DISPUTE_STATUES=[E.PENDING_DISPUTE_STATUS,E.DISPUTED_DISPUTE_STATUS];E.CLOSED_DISPUTE_STATUSES=[E.WON_DISPUTE_STATUS,E.LOST_DISPUTE_STATUS,E.REFUNDED_DISPUTE_STATUS];var S={NO_REPEAT:"none",WEEKLY_REPEAT:"weekly",MONTHLY_REPEAT:"monthly",ALL_DAY_PERIOD:"all-day",TIME_RANGE_PERIOD:"time-range",DAY_RANGE_PERIOD:"day-range",FAILED_STATUS:"failed",SUCCEEDED_STATUS:"succeeded",WEEK_DAYS:"sunday monday tuesday wednesday thursday friday saturday".split(" "),WEEK_DAYS_SHORT:{sunday:"Su",
monday:"M",tuesday:"T",wednesday:"W",thursday:"Th",friday:"F",saturday:"S"},weekDaysDefaultModel:function(){var a={};_.forEach(S.WEEK_DAYS,function(b){a[b]=!0});return a},defaultRule:function(){var a={period:S.TIME_RANGE_PERIOD,repeat:S.NO_REPEAT,hours:"",time:"",startOn:null,endOn:null};_.extend(a,S.weekDaysDefaultModel());return a}},K={ADJUSTMENT_TAG:"adjustment",FUND_BOOKING_FEE_PROCESSING_FEE_TAG:"fund-booking-fee",FUND_PROCESSING_FEE_TAG:"fund-processing-fee",OTHER_TAG:"other",PAYMENT_BOOKING_FEE_TAG:"payment-booking-fee",
PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG:"payment-booking-fee-processing-fee",PAYMENT_GROSS_TAG:"payment-gross",PAYMENT_PROCESSING_FEE_TAG:"payment-processing-fee",PAYOUT_TAG:"payout",REFUND_GROSS_TAG:"refund-gross",REFUND_BOOKING_FEE_TAG:"refund-booking-fee",REFUND_BOOKING_FEE_PROCESSING_FEE_TAG:"refund-booking-fee-processing-fee",REFUND_PROCESSING_FEE_TAG:"refund-processing-fee",TRANSFER_TAG:"transfer",UPLOAD_TAG:"upload",UNKNOWN_TAG:"",displayTag:function(a){return a===K.UNKNOWN_TAG?"Unknown":_.capitalize(a.split("-").join(" "))}};
K.TAGS=[K.ADJUSTMENT_TAG,K.FUND_BOOKING_FEE_PROCESSING_FEE_TAG,K.FUND_PROCESSING_FEE_TAG,K.OTHER_TAG,K.PAYMENT_BOOKING_FEE_TAG,K.PAYMENT_BOOKING_FEE_PROCESSING_FEE_TAG,K.PAYMENT_GROSS_TAG,K.PAYMENT_PROCESSING_FEE_TAG,K.PAYOUT_TAG,K.REFUND_GROSS_TAG,K.REFUND_BOOKING_FEE_TAG,K.REFUND_BOOKING_FEE_PROCESSING_FEE_TAG,K.REFUND_PROCESSING_FEE_TAG,K.TRANSFER_TAG,K.UPLOAD_TAG,K.UNKNOWN_TAG];var N={INDIVIDUAL_ACCOUNT_HOLDER_TYPE:"individual",COMPANY_ACCOUNT_HOLDER_TYPE:"company",ROUTING_NUMBER_REGEX_BY_COUNTRY:{AU:/^[\d]{6}$/,
CA:/^0?[\d]{5}-?[\d]{3}$/,GB:/^[\d]{2}-?[\d]{2}-?[\d]{2}$/,US:/^[\d]{9}$/},isIbanRequired:function(a){if(!a)return!1;var b=g.get("db").slipstream("ibanBankAccountCountries");return!_.isArray(b)?(console.warn("BankAccount.isIbanRequired: invalid value for ibanBankAccountCountries",b),!1):_.contains(b,a)},isRoutingNumberRequired:function(a){return!N.isIbanRequired(a)}},h={getCurrencyChoices:h},Z={VALID_VALIDITY:"valid",INVALID_VALIDITY:"invalid",DATE_RANGE_FOR_AVAILABILITY_TYPE:"range-for-booking",
DATE_RANGE_FOR_BOOKING_TYPE:"range-for-availability",displayDayPattern:function(a){if(!_.contains([Z.DATE_RANGE_FOR_AVAILABILITY_TYPE,Z.DATE_RANGE_FOR_BOOKING_TYPE],a.type))return"";a=a.dayPattern||[];return!a.length||a.length===S.WEEK_DAYS.length?"":_.map(a,function(a){return S.WEEK_DAYS_SHORT[a]}).join(", ")}},aa={FLAT_FEE_RULE_TYPE:"flat",MAXIMUM_FEE_RULE_TYPE:"maximum",calculateFeeableForFee:function(a,b){return _.roundHalfToEven(a/b)},calculateFeeableForRule:function(a,b,c){if(a.feeType!==f.PERCENTAGE_FEE_TYPE||
!a.percentageFeeRate)return 0;a=a.percentageFeeRate;if(c.type===aa.FLAT_FEE_RULE_TYPE)return aa.calculateFeeableForFee(c.amount,a);if(c.type===aa.MAXIMUM_FEE_RULE_TYPE){var d=_.roundHalfToEven(b*a);c=c.amount;return d>c?aa.calculateFeeableForFee(c,a):b}console.warn("StoredValueCard.calculateFeeableForRule: invalid rule type",c.type);return 0},calculateFeeable:function(a,b){if(!a.features.isStoredValueCardBookingFeesEnabled)return 0;var c=g.get("db").slipstream("storedValueCardFeeableRules");if(_.isUndefined(c))return console.warn("StoredValueCard.calculateFeeable: rules are not defined"),
0;c=c[a.country];if(!c)return 0;if(c.isUnrestricted)return b;var d=a.province;if(_.contains(c.unrestrictedProvinces,d))return b;c=c.provinceRules[d];return!c?0:aa.calculateFeeableForRule(a,b,c)},NUMBER_REGEX:/^[a-zA-Z0-9\-_\#\%$]+$/,isNumberValid:function(a){return aa.NUMBER_REGEX.test(a)}},ea={MIN_QR_CODE_SIZE:1,MAX_QR_CODE_SIZE:1.3,STANDARD:{name:"Standard",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,
hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,trailingStubMarginBottom:0.125}},BLANK:{name:"",settings:{isCompanyInformationIncluded:!0,isRotated:!1,len:5.5,height:2,marginTop:0.125,marginRight:0.125,marginBottom:0.125,marginLeft:0.125,hasLeadingStub:!0,leadingStubLength:1,leadingStubMarginTop:0.125,leadingStubMarginBottom:0.125,hasTrailingStub:!1,trailingStubLength:1,trailingStubMarginTop:0.125,
trailingStubMarginBottom:0.125}},mainLeft:function(a){var b=a.settings.marginLeft;a.settings.hasTrailingStub&&(b+=a.settings.trailingStubLength);return b},mainRight:function(a){var b=a.settings.marginRight;a.settings.hasLeadingStub&&(b+=a.settings.leadingStubLength);return b},qrCodeSize:function(a){a=a.settings.height-a.settings.marginTop-a.settings.marginBottom;a<ea.MIN_QR_CODE_SIZE&&(a=ea.MIN_QR_CODE_SIZE);a>ea.MAX_QR_CODE_SIZE&&(a=ea.MAX_QR_CODE_SIZE);return a},BOCA_PRINT_FORMAT:"boca",RECEIPT_PRINT_FORMAT:"receipt"},
fa={ADMIN_ONLY_TYPE:"admin",ADMIN_ONLY_TYPES:"admin admin-charge-disputed admin-dispute-closed duplicated-x-companies duplicated-x-companies-single generated-report ran-report rejected-sms updated-sms-notification-status card-error processor-webhook-error transferred-payment was-transferred-payment webhook-request-failed webhook-request-succeeded".split(" "),CHANGED_TYPES:["changed","changed-company-admin-notes","changed-booking-note","changed-customer-checkin-status"],isAdminOnly:function(a){return _.contains(fa.ADMIN_ONLY_TYPES,
a.type)},isChangedType:function(a){return _.contains(fa.CHANGED_TYPES,a)},objectUrl:function(a){var b;a.object&&(b=a.object.$url());b||(b=a.company.$url());return b},_changesByFieldName:{},changesByFieldName:function(a){var b=fa._changesByFieldName[a.uri];if(b)return b;b={};_.forEach(a.context.changes,function(a){b[k.camelKey(a.field)]=a});return fa._changesByFieldName[a.uri]=b}},I={NO_CUSTOM_TAX:"no",ONLY_TAXED_CUSTOM_TAX:"only-taxed",ALL_CUSTOM_TAX:"all",ALWAYS_CUSTOM_TAX:"always",displayCustomTax:function(a){var b=
{};b[I.NO_CUSTOM_TAX]="Not a custom tax";b[I.ONLY_TAXED_CUSTOM_TAX]="Custom tax";b[I.ALL_CUSTOM_TAX]="Custom tax (include untaxed)";b[I.ALWAYS_CUSTOM_TAX]="Custom tax (include untaxed, even on untaxed sheets)";return b[a]||b[I.NO_CUSTOM_TAX]},INHERIT_PRICE_TYPE:"inherit",CHANGE_PRICE_TYPE:"change",INHERIT_SHEET_RATE_TYPE:"inherit",CHANGE_SHEET_RATE_TYPE:"change",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",NONE_MODIFIER_TYPE:"none",
showOffset:function(a){return a.price.customTax!==I.NO_CUSTOM_TAX||a.price.modifierType===I.NONE_MODIFIER_TYPE?!1:a.price.modifierKind===I.OFFSET_MODIFIER_KIND&&(a.price.offset||a.price.modifierType===I.SET_MODIFIER_TYPE)},showRate:function(a){return a.price.customTax!==I.NO_CUSTOM_TAX||a.price.modifierType===I.NONE_MODIFIER_TYPE?!1:a.price.modifierKind===I.PERCENTAGE_MODIFIER_KIND&&(a.price.rate||a.price.modifierType===I.SET_MODIFIER_TYPE)},effectiveOffset:function(a,b){if(a.price.modifierType===
I.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return _.roundHalfToEven(a.price.offset*a.sheetRate.sheetRate*b)},effectiveRate:function(a,b){if(a.price.modifierType===I.NONE_MODIFIER_TYPE)return 0;b=_.isUndefined(b)?1:b;return a.price.rate*b},modifierKindChoices:function(a){var b,c=g.get("db").slipstream("currencies");if(c){var d=_.resolveCurrency(a);if(c=c[d])b=c.symbol}b||(console.warn("modifierKindChoices: unable to determine currency symbol",a),b="$");return[[I.PERCENTAGE_MODIFIER_KIND,
"%"],[I.OFFSET_MODIFIER_KIND,b]]}},wa=_.property("isOnline"),xa=_.property("isBase"),ia=_.property("isTotalBase"),W=_.property("isInvoiceBase"),V=function(a){return!a.isBase&&!a.isTotalBase&&!a.isInvoiceBase},R={NONE_TAXABILITY:"none",PRO_RATE_TAXABILITY:"pro-rate",FULL_TAXABILITY:"full",OFFSET_MODIFIER_KIND:"offset",PERCENTAGE_MODIFIER_KIND:"percentage",ADJUST_MODIFIER_TYPE:"adjust",SET_MODIFIER_TYPE:"set",baseSheet:function(a){return _.find(a,xa)},nonBaseSheets:function(a){return _.filter(a,V)},
sheetRateToModel:function(a){return _.roundHalfToEven(100*a,7)},sheetRateFromModel:function(a){return a/100},taxable:function(a){if(a.price.modifierType===I.NONE_MODIFIER_TYPE)return 0;var b=a.price.taxability;if(b===R.NONE_TAXABILITY)return 0;if(b===R.PRO_RATE_TAXABILITY)return I.effectiveOffset(a);if(b===R.FULL_TAXABILITY)return a.price.offset;console.warn("invalid taxability",b);return 0},isNonBase:V};I.NONE_PRICING={visibility:{isVisible:!0,isHiddenWhenBooking:!1,isHiddenOnReceipts:!1,isRequired:!1},
price:{modifierType:I.NONE_MODIFIER_TYPE,taxability:R.PRO_RATE_TAXABILITY},sheetRate:{sheetRate:1}};I.HIDDEN_PRICING={visibility:{isVisible:!1,isHiddenWhenBooking:!1,isHiddenOnReceipts:!1,isRequired:!1},price:{modifierType:I.NONE_MODIFIER_TYPE},sheetRate:{sheetRate:1}};var M=_.extend({baseSheet:R.baseSheet,totalBaseSheet:function(a){return _.find(a,ia)},nonBaseSheets:R.nonBaseSheets,onlineSheets:function(a){return _.filter(a,wa)},displaySheetRate:function(a){return a-1},fromDisplaySheetRate:function(a){return a+
1}},R),ma=_.extend({INHERIT_VISIBILITY:"inherit",VISIBLE_VISIBILITY:"visible",HIDDEN_VISIBILITY:"hidden"},I),U=_.extend({AFFILIATE_RELATIONSHIP:"affiliate",CHARTER_RELATIONSHIP:"charter",invoiceBaseSheet:function(a){return _.find(a,W)},nonBaseSheets:R.nonBaseSheets,displaySheetRate:function(a,b){if(b===U.CHARTER_RELATIONSHIP)return 1-a;if(b===U.AFFILIATE_RELATIONSHIP)return a},fromDisplaySheetRate:function(a,b){if(b===U.CHARTER_RELATIONSHIP)return 1-a;if(b===U.AFFILIATE_RELATIONSHIP)return a},displayRelationship:function(a){return a===
U.CHARTER_RELATIONSHIP?"reseller":a===U.AFFILIATE_RELATIONSHIP?"referral":"none"}},R),ya=_.extend({},I),X={},ga=function(){var a={GOOGLE_ANALYTICS_TYPE:"google-analytics",FACEBOOK_TYPE:"facebook",ADROLL_TYPE:"adroll",OPTIMIZELY_TYPE:"optimizely",CUSTOM_CODE_TYPE:"custom-code",IDENTIFIERS_BY_TYPE:{},IDENTIFIER_LABELS:{googleAnalyticsUa:"UA Code",facebookPixel:"Pixel ID",adrollAdvertiser:"Advertiser ID",adrollPixel:"Pixel ID",optimizelyAccount:"Account ID",optimizelyProject:"Project ID",optimizelyEventKey:"Goal Event",
optimizelyGoals:"Goal ID(s)",customCode:"Code",customIdentifiers:"Identifiers"},needsCrossDomainField:function(b){return _.includes([a.GOOGLE_ANALYTICS_TYPE,a.FACEBOOK_TYPE,a.ADROLL_TYPE,a.OPTIMIZELY_TYPE],b)},displayIdentifier:function(b){return a.IDENTIFIER_LABELS[b]}},b=a.IDENTIFIERS_BY_TYPE;b[a.GOOGLE_ANALYTICS_TYPE]=["googleAnalyticsUa"];b[a.FACEBOOK_TYPE]=["facebookPixel"];b[a.ADROLL_TYPE]=["adrollAdvertiser","adrollPixel"];b[a.OPTIMIZELY_TYPE]=["optimizelyAccount","optimizelyProject","optimizelyEventKey",
"optimizelyGoals"];b[a.CUSTOM_CODE_TYPE]=["customCode","customIdentifiers"];return a}(),ba={BEFORE_MIDNIGHT_CUTOFF_KIND:"before-midnight",BEFORE_START_CUTOFF_KIND:"before-start",RESTRICTION_FIELDS:"minimumInitialPartySize minimumSubsequentPartySize maximumInitialPartySize maximumSubsequentPartySize isBookableEverByPhone soldOutText cutoffUnreachedKind cutoffUnreachedHours isCutoffUnreachedCallToBook cutoffReachedKind cutoffReachedHours isCutoffReachedCallToBook autoOpenHours autoOpenKind".split(" "),
DEFAULT_AUTO_OPEN_HOURS:720,cutoffStart:function(a,b,c){if(a===ba.BEFORE_START_CUTOFF_KIND)return c.clone().subtract(b,"hours");if(a===ba.BEFORE_MIDNIGHT_CUTOFF_KIND)return c.clone().startOf("day").subtract(b,"hours");console.error("BookingRestriction.cutoffStart: invalid kind "+a)}},Q={Order:r,Contact:c,Booking:D,Customer:{},LineItem:{},ItemGroup:{},Availability:x,Company:f,User:{OWNER_TYPE:"owner",ADMIN_TYPE:"admin",EMPLOYEE_TYPE:"employee",ICS_RESELLER_KEY_NAME:"ICS Calendar"},TagGroup:{},Tag:{},
TagInstance:{},Item:C,FlowNode:z,CustomFieldInstanceGroup:{},CustomFieldInstanceCondition:F,CustomFieldInstance:p,CustomerType:{},CustomerPrototype:{name:function(a){return a.displayName},customerTypeSuffix:function(a){(a=_.compact([a.name?a.customerType.shortName||a.customerType.plural:"",a.isExclusive?"exclusive":""]).join(", "))&&(a="("+a+")");return a}},CustomerTypeRate:l,CheckinStatus:G,Image:{CAROUSEL_GALLERY:"carousel"},CustomField:y,ExtendedOption:{},TransportationOption:{},ConnectedCampaign:{},
GeneratingCampaign:{},CannedMessage:q,Notification:s,SmsNotification:H,ReviewExpressNotification:{},Subscription:v,Payment:E,Dispute:O,InStorePaymentType:{isUsable:function(a,b){var c=b.isCharter&&a.isVisibleWhenCollectedByCharter;return b.isAffiliate&&a.isVisibleWhenCollectedByAffiliate||c},isVisibleWhenCollectedByCharter:function(a){return _.filter(a,"isVisibleWhenCollectedByCharter")},isVisibleWhenCollectedByAffiliate:function(a){return _.filter(a,"isVisibleWhenCollectedByAffiliate")}},Refund:{FAILED_TRANSFER_STATUS:"failed",
SUCCEEDED_TRANSFER_STATUS:"succeeded"},Receipt:{ALL_PAYMENT_RECEIPTS:"all",printedAt:function(){return moment()}},Rule:S,Payout:{SUCCEEDED_STATUS:"succeeded",PAID_STATUS:"paid",PENDING_STATUS:"pending",FAILED_STATUS:"failed",PROCESSED_STATUS:"processed"},Fund:{},Transfer:{},Upload:{SUCCEEDED_STATUS:"succeeded",PENDING_STATUS:"pending",FAILED_STATUS:"failed"},Transaction:K,Account:{BANK_TYPE:"bank",DEPOSIT_TYPE:"deposit",ESCROW_TYPE:"escrow"},Adjustment:h,Campaign:{},CampaignValidityRule:Z,Code:{},
StoredValueType:{},StoredValueCard:aa,StoredValueAdjustment:{},TicketLayout:ea,CustomCalendar:{},CustomManifest:{},CustomReport:{QUERY_PARAM:"saved",QUERY_PARAM_KEY:"pk"},SuggestedReport:{QUERY_PARAM:"suggested",QUERY_PARAM_KEY:"slug",DEFAULT_SLUG:"default"},Activity:fa,Block:{},Agent:{OTHER_AGENT:{name:"Add new agent",pk:-1}},Desk:{OTHER_DESK:{name:"Add new desk",pk:-1}},Affiliation:B,CrewMember:{},Role:{},Hotel:{},Lodging:{},PreferredPickup:{},Pickup:{},Route:{},Stop:{},Run:{},Report:t,Invoice:{PAID_STATUS:"paid",
PENDING_STATUS:"pending",UNPAID_STATUS:"unpaid",OVERDUE_STATUS:"overdue",isInvoicedToCharter:function(a){return 0<a}},InvoiceEntry:{},Location:{},ViatorMapping:{},Waiver:{},ConnectedWaiver:{},WaiverInstance:{},Group:{AFFILIATE_TYPE:"affiliate",COMPANY_TYPE:"company",PARTNER_TYPE:"partner"},GroupOverride:{companyLevelOverrides:function(a){return _.filter(a,function(a){return null===a.relatedUser})}},PriceSheet:R,PriceLine:I,TotalSheet:M,TotalLine:ma,InvoiceSheet:U,InvoiceLine:ya,BankAccount:N,Card:{},
CardAffiliation:{},CustomFieldValue:{},BookingCustomFieldValue:X,CustomerCustomFieldValue:{},Resource:{NONE_GRANULARITY:"none"},RequirementGroup:{},Requirement:u,CustomerPrototypeRequirement:{},ResourceRequirement:{START_TIMING:"start-timing",END_TIMING:"end-timing",DATE_TIMING:"date-timing",PADDING_END_AT_KIND:"padding-kind",LENGTH_END_AT_KIND:"length-kind"},ResourceUse:{displayOption:function(a){return a?a.isIgnoreOveruse?"Create uses, don't check overuse":a.isSkipResourceUseCreation?"Don't create uses, check overuse":
"Create uses, check overuse":""},equals:function(a,b){return _.isUndefined(a.customerTypeRate)||_.isUndefined(b.customerTypeRate)?a.booking.pk===b.booking.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount:a.customerTypeRate.pk===b.customerTypeRate.pk&&a.resourceRequirement.pk===b.resourceRequirement.pk&&a.useCount===b.useCount},resourceUseSummaries:function(a,b){b=b||[];return _.reduce(function(a){return _.reduce(a,function(a,b){var c=b.resourceRequirement.resource;
a[c.pk]=a[c.pk]||[];a[c.pk].push(b);return a},{})}(a),function(a,c,d){a[d]=a[d]||{};a[d].totalUseCount=parseFloat(_.sum(c,"useCount").toFixed(2));a[d].resourcePk=d;a[d].resourceName=c[0].resourceRequirement.resource.name;a[d].isOverused=-1<_.map(b,"pk").indexOf(parseInt(d));return a},{})},resourceUseSummaryKey:function(a,b){return a+"-"+b}},ResourceOverride:{},Calendar:b,Day:{},ResellerCompany:{},ResellerCompanyMapping:{},ResellerItem:{},ResellerItemMapping:{},ResellerCustomerType:{},ResellerCustomerTypeMapping:{},
ResellerOption:{},ResellerOptionMapping:{},ResellerKey:{},ResellerApp:{},ResellerAppCompany:{},AnalyticsService:ga,CancellationPolicy:{},CancellationRule:{ALWAYS_TYPE:"always",HOURS_BEFORE_AVAILABILITY_START_TYPE:"hours-before-start",HOURS_BEFORE_AVAILABILITY_MIDNIGHT_TYPE:"hours-before-midnight",HOURS_BEFORE_PSEUDO_TYPE:"hours-before"},BookingRestriction:ba},qa=_.keys(Q);_.forEach(qa,function(a){Q[a].cls=a});Q.inject=function(a){_.forEach(qa,function(b){a[b]=Q[b]})};return Q}]);n.run(["$filter",
"$rootScope","db","emv","models","navigation","processors","urls",function(c,g,k,e,d,m,a,q){d.inject(g);g.nullModel={};d.Availability.manifestUrl=function(a){return m.compose(q.populate(q.dashboard.manifest.availabilities,{shortname:a.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0}),{items:a.item.pk,availabilities:a.pk})};d.Run.manifestUrl=function(a){return m.compose(q.populate(q.dashboard.manifest.runs,{shortname:a.route.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):
void 0}),{routes:a.route.pk})};d.Item.manifestUrl=function(a,b){return m.compose(q.populate(q.dashboard.manifest.availabilities,{shortname:a.company.shortname,date:b}),{items:a.pk})};d.Resource.manifestUrl=function(a,b){return m.compose(q.populate(q.dashboard.manifest.resources,{shortname:a.company.shortname,date:b}),{resources:a.pk})};d.Booking.processorTypes=function(a){a=a||[];return _.filter(_.sortBy(_.uniq(_.pluck(a,"processorType"))))};d.Booking.statementText=function(b,c){var e=b.statementText,
h=d.Booking.processorTypes(c);return _.map(h,function(b){return'"'+a.get(b).STATEMENT_TEXT_PREFIX+e+'"'}).join(" or ")};d.Booking.pendingStatementText=function(b){b=d.Booking.processorTypes([b]);return _.map(b,function(b){return'"'+a.get(b).PENDING_STATEMENT_TEXT+'"'}).join(" or ")};d.Payment.isDefaultCreditCardType=function(b){return b.type===d.Payment.CC_TYPE&&b.processorType===a.DEFAULT_PROCESSOR_TYPE};d.Payment.isLegacyCreditCardType=function(a){return d.Payment.isAnyCreditCardType(a)&&!d.Payment.isDefaultCreditCardType(a)};
var h=d.Report;h.MODELS={};h.MODELS[d.Booking.cls]={name:"Bookings",singular:"Booking",slug:"bookings",model:d.Booking,submodels:[]};h.MODELS[d.Customer.cls]={name:"Customers",singular:"Customer",slug:"customers",model:d.Customer,submodels:[d.Booking]};h.MODELS[d.LineItem.cls]={name:"Expenses and Discounts",singular:"Expense and discount",slug:"expenses-and-discounts",model:d.LineItem,submodels:[d.Booking]};h.MODELS[d.CustomFieldValue.cls]={name:"Custom Field Answers",singular:"Custom field answer",
slug:"custom-field-answers",model:d.CustomFieldValue,submodels:[d.Customer,d.Booking]};h.MODELS[d.Payment.cls]={name:"Sales",singular:"Sales",slug:"payments-and-refunds",model:d.Payment,submodels:[d.Booking]};h.ORDERED_MODELS=[d.Payment,d.Booking,d.Customer,d.CustomFieldValue,d.LineItem];h.UNSOUND_AGGREGATES={Payment:[d.Booking],Booking:[],Customer:[d.Booking],CustomFieldValue:[d.Booking,d.Customer],LineItem:[d.Booking]};h.advancedUrl=function(a,b){return q.populate(q.dashboard.reports.advanced.index,
{shortname:a.shortname,modelSlug:h.MODELS[b].slug})};h.SWITCH_QUERY_PARAM_KEY="switch";h.advancedSwitchUrl=function(a,b){var c={};c[h.SWITCH_QUERY_PARAM_KEY]=!0;return m.compose(h.advancedUrl(a,b),c)};h.VALID_COLUMNS=k.slipstream("reports.validColumns");h.VALID_GROUPS=k.slipstream("reports.validGroups");h.VALID_FILTERS=k.slipstream("reports.validFilters");h.PROHIBITED_GROUPS=k.slipstream("reports.prohibitedGroups");h.PROHIBITED_HIGHER_GROUPS=k.slipstream("reports.prohibitedHigherGroups");h.ALWAYS_UNSOUND_GROUPINGS=
k.slipstream("reports.alwaysUnsoundGroupings");_.extend(h,k.slipstream("reports.allColumns"));_.extend(h,k.slipstream("reports.allGroups"));_.extend(h,k.slipstream("reports.allFilters"));_.extend(h,k.slipstream("reports.allDateRanges"));h.MODELS_BY_GROUP={};_.forEach(h.VALID_GROUPS,function(a,b){_.forEach(a,function(a){h.MODELS_BY_GROUP[a]=h.MODELS_BY_GROUP[a]||[];h.MODELS_BY_GROUP[a].push(d[b])})});d.ResourceUse.OPTIONS=k.slipstream("resourceUse.options");d.ResourceUse.OPTIONS_VALUES_KEYS_MAP=_.reduce(d.ResourceUse.OPTIONS,
function(a,b){a[b.value]=b.key;return a},{});d.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP=_.reduce(d.ResourceUse.OPTIONS,function(a,b){a[b.key]=b.displayText;return a},{});d.ResourceUse.getUseSettings=function(a){var b;a.cls===d.ResourceRequirement.cls?b=[String(a.isSkipCreation),String(a.isIgnoreResourceOveruse)].join("-"):a.cls===d.Resource.cls?b=[String(a.isSkipResourceUseCreation),String(a.isIgnoreOveruse)].join("-"):console.error("invalid object passed to ResourceUse.getUseSettings");return d.ResourceUse.OPTIONS_VALUES_KEYS_MAP[b]};
d.ResourceUse.getDisplayText=function(a){a=d.ResourceUse.getUseSettings(a);return d.ResourceUse.OPTIONS_KEYS_DISPLAY_TEXT_MAP[a]};d.CustomReport.url=function(a){var b=h.advancedUrl(a.company,a.options.modelName),c={};c[d.CustomReport.QUERY_PARAM]=a[d.CustomReport.QUERY_PARAM_KEY];return m.compose(b,c)};d.SuggestedReport.url=function(a,b){var c=h.advancedUrl(b,a.options.modelName),e={};e[d.SuggestedReport.QUERY_PARAM]=a.slug;return m.compose(c,e)};d.Item.frontendUrl=function(a,b){return b?q.populate(q.company.item.month,
{shortname:a.company.shortname,itemPk:a.pk,year:b.format("YYYY"),month:b.format("MM")}):a.$url(q.company.item.index)};d.FlowNode.frontendUrl=function(a,b){var c="";return c=a.externalUrl?a.externalUrl:a.item?d.Item.frontendUrl(a.item,b):a.$url(q.company.flowNode.index)};d.FlowNode.suggestedItemUrl=function(a,b){var c;c=a.item&&a.item.externalUrl&&!a.externalUrl?a.item.externalUrl:d.FlowNode.frontendUrl(a,b);var e={};a.type!==d.FlowNode.PAGE_TYPE&&(e[d.FlowNode.FLOW_QUERY]=a.parent.pk);e[d.FlowNode.IS_SUGGESTED_QUERY]=
!0;return m.compose(c,e,!0)};_.extend(d.CampaignValidityRule,k.slipstream("campaignValidityRules.allTypes"));if(e.isDebugging){d.Payment.isEmv=function(a){return a.type===d.Payment.CC_TYPE};d.Payment.isEmvSignatureRequired=function(a){return 0===a.pk%2};var b=d.Payment.emvDetails;d.Payment.emvDetails=function(a){a.metadata||(a.metadata={});a.metadata.emvDetails=e.debugDetails;return b(a)}}}])})();
(function(){var n=angular.module("lib.processors",["auth.services","db.services","lib.services","navigation.services"]),c={UNSUPPORTED:"Unsupported processor. Please refresh the page and try again. If you continue to have trouble please contact support@fareharbor.com.",SCRIPT:"Could not contact processor. Please refresh the page and try again.",TIMEOUT:"Connection error. Please check your internet connection and try again.",WAIT:"Please wait a few moments and try again.",TRY_AGAIN:"Please try again.",
REFRESH:"Please refresh the page and try again.",GENERIC_BANK_ACCOUNT:"Could not update bank account. Please make sure all details have been entered correctly and try again.",REFRESH_BANK_ACCOUNT:"Could not update bank account. Please refresh the page and try again.",TRY_AGAIN_BANK_ACCOUNT:"Could not update bank account. Please try again.",GENERIC_CARD:"Could not process payment. Please refresh the page and try again ensuring all card details have been entered correctly. If you continue to have trouble please contact support@fareharbor.com.",
REFRESH_CARD:"Could not process payment. Please refresh the page and try again.",TRY_AGAIN_CARD:"Could not process payment. Please try again.",BAD_CARD:"Could not process payment. Please make sure all card details have been entered correctly. If you are still unsuccessful you may need to call the card issuer or try a different card.",INVALID_ROUTING_NUMBER:"Invalid routing number.",INVALID_CARD_NUMBER:"Invalid card number. Please check that you have entered your card number correctly and try again.",
BAD_CARD_NUMBER:"Incorrect card number. Please check that you have entered your card number correctly and try again.",INVALID_DEMO_CARD_NUMBER:"Only demo card numbers can be used while demo mode is enabled.",INVALID_EXPIRATION:"Invalid card expiration date. Please check that you've selected the correct expiration date for your card and try again.",BAD_EXPIRATION:"Expired card. Please enter a valid card.",INVALID_SECURITY_CODE:"Invalid CVC (card security code). Please check that you've entered your card's security code correctly and try again.",
BAD_SECURITY_CODE:"Incorrect CVC (card security code). Please check that you've entered your card's security code correctly and try again.",INVALID_COUNTRY_CODE:"Invalid country. Plesae check that your billing country is correct and try again.",INVALID_POSTAL_CODE:"Invalid postal (zip) code. Please check that your billing postal code is correct and try again.",BAD_POSTAL_CODE:"Incorrect postal (zip) code. Please check that your billing postal code is correct and try again."};n.factory("processors",
["$injector","auth","convert","db","Raven",function(g,k,e,d,m){var a={INDIVIDUAL_ENTITY_TYPE:"individual",COMPANY_ENTITY_TYPE:"company",DEFAULT_PROCESSOR_TYPE:"stripe",STRIPE_PROCESSOR_TYPE:"stripe",BALANCED_PROCESSOR_TYPE:"balanced",PROCESSOR_TYPES:["stripe","balanced"],VERIFICATION_REQUIREMENTS:d.slipstream("processorVerificationRequirements"),VERIFICATION_REQUIREMENT_TO_FORM_FIELD:d.slipstream("processorVerificationRequirementToCompanyTaxInformationFormField",{doNotConvert:!0}),SUPPORTED_BANK_ACCOUNT_COUNTRIES:d.slipstream("processorSupportedBankAccountCountries"),
BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES:d.slipstream("processorBankAccountVerificationEnabledCountries"),SUPPORTED_CURRENCIES:d.slipstream("processorSupportedCurrencies"),UNVERIFIED_VERIFICATION_STATUS:"unverified",SUBMITTED_VERIFICATION_STATUS:"submitted",PENDING_VERIFICATION_STATUS:"pending",VERIFIED_VERIFICATION_STATUS:"verified",ERRORS:c,SECRET_FIELD:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",secretField:function(c){return Array(Math.max((c||"").length,a.SECRET_FIELD.length)+1).join(a.SECRET_FIELD[0])},
cardType:function(a){if(!a)return"";a=a.toString().trim();var c={};c["51"]=c["52"]=c["53"]=c["54"]=c["55"]="mastercard";c["34"]=c["37"]="american express";c["4"]="visa";c["6"]="discover";c["35"]="jcb";c["30"]=c["36"]=c["38"]="diners club";var b=_.find(_.keys(c),function(b){return 0===a.indexOf(b)});return b?c[b]:"unknown"},cardTypeAbbreviation:function(a){return{visa:"visa",mastercard:"mc","american express":"amex",discover:"discover","diners club":"diners",jcb:"jcb",unknown:"unknown"}[a]||""},cardLast4:function(a){return a.substr(a.length-
4)},verificationRequirements:function(c,d,b){if(a.VERIFICATION_REQUIREMENTS){var e=[c,d,b,"minimum"].join(".");if(e=_.get(a.VERIFICATION_REQUIREMENTS,e))return e}c="processors: verification requirements not identified for "+c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},requiredVerificationFields:function(c,d){try{if(!d)throw Error("missing verification requirements");if(!a.VERIFICATION_REQUIREMENT_TO_FORM_FIELD)throw Error("missing verification mapping");var b=a.VERIFICATION_REQUIREMENT_TO_FORM_FIELD[c];
if(!b)throw Error("missing verification mapping for processor type");var f={};_.each(d,function(a){(a=b[a])&&(f[e.camelKey(a)]=!0)});if(_.isEmpty(f))throw Error("no required fields");return f}catch(g){var k="processors: verification fields not identified for "+c+": "+g.message;console.warn(k);m.captureMessage(k,{extra:{verificationRequirements:d},level:a.ERROR})}},supportedBankAccountCountries:function(c,d,b){if(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES){var e=[c,d,b].join(".");if(e=_.get(a.SUPPORTED_BANK_ACCOUNT_COUNTRIES,
e))return e}c="processors: supported bank account countries not identified for "+c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},verificationEnabledBankAccountCountries:function(c,d){if(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES){var b=[c,d].join(".");if(b=_.get(a.BANK_ACCOUNT_VERIFICATION_ENABLED_COUNTRIES,b))return b}b="processors: unable to identify verification enabled bank account countries for "+c+" "+d;console.error(b);m.captureMessage(b,{level:a.ERROR})},isVerificationEnabledForBankAccountCountry:function(c,
d,b){var e=a.verificationEnabledBankAccountCountries(c,d);if(e)return _.contains(e,b);c="processors: unable to identify whether bank account verification is enabled for "+c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},isBankAccountVerificationEnabled:function(c,d,b){var e=a.verificationEnabledBankAccountCountries(c,d);if(e){if(!e.length)return!1;var g=a.supportedBankAccountCountries(c,d,b);if(g)return!!_.intersection(g,e).length}c="processors: unable to identify whether bank account verification is enabled for "+
c+" "+d+" "+b;console.error(c);m.captureMessage(c,{level:a.ERROR})},supportedCurrencies:function(c,d){if(a.SUPPORTED_CURRENCIES){var b=[c,d].join(".");if(b=_.get(a.SUPPORTED_CURRENCIES,b))return b}b="processors: unable to determine supported currencies for "+c+" "+d;console.error(b);m.captureMessage(b,{level:a.ERROR})},INFO:"info",ERROR:"error",log:function(c,d,b,f){d=d||{};b=b||{};f=f||a.INFO;var g={userIdentifier:k.currentUser.isAuthenticated?k.currentUser.identifier:"anonymous"},g=_.extend(g,b);
try{d=e.clientRequest(d),m.captureMessage(c,{extra:d,tags:g,level:f})}catch(n){console.error("processors: invalid log data",d),m.captureMessage(c,{extra:{message:"invalid log data: "+n.toString()},tags:g,level:f})}console.info("processors: "+c)},get:function(a){return g.get(a||"stripe")}};return a}]);n.factory("stripe",["$q","$rootScope","db","processors","Stripe",function(c,k,e,d,m){var a={invalid_number:d.ERRORS.INVALID_CARD_NUMBER,incorrect_number:d.ERRORS.BAD_CARD_NUMBER,invalid_expiry_month:d.ERRORS.INVALID_EXPIRATION,
invalid_expiry_year:d.ERRORS.INVALID_EXPIRATION,expired_card:d.ERRORS.BAD_EXPIRATION,invalid_cvc:d.ERRORS.INVALID_SECURITY_CODE,incorrect_cvc:d.ERRORS.BAD_SECURITY_CODE,incorrect_zip:d.ERRORS.BAD_POSTAL_CODE,card_declined:d.ERRORS.BAD_CARD,processing_error:d.ERRORS.TRY_AGAIN,rate_limit:d.ERRORS.WAIT},n=[{regex:/^Expired API Key provided/i,message:d.ERRORS.REFRESH}],h=e.slipstream("stripeLivePublishableKey"),b=e.slipstream("stripeTestPublishableKey"),f=function(b,e,f){var n=c.defer();m.setPublishableKey(h);
b={currency:b.processorCurrency,country:e.processorCountry,account_number:e.accountNumber,account_holder_name:e.accountHolderName,account_holder_type:e.accountHolderType};e.routingNumber&&(b.routing_number=e.routingNumber);m.bankAccount.createToken(b,function(b,c){k.$safeApply(function(){if(c.error){d.log("Stripe client-side error ("+(c.status||"unknown error")+")",_.extend({stripeResponse:c},f));var b=c.error.message+".";c.error.code&&(b=a[c.error.code]||b);return n.reject([b])}return n.resolve({processorType:"stripe",
stripeBankAccountToken:c.id})})});return n.promise},A=function(e,f,A,z){var l=c.defer();if(!m)return d.log("Stripe: unable to load stripe.js"),l.reject([d.ERRORS.SCRIPT]),l.promise;m.setPublishableKey(A?b:h);e={number:f.number,exp_month:f.expirationMonth,exp_year:f.expirationYear};f.cvc&&(e.cvc=f.cvc);e.name=f.name||"";e.address_zip=f.postalCode||"";e.address_country=f.countryCode||"";m.card.createToken(e,function(b,c){k.$safeApply(function(){if(!c)return l.reject([d.ERRORS.TIMEOUT]);if(c.error){var b;
c.error.code?b=a[c.error.code]:c.error.message&&_.forEach(n,function(a){if(c.error.message.match(a.regex))return b=a.message,!1});b||(b=d.ERRORS.GENERIC_CARD);var e="card_error"===c.error.type?d.INFO:d.ERROR,f="Stripe client-side "+(c.status||"")+" error",f=f+(" ("+(c.error.type||"unknown error")+")");c.error.message&&(f+=" - "+c.error.message);d.log(f,_.extend({stripeResponse:c,error:b},z),{type:c.error.type},e);return l.reject([b])}return l.resolve({processorType:"stripe",stripeToken:c.id})})});
return l.promise};return{PROCESSOR_TYPE:"stripe",PENDING_STATEMENT_TEXT:"STRIPE",STATEMENT_TEXT_PREFIX:"",tokenizeBankAccount:function(a,b,e){if(!m){var h=c.defer();d.log("Stripe: unable to load stripe.js");h.reject([d.ERRORS.SCRIPT]);return h.promise}h=f(a,b,e);a=f(a,b,e);return c.all([h,a]).then(function(a){return{processorType:"stripe",stripeAccountBankAccountToken:a[0].stripeBankAccountToken,stripeCustomerBankAccountToken:a[1].stripeBankAccountToken}},function(a){return c.reject(_.unique(_.append(a)))})},
tokenizeCard:A,tokenizedCard:function(a){return{processorType:"stripe",stripeToken:a}},testToken:function(a,b){var c={number:"4242424242424242",expirationMonth:1,expirationYear:moment().year()+1,cvc:"123"};b=_.extend(b,{testing:!0});return A(a,c,a.isDemoModeEnabled,b).then(function(a){a=a.stripeToken;console.info("stripe: test token",a);return a})},chargedCard:function(a){var b={processorType:"stripe",stripeChargeId:a.processorId};_.extend(b,a);return b}}}]);n.factory("balanced",["$rootScope","$timeout",
"$q","processors",function(c,k,e,d){c=function(){var c=e.defer();c.reject([d.ERRORS.UNSUPPORTED]);return c.promise};return{PROCESSOR_TYPE:"balanced",PENDING_STATEMENT_TEXT:"BALANCED",STATEMENT_TEXT_PREFIX:"BAL*",tokenizeBankAccount:c,tokenizeCard:c}}]);n.factory("cardflight",function(){return{isTestToken:function(c){return/^test_/.test(c)}}});n.factory("Stripe",function(){return window.Stripe||null});n.factory("payworks",["$rootScope","$q","$timeout","db","events","models","require",function(c,k,
e,d,m,a,n){var h={CONNECTING_TO_ACCESSORY:"Connecting...",INITIALIZING_TRANSACTION:"Initializing...",PROCESSING:"Processing...",WAITING_FOR_CARD_PRESENTATION:"Waiting for card...",WAITING_FOR_CARD_REMOVAL:"Remove card..."},b=function(a,b){return _.extend({tag:a},b)},f=function(a,c){var e="production"===d.slipstream("configuration")&&!c.isDemoModeEnabled?"LIVE":"TEST";return b(a,{type:"LOGIN_MERCHANT_REQUEST",loginMerchantRequest:{providerMode:e,merchantIdentifier:c.payworksMerchantId,merchantSecret:c.payworksMerchantSecretKey}})},
A=function(a,c){return b(a,{type:"ABORT_OPERATION_REQUEST",referenceTag:c,abortOperationRequest:{}})},w=function(a){if(a){var b=a.label;a=a.value;if(b&&a)return{key:b,value:a}}},u=function(a){var b=[],c=a.data||{};_.forEach(["DATE","TIME","AMOUNT_AND_CURRENCY","STATUS_TEXT","SUBJECT"],function(a){(a=w(c[a]))&&b.push(a)});_.forEach(["merchantDetails","clearingDetails","paymentDetails"],function(c){_.forEach(a[c]||[],function(a){(a=w(a))&&b.push(a)})});return b},C=function(c,e,f,g){var l=k.defer(),
m=function(a){a=(n.lastInformation=a)||"Unknown error";c.lastDecline&&(a="");l.reject(a)},n={identifier:_.uuid(),connection:c,amount:f,isAbortable:!1,$promise:l.promise,cancel:function(){n.isAbortable&&c.send(A(_.uuid(),n.identifier));m("Cancelled")},lastInformation:"Waiting...",information:function(){return n.lastInformation},message:function(a){switch(a.type){case "EXECUTE_TRANSACTION_UPDATE":console.info("payworks: transaction update",a);var b=_.get(a,"executeTransactionUpdate.state")||"Processing...";
n.lastInformation=h[b]||b;n.isAbortable=!1!==_.get(a,"executeTransactionUpdate.abortable");break;case "EXECUTE_TRANSACTION_RESPONSE":console.info("payworks: transaction response",a);b=_.get(a,"executeTransactionResponse.state");if(!b){m("Invalid transaction state");break}if("ABORTED"===b){m("Cancelled");break}if("DECLINED"===b){c.lastDecline={customerReceipt:u(a.executeTransactionResponse.transaction.customerReceipt),merchantReceipt:u(a.executeTransactionResponse.transaction.merchantReceipt)};m();
break}b=_.get(a,"executeTransactionResponse.transaction.identifier");if(!b){m("Invalid transaction identifier");break}a=_.get(a,"executeTransactionResponse.transaction.merchantReceipt.data.CLEARING_DETAILS_TRANSACTION_IDENTIFIER.value");if(!a){m("Invalid transaction identifier");break}l.resolve({processorId:a,payworksTransactionId:b});break;case "ABORT_OPERATION_RESPONSE":console.info("payworks: abort response",a);break;default:console.warn("payworks: invalid transaction message",a)}},error:function(a){console.warn("payworks: transaction error",
a);m(a.error.message)}};c.send(b(n.identifier,{type:"EXECUTE_TRANSACTION_REQUEST",resource:"devices/usbMiura",executeTransactionRequest:{mode:"ONLINE",transactionParameters:{amount:_.roundHalfToEven(f/100,2).toFixed(2),currency:c.company.processorCurrency.toUpperCase(),autoCapture:!0,type:"CHARGE",subject:e.cls===a.Booking.cls?"Booking #"+e.pk.toString():"Order #"+e.identifier,customIdentifier:e.cls===a.Booking.cls?e.pk.toString():e.identifier,statementDescriptor:c.company.statementText,applicationFee:_.roundHalfToEven(g/
100,2).toFixed(2),metadata:{configuration:d.slipstream("configuration")}}}}));return n},z=function(a){var b=[],d=function(a){c.$apply(function(){var b=JSON.parse(a.data);if("OK"===b.status)if(m.transaction)console.info("payworks: received transaction message",b),m.transaction.message(b);else switch(b.type){case "LOGIN_MERCHANT_RESPONSE":console.info("payworks: logged in",b);break;default:console.warn("payworks: received unexpected message",b)}else console.error("payworks: error",b),m.transaction&&
m.transaction.error(b)})},e=function(a){console.warn("payworks: unable to connect to pay server",a);m.socket=null},h=function(){console.info("payworks: connection closed");m.transaction&&(m.transaction.cancel(),m.transaction=null)},k=function(){console.info("payworks: connection opened");m.send(f(_.uuid(),m.company))},l=function(){var a=new WebSocket("ws://localhost:8080");a.onmessage=d;a.onerror=e;a.onopen=k;a.onclose=h;return a},m={company:a,socket:l(),send:function(a){b.push(a);m.socket&&m.socket.readyState===
WebSocket.OPEN&&(_.forEach(b,function(a){console.info("payworks: sending",a);m.socket.send(JSON.stringify(a))}),_.clear(b))},destroy:function(){console.info("payworks: destroying connection...");m.transaction&&(m.transaction.cancel(),m.transaction=null);m.socket&&(m.socket.close(),m.socket=null)},createTransaction:function(a,b,c){console.info("payworks: creating transaction",a,b,c);m.lastDecline=null;m.socket||(m.socket=l());m.transaction&&(m.transaction.cancel(),m.transaction=null);m.transaction=
C(m,a,b,c);return m.transaction}};return m},l={CANCELLED:{},connection:null,connect:function(a){n.assert(!l.connection,"payworks: expected no connection");l.connection=z(a)},disconnect:function(){l.connection&&(l.connection.destroy(),l.connection=null)},isConnected:function(){return!!l.connection&&!!l.connection.socket&&l.connection.socket.readyState===WebSocket.OPEN},charge:function(a,b,c,d){l.connection?l.connection.company!==a&&(l.disconnect(),l.connect(a)):(l.connect(a),l.connection=z(a));return l.connection.createTransaction(b,
c,d).$promise},cancel:function(){l.connection&&(l.connection.lastDecline=null,l.connection.transaction&&l.connection.transaction.cancel())},information:function(){return!l.connection?"Not connected":!l.connection.transaction?"Ready...":l.connection.transaction.information()},lastDecline:function(){return l.connection?l.connection.lastDecline:null}};m.on(c,"auth.logout",function(){l.disconnect()});return l}]);n.factory("emv",["$rootScope","events","payworks",function(c,k,e){var d={isConnected:function(){return e.isConnected()},
charge:function(c,a,d,g){return e.charge(c,a,d,g)},information:function(){return e.information()},lastDecline:function(){return d.isDebugging?d.debugDecline:e.isConnected()?e.lastDecline():null},cancel:function(){return e.cancel()}};k.on(c,"navigation.company.updated",function(c,a){var d=a.company;d?d.features.isEmvEnabled&&e.connect(d):e.disconnect()});d.isDebugging=!1;d.debugDecline={customerReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",
value:"Authorization declined."},{key:"Description",value:"Booking #1234"}],merchantReceipt:[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"}]};d.debugDetails=[{key:"Date",value:"12/32/17"},{key:"Time",value:"12:32pm"},{key:"Amount",value:"USD$12.32"},{key:"Information",value:"Authorization declined."},{key:"Description",value:"Booking #1234"},{key:"Name",value:"Adeventure Extremer"},
{key:"Address",value:"12:32pm"},{key:"Zip",value:"12321"},{key:"City",value:"Aina Haina"},{key:"Country",value:"USA"},{key:"Contact",value:"4155551212"},{key:"Transaction",value:"ch_1BLzcrL4FOCDmmKvrGbjEG2t"},{key:"Authorization",value:"123212321"},{key:"Scheme",value:"payworks VISA"},{key:"Account",value:"**** **** **** 4242"},{key:"AID",value:"A0000000031010"},{key:"Entry Mode",value:"Chip"},{key:"Verification",value:"Signature"}];return d}]);n.run(["$rootScope","emv","processors",function(c,k,
e){c.emv=k;c.processors=e}])})();angular.module("auth",["auth.controllers","auth.directives","auth.services"]);
(function(){var n=angular.module("auth.controllers",["lib","navigation"]);n.controller("auth.LoginCtrl",["$scope","auth","flash","navigation","urls",function(c,g,k,e,d){g=e.get("shortname")||"";c.credentials={shortname:g};var m=e.get("next");c.submit=function(a){c.credentials.shortname&&(a=d.populate(d.company.login,{shortname:c.credentials.shortname.replace(/\s+/g,"").toLowerCase()}),m&&(a=e.compose(a,{next:m})),e.navigate(a))}}]);n.controller("auth.CompanyLoginCtrl",["$scope","auth","flash","navigation",
"urls",function(c,g,k,e,d){k=e.currentCompany?e.currentCompany.shortname:"";var m=e.get("username")||"";e.clear("username",!0);c.credentials={shortname:k,username:m,password:""};var a=e.get("next"),m="yes"===e.get("require");!m&&g.currentUser.isAuthenticated&&k===g.currentUser.company.shortname?e.redirect(a||g.currentUser.company.$url(d.dashboard.index),"replace"):(c.differentCompanyLoginUrl=d.root.login,a&&(k={next:a},m&&(k.require="yes"),c.differentCompanyLoginUrl=e.compose(c.differentCompanyLoginUrl,
k)),c.submit=function(k){g.login(c.credentials,k).then(function(){var c=a||g.currentUser.company.$url(d.dashboard.index);e.navigate(c)},function(){c.credentials.password=""})})}]);n.controller("auth.ForgotPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,g,k,e,d){var m=e.get("shortname")||"";e.clear("shortname",!0);var a=e.get("username")||"";e.clear("username",!0);c.alreadyHasCompany=!!m;c.credentials={shortname:m,username:a};c.submit=function(a){g.forgot.password({},c.credentials,
a).$promise.then(function(){k.success("An email has been sent to the address associated with this account.");e.navigate(d.root.login)})}}]);n.controller("auth.ResetPasswordCtrl",["$scope","db","flash","navigation","urls",function(c,g,k,e,d){var m=e.get("shortname")||"";e.clear("shortname",!0);var a=e.get("username")||"";e.clear("username",!0);var n=e.get("token")||"";e.clear("token",!0);!m||!a||!n?(k.error("Bad password reset link."),e.navigate(d.root.login)):(c.credentials={token:n,username:a,shortname:m,
password:""},c.submit=function(a){g.forgot.password.reset({},c.credentials,a).$promise.then(function(){k.success("Your password has been changed. Please log in.");var a=d.populate(d.company.login,{shortname:m}),a=a+("?username="+c.credentials.username);e.navigate(a)})})}]);n.controller("auth.ForgotCredentialsCtrl",["$scope","db","flash","navigation","urls",function(c,g,k,e,d){c.credentials={email:""};c.submit=function(m){var a=c.credentials.email;g.forgot.credentials({},c.credentials,m).$promise.then(function(){k.success("We emailed you at <b>"+
a+"</b>.");e.navigate(d.root.login)})}}])})();
(function(){angular.module("auth.directives",[]).config(["$compileProvider","d",function(n,c){var g=function(e,d){if(!d.parse||!d.permission)throw Error("auth: "+e+": invalid directive definition");return n.directive(e,c.conditionalDirective({name:e,watch:["$injector","$parse","auth",function(g,a,k){var h=c.safeInvoke(g,d.permission),b=c.safeInvoke(g,d.parse);return function(c,d,g){var k=b(g),m=g.ngCanOnlyWhen?a(g.ngCanOnlyWhen):_.always,n=g.ngCanAlsoWhen?a(g.ngCanAlsoWhen):_.never,l=!g.ngCanOnce||
c.$eval(g.ngCanOnce),p,q=!0;return function(){try{if(n(c))return!0;if(!m(c))return!1;var a;l&&!q?a=p:(a=p=h(k(c)),q=!1);return a}catch(b){throw console.error("auth: "+e+": error checking permission for arguments: "+g[e]),b;}}}}],once:function(c,a,d){return!d.ngCanOnlyWhen&&!d.ngCanAlsoWhen&&(!d.ngCanOnce||c.$eval(d.ngCanOnce))},operator:function(c,a,d){return function(a){d.ngThen&&(c[d.ngThen]=a);return a}}}))},k=function(c,d){return g(c,{parse:["$parse",function(d){return function(a){return d(a[c])}}],
permission:["auth",function(c){return function(a){return c.permissions.can(d.permission,a)}}]})};k("ngCanView",{permission:"view"});k("ngCanUpdate",{permission:"update"});k("ngCanRemove",{permission:"remove"});k("ngCanAdminView",{permission:"adminView"});k("ngCanAdminUpdate",{permission:"adminUpdate"});k("ngCanViewAmounts",{permission:"viewAmounts"});k("ngCanViewDashboardSection",{permission:"viewDashboardSection"});k("ngCanViewAdminSection",{permission:"viewAdminSection"});k("ngCanViewManifestSection",
{permission:"viewManifestSection"});k("ngCanViewInvoiceAmounts",{permission:"viewInvoiceAmounts"});k=function(c,d){return g(c,{parse:["$parse",function(d){return function(a){a=a[c].match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);if(!a)throw Error("auth: "+c+": expected expression of the form '_type_ on _object_'");var g=a[1],h=d(a[2]);return function(a){return{cls:g,owner:h(a)}}}}],permission:["auth",function(c){return function(a){return c.permissions.can(d.permission,a.cls,a.owner)}}]})};k("ngCanCreate",
{permission:"create"});k("ngCanList",{permission:"list"});k("ngCanAdminCreate",{permission:"adminCreate"});k("ngCanAdminList",{permission:"adminList"});g("ngCan",{parse:["$parse",function(c){return function(d){var g=d.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s*$/);d=d.ngCan.match(/^\s*([\s\S]+)\s+on\s+([\s\S]+)\s+with\s+([\s\S]+)\s*$/);if(!g&&!d)throw Error("auth: ng-can: expected expression of the form '_type_ on _object_' or '_type_ on _model_ with _object_'");var a=g[1],k=_.never,h=_.never;
d?(k=c(d[2]),h=c(d[3])):h=c(g[2]);return function(b){return{permission:a,object:h(b),cls:k(b)}}}}],permission:["auth",function(c){return function(d){return!d.cls?c.permissions.can(d.permission,d.object):c.permissions.can(d.permission,d.cls,d.object)}}]});g("ngCanAny",{parse:["$parse",function(c){return function(d){var g=c(d.ngCanAny),a,k;d.ngCanAnyWith?(a=c(d.ngCanAnyOn),k=c(d.ngCanAnyWith)):(a=_.never,k=c(d.ngCanAnyOn));return function(c){return{permissions:g(c),object:k(c),cls:a(c)}}}}],permission:["auth",
function(c){return function(d){return!d.cls?_.any(d.permissions,function(g){return c.permissions.can(g,d.object)}):_.any(d.permissions,function(g){return c.permissions.can(g,d.cls,d.object)})}}]})}])})();
(function(){var n=angular.module("auth.services",["db.services","lib.services","urls.services"]);n.factory("auth",["$http","$injector","$rootScope","convert","db","events","models","sessionStorage","storage","urls",function(c,g,k,e,d,m,a,n,h,b){var f=["z","hmleigh"],A={isAuthenticated:!1};g={};var w=function(a){var b=t.currentUser;return(a=a||b.company)&&b.isAuthenticated&&b.company&&b.company===a},u=function(){var a=t.currentUser;return a.isAuthenticated&&a.company&&a.company.isAdmin},C=function(a){return a.affiliation&&
a.affiliation.affiliateCompany===t.currentUser.company},z=function(a,b){var c=a.conditions.maxCompanyTier;if(_.isNumber(c)){var d=b.features?b.features.tier:null;if(!_.isNumber(d)||d>c)return!1}return!0},l={},p={};e=function(){p={}};m.on(k,"auth.login",e);m.on(k,"auth.logout",e);m.on(k,"auth.clearEffectiveGroupCache",e);var F=function(a,b){var c,d;if(t.currentUser.company===b)c=t.currentUser.group;else if(t.currentUser.company.isAdmin)(c=t.currentUser.adminGroup)&&!z(c,b)&&(c=null);else if(t.currentUser.company.isAffiliate){var e=
_.findWhere(t.currentUser.company.partners,{company:b});t.currentUser.partnerGroup&&(e&&e.affiliateGroup)&&(d={groupPermissions:_.omit(e.affiliateGroup.groupPermissions,function(a,b){return!(a&&_.get(t.currentUser.partnerGroup.groupPermissions,b,!1))})})}c||((e=_.findWhere(t.currentUser.relatedGroupOverrides,{company:b}))||(e=_.findWhere(t.currentUser.company.relatedGroupOverrides,{company:b,relatedUser:null})),e&&(c=e.group));if(c=c||d)return c;console.warn("auth: user with no effective group",t.currentUser,
a,b)},G=function(a){if(!a)throw console.error("auth: invalid permission",this,a,this.cls),Error("auth: invalid permission");a="can"+_.capitalize(a);var b=l[this.cls][a];if(b)return D.call(this,b);console.error("auth: invalid permission configuration",this,a,l,b);return!1},x=function(b){var c,d,e;if(2===arguments.length)d=(c=arguments[1])?c.cls:"",e=a.Company.forObject(c);else if(3===arguments.length){c=null;if((d=arguments[1])&&!_.isString(d))d=d.cls;e=arguments[2]}else console.error("auth: invalid arguments when checking permission",
arguments);if(_.isUndefined(c))throw console.error("auth: invalid object when checking permission",b,c),Error("auth: invalid object when checking permission "+b);if(!d)throw console.error("auth: invalid class when checking permission",b,d,e),Error("auth: invalid class when checking permission "+b);if(!e)throw console.error("auth: invalid owner when checking permission",b,d,e),Error("auth: invalid owner when checking permission "+b);var f=a.Company.forObject(e);if(!f)throw console.error("auth: invalid company when checking permission",
b,d,e,c),Error("auth: invalid company when checking permission "+b);var g;g=c;var h=f;if(t.currentUser.isAuthenticated){var k=h.uri,m=p[k];_.isUndefined(m)&&(m=F(g,h),p[k]=m);g=m}else g=void 0;c={company:f,instance:c,owner:e,cls:d,group:g,permissions:g?g.groupPermissions:{},can:G};f!==e&&(c[_.uncapitalize(e.cls)]=e);(d=l[d].init)&&d.call(c);return G.call(c,b)};k=function(a){return function(){var b=_.toArray(arguments);b.unshift(a);return x.apply(this,b)}};g.canView=k("view");g.canUpdate=k("update");
g.canRemove=k("remove");g.canAdminView=k("adminView");g.canAdminUpdate=k("adminUpdate");g.canCreate=k("create");g.canList=k("list");g.canAdminCreate=k("adminCreate");g.canAdminList=k("adminList");g.can=x;var r=function(a,b,c){b=b||!1;c=_.isUndefined(c)?b:c;a=_.capitalize(a);var d="canView"+a,e="canEdit"+a,f="canEditPrivateProperties"+a;a="canViewPrivateProperties"+a;return{canView:function(){return b?!0:this.permissions[d]},canList:function(){return c?!0:this.permissions[d]},canCreate:e,canUpdate:e,
canRemove:e,canClear:e,canAdminUpdate:f,canAdminCreate:f,canAdminView:a,canAdminList:a}};k=function(a,b,c,d,e){b=b||"booking";a=_.capitalize(a);e=e||{};var f=e.canView||"canView"+a,g=e.canList||"canView"+a,h=e.canCreate||"canEdit"+a,k=e.canUpdate||"canEdit"+a,l=e.canRemove||"canEdit"+a;return _.extend(r(a,c,d),{init:function(){this.instance&&(this.booking=_.getDotted(this.instance,b))},canView:function(){return!this.group?!0:!x("view",this.booking)?!1:this.permissions[f]},canList:function(){return!this.group?
!0:!x("view",this.booking)?!1:this.permissions[g]},canCreate:function(){return!x("update",this.booking)?!1:this.permissions[h]},canUpdate:function(){return!x("update",this.booking)?!1:this.permissions[k]},canRemove:function(){return!x("update",this.booking)?!1:this.permissions[l]}})};var D=function(a){if(_.isFunction(a))return a.apply(this);if(_.isString(a))return this.permissions[a]||!1;console.error("auth: invalid permission method",a);return!1};e=function(a,b){return function(){a=_.isArray(a)?
a:[a];var c=!0,d=_.clone(this);d.cls=d.company.cls;_.forEach(a,function(a){if(!d.can(a))return c=!1});return c&&D.call(this,b)}};l[a.Company.cls]=r("company",!0);l[a.Company.cls].canCreate=function(){return!u()?!1:this.permissions.canEditCompanies};l[a.Company.cls].canRemove=function(){return this.instance===t.currentUser.company?!1:this.can("create")};l[a.Company.cls].canUpdateCompanyWebsite="canEditCompany";l[a.Company.cls].canUpdateCompanyPayments=e("viewAmounts","canEditAccounting");l[a.Company.cls].canChangePriceSheets=
e("viewAmounts","canChangePriceSheets");l[a.Company.cls].canCreateCustomRefunds=e("viewAmounts","canCreateCustomRefunds");l[a.Company.cls].canEditAccounting=e("viewAmounts","canEditAccounting");l[a.Company.cls].canEditTransportation="canEditTransportation";l[a.Company.cls].canDuplicateAcrossCompanies=function(){return t.currentUser.company.isAdmin&&this.permissions.canEditTransportation};l[a.Company.cls].canViewAmounts=function(){return!this.group&&!t.currentUser.isAuthenticated?!0:this.permissions.canViewAmounts};
l[a.Company.cls].canViewInvoiceAmounts="canViewInvoiceAmounts";l[a.Company.cls].canViewPricing=e("viewAmounts","canViewSheets");l[a.Company.cls].canUpdatePricing=e("viewAmounts","canEditPricing");l[a.Company.cls].canViewAdminSection=function(){return!t.currentUser.isAuthenticated?!1:t.currentUser.company.isAdmin&&this.permissions.canViewAdminSection};l[a.Company.cls].canViewDashboardSection="canViewDashboardSection";l[a.Company.cls].canViewItemsSection="canViewItemsSection";l[a.Company.cls].canViewSettingsSection=
"canViewSettingsSection";l[a.Company.cls].canViewBookingsSection="canViewBookingsSection";l[a.Company.cls].canViewManifestSection="canViewManifestSection";l[a.Company.cls].canViewReports="canViewReports";l[a.Company.cls].canViewNetworkSettings="canViewNetworkSettings";l[a.Company.cls].canCancel=function(){return this.permissions.canCancelBookings};l[a.Company.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings};l[a.Company.cls].canEditSheets="canEditSheets";l[a.TagGroup.cls]=
r("tags",!0);var B=function(){return!u()||!this.company.isAdmin?!1:this.permissions.canEditTags};l[a.TagGroup.cls].canCreate=B;l[a.TagGroup.cls].canUpdate=B;l[a.TagGroup.cls].canRemove=B;l[a.Tag.cls]=l[a.TagGroup.cls];l[a.TagInstance.cls]=r("tagInstances",!0);B=function(){return!u()||!x("update",this.owner)?!1:this.permissions.canEditTagInstances};l[a.TagInstance.cls].canCreate=B;l[a.TagInstance.cls].canUpdate=B;l[a.TagInstance.cls].canRemove=B;l[a.CustomManifest.cls]=r("customManifests");l[a.CustomCalendar.cls]=
r("customCalendars");l[a.CustomReport.cls]=r("customReports");l[a.Role.cls]=r("roles");l[a.CrewMember.cls]=r("crewMembers");l[a.CrewMember.cls].canCreateSelfAssignable="canEditCrewMembersSelfAssignable";l[a.CrewMember.cls].canUpdate=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===t.currentUser?this.permissions.canEditCrewMembersSelfAssignable:!1};l[a.CrewMember.cls].canRemove=function(){return this.permissions.canEditCrewMembers?!0:this.instance.user===t.currentUser?
this.permissions.canEditCrewMembersSelfAssignable:!1};l[a.CrewMember.cls].canCreate=function(){return this.permissions.canEditCrewMembers};l[a.Group.cls]=r("groups");l[a.GroupOverride.cls]=r("groups");l[a.User.cls]=r("users",!0);l[a.User.cls].canUpdate=function(){return this.instance===t.currentUser?!0:this.permissions.canEditUsers};l[a.User.cls].canRemove=function(){return this.instance==t.currentUser?!1:this.permissions.canEditUsers};l[a.Agent.cls]=r("agents",!0);l[a.Agent.cls].canCreate=function(){return this.permissions.canEditAgents?
!0:!this.affiliation?!1:w(this.affiliation.affiliateCompany)?x("create",a.Agent,this.affiliation.affiliateCompany):!1};l[a.Desk.cls]=r("desks",!0);l[a.Desk.cls].canCreate=function(){if(this.permissions.canEditDesks)return!0;if(!this.affiliation)return!1;if(w(this.affiliation.affiliateCompany))return x("create",a.Desk,this.affiliation.affiliateCompany)};l[a.Affiliation.cls]=r("network");l[a.Affiliation.cls].canView=function(){return this.permissions.canViewNetwork?!0:!this.instance?!1:x("view",a.Affiliation,
this.instance.affiliateCompany)};l[a.Affiliation.cls].canRemove=function(){return this.permissions.canEditNetwork?!0:!this.instance?!1:x("remove",a.Affiliation,this.instance.affiliateCompany)};l[a.CannedMessage.cls]=r("cannedMessages");l[a.CannedMessage.cls].canListAssociatedItems="canListAssociatedItems";l[a.Item.cls]=r("items",!0);l[a.Item.cls].canView=function(){return!this.instance.isPrivate||this.permissions.canViewItems};l[a.FlowNode.cls]=r("flowNodes",!0);l[a.Image.cls]=r("images",!0);l[a.CustomField.cls]=
r("customFields",!0);l[a.CustomField.cls].canListAssociatedItems="canListAssociatedItems";l[a.CustomField.cls].canSkipRecipientName=function(){return!!this.group};l[a.CustomField.cls].canViewPrivate="canViewPrivateCustomFields";l[a.ExtendedOption.cls]=r("customFields",!0);l[a.TransportationOption.cls]=r("customFields",!0);l[a.ConnectedCampaign.cls]=r("customFields",!0,!1);l[a.ConnectedWaiver.cls]=r("customFields",!0,!1);l[a.GeneratingCampaign.cls]=r("customFields",!0);l[a.CustomFieldInstance.cls]=
r("customFields",!0);l[a.CustomFieldInstanceCondition.cls]=r("customFields",!0);l[a.CustomFieldInstanceGroup.cls]=r("customFields",!0);l[a.Availability.cls]=r("availabilities",!0);l[a.Availability.cls].canCreate=function(){return this.permissions.canViewOnlyCrewedAvailabilities?!1:this.permissions.canCreateAvailabilities};l[a.Availability.cls].canOveruseResources="canOveruseResources";l[a.Availability.cls].canBookClosed="canBookClosedAvailabilities";l[a.Availability.cls].canOverbook="canOverbookAvailabilities";
l[a.Availability.cls].canBookUnbookable=function(){return this.permissions.canOveruseResources||this.permissions.canBookClosed||this.permissions.canOverbook};l[a.Availability.cls].canUpdateMultiple=function(){return this.permissions.canViewOnlyCrewedAvailabilities?!1:this.permissions.canEditMultipleAvailabilities};l[a.Availability.cls].canViewCapacities="canViewAvailabilityCapacities";l[a.Availability.cls].canReportOn="canViewAvailabilities";l[a.CustomerType.cls]=r("customerTypes",!0);l[a.CustomerType.cls].canListAssociatedItems=
"canListAssociatedItems";l[a.CheckinStatus.cls]=r("checkinStatuses");l[a.Campaign.cls]=r("campaigns",!0);l[a.Code.cls]=r("codes");l[a.CampaignValidityRule.cls]=r("campaigns",!0);l[a.StoredValueType.cls]=r("storedValueCards");l[a.StoredValueCard.cls]=r("storedValueCards",!0,!1);l[a.StoredValueAdjustment.cls]=r("storedValueCards",!0);l[a.Fund.cls]=function(a){a="canView"+_.capitalize(a);return{canView:a,canList:a,canCreate:_.never,canUpdate:_.never,canRemove:_.never}}("accounting");l[a.Fund.cls].canView=
l[a.Fund.cls].canList=function(){return!u()?!1:this.permissions.canViewAccounting};l[a.Transaction.cls]=l[a.Fund.cls];l[a.Contact.cls]=r("contacts",!0);l[a.Contact.cls].canUpdateLanguage=function(){return u()&&this.can("update")};l[a.InStorePaymentType.cls]=r("inStorePaymentTypes");l[a.BankAccount.cls]=r("bankAccounts");l[a.BankAccount.cls].canCreate=function(){return this.permissions.canEditAccounting};l[a.BankAccount.cls].canRemove=function(){return this.permissions.canEditAccounting};l[a.BankAccount.cls].canUpdate=
function(){return this.permissions.canEditAccounting};l[a.Card.cls]=r("cards",!0);l[a.Card.cls].canCreate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};l[a.Card.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};l[a.Card.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};l[a.CardAffiliation.cls]=r("cards",!0);l[a.CardAffiliation.cls].canCreate=function(){return this.permissions.canViewCards&&
this.permissions.canEditAccounting};l[a.CardAffiliation.cls].canRemove=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};l[a.CardAffiliation.cls].canUpdate=function(){return this.permissions.canViewCards&&this.permissions.canEditAccounting};l[a.Account.cls]=r("accounting");l[a.Payout.cls]=r("accounting");l[a.Payout.cls].canRetry=function(){return u()&&this.can("adminUpdate")};l[a.Transfer.cls]=r("accounting");l[a.Adjustment.cls]=r("accounting");l[a.Adjustment.cls].canCreate=
function(){return!u()?!1:this.permissions.canEditAccounting};l[a.Adjustment.cls].canUpdate=_.never;l[a.Adjustment.cls].canRemove=_.never;l[a.Invoice.cls]=r("invoices");l[a.InvoiceEntry.cls]=r("invoices");l[a.Upload.cls]=r("accounting");l[a.Upload.cls].canCreateDirectType=function(){return!this.permissions.canEditAccounting?!1:this.permissions.canCreateDirectUploads};l[a.Hotel.cls]=r("hotels",!0);l[a.Hotel.cls].canCreate=function(){return!u()?!1:this.permissions.canEditHotels};l[a.Hotel.cls].canUpdate=
l[a.Hotel.cls].canCreate;l[a.Hotel.cls].canRemove=l[a.Hotel.cls].canCreate;l[a.Lodging.cls]=r("transportation",!0);l[a.Pickup.cls]=r("transportation",!0);l[a.PreferredPickup.cls]=r("transportation",!0);l[a.Route.cls]=r("transportation",!0);l[a.Run.cls]=r("transportation",!0);l[a.Stop.cls]=r("transportation",!0);l[a.Activity.cls]=r("activities");l[a.Activity.cls].canCreate="canEditActivities";l[a.Activity.cls].canView=function(){return a.Activity.isAdminOnly(this.instance)?u():!0};l[a.Activity.cls].canToggleAdminOnlyStatus=
function(){return!u()||this.instance.object&&this.instance.object.cls===a.Activity.cls||a.Activity.isAdminOnly(this.instance)&&!this.instance.context.adminOnlyOriginalType?!1:this.can("update")};l[a.Activity.cls].canCreateNoteOnActivity=function(){return!u()||this.instance.object&&this.instance.object.cls===a.Activity.cls?!1:this.can("create")};l[a.Activity.cls].canList=function(){return this.permissions.canViewActivities||this.permissions.canViewActivitiesSelf};l[a.Activity.cls].canListFeed=function(){return this.permissions.canViewActivitiesFeed};
l[a.Waiver.cls]=r("waivers",!0);l[a.WaiverInstance.cls]=k("waiverInstances","booking",!1);l[a.CustomerPrototype.cls]=r("customFields",!0);l[a.CustomerPrototype.cls].canCreate=function(){return!x("updatePricing",this.company)?!1:this.permissions.canEditCustomFields};l[a.CustomerTypeRate.cls]=r("availabilities",!0);l[a.Block.cls]=r("blocks");l[a.TotalSheet.cls]=r("sheets");l[a.TotalSheet.cls].canView=_.always;l[a.TotalSheet.cls].canReportOn=function(){return this.can("list")};l[a.InvoiceSheet.cls]=
r("sheets");l[a.InvoiceSheet.cls].canView=_.always;l[a.InvoiceSheet.cls].canReportOn=function(){return this.can("list")};l[a.TotalLine.cls]=r("sheets");l[a.TotalLine.cls].canView=_.always;l[a.TotalLine.cls].canCreate="canEditPricing";l[a.TotalLine.cls].canUpdate="canEditPricing";l[a.TotalLine.cls].canRemove="canEditPricing";l[a.InvoiceLine.cls]=r("sheets");l[a.InvoiceLine.cls].canView=_.always;l[a.InvoiceLine.cls].canCreate="canEditPricing";l[a.InvoiceLine.cls].canUpdate="canEditPricing";l[a.InvoiceLine.cls].canRemove=
"canEditPricing";l[a.Subscription.cls]=r("users");l[a.Notification.cls]=k("notifications");l[a.Notification.cls].canCreate=_.super(l[a.Notification.cls].canCreate,function(){return!this.booking?this.permissions.canEditNotifications:this.super()});l[a.Notification.cls].canCreateDisputeType=function(){return!u()?!1:this.can("create",this.booking)};l[a.SmsNotification.cls]=k("smsNotifications");l[a.SmsNotification.cls].canCreate=function(){return this.company.isSmsEnabled&&this.permissions.canEditSmsNotifications&&
x("update",this.booking)};l[a.ReviewExpressNotification.cls]=k("reviewExpress");l[a.Order.cls]=r("orders");l[a.Booking.cls]=r("bookings");l[a.Booking.cls].canSkipPayment="canSkipPayment";l[a.Booking.cls].canBookHiddenFields="canBookHiddenFields";l[a.Booking.cls].canViewAffiliateBookings="canViewAffiliateBookings";l[a.Booking.cls].canOverrideTransportation="canOverrideTransportation";l[a.Booking.cls].canCreate=function(){return!this.group&&!t.currentUser.isAuthenticated?!0:this.permissions.canCreateBookings};
l[a.Booking.cls].canUpdate=function(){return this.permissions.canEditBookings?!0:C(this.instance)};l[a.Booking.cls].canUpdateExplicitTotal=function(){return!this.permissions.canViewAmounts||this.booking&&!this.can("update")?!1:this.permissions.canEditBookingExplicitTotals};l[a.Booking.cls].canUpdateExplicitInvoicePrice=function(){return!this.permissions.canViewInvoiceAmounts||this.booking&&!this.can("update")?!1:this.permissions.canEditBookingExplicitInvoicePrices};l[a.Booking.cls].canViewBookingNote=
"canViewBookingNotes";l[a.Booking.cls].canUpdateBookingNote=function(){return!this.can("viewBookingNote")?!1:this.permissions.canEditBookingNotes};l[a.Booking.cls].canUpdateBookingAffiliations=function(){return!this.can("update")?!1:this.permissions.canEditBookingAffiliations};l[a.Booking.cls].canUpdateBookingAffiliationInfo=function(){return!this.can("update")?!1:this.permissions.canEditBookingAffiliationInfo};l[a.Booking.cls].canView=function(){return!this.group||this.permissions.canViewBookings?
!0:C(this.instance)};l[a.Booking.cls].canCancel=function(){return this.can("update")&&this.permissions.canCancelBookings};l[a.Booking.cls].canCancelEligible=function(){return!this.can("update")||!a.Booking.isEligibleForCancellation(this.instance,t.currentUser)?!1:this.permissions.canCancelEligibleBookings};l[a.Booking.cls].canRebook=function(){return!this.can("cancel")?!1:this.can("create")};l[a.Booking.cls].canRebookEligible=function(){return!this.can("cancelEligible")||!a.Booking.isEligibleForRebook(this.instance,
t.currentUser)?!1:this.can("create")};l[a.Booking.cls].canEditCustomFieldValues=function(){return this.can("update")&&this.permissions.canEditCustomFieldValues};l[a.Customer.cls]=k("customers");l[a.Customer.cls].canViewCheckinStatus=function(){return!this.booking?this.permissions.canViewCustomerCheckinStatus:this.can("view")&&this.permissions.canViewCustomerCheckinStatus};l[a.Customer.cls].canUpdateCheckinStatus=function(){return x("update",this.booking)&&this.permissions.canEditCustomerCheckinStatus};
l[a.BookingCustomFieldValue.cls]=k("customFieldValues");l[a.BookingCustomFieldValue.cls].canUpdate="canEditCustomFieldValues";l[a.CustomerCustomFieldValue.cls]=k("customFieldValues");l[a.CustomerCustomFieldValue.cls].canUpdate="canEditCustomFieldValues";l[a.Refund.cls]=k("refunds");l[a.Refund.cls].canUpdate=e("viewAmounts",l[a.Refund.cls].canUpdate);l[a.Refund.cls].canCreate=e("viewAmounts",l[a.Refund.cls].canCreate);l[a.LineItem.cls]=k("lineItems","booking",!1);l[a.LineItem.cls].canUpdate=e("viewAmounts",
l[a.LineItem.cls].canUpdate);l[a.LineItem.cls].canCreate=e("viewAmounts",l[a.LineItem.cls].canCreate);l[a.LineItem.cls].canReportOn=function(){return this.permissions.canViewLineItems};l[a.Payment.cls]=k("payments");l[a.Payment.cls].canCreate="canEditPayments";l[a.Payment.cls].canCreatePartial=e("viewAmounts","canSkipPayment");l[a.Payment.cls].canCreateWithoutCVC=function(){return u()||this.permissions.canCreateCreditCardPaymentsWithoutCvv};l[a.Payment.cls].canCreateWithoutCardholdersName="canSkipCardholderInfo";
l[a.Payment.cls].canCreateWithoutPostalCode="canSkipPostalCode";l[a.Payment.cls].canCreateWithoutCountryCode="canSkipPostalCode";l[a.Payment.cls].canCreateCreditCard=e("viewAmounts","canCreateCreditCardPayments");l[a.Payment.cls].canCreateInStore=e("viewAmounts","canCreateInStorePayments");l[a.Payment.cls].canCreateStoredValueCard=e("viewAmounts","canCreateStoredValueCardPayments");l[a.Payment.cls].canCreateDeferred="canCreateDeferredPayments";l[a.Payment.cls].canCreateAffiliate=function(){return this.permissions.canCreateAffiliatePayments?
!0:this.booking?C(this.booking):!1};l[a.TicketLayout.cls]=r("ticketLayouts",!0);l[a.Location.cls]=r("locations");l[a.Location.cls].canView="canEditLocations";l[a.Location.cls].canViewSensitive="canEditLocations";l[a.Location.cls].canList="canEditLocations";l[a.Report.cls]=r("reports");l[a.Report.cls].canViewAccountsType="canViewAccounting";l[a.Report.cls].canViewEscrowType="canViewAccounting";l[a.Report.cls].canViewFundsType="canViewAccounting";l[a.Report.cls].canViewPayoutsType="canViewAccounting";
l[a.Report.cls].canViewTransfersType="canViewAccounting";l[a.Report.cls].canViewInvoicesType="canViewInvoices";l[a.Report.cls].canViewInvoiceableBookingsType="canEditInvoices";l[a.Report.cls].canViewAdvancedType="canViewAdvancedReport";l[a.Report.cls].canViewAgentsSummaryType="canViewAgentsSummaryReport";l[a.Report.cls].canViewBookingTypesSummaryType="canViewBookingTypesSummaryReport";l[a.Report.cls].canViewBookingsType="canViewBookingsReport";l[a.Report.cls].canViewCampaignsSummaryType="canViewCampaignsSummaryReport";
l[a.Report.cls].canViewContactsType="canViewContactsReport";l[a.Report.cls].canViewCrewSummaryType="canViewCrewSummaryReport";l[a.Report.cls].canViewCustomFieldSummaryType="canViewCustomFieldSummaryReport";l[a.Report.cls].canViewCustomerTypesSummaryType="canViewCustomerTypesSummaryReport";l[a.Report.cls].canViewDesksSummaryType="canViewDesksSummaryReport";l[a.Report.cls].canViewItemsSummaryType="canViewItemsSummaryReport";l[a.Report.cls].canViewLineItemsSummaryType="canViewLineItemsSummaryReport";
l[a.Report.cls].canViewLodgingsSummaryType="canViewLodgingsSummaryReport";l[a.Report.cls].canViewPaymentsType="canViewPaymentsReport";l[a.Report.cls].canViewDisputesType="canViewDisputesReport";l[a.Report.cls].canViewPickupLocationsSummaryType="canViewPickupLocationsSummaryReport";l[a.Report.cls].canViewRevenueSummaryType="canViewRevenueSummaryReport";l[a.Report.cls].canViewUsersSummaryType="canViewUsersSummaryReport";l[a.Report.cls].canViewCompaniesType="canViewCompaniesReport";l[a.Report.cls].canViewInProgressReportsType=
"canViewInProgressReportsReport";l[a.Report.cls].canViewTransactionsType="canViewTransactionsReport";l[a.Report.cls].canViewVolumeType="canViewVolumeReport";l[a.Report.cls].canReport=function(){return!!this.group};l[a.ViatorMapping.cls]=r("viator");l[a.Resource.cls]=r("resources");l[a.Resource.cls].canListAssociatedItems="canListAssociatedItems";l[a.Requirement.cls]=r("resources");l[a.RequirementGroup.cls]=r("resources");l[a.CustomerPrototypeRequirement.cls]=r("resources");l[a.ResourceRequirement.cls]=
r("resources");l[a.ResourceOverride.cls]=r("resources");l[a.ResourceUse.cls]=k("resources","booking",!1,!1,{canCreate:"canEditResourceUses",canUpdate:"canEditResourceUses",canRemove:"canEditResourceUses"});l[a.ResourceUse.cls].canList=_.super(l[a.ResourceUse.cls].canList,function(){return!this.booking?this.permissions.canViewResources:this.super()});l[a.AnalyticsService.cls]=r("analyticsServices",!0);l[a.CancellationPolicy.cls]=r("cancellationPolicies",!0);l[a.CancellationPolicy.cls].canListAssociatedItems=
"canListAssociatedItems";l[a.CancellationRule.cls]=r("cancellationPolicies",!0);l[a.BookingRestriction.cls]=r("bookingRestrictions",!0);l[a.BookingRestriction.cls].canListAssociatedItems="canListAssociatedItems";g.canBookWithNoFee=function(a,b){return t.currentUser.isAuthenticated};k=function(a){return _.super(a,function(){return _.isNumber(this.group.conditions&&this.group.conditions.maxCompanyTier)?!1:this.super()})};l[a.ResellerApp.cls]=r("reseller");l[a.ResellerApp.cls].canList=k(l[a.ResellerApp.cls].canList);
l[a.ResellerAppCompany.cls]=r("reseller");l[a.ResellerCompany.cls]=r("reseller");l[a.ResellerCompany.cls].canList=k(l[a.ResellerCompany.cls].canList);l[a.ResellerCompanyMapping.cls]=r("reseller");l[a.ResellerCompanyMapping.cls].canCreate=function(){return!u()?!1:this.permissions.canEditReseller};l[a.ResellerCompanyMapping.cls].canList=function(){return!u()?!1:this.permissions.canViewReseller};l[a.ResellerCompanyMapping.cls].canRemove=function(){return!u()?!1:this.permissions.canEditReseller};l[a.ResellerItem.cls]=
r("reseller");l[a.ResellerItemMapping.cls]=r("reseller");l[a.ResellerCustomerType.cls]=r("reseller");l[a.ResellerCustomerTypeMapping.cls]=r("reseller");l[a.ResellerOption.cls]=r("reseller");l[a.ResellerOptionMapping.cls]=r("reseller");l[a.ResellerKey.cls]=r("reseller");l[a.Order.cls].canCancelEligible=function(){return this.permissions.canCancelEligibleBookings&&!this.can("cancel")};(k=d.slipstream("currentUser"))?k.isAuthenticated=!0:k=A;e=function(a){var b=function(){return t.currentUser.isAuthenticated?
t.currentUser.username+"@"+t.currentUser.company.shortname:"anonymous"};return{get:function(c){return a.get(b()+":"+c)},set:function(c,d){return a.set(b()+":"+c,d)},del:function(c){return a.del(b()+":"+c)},clear:function(){if(a.key&&a.length)for(var c=b(),d,e,f=0;f<a.length;f++)e=a.key(f),d=e.split(":",1)[0],d===c&&a.del(e);else a.clear()}}};var t={permissions:g,storage:e(h),sessionStorage:e(n),currentUser:k,isAuthenticatedForAdminCompany:u,isAuthenticatedForAdminCompanyAsDeveloper:function(){return u()&&
_.contains(f,t.currentUser.username)},relatedCompanies:function(){return!t.currentUser.isAuthenticated?[]:_.sortBy(_.unique(_.append(_.pluck(a.GroupOverride.companyLevelOverrides(t.currentUser.company.relatedGroupOverrides),"company"),_.pluck(t.currentUser.relatedGroupOverrides,"company"))),"name")},login:function(a,b){var c=d.login({},a,b);return c.$promise.then(function(){t.currentUser=c;t.currentUser.isAuthenticated=!0;m.broadcast("auth.login")})},logout:function(){t.storage.clear();t.sessionStorage.clear();
t.currentUser=A;var a=c.post(b.api.logout);m.broadcast("auth.logout");return a}};return window.$$auth=t}]);n.run(["$rootScope","$window","auth",function(c,g,k){c.auth=k;g.$$auth=k}])})();angular.module("cache",["cache.services"]);
(function(){var n=angular.module("cache.services",["lib.services","urls.services"]);n.factory("cache",["moment","urls",function(c,g){var k=function(a,c){c=c||{};for(var d in a)a.hasOwnProperty(d)&&(c[d]=e(a[d]));return c},e=function(a){if(_.isArray(a)){for(var c=[],g=0,b=a.length;g<b;g++)c.push(e(a[g]));return c}return _.isModelObject(a)?d(a):_.isObject(a)?k(a):a},d=function(a,c){if(_.isUndefined(a)||null===a)return c&&delete m.cache[c],a;if(!_.isObject(a))return a;var d=a.uri;c=c||d;var b=m.cache[c];
d&&(c&&c!==d&&!_.isUndefined(b))&&(console.log("cache: overlapping uris",d,c),delete m.cache[c]);b=_.isUndefined(b)?{}:b;d&&(m.cache[d]=b,b.$url||(b.$url=g.populateForObject));d=k(a,b);d.$fresh=!1;return d},m={cache:{},read:function(a,c){if(_.isUndefined(a))throw Error("cache.read: invalid key");c&&(a="["+a+"]");var d=m.cache[a];_.isUndefined(d)&&(d=c?[]:{},d.uri=a,d.$fresh=!0,m.cache[a]=d);return d},update:d,clear:function(){m.cache={}},fresh:function(a){return!!a.$fresh},populate:e,reference:function(a){if(a.cls&&
a.uri)return{cls:a.cls,uri:a.uri}}};return window.$$cache=m}]);n.run(["$rootScope","cache","events",function(c,g,k){k.on(c,"auth.logout",function(){g.clear()})}])})();
(function(){var n=angular.module("cart",["cache","db","navigation"]);n.factory("cart",["$q","$rootScope","$timeout","cache","clientOptions","db","events","flows","navigation","require","persistentStorage","urls","xmessage",function(c,g,k,e,d,m,a,n,h,b,f,A,w){var u=function(a){return{company:a,entries:[],isNoTax:!1,isCardRequired:!0,totals:{price:0,tax:0,total:0}}},C=function(){B.status="success";a.broadcast("cart.loaded")},z=function(a){a.totals.price=_.sum(a.entries,"totals.price");a.totals.tax=
_.sum(a.entries,"totals.tax");a.totals.bookingFee=_.sum(a.entries,"totals.bookingFee");a.isNoTax=_.all(a.entries,"isNoTax");a.isCardRequired=_.any(a.entries,"isCardRequired")},l={},p=function(a,c,d,e,f){b.assert(!!c,"cart: expected availability");b.assert(!!d,"cart: expected breakdown");b.defined(e,"price","cart: expected total price");b.defined(e,"tax","cart: expected total tax");b.defined(e,"bookingFee","cart: expected total total");b.assert(!!f,"cart: expected model");var g=a.company.shortname;
l[g]=l[g]||{};var h=l[g][c.uri];h||(h={availability:c},l[g][c.uri]=h,a.entries.push(h));h.customerBreakdown=d;h.totals=e;h.isNoTax=!h.totals.tax&&c.item.isNoTax;h.isCardRequired=c.item.isCardRequired;h.model=f;z(a)},F=function(a,b){_.overwriteWithout(a.entries,function(a){return a.availability===b.availability});l[a.company.shortname]&&delete l[a.company.shortname][b.availability.uri];z(a)},G=function(a){_.clear(a.entries);l[a.company.shortname]={};z(a)},x=function(a,b){try{var d=_.map(b.entries,
function(a){var b=m.availability(a.availability,null,null,null,{tagAlong:!0});return b.$promise.then(function(){return{availability:b,storedEntry:a}},function(){return null})});return c.all(d).then(function(b){G(a);_.forEach(b,function(b){if(b){var c=b.availability;b=b.storedEntry;var d=_.choose(b.customerBreakdown,function(a){var b=e.read(a.customerTypeRate.uri);if(b)return{count:a.count,customerTypeRate:b}});p(a,c,d,b.totals,b.model)}});console.info("cart: finished hydrating")})}catch(f){return console.warn("cart: unable to load cart",
b,f),c.when(null)}},r=function(a){var b={};b.entries=_.map(a,function(a){var b=_.map(a.customerBreakdown,function(a){return{count:a.count,customerTypeRate:e.reference(a.customerTypeRate)}});return{availability:A.extract(a.availability),customerBreakdown:b,totals:a.totals,model:a.model}});return b},D=function(a){if(B.company){var b=r(B.entries);b?(console.info("cart: storing",b),b=f.set("cart",b)):b=f.del("cart");a&&(b=b.then(function(){w.broadcast("fareharbor.cart.changed")}));return b}},B={status:"success",
add:function(a,b,c,d){p(B,a,b,c,d);return D(!0)},remove:function(a){F(B,a);D(!0)},clear:function(){G(B);D(!0)},search:function(a){return(l[B.company.shortname]||{})[a.uri]||null},keepShoppingUrl:function(a){return n.initialUrl()||a.$url(A.company.index)},permalinkUrl:function(a){a=A.populate(A.company.cart.permalink,{shortname:a.shortname,cartUuid:d.userIdentifier});return n.extendWithFlow(a)},load:function(){if(B.company&&"loading"!==B.status)return B.status="loading",B.$promise=f.get("cart").then(function(a){if(a)return console.info("cart: hydrating...",
a),x(B,a)}).then(C,C),B.$promise},allCompanies:{status:"success",carts:{},load:function(){B.allCompanies.status="loading";B.allCompanies.$promise=f.getForAllCompanies("cart").then(function(a){delete B.allCompanies.$promise;_.clear(B.allCompanies.carts);l={};var b=[];_.forEach(a,function(a){if(a.cart){var c=a.company.shortname;B.allCompanies.carts[c]=u(a.company);console.info("cart: loading all...",a);b.push(x(B.allCompanies.carts[c],a.cart))}});return c.all(b).then(function(){B.company&&B.allCompanies.carts[B.company.shortname]?
_.extend(B,B.allCompanies.carts[B.company.shortname]):_.extend(B,u());B.allCompanies.status="success"},function(){B.allCompanies.status="success"})});return B.allCompanies.$promise}}};_.extend(B,u(null));var t=function(a){a&&B.company!==a&&(console.info("cart: loading for new company",a),D(),B.company=a,B.load())};t(h.currentCompany);a.on(g,"navigation.company.updated",function(a,b){t(b.company)});a.on(g,"persistentStorage.reIdentifiedUser",function(){h.currentCompany&&(B.company=h.currentCompany,
B.load(),console.info("cart: loading for new user"))});return B}]);n.controller("cart.CartCtrl",["$scope","clientOptions","controllers","db","navigation","require",function(c,g,k,e,d,m){g.reflect("userIdentifier")}]);n.controller("cart.ViewCartCtrl",["$scope","cart",function(c,g){g.load()}]);n.directive("ngCart",["analytics","cart","db","flows","lightframe","localization","navigation","paymentController","tracking","urls",function(c,g,k,e,d,m,a,n,h,b){return{templateUrl:"cart.cart",controller:["$scope",
"$attrs",function(f,A){k.slipstream("isDebug")&&(window.$$pop=function(a,b){f.$safeApply(function(){var c=a?a.replace(" ","-"):"z";w.newOrder["contact-name"]=_.capitalize(a||"zach");w.newOrder["contact-phone"]="4158881212";w.newOrder["contact-email"]=c+"@fareharbor.com";w.newOrder["payments-payment-cardNumber"]="4242424242424242";w.newOrder["payments-payment-cardholdersName"]="Zach Snow";w.newOrder["payments-payment-cardExpiryMonth"]="12";w.newOrder["payments-payment-cardExpiryYear"]="2018";w.newOrder["payments-payment-cardCvc"]=
"123";w.newOrder["payments-payment-postalCode"]="12345";w.newBooking["payments-payment-countryCode"]="US";_.extend(w.newBooking,b)})});var w=this,u={};w.setEntryValidity=function(a,b){var c=a.availability.uri;_.isUndefined(b)?delete u[c]:u[c]=!!b};w.addEntryController=function(a){_.contains(w.entryCtrls,a)||w.entryCtrls.push(a)};w.removeEntryController=function(a){_.contains(w.entryCtrls,a)&&_.ref.remove(w.entryCtrls,a)};w.newOrder=f.newOrder={"contact-language":m.current().LANGUAGE,clientUuid:_.uuid()};
w.company=f.$eval(A.ngCart);w.attachControl=function(a,b){w[a]=b;b.cartCtrl=w};w.showCompleteButton=function(a){return!a.$invalid&&!a.$submitting&&0<g.entries.length&&_.all(u)&&w.paymentCtrl&&w.paymentCtrl.isCurrentOptionValid()&&w.paymentCtrl.isCurrentKindValid()&&!w.paymentCtrl.isAmountTooLow()};var C=!1;w.isNavigateAwayAllowed=function(a){return C?!0:!a.$pristine?!1:!0};var z=function(l,m){m=m||_.ignore;var n=_.extend({},w.newOrder);n.bookingCount=g.entries.length;_.forEach(g.entries,function(a,
b){var c="booking"+b.toString()+"-";_.extendWithPrefix(c,n,a.model);n[c+"availability"]=a.availability.pk});console.info("cart: creating order",n);var q=k.orders.create({shortname:w.company.shortname},n,l);q.$promise.then(function(){C=!0;var k=q.$url(b.company.order.index);1===q.contributingBookings.length&&(k=q.contributingBookings[0].$url(b.company.item.booking));k=e.extendWithFlow(k);a.navigate(k);g.clear();l.$submitting=!0;k={company:w.company.shortname,order:q.uuid,total:q.contributingBookingCosts.totalCost.total,
bookingCount:q.bookingCount,items:_.unique(_.map(q.contributingBookings,"item.name")),isLightframe:d.isLightframe()};h.track(f,"completed-order",k);c.trackOrder(q);m()},function(){h.track(f,"failed-order",{company:w.company.shortname,isLightframe:d.isLightframe()});w.paymentCtrl.restoreCard();l.$submitting=!1;m()})};w.submit=function(a){if(g.entries.length)if(a.$valid){a.$submitting=!0;w.paymentCtrl.saveCard();var b=w.paymentCtrl.option();if(b===w.paymentCtrl.CHARGE_OPTION||b===w.paymentCtrl.DEFER_OPTION)w.tokenizingCard=
!0;f.$asyncApply(function(b){w.paymentCtrl.createToken(a,function(){w.tokenizingCard=!1;z(a,b)},function(){w.tokenizingCard=!1;a.$submitting=!1;b()})})}else console.error("cart: attempting to submit invalid order form");else console.error("cart: attempting to submit empty order form")};n(f,{modelKey:"newOrder",fieldPrefix:"payments-payment",company:w.company,gross:function(){return!w.cartTotalsCtrl?0:w.cartTotalsCtrl.totals.preBookingFeeTotal},bookingFee:function(){return!w.cartTotalsCtrl?0:w.cartTotalsCtrl.totals.bookingFee},
invoicePrice:0,isAnonymous:!0,isAffiliate:!1,isCompany:!1,isCardRequired:!!g.isCardRequired});w.attachControl("paymentCtrl",f.paymentCtrl)}],controllerAs:"cartCtrl"}}]);n.directive("ngCartEntry",["cart","db","navigation","urls",function(c,g,k,e){return{restrict:"A",require:"^ngCart",templateUrl:"cart.entry",controller:["$scope","$attrs",function(d,m){var a=this;a.status="loading";a.cartCtrl=d.cartCtrl;a.entry=d.$eval(m.ngCartEntry);a.total=_.sum([a.entry.totals.price,a.entry.totals.tax,a.entry.totals.bookingFee]);
a.change=function(){var b=a.entry.availability.$url(e.company.item.book);k.navigate(b)};a.remove=function(){c.remove(a.entry)};var n={};_.forEach(a.entry.customerBreakdown,function(a){n[a.customerTypeRate.pk]=a.count});var h=g.availability.liveCapacity({shortname:a.entry.availability.item.company.shortname,itemPk:a.entry.availability.item.pk,availabilityPk:a.entry.availability.pk},null,null,{customerTypeRateCounts:_.stringifyJSON(n),totalSheet:a.entry.model.totalSheet});h.$promise.then(function(){a.cartCtrl.setEntryValidity(a.entry,
h.isBookable);a.status=a.entry.availability.isBookable&&h.isBookable?"success":"error";a.isPossiblyBookable=a.entry.availability.isBookable},function(){a.cartCtrl.setEntryValidity(a.entry,!0);a.status="success"});d.$on("$destroy",function(){a.cartCtrl.setEntryValidity(a.entry)})}],controllerAs:"cartEntryCtrl"}}]);n.directive("ngCartTotals",["cart","models","redeemStoredValueCardsController",function(c,g,k){return{restrict:"A",require:"^ngCart",templateUrl:"cart.totals",controller:["$scope",function(e){var d=
this;e.cartCtrl.attachControl("cartTotalsCtrl",d);d.cartCtrl=e.cartCtrl;d.totals=_.extend({},c.totals);d.currentPrice=function(){return d.totals.price};d.currentTax=function(){return d.totals.tax};var m=function(a){return a.availability.uri},a=function(a){return a.totals.price+a.totals.tax},n=function(b){var d=e.redeemStoredValueCardsCtrl.storedValueCards;if(!d.length)return b;var h={};_.forEach(d,function(b){b=e.redeemStoredValueCardsCtrl.applied(b);b=_.prorate(b,c.entries,a,m);h=_.merge(h,b,_.add)});
var k=0;_.forEach(c.entries,function(a){var b=m(a);k+=g.Booking.adjustBookingFee(a.totals.bookingFee,a.totals.price,a.totals.tax,h[b])});return k},h=function(){_.extend(d.totals,c.totals);d.totals.bookingFee=n(d.totals.bookingFee);d.totals.preBookingFeeTotal=d.totals.price+d.totals.tax-e.redeemStoredValueCardsCtrl.totalApplied();d.totals.total=d.totals.preBookingFeeTotal+d.totals.bookingFee};e.$watchCollection("cart.entries",function(){h()});k(e,{company:d.cartCtrl.company,modelKey:"newOrder",price:d.currentPrice,
tax:d.currentTax,toggleName:"applyStoredValueCard"});e.cartCtrl.attachControl("redeemStoredValueCardsCtrl",e.redeemStoredValueCardsCtrl);e.$watch("redeemStoredValueCardsCtrl.storedValueCards.length",function(a){h()})}],controllerAs:"cartTotalsCtrl"}}]);n.directive("ngCartComplete",["cart",function(c){return{restrict:"A",require:"^ngCart",templateUrl:"cart.complete",controller:["$scope",function(c){}],controllerAs:"cartCompleteCtrl"}}]);n.directive("ngCartAdd",["cart","navigation","urls",function(c,
g,k){return{restrict:"A",require:"^ngBook",templateUrl:"cart.add",controller:["$scope",function(e){var d=this;d.isAdding=!1;d.isAvailabilityInCart=!!c.search(e.bookCtrl.availability);d.add=function(){d.isAdding=!0;var k={price:e.bookCtrl.bookTotalsCtrl.totals.price,tax:e.bookCtrl.bookTotalsCtrl.totals.tax,bookingFee:e.bookCtrl.bookTotalsCtrl.totals.bookingFee};e.bookCtrl.isAlreadyBooked=!0;c.add(e.bookCtrl.availability,e.bookCtrl.bookCountsCtrl.customerBreakdown(),k,e.bookCtrl.newBooking).then(function(){g.navigate(c.permalinkUrl(e.bookCtrl.item.company))},
function(){d.isAdding=!1})}}],controllerAs:"cartAddCtrl"}}]);n.directive("ngCartSubmit",[function(){return{restrict:"A",require:"^ngCart",templateUrl:"cart.submit"}}]);n.run(["$rootScope","cart",function(c,g){c.cart=g;window.$$cart=g}])})();angular.module("db",["db.services"]);
(function(){var n=0;angular.module("db.services",["cache.services","lib.services"]).factory("db",["$http","$injector","$rootScope","$q","$window","cache","convert","flash","require","urls",function(c,g,k,e,d,m,a,q,h,b){var f=!1;angular.element(d).on("beforeunload",function(){f=!0});var A={},w=_.debounce(function(){f||q.warn("<b>Could not reach FareHarbor.</b> Please check your internet connection.")},2E3,!0),u=function(a){_.isUndefined(a)&&(a="<b>That didn't work.</b> Please try again.");a&&q.error(a)},
C=_.debounce(function(a){q.error("<b>Too many "+a+'.</b> Please wait a few minutes and try again. If you continue to receive this message please contact <a href="mailto:support@fareharbor.com" target="_blank">support@fareharbor.com</a>.')},2E3,!0),z=_.debounce(function(){q.error("<b>FareHarbor will be right back.</b> Please wait a few minutes and try again.")},2E3,!0),l=function(a,b,c){return c?_.map(a,function(a){return m.update(a)}):m.update(a,b)},p=function(d){var f={},g={isDelete404Success:!0},
k=d.formName||d.key+"Form";return function(p,E,r,s,t){var v=_.extend({},g,d,t),y=!1!==v.flashError,x,S;if(_.isString(p))x=p;else{var K={};_.extend(K,v.defaultParams||{},p);x=b.populate(v.url,K)}S=x;if(_.isUndefined(x))return console.warn("db: invalid endpoint",v.url,K),E=v.isArray?[]:{},E.$promise=e.reject(null),E.$promise.cancel=_.ignore,E;s&&(x+="?"+eb(a.clientRequest(s)),s=null);v.ignoreQueryParamsInCacheUri||(S=x);var B=n+=1;console.log("db: endpoint",x,B);if((p=f[x])&&!v.ignoreInFlight){if(v.tagAlong)return console.log("db: tagging along",
x,B),p.value;"GET"===v.method&&"GET"===p.method&&(console.log("db: already in flight, cancelling",x,B),p.timeout.promise.cancelled=!0,p.timeout.resolve())}var N;N=v.ignoreCache?v.isArray?[]:{}:m.read(S,v.isArray);var D=function(a){a.data&&v.sideKeys&&_.forEach(v.sideKeys,function(b){var c=a.data[b];c&&(a[b]=l(c,null,_.isArray(c)))})},Z=_.identity;v.key&&(Z=v.isArray?function(a){console.log("db: success",x,B);if(N.$requestId!==B)return console.log("db: out of order",x,N.$requestId,B),a;var b=_.isFunction(v.key)?
v.key(a):v.key;_.overwrite(N,l(a.data[b],null,!0));N.$fresh=!1;a.data?(a.primaryData=a.data[b]=N,D(a)):a.primaryData=null;r&&G(r,k)(a,N);return a}:function(a){console.log("db: success",x,B);if(N.$requestId!==B)return console.warn("db: out of order",x,N.$requestId,B),a;var b=_.isFunction(v.key)?v.key(a):v.key,c=a.data[b],c=v.ignoreCache?l(c):l(c,S);a.data?(a.primaryData=a.data[b]=c,D(a)):a.primaryData=null;r&&G(r,k)(a,c);return a});var I;r&&(I=F(r,k));p=function(a){return function(b){b=a(b);console.log("db: complete",
x,B);v.ignoreInFlight||(f[x]=null);r&&(r.$submitting=!1);N.$requestId===B&&(delete N.$requestId,delete N.$promise);return b}};r&&(r.$submitting=!0);s=e.defer();var H=c({method:v.method,url:x,data:E||{},timeout:s.promise}).then(p(Z),p(function(a){console.log("db: error",x,B,a);var b=a.status;if(500===b)return q.error("<b>Whoops, an internal error has occurred.</b> FareHarbor has been notified. Please wait a few minutes and try again."),e.reject(a);if(503===b)return z(),e.reject(a);if(403===b)return y&&
q.error('<b>Not allowed.</b> Please <a href="/login/">log in</a> as a different user or request permission from your administrator.'),e.reject(a);if(420===b)return C("connections"),e.reject(a);if(429===b)return C("requests"),e.reject(a);if(324===b)return w(),e.reject(a);if(0===b){if(a.config.timeout&&a.config.timeout.cancelled)return A;w();return e.reject(a)}if(400===b)return I?I(a,b):y&&u(a.data.errorMessage||v.errorMessage),e.reject(a);if(404===b){if(v.isDelete404Success&&"DELETE"===v.method)return console.log("db: treating 404 as success",
x,B),Z(a)}else u(a.data.errorMessage||v.errorMessage),console.error("db: unknown error",a,b);return e.reject(a)}));h.assert(!H.success&&!H.error,"db: disallow $http promise interface");v.ignoreInFlight||(f[x]={timeout:s,value:N,requestId:B,method:v.method,uri:x});N.$requestId=B;N.$promise=H;N.$promise.timeout=s;N.$promise.cancel=function(){H.timeout?(H.timeout.promise.cancelled=!0,H.timeout.resolve(),console.log("db: cancelled",x,B)):console.warn("db: cancellation failed",x,B)};return N}},F=function(a,
b){return function(c){var d=c.data[b];_.forEach(d,function(b,c){a[c]||(a[c]={$error:{}});var d=a[c];b&&b.length?d.$error.$server=b:d.$error={}});a.$errorCallbacks&&_.forEach(a.$errorCallbacks,function(a){a(d)})}},G=function(a,b){return function(b,c){_.forEach(a,function(a,b){a&&a.$error&&delete a.$error.$server});a.$successCallbacks&&_.forEach(a.$successCallbacks,function(a){a(c)})}},x=function(a,c){c||(c=a+"s");var d=p({method:"GET",url:b.api[c],isArray:!0,key:c});d.create=p({method:"POST",url:b.api[c],
key:a});return d},r=function(a){var c=p({method:"GET",url:b.api[a],key:a});c.update=p({method:"PUT",url:b.api[a],key:a});c.remove=p({method:"DELETE",url:b.api[a],formName:"disableForm"});return c},D=function(a,b,c){var d={};d[b]=_.isUndefined(c)?"yes":c;return function(b,c,e,f,g){f=_.extend(d,f);return a(b,c,e,f,g)}},B=function(a){return D(a,"pickable")},t=p({method:"POST",url:b.api.login,key:"user",formName:"loginForm"}),y={};y.password=p({method:"POST",url:b.api.forgotPassword,formName:"forgotPasswordForm"});
y.password.reset=p({method:"POST",url:b.api.resetPassword,formName:"resetPasswordForm"});y.credentials=p({method:"POST",url:b.api.forgotCredentials,formName:"forgotCredentialsForm"});var L=p({method:"GET",url:b.api.reportTest,key:"report"}),J=p({method:"GET",url:b.api.companies,isArray:!0,key:"companies"});J.pickable=B(J);J.jump=D(J,"jump");J.full=D(J,"full");J.create=p({method:"POST",url:b.api.companies,key:"company"});J.admin=p({method:"GET",url:b.api.company,key:"company",defaultParams:{shortname:"admin"}});
J.report=p({method:"GET",url:b.api.reportCompanies,key:"report"});var s=p({method:"GET",url:b.api.company,key:"company"});s.update=p({method:"PUT",url:b.api.company,key:"company"});s.remove=p({method:"DELETE",url:b.api.company});s.styles={};s.styles.update=p({method:"PUT",url:b.api.companyStyles,key:"styles",formName:"companyStylesForm"});s.adminNotes={};s.adminNotes.update=p({method:"PUT",url:b.api.companyAdminNotes,key:"adminNotes",formName:"companyAdminNotesForm"});s.accounts=p({method:"GET",url:b.api.companyAccounts,
key:"accounts"});s.accounts.report=p({method:"GET",url:b.api.reportAccounts,key:"report"});s.nags={};s.nags.update=p({method:"PUT",url:b.api.companyNags,key:"companyNags",formName:"companyNagsForm"});s.companyFeatures={};s.companyFeatures.update=p({method:"PUT",url:b.api.companyFeatures,key:"companyFeatures",formName:"companyFeaturesForm"});s.itemColorsFeature={};s.itemColorsFeature.update=p({method:"PUT",url:b.api.companyItemColorsFeature,key:"companyItemColorsFeature",formName:"companyItemColorsFeatureForm"});
s.contactInformation={};s.contactInformation.update=p({method:"PUT",url:b.api.companyContactInformation,key:"contactInformation",formName:"companyContactInformationForm"});s.taxInformation={};s.taxInformation.update=p({method:"PUT",url:b.api.companyTaxInformation,key:"taxInformation",formName:"companyTaxInformationForm"});s.extendedTaxInformation={};s.extendedTaxInformation.update=p({method:"PUT",url:b.api.companyExtendedTaxInformation,key:"extendedTaxInformation",formName:"companyExtendedTaxInformationForm"});
s.tosAcceptance={};s.tosAcceptance.update=p({method:"PUT",url:b.api.companyTosAcceptance,key:"tosAcceptance",formName:"companyTosAcceptanceForm"});s.escrowReport=p({method:"GET",url:b.api.reportEscrow,key:"report"});s.profile={};s.profile.update=p({method:"PUT",url:b.api.companyProfile,key:"profile",formName:"companyProfileForm"});s.payments={};s.payments.update=p({method:"PUT",url:b.api.companyPayments,key:"payments",formName:"companyPaymentsForm"});s.manifestSettings={};s.manifestSettings.update=
p({method:"PUT",url:b.api.companyManifestSettings,key:"manifestSettings",formName:"manifestSettingsForm"});s.images=p({method:"GET",url:b.api.companyImages,key:"images",isArray:!0});s.images.create=p({method:"POST",url:b.api.companyImages,key:"image"});s.image={};s.image.update=p({method:"PUT",url:b.api.companyImage,key:"image"});s.image.remove=p({method:"DELETE",url:b.api.companyImage});s.activities={};s.activities.all=p({method:"GET",url:b.api.allActivities,isArray:!0,key:"activities"});s.activities.system=
p({method:"GET",url:b.api.systemActivities,isArray:!0,key:"activities"});s.activities.admin=D(s.activities.system,"admin");s.calendar=p({method:"GET",url:b.api.companyCalendar,key:"calendar"});s.summaryReport={};s.summaryReport.items=p({method:"GET",url:b.api.reportItemsSummary,key:"report"});s.summaryReport.users=p({method:"GET",url:b.api.reportUsersSummary,key:"report"});s.summaryReport.bookingTypes=p({method:"GET",url:b.api.reportBookingTypesSummary,key:"report"});s.summaryReport.customerTypes=
p({method:"GET",url:b.api.reportCustomerTypesSummary,key:"report"});s.summaryReport.customField=p({method:"GET",url:b.api.reportCustomFieldSummary,key:"report"});s.summaryReport.lodgings=p({method:"GET",url:b.api.reportLodgingsSummary,key:"report"});s.summaryReport.pickups=p({method:"GET",url:b.api.reportPickupsSummary,key:"report"});s.summaryReport.crew=p({method:"GET",url:b.api.reportCrewSummary,key:"report"});s.summaryReport.agents=p({method:"GET",url:b.api.reportAgentsSummary,key:"report"});s.summaryReport.desks=
p({method:"GET",url:b.api.reportDesksSummary,key:"report"});s.summaryReport.campaigns=p({method:"GET",url:b.api.reportCampaignsSummary,key:"report"});s.summaryReport.revenue=p({method:"GET",url:b.api.reportRevenueSummary,key:"report"});s.advancedReport=p({method:"POST",url:b.api.reportAdvanced,key:"report"});var H=x("group"),v=r("group");v.duplicate=p({method:"POST",url:b.api.duplicateGroup,key:"group",formName:"duplicateGroupForm"});v.remove=p({method:"DELETE",url:b.api.group,formName:"disableForm"});
var O=x("groupOverride");O.related=p({method:"GET",url:b.api.relatedGroupOverrides,isArray:!0,key:"groupOverrides"});var E=r("groupOverride");E.activities=p({method:"GET",url:b.api.groupOverrideActivities,isArray:!0,key:"activities"});var S=x("bankAccount"),K=r("bankAccount");K.remove=p({method:"DELETE",url:b.api.bankAccount,key:"bankAccount"});K.verify=p({method:"PUT",url:b.api.verifyBankAccount,key:"verifiedBankAccount",formName:"verifyBankAccountForm"});var N=x("card"),Z=r("card");Z.remove=p({method:"DELETE",
url:b.api.card,key:"disableForm"});var aa=p({method:"GET",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations"});aa.create=p({method:"POST",url:b.api.cardAffiliations,isArray:!0,key:"cardAffiliations",form:"cardAffiliationsForm"});var ea=x("customManifest"),fa=r("customManifest"),I=x("customCalendar"),wa=r("customCalendar"),xa=x("customReport"),ia=r("customReport"),W=p({method:"GET",url:b.api.users,isArray:!0,key:"users"});W.pickable=B(W);W.all=p({method:"GET",url:b.api.allUsers,isArray:!0,
key:"users"});W.related=p({method:"GET",url:b.api.relatedUsers,isArray:!0,key:"users"});W.create=p({method:"POST",url:b.api.users,key:"user",formName:"createUserForm"});var V=p({method:"GET",url:b.api.user,key:"user"});V.update=p({method:"PUT",url:b.api.user,key:"user",formName:"updateUserForm"});V.remove=p({method:"DELETE",url:b.api.user});V.activities=p({method:"GET",url:b.api.userActivities,isArray:!0,key:"activities"});V.subscriptions=p({method:"GET",url:b.api.userSubscriptions,isArray:!0,key:"subscriptions"});
V.itemSubscriptions=p({method:"GET",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});V.itemSubscriptions.update=p({method:"POST",url:b.api.userItemSubscriptions,isArray:!0,key:"subscriptions"});V.overview=p({method:"GET",url:b.api.userOverview,key:"overview"});var R=x("item");R.pickable=B(R);R.all=p({method:"GET",url:b.api.allItems,isArray:!0,key:"items"});R.calendar=p({method:"GET",url:b.api.itemsCalendar,key:"calendar"});var M=r("item");M.color=p({method:"PUT",url:b.api.itemColor,
key:"color",formName:"updateItemColorForm"});M.calendar=p({method:"GET",url:b.api.itemCalendar,key:"calendar"});M.duplicate=p({method:"POST",url:b.api.duplicateItem,key:"item"});M.subscriptions=p({method:"GET",url:b.api.itemSubscriptions,isArray:!0,key:"subscriptions"});M.images=p({method:"GET",url:b.api.itemImages,key:"images",isArray:!0});M.images.create=p({method:"POST",url:b.api.itemImages,key:"image"});M.image={};M.image.update=p({method:"PUT",url:b.api.itemImage,key:"image"});M.image.remove=
p({method:"DELETE",url:b.api.itemImage});M.viatorSettings={};M.viatorSettings.update=p({method:"PUT",url:b.api.viatorSettings,key:"viatorSettings",formName:"viatorSettingsForm"});M.viatorMappings=x("viatorMapping");M.viatorMapping=r("viatorMapping");M.reviewExpressSettings={};M.reviewExpressSettings.update=p({method:"PUT",url:b.api.reviewExpressSettings,key:"reviewExpressSettings",form:"reviewExpressSettingsForm"});M.picthriveSettings={};M.picthriveSettings.update=p({method:"PUT",url:b.api.picthriveSettings,
key:"picthriveSettings",formName:"picthriveSettingsForm"});M.ratings=p({method:"GET",url:b.api.itemRatings,key:"ratings"});M.flowPages=p({method:"GET",isArray:!0,url:b.api.itemFlowPages,key:"flowNodes"});M.flowPages.full=D(M.flowPages,"full");var ma=r("flowNode"),U=function(){return g.get("flows").wrapEndpoint(ma).apply(null,arguments)};U.update=ma.update;U.remove=ma.remove;var ya=p({method:"GET",url:b.api.defaultFlowPage,key:"defaultFlowPage"});U.withDescendants=D(p({method:"GET",url:b.api.flowNode,
key:"flowNode",ignoreQueryParamsInCacheUri:!0}),"descendants");U.duplicate=p({method:"POST",url:b.api.duplicateFlowNode,key:"flowNode"});var X=x("flowNode");X.multi=p({method:"POST",url:b.api.flowNodes,isArray:!0,key:"flowNodes",formName:"flowNodeForm"});X.root=D(X,"root");X.root.create=D(X.create,"root");X.pages=D(X,"pages");var ga=p({method:"GET",url:b.api.affiliates,isArray:!0,key:"affiliations"});ga.all=p({method:"GET",url:b.api.allAffiliates,isArray:!0,key:"affiliations"});ga.pickable=B(ga);
ga.create=p({method:"POST",url:b.api.affiliates,key:"affiliation",formName:"createAffiliationForm"});var ba=p({method:"GET",url:b.api.affiliate,key:"affiliation"});ba.update=p({method:"PUT",url:b.api.affiliate,key:"affiliation",formName:"updateAffiliationForm"});ba.remove=p({method:"DELETE",url:b.api.affiliate,formName:"disableForm"});var Q=p({method:"GET",url:b.api.affiliateCards,key:"cards",isArray:!0,flashError:!1}),qa=p({method:"GET",url:b.api.affiliateCardAffiliations,key:"cardAffiliations",
isArray:!0,flashError:!1}),na=p({method:"GET",url:b.api.partners,isArray:!0,key:"affiliations"});na.all=D(na,"all");na.pickable=B(na);var bb=p({method:"GET",url:b.api.partner,key:"partner"});bb.remove=p({method:"DELETE",url:b.api.partner,formName:"disableForm"});var fc=p({method:"GET",url:b.api.partnerCards,key:"cards",isArray:!0,flashError:!1}),gc=p({method:"GET",url:b.api.partnerCardAffiliations,key:"cardAffiliations",isArray:!0,flashError:!1}),cb=x("agent");cb.all=p({method:"GET",url:b.api.allAgents,
isArray:!0,key:"agents"});var hc=r("agent"),db=x("desk");db.all=p({method:"GET",url:b.api.allDesks,isArray:!0,key:"desks"});var ic=r("desk"),jc=x("hotel"),kc=r("hotel"),fb=x("lodging");fb.duplicate=p({method:"POST",url:b.api.duplicateLodgingsAcrossCompanies,formName:"duplicateLodgingsAcrossCompaniesForm",key:"lodgings",isArray:!0});var lc=r("lodging"),mc=x("preferredPickup"),nc=r("preferredPickup"),gb=x("pickup");gb.duplicate=p({method:"POST",url:b.api.duplicatePickupsAcrossCompanies,formName:"duplicatePickupsAcrossCompaniesForm",
key:"pickups",isArray:!0});var oc=r("pickup"),ra=x("route");ra.pickable=B(ra);ra.duplicate=p({method:"POST",url:b.api.duplicateRoutesAcrossCompanies,formName:"duplicateRoutesAcrossCompaniesForm",key:"routes",isArray:!0});var hb=r("route");hb.duplicate=p({method:"POST",url:b.api.duplicateRoute,key:"route",formName:"duplicateRouteForm"});var pc=x("stop"),qc=r("stop"),za={};za.searchByDate=p({method:"GET",url:b.api.searchRunsByDate,isArray:!0,key:"runs"});za.manifest=p({method:"GET",url:b.api.runsManifest,
isArray:!0,key:"runs"});var ib=p({method:"GET",url:b.api.campaigns,isArray:!0,key:"campaigns"});ib.create=p({method:"POST",url:b.api.campaigns,key:"campaign"});var sa=p({method:"GET",url:b.api.campaign,key:"campaign"});sa.update=p({method:"PUT",url:b.api.campaign,key:"campaign"});sa.remove=p({method:"DELETE",url:b.api.campaign,formName:"disableForm"});sa.customFields=p({method:"GET",url:b.api.campaignCustomFields,isArray:!0,key:"customFields"});var jb=p({method:"GET",url:b.api.campaignValidityRules,
isArray:!0,key:"campaignValidityRules"});jb.create=p({method:"POST",url:b.api.campaignValidityRules,key:"campaignValidityRule",formName:"createCampaignValidityRuleForm"});var kb=p({method:"GET",url:b.api.campaignValidityRule,key:"campaignValidityRule"});kb.remove=p({method:"DELETE",url:b.api.campaignValidityRule,formName:"disableForm"});var lb=p({method:"GET",url:b.api.codes,isArray:!0,key:"codes"});lb.create=p({method:"POST",url:b.api.codes,key:"codes",isArray:!0,formName:"createCodesForm"});var Aa=
p({method:"GET",url:b.api.code,key:"code"});Aa.update=p({method:"PUT",url:b.api.code,key:"code",formName:"updateCodeForm"});Aa.remove=p({method:"DELETE",url:b.api.code});var rc=x("storedValueType"),sc=r("storedValueType"),Ba=p({method:"GET",url:b.api.storedValueCards,isArray:!0,key:"storedValueCards"});Ba.create=p({method:"POST",url:b.api.storedValueCards,key:"storedValueCards",isArray:!0,formName:"createStoredValueCardsForm"});Ba.search=p({method:"GET",url:b.api.searchStoredValueCardsByNumber,key:"searchResult"});
var ta=r("storedValueCard");ta.payments=p({method:"GET",url:b.api.storedValueCardPayments,isArray:!0,key:"payments"});ta.notifications={};ta.notifications.create=p({method:"POST",url:b.api.storedValueCardNotifications,isArray:!0,key:"notifications",formName:"storedValueCardNotificationForm"});var tc=x("storedValueAdjustment"),Ca=r("storedValueAdjustment");delete Ca.update;delete Ca.remove;var uc=x("resellerCompany","resellerCompanies"),vc=r("resellerCompany"),wc=x("resellerCompanyMapping"),xc=r("resellerCompanyMapping"),
yc=x("resellerItem"),zc=r("resellerItem"),Ac=x("resellerItemMapping"),Bc=r("resellerItemMapping"),Cc=x("resellerCustomerType"),Dc=r("resellerCustomerType"),Ec=x("resellerCustomerTypeMapping"),Fc=r("resellerCustomerTypeMapping"),Gc=x("resellerOption"),Hc=r("resellerOption"),Ic=x("resellerOptionMapping"),Jc=r("resellerOptionMapping"),Kc=p({method:"GET",url:b.api.resellerUnmappedItems,isArray:!0,key:"items"}),Lc=p({method:"GET",url:b.api.resellerUnmappedCustomerPrototypes,isArray:!0,key:"customerPrototypes"}),
Mc=x("resellerKey"),Nc=r("resellerKey"),Oc=x("resellerApp"),Pc=r("resellerApp"),Qc=x("resellerAppCompany","resellerAppCompanies"),Rc=r("resellerAppCompany"),Da=p({method:"GET",url:b.api.customFields,isArray:!0,key:"customFields"});Da.all=p({method:"GET",url:b.api.allCustomFields,isArray:!0,key:"customFields"});Da.create=p({method:"POST",url:b.api.customFields,key:"customField",formName:"createCustomFieldForm"});var ja=p({method:"GET",url:b.api.customField,key:"customField"});ja.items=p({method:"GET",
url:b.api.customFieldItems,key:"items",isArray:!0});ja.duplicate=p({method:"POST",url:b.api.duplicateCustomField,key:"customField",formName:"duplicateCustomFieldForm"});ja.prevalidate=p({method:"POST",url:b.api.prevalidateCustomField,key:"prevalidity",formName:"prevalidateCustomFieldForm",flashError:!1});ja.update=p({method:"PUT",url:b.api.customField,key:"customField",formName:"updateCustomFieldForm"});ja.remove=p({method:"DELETE",url:b.api.customField,formName:"disableForm"});var mb={};mb.create=
p({method:"POST",url:b.api.transportationOptions,key:"transportationOption"});var Ea={};Ea.update=p({method:"PUT",url:b.api.transportationOption,key:"transportationOption"});Ea.remove=p({method:"DELETE",url:b.api.transportationOption});var nb={};nb.create=p({method:"POST",url:b.api.extendedOptions,key:"extendedOption",formName:"createExtendedOptionForm"});var Fa={};Fa.update=p({method:"PUT",url:b.api.extendedOption,key:"extendedOption",formName:"updateExtendedOptionForm"});Fa.remove=p({method:"DELETE",
url:b.api.extendedOption});var ob={};ob.create=p({method:"POST",url:b.api.connectedCampaigns,key:"connectedCampaign",formName:"createConnectedCampaignForm"});var pb={};pb.remove=p({method:"DELETE",url:b.api.connectedCampaign});var qb={};qb.create=p({method:"POST",url:b.api.generatingCampaigns,key:"generatingCampaign",formName:"generatingCampaignForm"});var Ga={};Ga.update=p({method:"PUT",url:b.api.generatingCampaign,key:"generatingCampaign",formName:"generatingCampaignForm"});Ga.remove=p({method:"DELETE",
url:b.api.generatingCampaign});var Ha=r("customFieldInstanceGroup"),rb=x("customFieldInstanceGroup");rb.multi=p({method:"POST",url:b.api.customFieldInstanceGroupsMulti,isArray:!0,key:"customFieldInstanceGroups",formName:"customFieldInstanceGroupsForm"});Ha.remove=p({method:"DELETE",url:b.api.customFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"disableForm"});Ha.duplicate=p({method:"POST",url:b.api.duplicateCustomFieldInstanceGroup,key:"customFieldInstanceGroup",formName:"duplicateForm"});
var Sc=r("customFieldInstance"),sb=x("customFieldInstance");sb.multi=p({method:"POST",url:b.api.customFieldInstancesMulti,isArray:!0,key:"customFieldInstances",formName:"customFieldInstancesForm"});var Tc=r("customFieldInstanceCondition"),Uc=x("customFieldInstanceCondition"),tb=p({method:"GET",url:b.api.roles,isArray:!0,key:"roles"});tb.create=p({method:"POST",url:b.api.roles,key:"role"});var Ia=p({method:"GET",url:b.api.role,key:"role"});Ia.update=p({method:"PUT",url:b.api.role,key:"role"});Ia.remove=
p({method:"DELETE",url:b.api.role});var ub=p({method:"GET",url:b.api.crewMembers,isArray:!0,key:"crewMembers"});ub.create=p({method:"POST",url:b.api.crewMembers,key:"crewMember"});var Ja=p({method:"GET",url:b.api.crewMember,key:"crewMember"});Ja.update=p({method:"PUT",url:b.api.crewMember,key:"crewMember"});Ja.remove=p({method:"DELETE",url:b.api.crewMember,key:"crewMember"});var vb=r("customerType");vb.items=p({method:"GET",url:b.api.customerTypeItems,key:"items",isArray:!0});var wb=x("customerType");
wb.all=p({method:"GET",url:b.api.allCustomerTypes,isArray:!0,key:"customerTypes"});var xb=r("customerPrototype");xb.duplicate=p({method:"POST",url:b.api.duplicateCustomerPrototype,key:"customerPrototype",formName:"duplicateForm"});var Ka=x("customerPrototype");Ka.all=p({method:"GET",url:b.api.allCustomerPrototypes,isArray:!0,key:"customerPrototypes"});Ka.multi=p({method:"POST",url:b.api.customerPrototypesMulti,isArray:!0,key:"customerPrototypes",formName:"customerPrototypesForm"});var yb=r("checkinStatus",
"checkinStatuses"),Vc=x("checkinStatus","checkinStatuses");yb.updateBookings=p({method:"PUT",url:b.api.checkinStatusForBookings,key:"bookings",isArray:!0,formName:"updateCheckinStatusForBookingsForm"});var Wc=x("cannedMessage"),zb=r("cannedMessage");zb.items=p({method:"GET",url:b.api.cannedMessageItems,key:"items",isArray:!0});var T={};T.next=p({method:"GET",url:b.api.nextAvailability,key:"availability"});T.update=p({method:"POST",url:b.api.updateAvailabilities,formName:"updateAvailabilitiesForm",
key:"updateAvailabilities"});T.updateByItem=p({method:"POST",url:b.api.updateItemAvailabilities,formName:"updateAvailabilitiesForm",key:"updateAvailabilities"});T.byDate=p({method:"GET",url:b.api.availabilitiesByDate,isArray:!0,key:"availabilities"});T.byTag={};T.byTag.clear=p({method:"DELETE",url:b.api.availabilitiesByTag,formName:"disableForm"});T.searchByDate=p({method:"GET",url:b.api.searchAvailabilitiesByDate,isArray:!0,key:"availabilities"});T.searchByPk=p({method:"GET",url:b.api.searchAvailabilitiesByPk,
isArray:!0,key:"availabilities"});T.manifest=p({method:"GET",url:b.api.availabilitiesManifest,isArray:!0,key:"availabilities"});T.manifestPickable=B(T.manifest);T.searchByUpcoming=p({method:"GET",url:b.api.searchAvailabilitiesByUpcoming,isArray:!0,key:"availabilities"});T.rule=p({method:"POST",url:b.api.rule,isArray:!0,key:"availabilities",formName:"ruleForm"});var Y=p({method:"GET",url:b.api.availability,key:"availability"});Y.update=p({method:"PUT",url:b.api.availability,key:"availability",formName:"updateAvailabilityForm"});
Y.status={};Y.status.update=p({method:"PUT",url:b.api.availabilityStatus,key:"availabilityStatus",formName:"updateAvailabilityStatusForm"});Y.book=p({method:"POST",url:b.api.book,key:"booking",formName:"bookForm"});Y.liveCapacity=p({method:"GET",url:b.api.availabilityLiveCapacity,key:"liveCapacity",formName:"liveCapacityForm"});Y.resourceUses=p({method:"GET",url:b.api.availabilityResourceUses,key:"resourceUses",isArray:!0});Y.remove=p({method:"DELETE",url:b.api.availability,formName:"disableForm"});
Y.notifications=p({method:"POST",url:b.api.notifications,formName:"notificationsForm"});Y.note={};Y.note=p({method:"PUT",url:b.api.availabilityNote,key:"note",formName:"updateAvailabilityNoteForm"});var Ab={};Ab.create=p({method:"POST",url:b.api.customerTypeRates,key:"customerTypeRate"});var La={};La.remove=p({method:"DELETE",url:b.api.customerTypeRate,formName:"disableForm"});La.update=p({method:"PUT",url:b.api.customerTypeRate,key:"customerTypeRate"});var Xc=x("block"),Yc=r("block"),Ma=r("contact");
Ma.bookings={};Ma.bookings.update=p({method:"PUT",url:b.api.contactBookings,key:"modified"});var Bb={};Bb.report=p({method:"GET",url:b.api.reportContacts,key:"report"});var Zc=p({method:"GET",url:b.api.contactPayments,isArray:!0,key:"payments"}),Na=p({method:"GET",url:b.api.order,key:"order"});Na.notification=p({method:"POST",url:b.api.orderNotification,formName:"orderNotificationForm"});Na.cancel=p({method:"POST",url:b.api.orderCancellation,key:"order",formName:"cancelOrderBookingsForm"});var Cb=
{};Cb.create=p({method:"POST",url:b.api.orders,key:"order",formName:"orderForm"});var Oa=p({method:"GET",url:b.api.orderPayments,isArray:!0,key:"payments"});Oa.create=p({method:"POST",url:b.api.orderPayments,key:"payments"});Oa.refund=p({method:"POST",url:b.api.orderRefunds,isArray:!0,key:"payments"});var da=p({method:"GET",url:b.api.bookings,isArray:!0,key:"bookings"});da.byContact=p({method:"GET",url:b.api.bookingsByContact,isArray:!0,key:"bookings"});da.searchByQuery=p({method:"GET",url:b.api.searchBookingsByQuery,
isArray:!0,key:"bookings"});da.searchByNew=p({method:"GET",url:b.api.searchBookingsByNew,isArray:!0,key:"bookings"});da.report=p({method:"GET",url:b.api.reportBookings,key:"report"});da.invoiceableReport=p({method:"GET",url:b.api.reportInvoiceableBookings,key:"report"});da.manifest=p({method:"GET",url:b.api.bookingsManifest,isArray:!0,key:"bookings"});da.searchByUuid=p({method:"GET",url:b.api.searchBookingsByUuid,isArray:!0,key:"bookings"});var P=p({method:"GET",url:b.api.booking,key:"booking"});
P.byPk=p({method:"GET",url:b.api.bookingByPk,key:"booking",ignoreCache:!0});P.reprice=p({method:"PUT",url:b.api.repriceBooking,key:"repricing",formName:"repriceBookingForm"});P.notification=p({method:"POST",url:b.api.notification,formName:"notificationForm"});P.smsNotification=p({method:"POST",url:b.api.smsNotification,formName:"smsNotificationForm"});P.cancel=p({method:"DELETE",url:b.api.booking,key:"booking",formName:"cancelBookingForm"});P.note={};P.note.update=p({method:"PUT",url:b.api.bookingNote,
key:"note",formName:"updateBookingNoteForm"});P.explicitGross={};P.explicitGross.update=p({method:"PUT",url:b.api.bookingExplicitGross,key:"explicitGross",formName:"updateBookingExplicitGrossForm"});P.explicitInvoicePrice={};P.explicitInvoicePrice.update=p({method:"PUT",url:b.api.bookingExplicitInvoicePrice,key:"explicitInvoicePrice",formName:"updateBookingExplicitInvoicePriceForm"});P.notificationOptions={};P.notificationOptions.update=p({method:"PUT",url:b.api.bookingNotificationOptions,key:"notificationOptions",
formName:"updateBookingNotificationOptionsForm"});P.affiliation={};P.affiliation.update=p({method:"PUT",url:b.api.affiliation,key:"affiliation"});P.checkinStatus={};P.checkinStatus.update=p({method:"PUT",url:b.api.bookingCheckinStatus,key:"bookingCheckinStatus",formName:"updateBookingCheckinStatusForm"});P.effectiveCancellationRule=p({method:"GET",url:b.api.bookingEffectiveCancellationRule,key:"cancellationRule"});var Db={checkinStatus:{}};Db.checkinStatus.update=p({method:"PUT",url:b.api.customerCheckinStatus,
key:"customerCheckinStatus",formName:"updateCustomerCheckinStatusForm"});var Eb={};Eb.find=p({method:"GET",url:b.api.searchCustomersByEncodedPk,key:"booking"});var Fb={};Fb.update=p({method:"PUT",url:b.api.bookingCustomFieldValue,key:"customFieldValue"});var Gb={};Gb.update=p({method:"PUT",url:b.api.customerCustomFieldValue,key:"customFieldValue"});var ca=x("report");ca.recent=p({method:"GET",url:b.api.recentReports,key:"reports",isArray:!0});ca.inProgress=p({method:"GET",url:b.api.inProgressReports,
key:"reports",isArray:!0});ca.volumeOverview=p({method:"GET",url:b.api.volumeOverviewReport,key:"volume"});ca.dailyVolumeOverview=p({method:"GET",url:b.api.dailyVolumeOverviewReport,key:"dailyVolume"});ca.paymentOverview=p({method:"GET",url:b.api.paymentOverviewReport,key:"paymentOverview"});ca.itemsSummaryOverview=p({method:"GET",url:b.api.itemsSummaryOverviewReport,key:"itemsSummary"});ca.nextPayoutOverview=p({method:"GET",url:b.api.nextPayoutOverviewReport,key:"nextPayout"});ca.report=p({method:"GET",
url:b.api.reportReports,key:"report"});var ha=r("report");ha.rerun=ha.update;delete ha.update;ha.cancel=p({method:"DELETE",url:b.api.report,formName:"disableForm",key:"report"});delete ha.remove;ha.objects=p({method:"POST",url:b.api.reportObjects,key:"objects",isArray:!1});var Pa=x("invoice");Pa.report=p({method:"GET",url:b.api.reportInvoices,key:"report"});Pa.partnerInvoice=p({method:"GET",url:b.api.partnerInvoice,key:"invoice"});var ka=r("invoice");ka.uploads=p({method:"GET",url:b.api.invoiceUploads,
isArray:!0,key:"uploads"});ka.uploads.create=p({method:"POST",url:b.api.invoiceUploads,key:"upload"});ka.notifications={};ka.notifications.create=p({method:"POST",url:b.api.invoiceNotifications,isArray:!0,key:"notifications",formName:"invoiceNotificationForm"});ka.uuid=p({method:"GET",url:b.api.uuidInvoice,key:"invoice"});var Qa={};Qa.create=p({method:"POST",url:b.api.lineItems,key:"lineItem"});Qa.report=p({method:"GET",url:b.api.reportLineItems,key:"report"});var Ra=p({method:"GET",url:b.api.lineItem,
key:"lineItem"});Ra.remove=p({method:"DELETE",url:b.api.lineItem});Ra.update=p({method:"PUT",url:b.api.lineItem,key:"lineItem"});var $c=x("tagGroup"),ad=r("tagGroup"),Hb={};Hb.create=p({method:"POST",url:b.api.tags,key:"tag"});var Sa={};Sa.update=p({method:"PUT",url:b.api.tag,key:"tag"});Sa.remove=p({method:"DELETE",url:b.api.tag,formName:"disableForm"});var Ib=p({method:"GET",url:b.api.objectTags,key:"objectTags",isArray:!0});Ib.update=p({method:"PUT",url:b.api.objectTags,key:"objectTags",isArray:!0});
var la=p({method:"GET",url:b.api.payments,isArray:!0,key:"payments"});la.related=p({method:"GET",url:b.api.relatedPayments,isArray:!0,key:"payments"});la.create=p({method:"POST",url:b.api.payments,key:"payment"});la.refund=p({method:"POST",url:b.api.refunds,isArray:!0,key:"payments"});la.report=p({method:"GET",url:b.api.reportPayments,key:"report"});la.volumeReport=p({method:"GET",url:b.api.reportVolume,key:"report"});var Jb=p({method:"GET",url:b.api.paymentFees,isArray:!0,key:"payments"});Jb.update=
p({method:"POST",url:b.api.paymentFees,key:"payments"});var bd=x("inStorePaymentType"),cd=r("inStorePaymentType"),Kb={custom:{}};Kb.custom.create=p({method:"POST",url:b.api.customRefunds,key:"refund",formName:"customRefundForm"});var Lb={};Lb.report=p({method:"GET",url:b.api.reportDisputes,key:"report"});var Mb=p({method:"GET",url:b.api.payouts,isArray:!0,key:"payouts"});Mb.report=p({method:"GET",url:b.api.reportPayouts,key:"report"});var Nb=p({method:"GET",url:b.api.payout,key:"payout"});Nb.retry=
p({method:"PUT",url:b.api.payoutRetry,key:"payoutRetry"});var Ob=p({method:"GET",url:b.api.transfers,isArray:!0,key:"transfers"});Ob.create=p({method:"POST",url:b.api.transfers,key:"transfer"});var dd=p({method:"GET",url:b.api.transfer,key:"transfer"}),Pb=p({method:"GET",url:b.api.uploads,isArray:!0,key:"uploads"});Pb.create=p({method:"POST",url:b.api.uploads,key:"upload"});var ed=p({method:"GET",url:b.api.upload,key:"upload"}),Qb=p({method:"GET",url:b.api.funds,isArray:!0,key:"funds"});Qb.report=
p({method:"GET",url:b.api.reportFunds,key:"report"});var fd=p({method:"GET",url:b.api.fund,key:"fund"}),Rb=p({method:"GET",url:b.api.adjustments,isArray:!0,key:"adjustments"});Rb.create=p({method:"POST",url:b.api.adjustments,key:"adjustment"});var gd=p({method:"GET",url:b.api.adjustment,key:"adjustment"}),Sb={};Sb.report=p({method:"GET",url:b.api.reportTransactions,key:"report"});var Ta=p({method:"GET",url:b.api.activities,isArray:!0,key:"activities"});Ta.notes={};Ta.notes.create=p({method:"POST",
url:b.api.notes,key:"activity",formName:"noteForm"});var Tb=p({method:"GET",url:b.api.activity,key:"activity"});Tb.update=p({method:"PUT",url:b.api.activity,key:"activity"});var hd=p({method:"PUT",url:b.api.reorder,key:"reorder"}),Ub=p({method:"GET",url:b.api.waivers,isArray:!0,key:"waivers"});Ub.create=p({method:"POST",url:b.api.waivers,key:"waiver"});var Ua=p({method:"GET",url:b.api.waiver,key:"waiver"});Ua.update=p({method:"PUT",url:b.api.waiver,key:"waiver"});Ua.remove=p({method:"DELETE",url:b.api.waiver,
formName:"disableForm"});var Vb={};Vb.create=p({method:"POST",url:b.api.connectedWaivers,key:"connectedWaiver",formName:"createConnectedWaiverForm"});var Wb={};Wb.remove=p({method:"DELETE",url:b.api.connectedWaiver});var Xb={};Xb.remove=p({method:"DELETE",url:b.api.waiverInstance,key:"waiverInstance"});var Va=x("totalSheet");Va.all=D(Va,"all");var oa=r("totalSheet");oa.duplicate=p({method:"POST",url:b.api.duplicateTotalSheet,key:"totalSheet",formName:"duplicateSheetForm"});oa.pricing=p({method:"GET",
url:b.api.totalPricing,key:"effectivePricings",isArray:!0});oa.pricing.update=p({method:"PUT",url:b.api.totalPricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});oa.pricing.stack=p({method:"GET",url:b.api.totalStack,key:"lines",isArray:!0});var Wa=x("invoiceSheet");Wa.all=D(Wa,"all");var pa=r("invoiceSheet");pa.duplicate=p({method:"POST",url:b.api.duplicateInvoiceSheet,key:"invoiceSheet",formName:"duplicateSheetForm"});pa.pricing=p({method:"GET",url:b.api.invoicePricing,key:"effectivePricings",
isArray:!0});pa.pricing.update=p({method:"PUT",url:b.api.invoicePricing,key:"effectivePricings",isArray:!0,formName:"priceLineForm"});pa.pricing.stack=p({method:"GET",url:b.api.invoiceStack,key:"lines",isArray:!0});var Xa={};Xa.channels=p({method:"GET",url:b.pusher.channels,key:"channels",isArray:!0});Xa.members=p({method:"POST",url:b.pusher.members,key:"channels",isArray:!0});var Yb=r("location");Yb.items=p({method:"GET",url:b.api.locationItems,key:"items",isArray:!0});var id=x("location"),Zb=x("resource");
Zb.manifest=p({method:"GET",url:b.api.resourcesManifest,key:"resources",isArray:!0});var Ya=r("resource");Ya.items=p({method:"GET",url:b.api.resourceItems,key:"items",isArray:!0});Ya.availabilities=p({method:"GET",url:b.api.resourceAvailabilities,key:"availabilities",isArray:!0});var ua={};ua.byDate=p({method:"GET",url:b.api.resourceUsesByDate,key:"resourceUses",isArray:!0});ua.calendar=p({method:"GET",url:b.api.resourceUsesCalendar,key:"calendar"});ua.reapplyBookingResourceUses=p({method:"POST",
url:b.api.reapplyBookingResourceUses,key:"reappliedBookingResourceUses",formName:"reapplyBookingResourceUsesForm"});var jd=x("requirementGroup"),$b=r("requirementGroup");$b.duplicate=p({method:"POST",url:b.api.duplicateRequirementGroup,key:"requirementGroup",formName:"duplicateRequirementGroupForm"});var kd=x("requirement"),ld=r("requirement"),md=x("resourceRequirement"),nd=r("resourceRequirement"),od=r("resourceUse"),va=p({method:"GET",url:b.api.resourceOverride,key:"resourceOverride"});va.update=
p({method:"PUT",url:b.api.resourceOverride,key:"resourceOverride",formName:"resourceOverrideForm"});va.remove=p({method:"DELETE",url:b.api.resourceOverride,formName:"disableForm"});va.rule=p({method:"POST",url:b.api.resourceOverrideRule,isArray:!0,key:"resourceOverrides",formName:"resourceOverrideRuleForm"});var Za={byTag:{}};Za.byTag.clear=p({method:"DELETE",url:b.api.resourceOverridesByTag,formName:"disableForm"});Za.byDate=p({method:"GET",url:b.api.resourceOverridesByDate,key:"resourceOverrides",
isArray:!0});var pd=x("ticketLayout"),qd=r("ticketLayout"),rd=x("analyticsService"),sd=r("analyticsService"),td=x("cancellationPolicy","cancellationPolicies"),$a=r("cancellationPolicy"),ud=x("cancellationRule"),vd=r("cancellationRule");$a.affiliations=p({method:"GET",isArray:!0,url:b.api.cancellationPolicyAffiliations,key:"affiliations"});$a.items=p({method:"GET",isArray:!0,url:b.api.cancellationPolicyItems,key:"items"});var wd=x("bookingRestriction"),ac=r("bookingRestriction");ac.items=p({method:"GET",
isArray:!0,url:b.api.bookingRestrictionItems,key:"items"});var bc=p({method:"GET",isArray:!0,url:b.api.persistentStore,key:"persistentStores"});bc.remove=p({method:"DELETE",url:b.api.persistentStore});var cc=p({method:"GET",url:b.api.persistentStoreForCompany,key:"persistentStore"});cc.remove=p({method:"DELETE",url:b.api.persistentStoreForCompany});var ab=p({method:"GET",url:b.api.persistentStoreItem,key:"value"});ab.update=p({method:"PUT",url:b.api.persistentStoreItem,key:"value",formName:"persistentStoreForm"});
ab.remove=p({method:"DELETE",url:b.api.persistentStoreItem});var xd=p({method:"GET",formName:"noForm",key:function(a){return _.keys(a.data)[0]}}),yd=p({method:"GET",url:b.api.version,key:"version"}),dc=function(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%2F/gi,"/").replace(/%20/g,b?"%20":"+")},ec=function(a,b){b=_.isBoolean(b)?b?"yes":"no":b;return dc(a,!0)+"="+dc(b,!0)},eb=function(a){var b=[];_.forEach(a,function(a,
c){_.isArray(a)?_.forEach(a,function(a){b.push(ec(c,a))}):b.push(ec(c,a))});return b.join("&")};return{CANCELLED:A,toKeyValue:eb,login:t,forgot:y,companies:J,company:s,users:W,user:V,groups:H,group:v,groupOverrides:O,groupOverride:E,contacts:Bb,contact:Ma,contactPayments:Zc,customManifests:ea,customManifest:fa,customCalendars:I,customCalendar:wa,customReports:xa,customReport:ia,items:R,item:M,flowNodes:X,flowNode:U,defaultFlowPage:function(){return g.get("flows").wrapEndpoint(ya,!0).apply(null,arguments)},
activities:Ta,activity:Tb,affiliates:ga,affiliate:ba,affiliateCards:Q,affiliateCardAffiliations:qa,partners:na,partner:bb,partnerCards:fc,partnerCardAffiliations:gc,agents:cb,agent:hc,desks:db,desk:ic,cannedMessages:Wc,cannedMessage:zb,customerPrototypes:Ka,customerPrototype:xb,customerTypes:wb,customerType:vb,checkinStatuses:Vc,checkinStatus:yb,customFields:Da,customField:ja,transportationOptions:mb,transportationOption:Ea,extendedOptions:nb,extendedOption:Fa,connectedCampaigns:ob,connectedCampaign:pb,
generatingCampaigns:qb,generatingCampaign:Ga,customFieldInstances:sb,customFieldInstance:Sc,customFieldInstanceConditions:Uc,customFieldInstanceCondition:Tc,customFieldInstanceGroups:rb,customFieldInstanceGroup:Ha,customerCustomFieldValue:Gb,bookingCustomFieldValue:Fb,availabilities:T,availability:Y,customerTypeRates:Ab,customerTypeRate:La,blocks:Xc,block:Yc,orders:Cb,order:Na,orderPayments:Oa,bookings:da,booking:P,customer:Db,customers:Eb,lineItems:Qa,lineItem:Ra,payments:la,disputes:Lb,refunds:Kb,
paymentFees:Jb,inStorePaymentTypes:bd,inStorePaymentType:cd,bankAccounts:S,bankAccount:K,cards:N,card:Z,cardAffiliations:aa,reports:ca,report:ha,campaigns:ib,campaign:sa,campaignValidityRules:jb,campaignValidityRule:kb,codes:lb,code:Aa,storedValueTypes:rc,storedValueType:sc,storedValueCards:Ba,storedValueCard:ta,storedValueAdjustments:tc,storedValueAdjustment:Ca,resellerCompanies:uc,resellerCompany:vc,resellerCompanyMappings:wc,resellerCompanyMapping:xc,resellerItems:yc,resellerItem:zc,resellerItemMappings:Ac,
resellerItemMapping:Bc,resellerCustomerTypes:Cc,resellerCustomerType:Dc,resellerCustomerTypeMappings:Ec,resellerCustomerTypeMapping:Fc,resellerOptions:Gc,resellerOption:Hc,resellerOptionMappings:Ic,resellerOptionMapping:Jc,resellerUnmappedItems:Kc,resellerUnmappedCustomerPrototypes:Lc,resellerKeys:Mc,resellerKey:Nc,resellerApps:Oc,resellerApp:Pc,resellerAppCompany:Rc,resellerAppCompanies:Qc,reorder:hd,refresh:function(a,b){h.assert(a,"db.refresh: expected uri");return xd(a,null,null,null,b)},slipstream:function(b,
c){c=c||{};if(window.slipstream&&window.slipstream[b]){var d=window.slipstream[b],e=c.doNotConvert||!1;return _.isObject(d)?(d=e?d:a.serverResponse(d),l(d,null,_.isArray(d))):d}},payouts:Mb,payout:Nb,transfers:Ob,transfer:dd,uploads:Pb,upload:ed,adjustments:Rb,adjustment:gd,transactions:Sb,funds:Qb,fund:fd,roles:tb,role:Ia,crewMembers:ub,crewMember:Ja,hotels:jc,hotel:kc,lodgings:fb,lodging:lc,pickups:gb,pickup:oc,routes:ra,route:hb,stops:pc,stop:qc,runs:za,preferredPickups:mc,preferredPickup:nc,testReport:L,
invoices:Pa,invoice:ka,totalSheets:Va,totalSheet:oa,invoiceSheets:Wa,invoiceSheet:pa,locations:id,location:Yb,waivers:Ub,waiver:Ua,connectedWaivers:Vb,connectedWaiver:Wb,waiverInstance:Xb,resources:Zb,resource:Ya,resourceUses:ua,requirementGroups:jd,requirementGroup:$b,requirements:kd,requirement:ld,resourceRequirements:md,resourceRequirement:nd,resourceUse:od,resourceOverride:va,resourceOverrides:Za,ticketLayouts:pd,ticketLayout:qd,analyticsServices:rd,analyticsService:sd,cancellationPolicies:td,
cancellationPolicy:$a,cancellationRules:ud,cancellationRule:vd,bookingRestrictions:wd,bookingRestriction:ac,persistentStore:bc,persistentStoreForCompany:cc,persistentStoreItem:ab,tagGroups:$c,tagGroup:ad,tags:Hb,tag:Sa,objectTags:Ib,version:yd,serverResponse:l,formErrorHandler:F,errorStatus:function(a){return 0===a&&!f?"disconnect":404===a?"not-found":403===a?"forbidden":"error"},pusher:Xa,searchEndpoint:function(a,b){return function(c){return a(b,null,null,{q:c})}}}}])})();
angular.module("clientOptions",["clientOptions.services"]);
(function(){var n=angular.module("clientOptions.services",["db","lib","navigation"]);n.factory("clientOptions",["$rootScope","$sniffer","auth","db","events","models","navigation","storage","urls",function(c,g,k,e,d,m,a,n,h){h=/^(?:https?:\/\/)?(?:[a-z0-9\-_]+\.[a-z0-9\-_]+)+.*/i;var b=[{query:"u",key:"userIdentifier",reflect:!n.isPersistent(),reflectExternal:function(){return k.currentUser.isAuthenticated?!1:!0}},{query:"asn",key:"asnAffiliateCompany",reflect:!0},{query:"asn-ref",key:"asnVoucherNumber",
reflect:!0},{query:"sheet",key:"defaultTotalSheetPk",reflect:!0,type:"int"},{query:"full-items",key:"isFullItemsEnabled",reflect:!0,type:"yes-no"},{query:"kiosk",key:"isKioskModeEnabled",isSlipstream:!0,type:"yes-no"},{query:"ref",key:"onlineBookingReference",reflect:!0},{query:"referrer",key:"referrerUrl",pattern:h},{query:"back",key:"backUrl",pattern:h,decode:!0},{query:"preview"},{query:"site-tags",key:"trackingSiteTags",onlyIfDefined:!0,decode:!0},{query:"page-tags",key:"trackingPageTags",onlyIfDefined:!0,
decode:!0},{query:"button-tags",key:"trackingButtonTags",onlyIfDefined:!0,decode:!0},{query:"from-ssl",key:"trackingIsFromSsl",type:"yes-no",onlyIfDefined:!0},{query:"from-embed",key:"trackingFromEmbed",onlyIfDefined:!0},{query:m.FlowNode.FLOW_QUERY,key:"flowNode",reflect:!0,isUpdatedOnLocationChange:!0,isAuthenticatedAllowed:!0},{query:m.FlowNode.IS_SUGGESTED_QUERY,key:"isInSuggestedItems",reflect:!0,type:"yes-no",isUpdatedOnLocationChange:!0}],f=_.filter(b,"isUpdatedOnLocationChange"),A=function(a){a=
a||_.always;var c={};_.forEach(b,function(b){if(a(b)&&b.key){var d=z[b.key];_.isUndefined(d)||("yes-no"===b.type?d&&(c[b.query]="yes"):"int"===b.type?_.isFinite(d)&&(c[b.query]=d):d&&(c[b.query]=d))}});return c},w=function(){return A(function(a){return!!a.reflect})},u=function(){var a=A(function(a){return _.isFunction(a.reflectExternal)?a.reflectExternal():!!a.reflectExternal});return _.mapKeys(a,function(a,b){return"fh-"+b})};c.$on("$locationChangeSuccess",function(){_.forEach(f,l);var b=w();_.forEach(b,
function(b,c){a.set(c,b,!0)})});d.on(c,"navigation.company.updated",function(){a.currentCompany&&(z.asnCharterCompany?z.asnCharterCompany!==a.currentCompany.shortname&&(z.asnCharterCompany="",z.asnAffiliateCompany="",z.asnVoucherNumber=""):z.asnCharterCompany=a.currentCompany.shortname)});c=e.slipstream("domain");var C=e.slipstream("protocol")+"://"+c,z={reflect:function(c){var d=_.find(b,"key",c).query;a.set(d,z[c],!0)},extendUrl:function(b){return a.compose(b,A(),!0)},reflectUrl:function(b){var c;
if("/"===b.charAt(0)||0===b.indexOf(C))c=w();else if(0===b.indexOf("http"))c=u();else return b;return a.compose(b,c,!0)},reflectUrlsInHrefs:function(a){a.on("mousedown","a",function(){var a=$(this);a.attr("href",z.reflectUrl(a.attr("href")))})}},l=function(b){var c=a.get(b.query)||"";!c&&b.isSlipstream&&(c=e.slipstream(b.query)||"");k.currentUser.isAuthenticated&&!b.isAuthenticatedAllowed&&(c="");b.pattern&&!b.pattern.test(c)&&(c="");if(!b.onlyIfDefined||c)"int"===b.type?(c=parseInt(c,10),c=isNaN(c)?
null:c):"yes-no"===b.type&&(c="yes"===c),g.history&&!b.isUpdatedOnLocationChange&&a.clear(b.query,!0),b.decode&&(c=decodeURIComponent(c)),b.key&&(z[b.key]=c)};_.forEach(b,l);k.currentUser.isAuthenticated||(z.asnAffiliateCompany=z.asnAffiliateCompany||e.slipstream("asnAffiliateCompany")||"");z.asnAffiliateCompany||(z.asnAffiliateCompany="",z.asnVoucherNumber="");return z}]);n.run(["$rootScope","clientOptions",function(c,g){c.clientOptions=g}])})();
(function(){angular.module("flash",["flash.services"]);angular.module("flash.services",[]).factory("flash",[function(){return{debug:_.ignore,info:_.ignore,warn:_.ignore,error:_.ignore,success:_.ignore}}])})();angular.module("lightframe",["lightframe.services"]);
(function(){var n=angular.module("lightframe.services",[]);n.factory("lightframe",["$browser","$sniffer","$window","clientOptions","navigation","xmessage",function(c,g,k,e,d,m){c="";var a=!1,n=!1,h=null,b={};g=function(a){try{a=decodeURIComponent(a),b=JSON.parse(a)||{},h=b.parentUrl||null}catch(c){}};/^fareharbor-embed:/.test(k.name)?(g(window.name.substr(17)),c=b.embedId||"",a=b.isLightframed||!1):/^fareharbor-lightframe/.test(k.name)&&(g(window.name.substr(22)),n=!0);var f={embedId:c,isLightframe:function(){return k.top!==
k&&n},isEmbed:function(){return k.top!==k&&f.embedId},isLightframed:function(){return f.isEmbed()&&a},parentUrl:function(){return h},isParentInsecure:function(){return!1},broadcast:function(a,b){b=_.extend({embedId:f.embedId},b);m.broadcast(a,b)},updateHeight:function(a){f.isEmbed()&&a&&f.broadcast("fareharbor.height",{height:a})},open:function(a){a=e.extendUrl(a);f.isEmbed()?f.broadcast("fareharbor.open",{url:a}):k.top.location.href=k.location.protocol+"//"+k.location.hostname+(k.location.port?":"+
k.location.port:"")+a},close:function(){f.broadcast("fareharbor.close")},ready:function(){f.broadcast("fareharbor.ready")},isDirectAccess:function(){return k.top===k},listenForTouch:function(){var a=function(){f.broadcast("fareharbor.touchDetected")};window.addEventListener("touchstart",function u(){a();window.removeEventListener("touchstart",u)},!1);window.addEventListener("pointerdown",function C(b){"touch"==b.pointerType&&(a(),window.removeEventListener("pointerdown",C))},!1)}};return f}]);n.run(["$rootScope",
"lightframe",function(c,g){c.lightframe=g;c.isLightframe=g.isLightframe();g.ready();g.listenForTouch()}])})();(function(){angular.module("tracking",[]).factory("analytics",[function(){return{trackView:_.ignore}}])})();angular.module("urls",["urls.services"]);
(function(){var n=angular.module("urls.services",["lib.services"]);n.factory("urls",["models","require",function(c,g){var k={},e=function(a,c){var d=a,b,e,g;for(g in c)if(c.hasOwnProperty(g)){var m=c[g];g&&void 0!==m&&(e=":"+g+"(?:\\([^\\)/]+\\))?",(b=k[e])||(b=k[e]=RegExp(e)),d=d.replace(b,m))}if(-1===d.indexOf(":"))return d},d={Company:function(a){return{shortname:a.shortname,canonical:{company:"company.index",dashboard:"dashboard.index"}}},Hotel:function(a){return{shortname:a.company.shortname,
hotelPk:a.pk}},Lodging:function(a){return{shortname:a.company.shortname,lodgingPk:a.pk}},PreferredPickup:function(a){return{shortname:a.company.shortname,lodgingPk:a.lodging.pk,preferredPickupPk:a.pk}},Route:function(a){return{shortname:a.company.shortname,routePk:a.pk,canonical:{dashboard:"dashboard.settings.routes.route"}}},Run:function(a){return{shortname:a.company.shortname,routePk:a.route.pk,runPk:a.run.pk}},Stop:function(a){return{shortname:a.company.shortname,routePk:a.route.pk,stopPk:a.pk}},
Pickup:function(a){return{shortname:a.company.shortname,pickupPk:a.pk}},User:function(a){return{username:a.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.index"}}},CustomManifest:function(a){return{customManifestPk:a.pk,shortname:a.company.shortname}},CustomCalendar:function(a){return{customCalendarPk:a.pk,shortname:a.company.shortname}},CustomReport:function(a){return{customReportPk:a.pk,shortname:a.company.shortname}},Image:function(a){return{imagePk:a.pk,
itemPk:a.item?a.item.pk:void 0,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.index"}}},Resource:function(a){return{resourcePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.resources.resource.index"}}},ResourceOverride:function(a){return{resourceOverridePk:a.pk,resourcePk:a.resource.pk,shortname:a.resource.company.shortname,canonical:{dashboard:"dashboard.resources.resource.uses.index"}}},TagGroup:function(a){return{tagGroupPk:a.pk,shortname:a.company.shortname}},
Tag:function(a){return{tagPk:a.pk,tagGroupPk:a.tagGroup.pk,shortname:a.tagGroup.company.shortname}},Item:function(a){return{itemPk:a.pk,shortname:a.company.shortname,canonical:{company:"company.item.index",dashboard:"dashboard.items.item.index"}}},FlowNode:function(a){return{flowNodePk:a.pk,shortname:a.company.shortname,canonical:{company:"company.flowNode.index",dashboard:"dashboard.settings.flows.flowNode.index"}}},CustomerPrototype:function(a){return{customerPrototypePk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.items.item.prices.customerTypes"}}},Availability:function(a){return{availabilityPk:a.pk,itemPk:a.item.pk,shortname:a.item.company.shortname,date:a.startAt?a.startAt.format("YYYY-MM-DD"):void 0,canonical:{company:"company.item.availability",dashboard:"dashboard.overlay.availability.index"}}},Block:function(a){return{blockPk:a.pk,shortname:a.company.shortname}},Contact:function(a){return{contactPk:a.pk,shortname:a.company.shortname}},Order:function(a){return{contactPk:a.contact.pk,
orderUuid:a.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.order"}}},Booking:function(a){return{bookingUuid:a.uuid,itemPk:a.item.pk,contactPk:a.contact.pk,shortname:a.company.shortname,affiliateShortname:a.affiliation?a.affiliation.affiliateCompany.shortname:void 0,canonical:{company:"company.item.booking",dashboard:"dashboard.overlay.contact.booking"}}},Campaign:function(a){return{campaignPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.index"}}},
CampaignValidityRule:function(a){return{campaignValidityRulePk:a.pk,campaignPk:a.campaign.pk,shortname:a.campaign.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.settings"}}},Code:function(a){return{codePk:a.pk,campaignPk:a.campaign.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.campaigns.campaign.code"}}},StoredValueType:function(a){return{storedValueTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueType"}}},
StoredValueCard:function(a){return{storedValueCardPk:a.pk,storedValueCardNumber:a.number,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.index"}}},StoredValueAdjustment:function(a){return{storedValueAdjustmentPk:a.pk,storedValueCardPk:a.storedValueCard.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.storedValue.storedValueCard.storedValueAdjustment"}}},Customer:function(a){return{customerPk:a.pk,bookingUuid:a.booking.uuid,
shortname:a.company.shortname}},CheckinStatus:function(a){return{checkinStatusPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.checkinStatuses"}}},CustomerType:function(a){return{customerTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customerTypes.customerType"}}},CustomerTypeRate:function(a){return{customerTypeRatePk:a.pk,shortname:a.company.shortname}},CannedMessage:function(a){return{cannedMessagePk:a.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.cannedMessages.cannedMessage"}}},InStorePaymentType:function(a){return{inStorePaymentTypePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.inStorePaymentTypes"}}},BankAccount:function(a){return{bankAccountPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.payments.bankAccounts"}}},Card:function(a){return{cardPk:a.pk,shortname:a.company.shortname}},CardAffiliation:function(a){return{cardAffiliationPk:a.pk,
shortname:a.company.shortname}},Payment:function(a){return{paymentPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Refund:function(a){return{refundPk:a.pk}},LegacyTransfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname}},LegacyTransaction:function(a){return{transactionPk:a.pk}},Account:function(a){return{accountPk:a.pk,shortname:a.company.shortname}},Payout:function(a){return{payoutPk:a.pk,
shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.payouts.payout"}}},Transfer:function(a){return{transferPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.transfer"}}},Upload:function(a){return{uploadPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.accounts.upload"}}},Adjustment:function(a){return{adjustmentPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.reports.transactions.adjustment"}}},
Transaction:function(a){return{transactionPk:a.pk,shortname:c.Company.ADMIN_SHORTNAME}},LineItem:function(a){return{lineItemPk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Agent:function(a){return{agentPk:a.pk,shortname:a.company.shortname}},Desk:function(a){return{deskPk:a.pk,shortname:a.company.shortname}},Role:function(a){return{rolePk:a.pk,shortname:a.company.shortname}},
CrewMember:function(a){return{crewMemberPk:a.pk,availabilityPk:a.availability.pk,itemPk:a.availability.item.pk,shortname:a.company.shortname}},CustomField:function(a){return{customFieldPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},TransportationOption:function(a){return{transportationOptionPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ExtendedOption:function(a){return{extendedOptionPk:a.pk,
customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedCampaign:function(a){return{connectedCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},ConnectedWaiver:function(a){return{connectedWaiverPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},
GeneratingCampaign:function(a){return{generatingCampaignPk:a.pk,customFieldPk:a.customField.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.customFields.customField"}}},CustomFieldInstance:function(a){return{customFieldInstancePk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.index"}}},CustomFieldInstanceCondition:function(a){return{customFieldInstanceConditionPk:a.pk,customFieldInstancePk:a.customFieldInstance.pk,itemPk:a.customFieldInstance.item.pk,
shortname:a.customFieldInstance.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.index"}}},CustomFieldInstanceGroup:function(a){return{customFieldInstanceGroupPk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.fieldGroups"}}},RequirementGroup:function(a){return{requirementGroupPk:a.pk,itemPk:a.item.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},Requirement:function(a){return{requirementPk:a.pk,
requirementGroupPk:a.requirementGroup.pk,itemPk:a.requirementGroup.item.pk,shortname:a.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerPrototypeRequirement:function(a){return{customerPrototypeRequirementPk:a.pk,requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.item.pk,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},
ResourceRequirement:function(a){return{resourceRequirementPk:a.pk,requirementPk:a.requirement.pk,requirementGroupPk:a.requirement.requirementGroup.pk,itemPk:a.requirement.requirementGroup.item.pk,shortname:a.requirement.requirementGroup.company.shortname,canonical:{dashboard:"dashboard.items.item.prices.resources"}}},CustomerCustomFieldValue:function(a){return{customerCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},
BookingCustomFieldValue:function(a){return{bookingCustomFieldValuePk:a.pk,contactPk:a.booking.contact.pk,bookingUuid:a.booking.uuid,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Group:function(a){return{groupPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.group"}}},GroupOverride:function(a){return{groupOverridePk:a.pk,shortname:a.company.shortname}},ResourceUse:function(a){return{resourceUsePk:a.pk,customerPk:a.customer.pk,
contactPk:a.booking.contact.pk,bookingUuid:a.customer.booking.uuid,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Affiliation:function(a){return{affiliationPk:a.pk,shortname:a.company.shortname,partnerShortname:a.affiliateCompany.shortname}},Activity:function(a){return{activityPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.overlay.activity.index"}}},Notification:function(a){return{notificationPk:a.pk,shortname:a.company.shortname,contactPk:a.booking?a.booking.contact.pk:
void 0,bookingUuid:a.booking?a.booking.uuid:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},SmsNotification:function(a){return{smsNotificationPk:a.pk,shortname:a.company.shortname,contactPk:a.booking?a.booking.contact.pk:void 0,bookingUuid:a.booking?a.booking.uuid:void 0,canonical:{dashboard:"dashboard.overlay.contact.booking"}}},Subscription:function(a){return{subscriptionPk:a.pk,shortname:a.company.shortname}},Invoice:function(a){return{invoicePk:a.pk,invoiceUuid:a.uuid,shortname:a.company.shortname,
affiliateShortname:a.affiliation?a.affiliation.affiliateCompany.shortname:void 0}},InvoiceEntry:function(a){return{invoiceEntryPk:a.pk,invoicePk:a.invoice.pk,shortname:a.company.shortname}},Report:function(a){return{reportPk:a.pk,shortname:a.company.shortname,modelSlug:a.type===c.Report.ADVANCED_TYPE?c.Report.MODELS[a.options.modelName].slug:void 0,canonical:{dashboard:"dashboard.reports.advanced.permalink"}}},ViatorMapping:function(a){return{viatorMappingPk:a.pk,shortname:a.company.shortname,itemPk:a.item.pk}},
Waiver:function(a){return{waiverPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.waivers.waiver.index"}}},WaiverInstance:function(a){return{waiverPk:a.waiver.pk,waiverInstancePk:a.waiverInstance.pk,shortname:a.company.shortname}},TotalSheet:function(a){return{totalSheetPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.totalSheet"}}},InvoiceSheet:function(a){return{invoiceSheetPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.pricing.invoiceSheet"}}},
Location:function(a){return{locationPk:a.pk,shortname:a.company.shortname}},ResellerCompany:function(a){return{resellerCompanyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerCompanyMapping:function(a){return{resellerCompanyMappingPk:a.pk,resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.company.index"}}},ResellerItem:function(a){return{resellerItemPk:a.pk,
resellerCompanyPk:a.resellerCompany.pk,shortname:a.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerItemMapping:function(a){return{resellerItemMappingPk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.item.index"}}},ResellerCustomerType:function(a){return{resellerCustomerTypePk:a.pk,resellerItemPk:a.resellerItem.pk,
resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},ResellerCustomerTypeMapping:function(a){return{resellerCustomerTypeMappingPk:a.pk,resellerCustomerTypePk:a.resellerCustomerType.pk,resellerItemPk:a.resellerCustomerType.resellerItem.pk,resellerCompanyPk:a.resellerCustomerType.resellerItem.resellerCompany.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.customerType.index"}}},
ResellerOption:function(a){return{resellerOptionPk:a.pk,resellerItemPk:a.resellerItem.pk,resellerCompanyPk:a.resellerItem.resellerCompany.pk,shortname:a.resellerItem.resellerCompany.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerOptionMapping:function(a){return{resellerOptionMappingPk:a.pk,resellerOptionPk:a.resellerOption.pk,resellerItemPk:a.resellerOption.resellerItem.pk,resellerCompanyPk:a.resellerOption.resellerItem.resellerCompany.pk,shortname:a.company.shortname,
canonical:{dashboard:"dashboard.settings.reseller.option.index"}}},ResellerKey:function(a){return{resellerKeyPk:a.pk,username:a.user.username,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.permissions.user.apiKeys.apiKey"}}},ResellerApp:function(a){return{resellerAppPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.reseller.apps.app.index"}}},ResellerAppCompany:function(a){return{resellerAppCompanyPk:a.pk,resellerAppPk:a.resellerApp.pk,shortname:a.resellerApp.company.shortname}},
AnalyticsService:function(a){return{analyticsServicePk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.analyticsServices.analyticsService"}}},CancellationPolicy:function(a){return{cancellationPolicyPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},CancellationRule:function(a){return{cancellationPolicyPk:a.cancellationPolicy.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.cancellationPolicy.index"}}},
BookingRestriction:function(a){return{bookingRestrictionPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.bookingRestrictions.bookingRestriction"}}},TicketLayout:function(a){return{ticketLayoutPk:a.pk,shortname:a.company.shortname,canonical:{dashboard:"dashboard.settings.ticketLayouts.index"}}}},m={populate:e,populateForObject:function(a){a=a||"";var c;if(this.$urls){if(c=this.$urls[a])return c}else this.$urls={},this.$params=m.extract(this);if(a)c=e(a,this.$params);else{if(!this.$params.canonical)return"";
c=this.$params.canonical.dashboard||this.$params.canonical.company;if(!c)return"";c=e(_.getDotted(m,c),this.$params)}return this.$urls[a]=c},extract:function(a){g.assert(a,"urls: unable to extract from object",a);g.defined(d,a.cls,"urls: unable to extract cls",a);return d[a.cls](a)},calendarUrls:function(a){return{index:a,month:a+":year/:month/",day:a+":year/:month/:day/",agenda:a+":year/:month/:day/",grid:a+":year/:month/:day/",timeline:a+":year/:month/:day/"}},dayUrlForCompany:function(a,d){return e(a.features.isDayViewEnabled?
m.dashboard.bookings.day.date:m.dashboard.bookings.timeline.date+"?timeline-type="+c.Company.AVAILABILITY_TIMELINE,{shortname:a.shortname,date:d.format("YYYY-MM-DD")})},legacyManifest:"/:shortname/manifest/",company:{index:"/:shortname/",login:"/:shortname/login/",about:"/:shortname/about/",faq:"/:shortname/faq/",policies:"/:shortname/policies/",items:{index:"/:shortname/items/",calendar:"/:shortname/items/calendar/"},item:{index:"/:shortname/items/:itemPk(pk)/",calendar:"/:shortname/items/:itemPk(pk)/calendar/",
month:"/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/:shortname/items/:itemPk(pk)/date/:date/",availability:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",booking:"/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},storedValueCard:{index:"/:shortname/gift-cards/:storedValueCardNumber/"},cart:{index:"/:shortname/cart/",permalink:"/:shortname/cart/?u=:cartUuid"},order:{index:"/:shortname/orders/:orderUuid/"},
invoice:{index:"/:shortname/invoices/:invoiceUuid/"},flowNode:{index:"/:shortname/items/?flow=:flowNodePk",calendar:"/:shortname/items/calendar/?flow=:flowNodePk"}},dashboard:{index:"/:shortname/dashboard/",overlay:{index:"/:shortname/dashboard/@overlay=/",item:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/",date:"/:shortname/dashboard/@overlay=/items/:itemPk/date/:date/"},availability:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/",bookings:{index:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/",
cancelled:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/bookings/cancelled/"},message:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/message/",settings:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/settings/",prices:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/prices/",integrations:"/:shortname/dashboard/@overlay=/items/:itemPk/availabilities/:availabilityPk/integrations/"},
contact:{index:"/:shortname/dashboard/@overlay=/contacts/:contactPk/",booking:"/:shortname/dashboard/@overlay=/contacts/:contactPk/bookings/:bookingUuid/",order:"/:shortname/dashboard/@overlay=/contacts/:contactPk/orders/:orderUuid/"},deprecatedBooking:{index:"/:shortname/dashboard/@overlay=/bookings/:bookingUuid/"},activity:{index:"/:shortname/dashboard/@overlay=/activities/:activityPk/"},close:"/:shortname/dashboard/@overlay"},admin:{index:"/:shortname/dashboard/admin/"},manifest:{index:"/:shortname/dashboard/manifest/",
date:"/:shortname/dashboard/manifest/date/:date/",bookings:"/:shortname/dashboard/manifest/date/:date/bookings/",availabilities:"/:shortname/dashboard/manifest/date/:date/availabilities/",items:"/:shortname/dashboard/manifest/date/:date/items/",runs:"/:shortname/dashboard/manifest/date/:date/runs/",resources:"/:shortname/dashboard/manifest/date/:date/resources/"},bookings:{index:"/:shortname/dashboard/bookings/",calendar:"/:shortname/dashboard/bookings/calendar/",day:{index:"/:shortname/dashboard/bookings/day/",
date:"/:shortname/dashboard/bookings/day/:date/"},grid:{index:"/:shortname/dashboard/bookings/grid/",date:"/:shortname/dashboard/bookings/grid/:date/"},timeline:{index:"/:shortname/dashboard/bookings/timeline/",date:"/:shortname/dashboard/bookings/timeline/:date/"},agenda:{index:"/:shortname/dashboard/bookings/agenda/",date:"/:shortname/dashboard/bookings/agenda/:date/"},booking:{deprecatedPermalink:"/:shortname/dashboard/bookings/:bookingUuid/view/",deprecatedAffiliatePermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/:bookingUuid/"},
contact:{index:"/:shortname/dashboard/bookings/contacts/:contactPk/",order:"/:shortname/dashboard/bookings/contacts/:contactPk/orders/:orderUuid/view/",booking:"/:shortname/dashboard/bookings/contacts/:contactPk/bookings/:bookingUuid/view/",affiliateContactPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/",affiliateBookingPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/bookings/:bookingUuid/",affiliateOrderPermalink:"/:affiliateShortname/dashboard/bookings/network/:shortname/contacts/:contactPk/orders/:orderUuid/"}},
reports:{index:"/:shortname/dashboard/reports/",type:"/:shortname/dashboard/reports/:type/",invoices:{index:"/:shortname/dashboard/reports/invoices/",create:{index:"/:shortname/dashboard/reports/invoices/create/",permalink:"/:shortname/dashboard/reports/invoices/create/report/:reportPk/"},permalink:"/:shortname/dashboard/reports/invoices/report/:reportPk/",invoice:{index:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/",multi:"/:shortname/dashboard/reports/invoices/invoices/:invoicePks(pks)/",
notification:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/notification/",upload:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/upload/",receiveSignUp:"/:shortname/dashboard/reports/invoices/invoice/:invoicePk/receive-sign-up/"},partnerInvoice:{index:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/",notification:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/notification/",upload:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/upload/",
receiveSignUp:"/:affiliateShortname/dashboard/reports/invoices/partner-invoice/:invoicePk/receive-sign-up/"}},test:{index:"/:shortname/dashboard/reports/test/",permalink:"/:shortname/dashboard/reports/test/report/:reportPk/"},reports:{index:"/:shortname/dashboard/reports/reports/"},accounts:{index:"/:shortname/dashboard/reports/accounts/",permalink:"/:shortname/dashboard/reports/accounts/report/:reportPk/",transfer:"/:shortname/dashboard/reports/accounts/transfer/:transferPk/",upload:"/:shortname/dashboard/reports/accounts/upload/:uploadPk/"},
customersRedirect:{index:"/:shortname/dashboard/reports/customers/"},contacts:{index:"/:shortname/dashboard/reports/contacts/",permalink:"/:shortname/dashboard/reports/contacts/report/:reportPk/"},bookings:{index:"/:shortname/dashboard/reports/bookings/",permalink:"/:shortname/dashboard/reports/bookings/report/:reportPk/"},companies:{index:"/:shortname/dashboard/reports/companies/",permalink:"/:shortname/dashboard/reports/companies/report/:reportPk/"},payments:{index:"/:shortname/dashboard/reports/payments/",
permalink:"/:shortname/dashboard/reports/payments/report/:reportPk/"},disputes:{index:"/:shortname/dashboard/reports/disputes/",permalink:"/:shortname/dashboard/reports/disputes/report/:reportPk/"},lineItems:{index:"/:shortname/dashboard/reports/line-items/",permalink:"/:shortname/dashboard/reports/line-items/report/:reportPk/"},payouts:{index:"/:shortname/dashboard/reports/payouts/",permalink:"/:shortname/dashboard/reports/payouts/report/:reportPk/",payout:"/:shortname/dashboard/reports/payouts/payout/:payoutPk/"},
escrow:{index:"/:shortname/dashboard/reports/to-be-paid/",permalink:"/:shortname/dashboard/reports/to-be-paid/report/:reportPk/"},volume:{index:"/:shortname/dashboard/reports/volume/",permalink:"/:shortname/dashboard/reports/volume/report/:reportPk/"},transactions:{index:"/:shortname/dashboard/reports/transactions/",permalink:"/:shortname/dashboard/reports/transactions/report/:reportPk/",adjustment:"/:shortname/dashboard/reports/transactions/:adjustmentPk/"},bookingTypesSummary:{index:"/:shortname/dashboard/reports/booking-types-summary/",
permalink:"/:shortname/dashboard/reports/booking-types-summary/report/:reportPk/"},crewSummary:{index:"/:shortname/dashboard/reports/crew-summary/",permalink:"/:shortname/dashboard/reports/crew-summary/report/:reportPk/"},customerTypesSummary:{index:"/:shortname/dashboard/reports/customer-types-summary/",permalink:"/:shortname/dashboard/reports/customer-types-summary/report/:reportPk/"},customFieldSummary:{index:"/:shortname/dashboard/reports/custom-field-summary/",permalink:"/:shortname/dashboard/reports/custom-field-summary/report/:reportPk/"},
itemsSummary:{index:"/:shortname/dashboard/reports/items-summary/",permalink:"/:shortname/dashboard/reports/items-summary/report/:reportPk/"},lodgingsSummary:{index:"/:shortname/dashboard/reports/lodging-summary/",permalink:"/:shortname/dashboard/reports/lodging-summary/report/:reportPk/"},pickupsSummary:{index:"/:shortname/dashboard/reports/pickups-summary/",permalink:"/:shortname/dashboard/reports/pickups-summary/report/:reportPk/"},usersSummary:{index:"/:shortname/dashboard/reports/users-summary/",
permalink:"/:shortname/dashboard/reports/users-summary/report/:reportPk/"},agentsSummary:{index:"/:shortname/dashboard/reports/agents-summary/",permalink:"/:shortname/dashboard/reports/agents-summary/report/:reportPk/"},desksSummary:{index:"/:shortname/dashboard/reports/desks-summary/",permalink:"/:shortname/dashboard/reports/desks-summary/report/:reportPk/"},campaignsSummary:{index:"/:shortname/dashboard/reports/campaigns-summary/",permalink:"/:shortname/dashboard/reports/campaigns-summary/report/:reportPk/"},
revenueSummary:{index:"/:shortname/dashboard/reports/revenue-summary/",permalink:"/:shortname/dashboard/reports/revenue-summary/report/:reportPk/"},advanced:{redirect:"/:shortname/dashboard/reports/advanced/",index:"/:shortname/dashboard/reports/advanced/:modelSlug/",permalink:"/:shortname/dashboard/reports/advanced/:modelSlug/:reportPk/"}},items:{index:"/:shortname/dashboard/items/",grid:"/:shortname/dashboard/items/grid/",list:"/:shortname/dashboard/items/list/",item:{index:"/:shortname/dashboard/items/:itemPk/",
activity:"/:shortname/dashboard/items/:itemPk/activity/",calendar:"/:shortname/dashboard/items/:itemPk/calendar/",prices:{index:"/:shortname/dashboard/items/:itemPk/prices/",customerTypes:"/:shortname/dashboard/items/:itemPk/prices/customer-types/",fieldGroups:"/:shortname/dashboard/items/:itemPk/prices/field-groups/",resources:"/:shortname/dashboard/items/:itemPk/prices/resources/"},embeds:"/:shortname/dashboard/items/:itemPk/embeds/",onlineBooking:"/:shortname/dashboard/items/:itemPk/online-booking/",
suggestedItems:"/:shortname/dashboard/items/:itemPk/suggested-items/",info:{index:"/:shortname/dashboard/items/:itemPk/info/",notes:"/:shortname/dashboard/items/:itemPk/info/notes/",basic:"/:shortname/dashboard/items/:itemPk/info/basic/",photos:"/:shortname/dashboard/items/:itemPk/info/photos/",advanced:"/:shortname/dashboard/items/:itemPk/info/advanced/",tags:"/:shortname/dashboard/items/:itemPk/info/tags/"},notifications:{index:"/:shortname/dashboard/items/:itemPk/notifications/",internal:"/:shortname/dashboard/items/:itemPk/notifications/internal/",
external:"/:shortname/dashboard/items/:itemPk/notifications/external/"},integrations:{index:"/:shortname/dashboard/items/:itemPk/integrations/",subscribe:"/:shortname/dashboard/items/:itemPk/integrations/subscribe/",reviewExpress:"/:shortname/dashboard/items/:itemPk/integrations/review-express/",viator:"/:shortname/dashboard/items/:itemPk/integrations/viator/",picthrive:"/:shortname/dashboard/items/:itemPk/integrations/picthrive/"}}},resources:{index:"/:shortname/dashboard/resources/",resource:{index:"/:shortname/dashboard/resources/:resourcePk/",
settings:"/:shortname/dashboard/resources/:resourcePk/settings/",uses:{index:"/:shortname/dashboard/resources/:resourcePk/uses/",overview:"/:shortname/dashboard/resources/:resourcePk/uses/overview/",day:"/:shortname/dashboard/resources/:resourcePk/uses/date/:date/"}}},settings:{index:"/:shortname/dashboard/settings/",actions:"/:shortname/dashboard/settings/actions/",advanced:"/:shortname/dashboard/settings/advanced/",payments:{index:"/:shortname/dashboard/settings/payments/",cards:{index:"/:shortname/dashboard/settings/payments/cards/",
card:{index:"/:shortname/dashboard/settings/payments/cards/:cardPk/",settings:"/:shortname/dashboard/settings/payments/cards/:cardPk/settings/"}},inStorePaymentTypes:"/:shortname/dashboard/settings/payments/payment-types/",bankAccounts:"/:shortname/dashboard/settings/payments/bank-accounts/"},profile:{index:"/:shortname/dashboard/settings/profile/",style:"/:shortname/dashboard/settings/profile/style/",slideshow:"/:shortname/dashboard/settings/profile/slideshow/",pages:"/:shortname/dashboard/settings/profile/pages/"},
info:{index:"/:shortname/dashboard/settings/info/",notesAndPolicies:"/:shortname/dashboard/settings/info/notes/",contact:"/:shortname/dashboard/settings/info/contact/",socialMedia:"/:shortname/dashboard/settings/info/social-media/",advanced:"/:shortname/dashboard/settings/info/advanced/",tags:"/:shortname/dashboard/settings/info/tags/"},cancellationPolicies:"/:shortname/dashboard/settings/cancellation-policies/",cancellationPolicy:{index:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/",
settings:"/:shortname/dashboard/settings/cancellation-policies/:cancellationPolicyPk/settings/"},tagGroups:{index:"/:shortname/dashboard/settings/tag-groups/",tagGroup:{index:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/",settings:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/settings/",tag:"/:shortname/dashboard/settings/tag-groups/:tagGroupPk/tags/:tagPk/"}},permissions:{index:"/:shortname/dashboard/settings/permissions/",groups:"/:shortname/dashboard/settings/permissions/groups/",
group:"/:shortname/dashboard/settings/permissions/groups/:groupPk/",groupOverrides:"/:shortname/dashboard/settings/permissions/outside-users/",groupOverride:"/:shortname/dashboard/settings/permissions/outside-users/:groupOverridePk/",users:"/:shortname/dashboard/settings/permissions/users/",user:{index:"/:shortname/dashboard/settings/permissions/users/:username/",settings:"/:shortname/dashboard/settings/permissions/users/:username/settings/",apiKeys:{index:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/",
apiKey:"/:shortname/dashboard/settings/permissions/users/:username/api-keys/:resellerKeyPk/"}}},agents:{index:"/:shortname/dashboard/settings/agents/",agent:"/:shortname/dashboard/settings/agents/:agentPk/"},desks:{index:"/:shortname/dashboard/settings/desks/",desk:"/:shortname/dashboard/settings/desks/:deskPk/"},campaigns:{index:"/:shortname/dashboard/settings/campaigns/",campaign:{index:"/:shortname/dashboard/settings/campaigns/:campaignPk/",settings:"/:shortname/dashboard/settings/campaigns/:campaignPk/settings/",
code:"/:shortname/dashboard/settings/campaigns/:campaignPk/codes/:codePk/"}},checkinStatuses:"/:shortname/dashboard/settings/check-in/",customerTypes:{index:"/:shortname/dashboard/settings/customer-types/",customerType:"/:shortname/dashboard/settings/customer-types/:customerTypePk/"},customFields:{index:"/:shortname/dashboard/settings/custom-fields/",type:"/:shortname/dashboard/settings/custom-fields/type/:type/",customField:"/:shortname/dashboard/settings/custom-fields/:customFieldPk(pk)/"},cannedMessages:{index:"/:shortname/dashboard/settings/canned-messages/",
cannedMessage:"/:shortname/dashboard/settings/canned-messages/:cannedMessagePk/"},network:{index:"/:shortname/dashboard/settings/network/",affiliates:{index:"/:shortname/dashboard/settings/network/affiliates/",affiliate:{index:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/",cards:"/:shortname/dashboard/settings/network/affiliates/:affiliationPk/cards/"}},partners:{index:"/:shortname/dashboard/settings/network/partners/",partner:{index:"/:partnerShortname/dashboard/settings/network/partners/:affiliationPk/",
cards:"/:partnerShortname/dashboard/settings/network/partners/:affiliationPk/cards/"}}},hotels:{index:"/:shortname/dashboard/settings/hotels/",hotel:"/:shortname/dashboard/settings/hotels/:hotelPk/"},lodgings:{index:"/:shortname/dashboard/settings/lodgings/",lodging:"/:shortname/dashboard/settings/lodgings/:lodgingPk/"},pickups:{index:"/:shortname/dashboard/settings/pickups/",pickup:"/:shortname/dashboard/settings/pickups/:pickupPk/"},routes:{index:"/:shortname/dashboard/settings/routes/",route:"/:shortname/dashboard/settings/routes/:routePk/"},
pricing:{index:"/:shortname/dashboard/settings/pricing/",sheets:"/:shortname/dashboard/settings/pricing/sheets/",totalSheet:"/:shortname/dashboard/settings/pricing/total-sheets/:totalSheetPk/",invoiceSheet:"/:shortname/dashboard/settings/pricing/invoice-sheets/:invoiceSheetPk/",overview:"/:shortname/dashboard/settings/pricing/overview/"},activity:"/:shortname/dashboard/settings/activity/",embeds:"/:shortname/dashboard/settings/embeds/",integrations:{index:"/:shortname/dashboard/settings/integrations/",
subscribe:"/:shortname/dashboard/settings/integrations/subscribe/"},reseller:{index:"/:shortname/dashboard/settings/integrations/channels/",company:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/settings/"},item:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/settings/"},
customerType:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/customer-types/:resellerCustomerTypePk/settings/"},option:{index:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/",settings:"/:shortname/dashboard/settings/integrations/channels/:resellerCompanyPk/items/:resellerItemPk/options/:resellerOptionPk/settings/"},
apps:{index:"/:shortname/dashboard/settings/integrations/apps/",app:{index:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/",settings:"/:shortname/dashboard/settings/integrations/apps/:resellerAppPk/settings/"}}},waivers:{index:"/:shortname/dashboard/settings/waivers/",waiver:{index:"/:shortname/dashboard/settings/waivers/:waiverPk/"}},locations:{index:"/:shortname/dashboard/settings/locations/",settings:"/:shortname/dashboard/settings/locations/settings/",location:"/:shortname/dashboard/settings/locations/location/:locationPk/"},
storedValue:{index:"/:shortname/dashboard/settings/gift-cards/",storedValueTypes:"/:shortname/dashboard/settings/gift-cards/types/",storedValueType:"/:shortname/dashboard/settings/gift-cards/types/:storedValueTypePk/",storedValueCards:"/:shortname/dashboard/settings/gift-cards/cards/",storedValueCard:{index:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/",settings:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/settings/",storedValueAdjustment:"/:shortname/dashboard/settings/gift-cards/cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/"}},
analyticsServices:{index:"/:shortname/dashboard/settings/analytics/",analyticsService:"/:shortname/dashboard/settings/analytics/:analyticsServicePk/"},flows:{index:"/:shortname/dashboard/settings/flows/",flowNode:{index:"/:shortname/dashboard/settings/flows/:flowNodePk/"}},ticketLayouts:{index:"/:shortname/dashboard/settings/ticket-layouts/",ticketLayout:{index:"/:shortname/dashboard/settings/ticket-layouts/:ticketLayoutPk/"}},suggestedItems:"/:shortname/dashboard/settings/suggested-items/",bookingRestrictions:{index:"/:shortname/dashboard/settings/booking-restrictions/",
bookingRestriction:"/:shortname/dashboard/settings/booking-restrictions/:bookingRestrictionPk/"}}},root:{index:"/",login:"/login/",forgot:{index:"/forgot/",password:"/forgot/password/",resetPassword:"/forgot/password/reset/",credentials:"/forgot/credentials/"},version:"/version/",help:"/help/"},email:{bookingNotification:"/email/:type/:shortname/bookings/:bookingUuid/",orderNotification:"/email/:type/:shortname/orders/:orderUuid/",invoicePaymentRequest:"/email/:type/:shortname/invoice/:invoicePk/"},
embeds:{calendar:{index:"/embeds/calendar/:shortname/",all:"/embeds/calendar/:shortname/all/",items:"/embeds/calendar/:shortname/items/:itemPks(pks)/"},cart:{index:"/embeds/cart/"},checkin:{index:"/embeds/checkin/",company:{index:"/embeds/checkin/:shortname/",booking:{index:"/embeds/checkin/:shortname/bookings/:bookingUuid/",customer:"/embeds/checkin/:shortname/bookings/:bookingUuid/customers/:customerPk/"}},qr:"/:encodedCustomerPk"},book:{index:"/embeds/book/:shortname/",storedValueCard:{index:"/embeds/book/:shortname/gift-cards/:storedValueCardNumber/"},
items:{index:"/embeds/book/:shortname/items/",calendar:"/embeds/book/:shortname/items/calendar/"},item:{index:"/embeds/book/:shortname/items/:itemPk(pk)/",calendar:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/",month:"/embeds/book/:shortname/items/:itemPk(pk)/calendar/:year/:month/",date:"/embeds/book/:shortname/items/:itemPk(pk)/date/:date/",availability:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/",book:"/embeds/book/:shortname/items/:itemPk(pk)/availability/:availabilityPk/book/",
booking:"/embeds/book/:shortname/items/:itemPk(pk)/booking/:bookingUuid/"},cart:{index:"/embeds/book/:shortname/cart/",permalink:"/embeds/book/:shortname/cart/?u=:cartUuid"},order:{index:"/embeds/book/:shortname/orders/:orderUuid/"},flowNode:{index:"/embeds/book/:shortname/items/?flow=:flowNodePk",calendar:"/embeds/book/:shortname/items/calendar/?flow=:flowNodePk"}},partners:{index:"/embeds/partners/",company:"/embeds/partners/:shortname/"},items:{index:"/embeds/items/:shortname/"},analytics:{booking:"/embeds/a/:shortname/booking/:bookingUuid/"}},
pusher:{auth:"/realtime/auth/",channels:"/realtime/:shortname/channels/",members:"/realtime/:shortname/members/"},api:{login:"/api/v1/login/",logout:"/api/v1/logout/",forgotPassword:"/api/v1/forgot/password/",resetPassword:"/api/v1/forgot/password/reset/",forgotCredentials:"/api/v1/forgot/credentials/",companies:"/api/v1/companies/",company:"/api/v1/companies/:shortname/",companyNags:"/api/v1/companies/:shortname/nags/",companyFeatures:"/api/v1/companies/:shortname/features/",companyItemColorsFeature:"/api/v1/companies/:shortname/item-colors-feature/",
companyProfile:"/api/v1/companies/:shortname/profile/",companyContactInformation:"/api/v1/companies/:shortname/contact-information/",companyTaxInformation:"/api/v1/companies/:shortname/tax-information/",companyExtendedTaxInformation:"/api/v1/companies/:shortname/tax-information/extended/",companyTosAcceptance:"/api/v1/companies/:shortname/tos/",companyAccounts:"/api/v1/companies/:shortname/accounts/",companyStyles:"/api/v1/companies/:shortname/styles/",companyAdminNotes:"/api/v1/companies/:shortname/admin-notes/",
companyPayments:"/api/v1/companies/:shortname/payments/",companyManifestSettings:"/api/v1/companies/:shortname/manifest-settings/",companyCalendar:"/api/v1/companies/:shortname/calendar/:year/:month/",companyImages:"/api/v1/companies/:shortname/images/",companyImage:"/api/v1/companies/:shortname/images/:imagePk/",tagGroups:"/api/v1/companies/:shortname/tag-groups/",tagGroup:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/",tags:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/",tag:"/api/v1/companies/:shortname/tag-groups/:tagGroupPk/tags/:tagPk/",
objectTags:"/api/v1/companies/:shortname/tags/:objectCls/:objectPk/",inStorePaymentTypes:"/api/v1/companies/:shortname/in-store-payment-types/",inStorePaymentType:"/api/v1/companies/:shortname/in-store-payment-types/:inStorePaymentTypePk/",bankAccounts:"/api/v1/companies/:shortname/bank-accounts/",bankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/",cards:"/api/v1/companies/:shortname/cards/",card:"/api/v1/companies/:shortname/cards/:cardPk/",cardAffiliations:"/api/v1/companies/:shortname/cards/:cardPk/card-affiliations/",
verifyBankAccount:"/api/v1/companies/:shortname/bank-accounts/:bankAccountPk/verify/",hotels:"/api/v1/companies/:shortname/hotels/",hotel:"/api/v1/companies/:shortname/hotels/:hotelPk/",lodgings:"/api/v1/companies/:shortname/lodgings/",duplicateLodgingsAcrossCompanies:"/api/v1/companies/:shortname/lodgings/duplicate/",lodging:"/api/v1/companies/:shortname/lodgings/:lodgingPk/",preferredPickups:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/",preferredPickup:"/api/v1/companies/:shortname/lodgings/:lodgingPk/preferred-pickups/:preferredPickupPk/",
pickups:"/api/v1/companies/:shortname/pickups/",duplicatePickupsAcrossCompanies:"/api/v1/companies/:shortname/pickups/duplicate/",pickup:"/api/v1/companies/:shortname/pickups/:pickupPk/",routes:"/api/v1/companies/:shortname/routes/",duplicateRoutesAcrossCompanies:"/api/v1/companies/:shortname/routes/duplicate/",route:"/api/v1/companies/:shortname/routes/:routePk/",duplicateRoute:"/api/v1/companies/:shortname/routes/:routePk/duplicate/",stops:"/api/v1/companies/:shortname/routes/:routePk/stops/",stop:"/api/v1/companies/:shortname/routes/:routePk/stops/:stopPk/",
customManifests:"/api/v1/companies/:shortname/custom-manifests/",customManifest:"/api/v1/companies/:shortname/custom-manifests/:customManifestPk/",customCalendars:"/api/v1/companies/:shortname/custom-calendars/",customCalendar:"/api/v1/companies/:shortname/custom-calendars/:customCalendarPk/",customReports:"/api/v1/companies/:shortname/custom-reports/",customReport:"/api/v1/companies/:shortname/custom-reports/:customReportPk/",users:"/api/v1/companies/:shortname/users/",allUsers:"/api/v1/companies/:shortname/users/all/",
relatedUsers:"/api/v1/companies/:shortname/users/related/",user:"/api/v1/companies/:shortname/users/:username/",userActivities:"/api/v1/companies/:shortname/users/:username/activities/",userSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/",userItemSubscriptions:"/api/v1/companies/:shortname/users/:username/subscriptions/items/:itemPk/",userOverview:"/api/v1/companies/:shortname/users/:username/overview/",reorder:"/api/v1/companies/:shortname/reorder/:objectCls/:objectPk/",
activities:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPks/",activity:"/api/v1/companies/:shortname/activities/:activityPk(pk)/",allActivities:"/api/v1/companies/:shortname/activities/all/",systemActivities:"/api/v1/companies/:shortname/activities/system/",notes:"/api/v1/companies/:shortname/activities/:activityObjectCls/:activityObjectPk/notes/",items:"/api/v1/companies/:shortname/items/",allItems:"/api/v1/companies/:shortname/items/all/",item:"/api/v1/companies/:shortname/items/:itemPk/",
itemColor:"/api/v1/companies/:shortname/items/:itemPk/color/",duplicateItem:"/api/v1/companies/:shortname/items/:itemPk/duplicate/",itemCalendar:"/api/v1/companies/:shortname/items/:itemPk/calendar/:year/:month/",itemSubscriptions:"/api/v1/companies/:shortname/items/:itemPk/subscriptions/",itemImages:"/api/v1/companies/:shortname/items/:itemPk/images/",itemImage:"/api/v1/companies/:shortname/items/:itemPk/images/:imagePk/",itemRatings:"/api/v1/companies/:shortname/items/:itemPk/ratings/",itemFlowPages:"/api/v1/companies/:shortname/items/:itemPk/flow-nodes/",
itemsCalendar:"/api/v1/companies/:shortname/items/:itemPks(pks)/calendar/:year/:month/",flowNodes:"/api/v1/companies/:shortname/flow-nodes/",flowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/",defaultFlowPage:"/api/v1/companies/:shortname/flow-nodes/default/",duplicateFlowNode:"/api/v1/companies/:shortname/flow-nodes/:flowNodePk/duplicate/",cannedMessages:"/api/v1/companies/:shortname/canned-messages/",cannedMessage:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/",cannedMessageItems:"/api/v1/companies/:shortname/canned-messages/:cannedMessagePk/items/",
allCustomerTypes:"/api/v1/companies/:shortname/customer-types/all/",customerTypes:"/api/v1/companies/:shortname/customer-types/",customerType:"/api/v1/companies/:shortname/customer-types/:customerTypePk/",customerTypeItems:"/api/v1/companies/:shortname/customer-types/:customerTypePk/items/",customerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/",customerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/",duplicateCustomerPrototype:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/:customerPrototypePk/duplicate/",
allCustomerPrototypes:"/api/v1/companies/:shortname/items/:itemPk/customer-prototypes/all/",customerPrototypesMulti:"/api/v1/companies/:shortname/items/customer-prototypes/multi/",checkinStatuses:"/api/v1/companies/:shortname/checkin-statuses/",checkinStatus:"/api/v1/companies/:shortname/checkin-statuses/:checkinStatusPk/",checkinStatusForBookings:"/api/v1/companies/:shortname/checkin-statuses/bookings/",roles:"/api/v1/companies/:shortname/roles/",role:"/api/v1/companies/:shortname/roles/:rolePk/",
crewMembers:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/",crewMember:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/crew-members/:crewMemberPk/",customFields:"/api/v1/companies/:shortname/custom-fields/",allCustomFields:"/api/v1/companies/:shortname/custom-fields/all/",customField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/",customFieldItems:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/items/",duplicateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/duplicate/",
prevalidateCustomField:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/prevalidate/total-sheets/:totalSheetPk/availabilities/:availabilityPk/",transportationOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/",transportationOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/transportation-options/:transportationOptionPk/",extendedOptions:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/",extendedOption:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/extended-options/:extendedOptionPk/",
connectedCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/",connectedCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-campaigns/:connectedCampaignPk/",generatingCampaigns:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/",generatingCampaign:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/generating-campaigns/:generatingCampaignPk/",campaigns:"/api/v1/companies/:shortname/campaigns/",campaign:"/api/v1/companies/:shortname/campaigns/:campaignPk/",
campaignValidityRules:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/",campaignValidityRule:"/api/v1/companies/:shortname/campaigns/:campaignPk/campaign-validity-rules/:campaignValidityRulePk/",campaignCustomFields:"/api/v1/companies/:shortname/campaigns/:campaignPk/custom-fields/",storedValueTypes:"/api/v1/companies/:shortname/stored-value-types/",storedValueType:"/api/v1/companies/:shortname/stored-value-types/:storedValueTypePk/",storedValueCards:"/api/v1/companies/:shortname/stored-value-cards/",
storedValueCard:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/",storedValueCardPayments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/payments/",storedValueCardNotifications:"/api/v1/companies/:shortname/stored-value-cards/notifications/?q=:storedValueCardNumber",searchStoredValueCardsByNumber:"/api/v1/companies/:shortname/stored-value-cards/search/",storedValueAdjustments:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/",
storedValueAdjustment:"/api/v1/companies/:shortname/stored-value-cards/:storedValueCardPk/adjustments/:storedValueAdjustmentPk/",codes:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/",code:"/api/v1/companies/:shortname/campaigns/:campaignPk/codes/:codePk/",allAffiliates:"/api/v1/companies/:shortname/affiliates/all/",affiliates:"/api/v1/companies/:shortname/affiliates/",affiliate:"/api/v1/companies/:shortname/affiliates/:affiliationPk/",affiliateCards:"api/v1/companies/:shortname/affiliates/:affiliationPk/cards/",
affiliateCardAffiliations:"/api/v1/companies/:shortname/affiliates/:affiliationPk/card-affiliations/",partners:"/api/v1/companies/:shortname/partners/",partner:"/api/v1/companies/:shortname/partners/:affiliationPk/",partnerCards:"/api/v1/companies/:shortname/partners/:affiliationPk/cards/",partnerCardAffiliations:"/api/v1/companies/:shortname/partners/:affiliationPk/card-affiliations/",allAgents:"/api/v1/companies/:shortname/agents/all/",agents:"/api/v1/companies/:shortname/agents/",agent:"/api/v1/companies/:shortname/agents/:agentPk/",
allDesks:"/api/v1/companies/:shortname/desks/all/",desks:"/api/v1/companies/:shortname/desks/",desk:"/api/v1/companies/:shortname/desks/:deskPk/",customFieldInstances:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/",customFieldInstancesMulti:"/api/v1/companies/:shortname/items/custom-field-instances/multi/",customFieldInstance:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/",customFieldInstanceConditions:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/conditions/",
customFieldInstanceCondition:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instances/:customFieldInstancePk/conditions/:customFieldInstanceConditionPk/",customFieldInstanceGroups:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/",customFieldInstanceGroup:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/:customFieldInstanceGroupPk/",customFieldInstanceGroupsMulti:"/api/v1/companies/:shortname/items/custom-field-instance-groups/multi/",duplicateCustomFieldInstanceGroup:"/api/v1/companies/:shortname/items/:itemPk/custom-field-instance-groups/:customFieldInstanceGroupPk/duplicate/",
nextAvailability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/next/",availabilitiesByDate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/",availabilitiesByResource:"/api/v1/companies/:shortname/items/:itemPk/availabilities/date/:date/resource/:resourcePk/",availabilitiesByTag:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:tag/",availability:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/",availabilityStatus:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/status/",
availabilityLiveCapacity:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/live/",availabilityResourceUses:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/resource-uses/",updateItemAvailabilities:"/api/v1/companies/:shortname/items/:itemPk/availabilities/update/",updateAvailabilities:"/api/v1/companies/:shortname/availabilities/update/",availabilityNote:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/note/",sendConfirmations:" /api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/send-confirmations/",
notifications:" /api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/notifications/",customerTypeRates:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/",customerTypeRate:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/customer-type-rates/:customerTypeRatePk/",blocks:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/",block:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/blocks/:blockPk/",
rule:"/api/v1/companies/:shortname/items/:itemPk/availabilities/rule/",orders:"/api/v1/companies/:shortname/orders/",order:"/api/v1/companies/:shortname/orders/:orderUuid/",orderPayments:"/api/v1/companies/:shortname/orders/:orderUuid/payments/",orderNotification:"/api/v1/companies/:shortname/orders/:orderUuid/notification/",orderCancellation:"/api/v1/companies/:shortname/orders/:orderUuid/cancel/",book:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/book/",bookings:"/api/v1/companies/:shortname/items/:itemPk/availabilities/:availabilityPk/bookings/",
booking:"/api/v1/companies/:shortname/bookings/:bookingUuid/",bookingByPk:"/api/v1/companies/:shortname/bookings/:bookingPk/",repriceBooking:"/api/v1/companies/:shortname/bookings/:bookingUuid/reprice/",bookingCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/checkin-status/",customerCheckinStatus:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/:customerPk/checkin-status/",bookingNote:"/api/v1/companies/:shortname/bookings/:bookingUuid/note/",bookingExplicitGross:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-gross/",
bookingExplicitInvoicePrice:"/api/v1/companies/:shortname/bookings/:bookingUuid/explicit-invoice-price/",bookingNotificationOptions:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification-options/",bookingEffectiveCancellationRule:"/api/v1/companies/:shortname/bookings/:bookingUuid/effective-cancellation-rule/",searchCustomersByEncodedPk:"/embeds/redirect/checkin/:encodedPk/",contact:"/api/v1/companies/:shortname/contacts/:contactPk/",contactBookings:"/api/v1/companies/:shortname/contacts/:contactPk/bookings/",
contactPayments:"/api/v1/companies/:shortname/contacts/:contactPk/payments/",affiliation:"/api/v1/companies/:shortname/bookings/:bookingUuid/affiliation/",notification:"/api/v1/companies/:shortname/bookings/:bookingUuid/notification/",smsNotification:"/api/v1/companies/:shortname/bookings/:bookingUuid/sms-notifications/",lineItems:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/",lineItem:"/api/v1/companies/:shortname/bookings/:bookingUuid/line-items/:lineItemPk/",customerCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/customers/custom-field-values/:customerCustomFieldValuePk/",
bookingCustomFieldValue:"/api/v1/companies/:shortname/bookings/:bookingUuid/custom-field-values/:bookingCustomFieldValuePk/",payments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/",relatedPayments:"/api/v1/companies/:shortname/bookings/:bookingUuid/payments/related/",refunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/",orderRefunds:"/api/v1/companies/:shortname/orders/:orderUuid/refunds/",customRefunds:"/api/v1/companies/:shortname/bookings/:bookingUuid/refunds/custom/",
availabilitiesManifest:"/api/v1/companies/:shortname/manifest/availabilities/date/:date/",bookingsManifest:"/api/v1/companies/:shortname/manifest/bookings/date/:date/",runsManifest:"/api/v1/companies/:shortname/manifest/runs/date/:date/",resourcesManifest:"/api/v1/companies/:shortname/manifest/resources/date/:date/",searchAvailabilitiesByDate:"/api/v1/companies/:shortname/search/items/:itemPks(pks)/availabilities/date/:date/",searchAvailabilitiesByUpcoming:"/api/v1/companies/:shortname/search/availabilities/upcoming/:filter",
searchAvailabilitiesByPk:"/api/v1/companies/:shortname/search/availabilities/:availabilityPks/",searchBookingsByQuery:"/api/v1/companies/:shortname/search/bookings/query/:filter",searchBookingsByNew:"/api/v1/companies/:shortname/search/bookings/new/:filter",searchBookingsByUuid:"/api/v1/companies/:shortname/search/bookings/:bookingUuids/",searchRunsByDate:"/api/v1/companies/:shortname/search/runs/date/:date/",bookingsByContact:"/api/v1/companies/:shortname/search/bookings/contact/:contactPk/",invoices:"/api/v1/companies/:shortname/invoices/",
invoice:"/api/v1/companies/:shortname/invoices/:invoicePk/",uuidInvoice:"/api/v1/companies/:shortname/invoices/uuid/:invoiceUuid/",invoiceNotifications:"/api/v1/companies/:shortname/invoices/:invoicePk/notifications/",invoiceUploads:"/api/v1/companies/:shortname/invoices/:invoicePk/uploads/",partnerInvoice:"/api/v1/companies/:shortname/invoices/partner-invoices/:invoicePk/",groups:"/api/v1/companies/:shortname/groups/",group:"/api/v1/companies/:shortname/groups/:groupPk/",duplicateGroup:"/api/v1/companies/:shortname/groups/:groupPk/duplicate/",
groupOverrides:"/api/v1/companies/:shortname/group-overrides/",groupOverride:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/",groupOverrideActivities:"/api/v1/companies/:shortname/group-overrides/:groupOverridePk/activities/",relatedGroupOverrides:"/api/v1/companies/:shortname/group-overrides/related/",reports:"/api/v1/companies/:shortname/reports/",recentReports:"/api/v1/companies/:shortname/reports/recent/",inProgressReports:"/api/v1/companies/:shortname/reports/in-progress/",volumeOverviewReport:"/api/v1/companies/:shortname/reports/volume-overview/",
dailyVolumeOverviewReport:"/api/v1/companies/:shortname/reports/daily-volume-overview/",paymentOverviewReport:"/api/v1/companies/:shortname/reports/payment-overview/",itemsSummaryOverviewReport:"/api/v1/companies/:shortname/reports/items-summary-overview/",nextPayoutOverviewReport:"/api/v1/companies/:shortname/reports/next-payout-overview/",report:"/api/v1/companies/:shortname/reports/:reportPk(pk)/",reportObjects:"/api/v1/companies/:shortname/reports/:reportPk(pk)/objects/",reportReports:"/api/v1/companies/:shortname/reports/reports/",
reportContacts:"/api/v1/companies/:shortname/reports/contacts/",reportBookings:"/api/v1/companies/:shortname/reports/bookings/",reportInvoiceableBookings:"/api/v1/companies/:shortname/reports/invoiceable-bookings/",reportTest:"/api/v1/companies/:shortname/reports/test/",reportLineItems:"/api/v1/companies/:shortname/reports/line-items/",reportPayments:"/api/v1/companies/:shortname/reports/payments/",reportDisputes:"/api/v1/companies/:shortname/reports/disputes/",reportPayouts:"/api/v1/companies/:shortname/reports/payouts/",
reportInvoices:"/api/v1/companies/:shortname/reports/invoices/",reportAccounts:"/api/v1/companies/:shortname/reports/accounts/",reportTransactions:"/api/v1/companies/:shortname/reports/transactions/",reportEscrow:"/api/v1/companies/:shortname/reports/escrow/",reportVolume:"/api/v1/companies/:shortname/reports/volume/",reportCompanies:"/api/v1/companies/:shortname/reports/companies/",reportItemsSummary:"/api/v1/companies/:shortname/reports/summary/items/",reportUsersSummary:"/api/v1/companies/:shortname/reports/summary/users/",
reportBookingTypesSummary:"/api/v1/companies/:shortname/reports/summary/booking-types/",reportCustomerTypesSummary:"/api/v1/companies/:shortname/reports/summary/customer-types/",reportCustomFieldSummary:"/api/v1/companies/:shortname/reports/summary/custom-field/",reportLodgingsSummary:"/api/v1/companies/:shortname/reports/summary/lodgings/",reportPickupsSummary:"/api/v1/companies/:shortname/reports/summary/pickups/",reportCrewSummary:"/api/v1/companies/:shortname/reports/summary/crew/",reportAgentsSummary:"/api/v1/companies/:shortname/reports/summary/agents/",
reportDesksSummary:"/api/v1/companies/:shortname/reports/summary/desks/",reportCampaignsSummary:"/api/v1/companies/:shortname/reports/summary/campaigns/",reportRevenueSummary:"/api/v1/companies/:shortname/reports/summary/revenue/",reportAdvanced:"/api/v1/companies/:shortname/reports/advanced/",viatorSettings:"/api/v1/companies/:shortname/items/:itemPk/viator-settings/",viatorMappings:"/api/v1/companies/:shortname/items/:itemPk/viator-mappings/",viatorMapping:"/api/v1/companies/:shortname/items/:itemPk/viator-mappings/:viatorMappingPk/",
reviewExpressSettings:"/api/v1/companies/:shortname/items/:itemPk/review-express-settings/",picthriveSettings:"/api/v1/companies/:shortname/items/:itemPk/picthrive-settings/",payouts:"/api/v1/companies/:shortname/payouts/",payout:"/api/v1/companies/:shortname/payouts/:payoutPk/",payoutRetry:"/api/v1/companies/:shortname/payouts/:payoutPk/retry/",transfers:"/api/v1/companies/:shortname/transfers/",transfer:"/api/v1/companies/:shortname/transfers/:transferPk/",uploads:"/api/v1/companies/:shortname/uploads/",
upload:"/api/v1/companies/:shortname/uploads/:uploadPk/",adjustments:"/api/v1/companies/:shortname/adjustments/",adjustment:"/api/v1/companies/:shortname/adjustments/:adjustmentPk/",waivers:"/api/v1/companies/:shortname/waivers/",waiver:"/api/v1/companies/:shortname/waivers/:waiverPk/",connectedWaivers:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/",connectedWaiver:"/api/v1/companies/:shortname/custom-fields/:customFieldPk/connected-waivers/:connectedWaiverPk/",waiverInstance:"/api/v1/companies/:shortname/waivers/:waiverPk/waiver-instances/:waiverInstancePk/",
locations:"/api/v1/companies/:shortname/locations/",location:"/api/v1/companies/:shortname/locations/:locationPk/",locationItems:"/api/v1/companies/:shortname/locations/:locationPk/items/",totalSheets:"/api/v1/companies/:shortname/total-sheets/",totalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/",duplicateTotalSheet:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/duplicate/",totalPricing:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/",
totalStack:"/api/v1/companies/:shortname/total-sheets/:totalSheetPk/pricing/:objectCls/:objectPk/stack/",invoiceSheets:"/api/v1/companies/:shortname/invoice-sheets/",invoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/",duplicateInvoiceSheet:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/duplicate/",invoicePricing:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/",invoiceStack:"/api/v1/companies/:shortname/invoice-sheets/:invoiceSheetPk/pricing/:objectCls/:objectPk/stack/",
resources:"/api/v1/companies/:shortname/resources/",resource:"/api/v1/companies/:shortname/resources/:resourcePk/",resourceItems:"/api/v1/companies/:shortname/resources/:resourcePk/items/",resourceAvailabilities:"/api/v1/companies/:shortname/resources/:resourcePk/availabilities/date/:date/",resourceUsesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/:date/",resourceUsesCalendar:"/api/v1/companies/:shortname/resources/:resourcePk/resource-uses/calendar/:year/:month/",reapplyBookingResourceUses:"/api/v1/companies/:shortname/bookings/:bookingUuid/reapply-resource-uses/",
requirementGroups:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/",requirementGroup:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/",duplicateRequirementGroup:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/duplicate/",requirements:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/",requirement:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/:requirementPk/",
resourceRequirements:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/",resourceRequirement:"/api/v1/companies/:shortname/items/:itemPk/requirement-groups/:requirementGroupPk/requirements/:requirementPk/resource-requirements/:resourceRequirementPk/",resourceUse:"/api/v1/companies/:shortname/bookings/:bookingUuid/resource-uses/:resourceUsePk/",resourceOverride:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:resourceOverridePk/",
resourceOverrideRule:"/api/v1/companies/:shortname/resources/:resourcePk/resource-override-rule/",resourceOverridesByTag:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:tag/",resourceOverridesByDate:"/api/v1/companies/:shortname/resources/:resourcePk/resource-overrides/:date/",resellerCompanies:"/api/v1/companies/:shortname/reseller-companies/",resellerCompany:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/",resellerCompanyMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/",
resellerCompanyMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-company-mappings/:resellerCompanyMappingPk/",resellerItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/",resellerItem:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/",resellerItemMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/",
resellerItemMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-item-mappings/:resellerItemMappingPk",resellerCustomerTypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/",resellerCustomerType:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/",resellerCustomerTypeMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/",
resellerCustomerTypeMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/reseller-customer-type-mappings/:resellerCustomerTypeMappingPk/",resellerOptions:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/",resellerOption:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/",
resellerOptionMappings:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/",resellerOptionMapping:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-options/:resellerOptionPk/reseller-option-mappings/:resellerOptionMappingPk/",resellerUnmappedItems:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/unmapped/items/",
resellerUnmappedCustomerPrototypes:"/api/v1/companies/:shortname/reseller-companies/:resellerCompanyPk/reseller-items/:resellerItemPk/reseller-customer-types/:resellerCustomerTypePk/unmapped/customer-prototypes/",resellerKeys:"/api/v1/companies/:shortname/users/:username/reseller-keys/",resellerKey:"/api/v1/companies/:shortname/reseller-keys/:resellerKeyPk/",resellerApps:"/api/v1/companies/:shortname/reseller-apps/",resellerApp:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/",resellerAppCompanies:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/",
resellerAppCompany:"/api/v1/companies/:shortname/reseller-apps/:resellerAppPk/reseller-app-companies/:resellerAppCompanyPk",ticketLayouts:"/api/v1/companies/:shortname/ticket-layouts/",ticketLayout:"/api/v1/companies/:shortname/ticket-layouts/:ticketLayoutPk/",analyticsServices:"/api/v1/companies/:shortname/a-services/",analyticsService:"/api/v1/companies/:shortname/a-services/:analyticsServicePk/",cancellationPolicies:"/api/v1/companies/:shortname/cancellation-policies/",cancellationPolicy:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/",
cancellationRules:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/",cancellationRule:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/cancellation-rules/:cancellationRulePk/",cancellationPolicyAffiliations:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/affiliations/",cancellationPolicyItems:"/api/v1/companies/:shortname/cancellation-policies/:cancellationPolicyPk/items/",bookingRestrictions:"/api/v1/companies/:shortname/booking-restrictions/",
bookingRestriction:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/",bookingRestrictionItems:"/api/v1/companies/:shortname/booking-restrictions/:bookingRestrictionPk/items/",persistentStore:"/api/v1/persistence/:identifier/",persistentStoreForCompany:"/api/v1/persistence/:identifier/:shortname/",persistentStoreItem:"/api/v1/persistence/:identifier/:shortname/:key/",version:"/api/v1/version/"}};return m}]);n.run(["$rootScope","urls",function(c,g){c.urls=g}])})();
angular.module("native",["native.services"]);
(function(){var n=angular.module("native.services",[]);n.factory("native",["$rootScope","$window","auth","db","events",function(c,g,k,e,d){var m={STRONG_SUCCESS_INDICATION:"fareharbor.native.indicate.strongSuccessIndication",WEAK_SUCCESS_INDICATION:"fareharbor.native.indicate.weakSuccessIndication",STRONG_ERROR_INDICATION:"fareharbor.native.indicate.strongErrorIndication",WEAK_ERROR_INDICATION:"fareharbor.native.indicate.weakErrorIndication"},a=e.slipstream("isNative")||!1,n=e.slipstream("nativeClient")||
"",h=e.slipstream("nativeClientVersion")||"",b=e.slipstream("isDebug"),f=e.slipstream("domain"),A=e.slipstream("protocol"),w={isNative:a,client:n,version:h,broadcast:function(a,b){console.info("native: triggering",a,b);g.webkit&&g.webkit.messageHandlers&&g.webkit.messageHandlers.fareharbor?(b=_.extend({type:a},b),g.webkit.messageHandlers.fareharbor.postMessage(b)):console.warn("native: native client unavailable")},indicate:function(a){a=a||m.WEAK_SUCCESS_INDICATION;w.broadcast("fareharbor.native.indicate",
{indication:a})},print:function(a){var b={};if(a){var c=["<!DOCTYPE html>",'<html class="native-print">',"<head>",'<meta name="viewport" content="initial-scale=1.0" />'];_.forEach($('head link[type="text/css"][href^="/"]'),function(a){a=$(a).attr("href");a=_.startsWith(a,"//")?A+":"+a:A+"://"+f+a;c.push('<link rel="stylesheet" href="'+a+'" type="text/css">')});c.push("</head>");c.push("<body>");c.push(a.outerHTML);c.push("</body>");c.push("</html>");b.html=c.join("\n")}console.info("native: print",
b);w.broadcast("fareharbor.native.print",b)}};_.extend(w,m);d.on(c,"auth.logout",function(){w.broadcast("fareharbor.native.loggedOut")});k.currentUser.isAuthenticated||w.broadcast("fareharbor.native.logOut");g.FH={nativeEvent:function(a){c.$apply(function(){d.broadcast(a.type,a)})}};w.broadcast("fareharbor.native.ready");d.on(c,"fareharbor.native.inApp",function(a,b){w.isNative=!0;w.client=b.client||w.client||"unknown";w.version=b.version||w.version||"unknown"});if(b)d.on(c,"fareharbor.native.test",
function(a,b){g.confirm("fareharbor.native.test triggered; respond?")&&w.broadcast("fareharbor.native.testSucceeded",{number:42})});return w}]);n.run(["$rootScope","native",function(c,g){c.native=g}])})();angular.module("navigation",["navigation.services","navigation.directives"]);
(function(){var n=angular.module("navigation.directives",["clientOptions.services","lib.services"]);n.directive("ngNavigationActive",["d","navigation",function(c,k){return{restrict:"A",link:function(e,d,m){var a=e.isSet(m.ngNavigationExact)?k.pathEquals:k.pathStartsWith,n,h=function(){var b=n();b?_.isString(b)?d.toggleClass("current",!!a(b)):_.isArray(b)?d.toggleClass("current",_.any(b,function(c){return!c?(console.warn("ng-navigation-active: empty url in list",c,b,m.ngNavigationActive,m.ngHref),
!1):!!a(c)})):console.warn("ng-navigation-active: invalid url",b,m.ngNavigationActive,m.ngHref):(console.warn("ng-navigation-active: no url",b,m.ngNavigationActive,m.ngHref),d.removeClass("current"))};if(m.ngNavigationActive)n=c.watcher(e,m.ngNavigationActive,"",h,!0);else if(m.ngHref)n=c.observer(m,"ngHref","",h);else{console.warn("invalid use of ng-navigation-active");return}k.watch(e,h);h()}}}]);var c=function(c,k){n.directive(c,["$injector","$parse","navigation",function(e,d,m){var a=e.invoke(k);
return{transclude:"element",priority:1E3,terminal:!0,restrict:"A",compile:function(e,h,b){e=c+"When";var f=h[e]?d(h[e]):null;return function(c,d,e){var g=a(c,d,e),h,k,m=function(a){k&&k.$destroy();k=c.$new();k.route={bindings:a};b(k,function(a){h&&h.remove();d.after(a);h=a})},n;c.$watch(function(){return f&&!f(c)?!1:(n=g())?JSON.stringify(n):!1},function(a,b){e.ngThen&&(c[e.ngThen]=!!a);a&&b?m(n):a?m(n):b&&(k&&k.$destroy(),h&&(h.remove(),h=null))})}}}}])};c("ngNavigationSpec",["$parse","navigation",
function(c,k){var e={prefix:"pathStartsWith",path:"pathEquals"};return function(d,m,a){var n=_.bind(c(a.ngNavigationSpec),null,d),h=function(a){return k[e[a[0]]](a[1])};return function(){var a=n();return _.chooseFirst(a,h)}}}]);c("ngNavigationPrefix",["$parse","navigation",function(c,k){return function(e,d,m){var a=_.bind(c(m.ngNavigationPrefix),null,e),n=function(a){if(!a)throw Error("ng-navigation-prefix: invalid paths: "+m.ngNavigationPrefix);return k.pathStartsWith(a)};return function(){var c=
a();if(_.isUndefined(c))throw Error("ng-navigation-prefix: undefined paths: "+m.ngNavigationPrefix);_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-prefix: empty paths: "+m.ngNavigationPrefix);return _.chooseFirst(c,n)}}}]);c("ngNavigationPath",["$parse","navigation",function(c,k){return function(e,d,m){var a=_.bind(c(m.ngNavigationPath),null,e),n=function(a){if(!a)throw Error("ng-navigation-path: invalid paths: "+m.ngNavigationPath);return k.pathEquals(a)};return function(){var c=a();
if(_.isUndefined(c))throw Error("ng-navigation-path: undefined paths: "+m.ngNavigationPath);_.isArray(c)||(c=[c]);if(!c.length)throw Error("ng-navigation-path: empty paths: "+m.ngNavigationPath);return _.chooseFirst(c,n)}}}]);c("ngNavigationSection",["navigation",function(c){var k={root:"inRootSection",company:"inCompanySection",manifest:"inManifestSection",dashboard:"inDashboardSection"};return function(e,d,m){return function(){return c[k[m.ngNavigationSection]]()}}}]);c("ngNavigationInvoiceLogin",
["navigation","urls",function(c,k){var e=k.dashboard.reports.invoices.partnerInvoice.index,d=function(d){var a=c.get("next");return!a?!1:c.parseQuery(a).source===d};return function(k,a,n){return function(){return c.nextPathEquals(e)&&(d("uuid-invoice")||d("email"))}}}]);n.directive("ngConfirmNavigateAway",["$parse","$rootScope","$window",function(c,k,e){return{restrict:"A",require:"form",compile:function(d,k){var a=k.ngConfirmNavigateAwayWhen?c(k.ngConfirmNavigateAwayWhen):null;return function(c,
d,b,f){if(!e.slipstream.isEmbedded||e.slipstream.isBookEmbed){var g=function(){return b.ngConfirmNavigateAway?b.ngConfirmNavigateAway:"Your changes will be lost."},k=function(){if(a?a(c,{$url:void 0}):f.$dirty)return g()};c.$on("$locationChangeStart",function(b,d){(a?a(c,{$url:d}):f.$dirty)&&!e.confirm("Are you sure you want to leave this page? "+g())&&b.preventDefault()});var m=angular.element(e);m.on("beforeunload",k);c.$on("$destroy",function(){m.off("beforeunload",k)})}}}}}]);n.config(["$provide",
function(c){c.decorator("ngHrefDirective",["$delegate",function(c){c.shift();return c}])}]);n.directive("ngHref",["$browser","$location","$parse","clientOptions","d","navigation",function(c,k,e,d,m,a){return{restrict:"A",link:function(c,e,b){var f=!1,g=function(){var c=k();f&&(c=a.multiUrl(c));c=d.reflectUrl(c);b.$set("href",c)},k=m.observer(b,"ngHref","",function(b){!f&&a.parseMultiUrl(b)?(f=!0,a.watch(c,g)):g()})}}}]);c=function(c,k){return n.directive(c,["d","navigation",function(e,d){return{restrict:"A",
link:function(m,a,n){var h=m.isSet(n[c+"Strict"]),b=e.observer(n,c);a.on("click",function(c){var e=$(c.target),g=b();if(g&&k.test(c)&&!c.defaultPrevented&&(!h||a.is(e)))if(!e.is("a")||a.is(e))m.$apply(function(){d.navigate(g)}),k.preventDefault&&c.preventDefault()})}}}])};c("ngNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngShiftNavigate",{test:function(c){return c.shiftKey&&!c.controlKey&&!c.metaKey&&!c.altKey}});c("ngControlNavigate",{test:function(c){return!c.shiftKey&&
c.ctrlKey&&!c.metaKey&&!c.altKey}});c("ngMetaNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&c.metaKey&&!c.altKey}});c("ngAltNavigate",{test:function(c){return!c.shiftKey&&!c.controlKey&&!c.metaKey&&c.altKey},preventDefault:!0});c("ngShiftOrAltNavigate",{test:function(c){return(c.shiftKey||c.altKey)&&!c.controlKey&&!c.metaKey}});n.directive("ngRedirect",["navigation",function(c){return{restrict:"A",link:function(k,e,d){e=k.$eval(d.ngRedirect);k=k.$eval(d.ngRedirectMode)||"";if(!e)throw Error("ng-redirect: no url: "+
d.ngRedirect);c.redirect(e,k)}}}]);n.directive("ngReload",["navigation",function(c){return{restrict:"A",link:function(k,e,d){c.reload()}}}]);n.directive("ngReloadRoot",["$location","$window","navigation","urls",function(c,k,e,d){return{restrict:"A",link:function(){var m=e.compose(d.root.index,c.search());k.location.replace(m)}}}])})();
(function(){var n=angular.module("navigation.services",["auth.services","db.services","lib.services","urls.services"]);n.factory("navigation",["$rootScope","$browser","$injector","$location","$timeout","$window","auth","db","events","models","urls",function(c,g,k,e,d,m,a,n,h,b,f){n.slipstream("isDebug");var A=n.slipstream("protocol"),w=n.slipstream("domain"),u=g.baseHref();"/"===u[u.length-1]&&(u=u.slice(0,u.length-1));var C=function(a){return!u&&"/embeds/"===a.slice(0,8)||!u&&"/"!==a.slice(0,1)?
!1:a.slice(0,u.length)===u},z=function(a){return!C(a)?u+a:a},l="_top"===$("base").attr("target"),p=function(a,b){var c=m;l&&(c=m.top);b?c.location.replace(a):c.location.assign(a)},F={admin:"admin-section",company:"company-section",dashboard:"dashboard-section",root:"root-section"};F.all=_.values(F).join(" ");var G=function(a,b){b?($("body").removeClass(F.all),$("body").addClass(F[a])):$("body").removeClass(F[a])},x={glob:"([a-zA-Z0-9-_.]+)",slug:"([a-z0-9-_.]+)",path:"([a-z-/]+)",pk:"([0-9]+)",pks:"(([0-9]+)(,[0-9]+)*)"},
r=function(a,b,c){a=a.replace(/\//g,"\\/");a=a.replace(/:(\w+)(\((\w+)\))?/g,function(a,b,d,e){c.push(b);return d?x[e]:x.glob});return RegExp("^"+a+(b?"$":""))},D={},B=function(a,b){if(!a)throw Error("navigation: matcher not given path");if(!_.isString(a))throw console.error("navigation: matcher not given a string path",a,b),Error("navigation: matcher not given string path");var c=a+(b?"$":""),d=D[c];if(d)return d;var f=[],g,h=v.parseMultiUrl(a);if(h&&h.multiPath){g=r(h.path,!1,f);var k=[],l=r(h.multiPath,
b,k),d=function(){var a=e.search()[h.key];if(_.isUndefined(a))return!1;a=a||"/";"/"!==a[a.length-1]&&(a+="/");var b=v.path;"/"!==b[b.length-1]&&(b+="/");b=_.toArray(g.exec(b));if(!b.length)return!1;a=_.toArray(l.exec(a));if(!a.length)return!1;var c={};_.forEach(_.rest(b),function(a,b){c[f[b]]=a});_.forEach(_.rest(a),function(a,b){c[k[b]]=a});return c}}else g=r(a,b,f),d=function(){var a=v.path;"/"!==a[a.length-1]&&(a+="/");a=_.toArray(g.exec(a));if(!a.length)return!1;var b={};_.forEach(_.rest(a),function(a,
c){b[f[c]]=a});return b};return D[c]=d},t={};b=function(a,b){return function(c,d){var e=a+c;if(!d&&!_.isUndefined(t[e]))return t[e];var f=b(c);return t[e]=f}};var y=function(a,b){return function(){if(!_.isUndefined(t[a]))return t[a];var c=b();return t[a]=c}},L=function(a){try{return decodeURIComponent(a)}catch(b){}},J=function(a){var b={},c,d;_.forEach((a||"").split("&"),function(a){a&&(c=a.replace(/\+/g,"%20").split("="),d=L(c[0]),_.isUndefined(d)||(a=!_.isUndefined(c[1])?L(c[1]):!0,Object.hasOwnProperty.call(b,
d)?_.isArray(b[d])?b[d].push(a):b[d]=[b[d],a]:b[d]=a))});return b},s=function(a){var b=a.replace("%3F","?");return _.contains(b,"?")?b.split("?")[0]:a},H=function(a){return a&&(a=a.replace("%3F","?"),_.contains(a,"?"))?(a=a.split("?")[1],J(a)):{}},v={base:u,url:z(e.url()||"/"),path:z(e.path()||"/"),compose:function(a,b,c){c&&(b=_.pick(b,function(b,c){return!RegExp("[&\\?]"+c+"=").test(a)}));if(b=n.toKeyValue(b)){c="";var d=a.indexOf("#");-1!==d&&(c=a.slice(d),a=a.slice(0,d));return _.contains(a,"?")?
a+"&"+b+c:a+"?"+b+c}return a},parseQuery:H,extendQuery:function(a,b){var c=v.parseQuery(a);_.extend(c,b);a=s(a);return v.compose(a,c)},pathStartsWith:b("pathStartsWith",function(a){return B(a)()}),pathEquals:b("pathEquals",function(a){return B(a,!0)()}),nextPathEquals:b("nextPathEquals",function(a){a=r(a,!0,[]);var b=e.search().next;if(_.isUndefined(b))return!1;b=s(b);return(a=a.exec(b))&&a.length}),inCompanySection:y("inCompanySection",function(){var a,b=!v.inRootSection()&&!v.inDashboardSection()&&
!v.inLegacyManifestSection()&&!!(a=v.pathStartsWith(f.company.index));G("company",b);return a}),inDashboardSection:y("inDashboardSection",function(){var a,b=!v.inRootSection()&&!!(a=v.pathStartsWith(f.dashboard.index));G("dashboard",b);return a}),inLegacyManifestSection:y("inLegacyManifestSection",function(){var a,b=!v.inRootSection()&&!!(a=v.pathStartsWith(f.legacyManifest));G("dashboard",b);return a}),inRootSection:y("inRootSection",function(){var a=!1;_.forEach(f.root,function(b){a=b===f.root.index?
a||v.pathEquals(b):_.isObject(b)?a||v.pathStartsWith(b.index):a||v.pathStartsWith(b)});G("root",a);return a}),reload:function(){c.$evalAsync(function(){location.reload(!0)})},redirect:function(a,b){if(e.$$replace)d(_.bind(v.redirect,v,a,b));else{a=v.multiUrl(a||"/",b||"extend");if(C(a))return a=C(a)?a.slice(u.length):a,e.replace(),e.url(a),a;p(a,!0)}},navigate:function(a,b,c){a=v.multiUrl(a||"/",b||"replace");if(!C(a)||c)p(a);else return a=C(a)?a.slice(u.length):a,e.url(a),a},forceNavigate:function(a){return c.$apply(function(){return v.navigate(a)})},
open:function(a,b,c){c&&(c.stopPropagation(),c.preventDefault());b=_.extend({},{status:1,scrollbars:1,resizable:1},b);b=_.map(b,function(a,b){return b+"="+a}).join(",");m.open(a,"$$window",b)},get:function(a){return e.search()[a]},set:function(a,b,c){c&&e.replace();return e.search(a,b)},clear:function(a,b){b&&e.replace();return e.search(a,null)},getInt:function(a){a=_.int(this.get(a));if(!isNaN(a))return a},getPk:function(a){a=v.getInt(a);if(!_.isUndefined(a)&&!(0>=a))return a},getPks:function(a){return _.splitPks(this.get(a))},
parseMultiUrl:function(a){if(_.isUndefined(a))console.warn("navigation: invalid multi-url",a);else if(!/^(https?|ftp|mailto|tel)/.test(a)){var b=_.split(a,"@",2);if(2===b.length&&(a=b[0],b=b[1])){var b=_.split(b,"=",2),c=b[0],d=b[1]||"",e={},b=_.split(d,"?",2);2===b.length&&(d=b[0],e=J(b[1]));return{path:a,key:c,multiPath:d,search:e}}}},multiUrl:function(a,b,c){if(!a)throw Error("navigation: bad url to multi");b=b||"replace";var d=v.parseMultiUrl(a),f={};d&&(b="extend",d.multiPath&&(f[d.key]=d.multiPath),
_.extend(f,d.search));"extend"===b&&(f=_.extend({},e.search(),f),d&&!d.multiPath&&delete f[d.key]);d&&(a=d.path,c?a=c:v.pathStartsWith(d.path)&&(a=v.path));return v.compose(a,f)},watch:function(a,b,c){var d=function(){a.$safeApply(function(){b(v.path,v.url)})},e=function(a,b){if(_.isObject(c)&&c.search)if(a===b)d();else{var e=c.search,f=H(a),g=H(b);e&&(f=_.pick(f,e),g=_.pick(g,e));_.isEqual(f,g)||d()}else d()};return"path"===c?a.$watch(function(){var a=v.parseMultiUrl(v.url);return a?a.path:v.path},
d):"multiPath"===c?a.$watch(function(){var a=v.parseMultiUrl(v.url);return a?a.key+"="+a.multiPath:""},d):a.$watch(function(){return v.url},e)},currentCompany:null,updateCurrentCompany:function(a,b){var c=k.get("analytics");v.currentCompany=b;c.trackCompany(v.currentCompany);h.broadcast("navigation.company.updated",{company:v.currentCompany});a.$on("$destroy",function(){v.currentCompany=null;c.trackCompany(null);h.broadcast("navigation.company.updated",{company:v.currentCompany})})},isCurrentCompany:function(a){return v.currentCompany&&
_.isUriEqual(v.currentCompany,a)},absoluteUrl:function(a){a=_.isUndefined(a)?v.url:z(a);return A+"://"+w+a},loginRedirectUrl:function(a){var b;b=v.currentCompany?v.currentCompany.$url(f.company.login):f.root.login;var c=v.path,d=_.extend({},e.search());delete d.next;var d=v.compose(c,d),g={};/\/login\//g.test(c)||(g.next=d,a&&(g.require="yes"));return v.compose(b,g)},startBookingUrl:function(b,c){if(!b)return c.company.$url(f.dashboard.bookings.index);var d=b.availability.startAt,e=b.company,g=moment().startOf("day");
0>d.diff(g)&&(d=g);b.affiliation&&b.affiliation.affiliateCompany===a.currentUser.company&&(a.storage.set("currentPartnerSelection",b.company.uri),e=b.affiliation.affiliateCompany);if(v.pathStartsWith(f.dashboard.bookings.day.index))g=f.dashboard.bookings.day.date;else if(v.pathStartsWith(f.dashboard.bookings.agenda.index))g=f.dashboard.bookings.agenda.date;else if(v.pathStartsWith(f.dashboard.bookings.calendar))g=f.calendarUrls(f.dashboard.bookings.calendar).month;else if(v.pathStartsWith(f.dashboard.bookings.grid.index))g=
f.dashboard.bookings.grid.date;else if(v.pathStartsWith(f.dashboard.bookings.timeline.index))g=f.dashboard.bookings.timeline.date;else return v.compose(f.populate(f.dashboard.bookings.index,{shortname:e.shortname}),{date:d.format("YYYY-MM-DD")});return f.populate(g,{shortname:e.shortname,year:d.format("YYYY"),month:d.format("MM"),date:d.format("YYYY-MM-DD")})}},O=!0;c.$on("$locationChangeStart",function(a){c.$evalAsync(function(){c.$broadcast("$locationChangeComplete",!a.defaultPrevented);a.defaultPrevented&&
c.$broadcast("$locationChangeCancelled")})});c.$on("$locationChangeSuccess",function(a,b,c){b=b?b.replace(/^https?:\/\/[^\/]+/,""):"/";b=z(b);c=c?c.replace(/^https?:\/\/[^\/]+/,""):"/";c=z(c);a=e.path();a=z(a||"/");"/"!==a[a.length-1]?v.redirect(v.compose(a+"/",e.search())):(t={},v.url=b,v.path=a,(b!==c||O)&&d(function(){console.info("navigation: navigation complete",v.url,b);g.notifyWhenNoOutstandingRequests(function(){v.url===b&&k.get("analytics").trackView(b)})}),O=!1)});m.$$navigation=v;m.$$location=
e;return v}]);n.run(["$rootScope","navigation",function(c,g){c.navigation=g}])})();
(function(){var n=angular.module("embeds.cart","lib auth cache cart clientOptions db flash lightframe native navigation tracking urls".split(" "));configure(n);n.controller("embeds.cart.IndexCtrl",["$scope","cart","events","lightframe","navigation","xmessage",function(c,g,k,e,d,m){c.indexCtrl={carts:[],cartEntriesTotal:0};var a,n=function(){c.indexCtrl.cartEntriesTotal=0;c.indexCtrl.carts=_.filter(g.allCompanies.carts,function(a){c.indexCtrl.cartEntriesTotal+=a.entries.length;return!!a.entries.length});
m.broadcast(c.indexCtrl.carts.length?"fareharbor.cart.show":"fareharbor.cart.hide");a=moment()},h=function(){g.allCompanies.load().then(n)};h();m.on(c,"fareharbor.cart.changed",h);m.on(c,"fareharbor.window.focused",_.debounce(h,1E4,{leading:!0,trailing:!1}));setInterval(function(){(!a||6E4<=moment().diff(a))&&h()},6E4);c.indexCtrl.selectedCart=null;c.viewCart=function(a){if(a=a||c.indexCtrl.selectedCart)a=g.permalinkUrl(a.company),a=d.compose(a,{"from-embed":"cart"}),e.open(a),c.indexCtrl.selectedCart=
null};c.hide=function(){m.broadcast("fareharbor.cart.hide")}}])})();
