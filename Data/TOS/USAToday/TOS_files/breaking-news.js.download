define(["jquery","underscore","baseview","pubsub","utils","state","modules/global/barrier","modules/global/livevideo","easing","animatecolors"],function(e,i,t,r,n,a,s,o){"use strict";var g=t.extend({events:{"click .bnm-breaking-link":"onClickBreakingLink","click .bnm-close-btn":"onClickCloseBreakingBtn"},breakingColors:{breaking:{normal:"rgb(247,0,0)",highlight:"rgb(191,49,49)"},live:{normal:"rgb(0,170,255)",highlight:"rgb(0,145,218)"},developing:{normal:"rgb(0,170,255)",highlight:"rgb(0,145,218)"}},breakingBarHeight:0,initialize:function(r){r=e.extend({slideSpeed:200,onBreakingNewsChange:null},r),i.bindAll(this,"updateBreakingBar","checkBreakingNewsBarrier"),this.lastUpdate=localStorage.getItem("breakingLastUpdateClosed"),this.updateBreakingBar(),this.breakingBarPoll=setInterval(this.updateBreakingBar,91e3),this.barrier=new s,t.prototype.initialize.call(this,r)},destroy:function(){clearTimeout(this.initBreakingBar),clearInterval(this.breakingBarPoll),t.prototype.destroy.apply(this,arguments)},getHeight:function(){return this.breakingBarHeight},onClickCloseBreakingBtn:function(e){this.closeBreakingBar(!0),r.trigger("uotrack","breakingnewsbarexit")},onClickBreakingLink:function(i){var t=e(i.currentTarget).attr("href");if(t.indexOf("livevideoassetid")>0){"undefined"!=typeof this.currentlivevideo&&this.currentlivevideo.close();var r=new o;r.loadLiveVideo(t.split("#")[1].split("=")[1]),this.currentlivevideo=r,i.preventDefault()}},closeBreakingBar:function(e){return r.trigger("breakingbar:closing",this.options.slideSpeed),this.breakingBarHeight?(e&&localStorage.setItem("breakingLastUpdateClosed",this.lastUpdate),this.breakingBarHeight=0,this.options.onBreakingNewsChange&&this.options.onBreakingNewsChange(!1),this.$el.animate({height:0},this.options.slideSpeed,i.bind(function(){this.$el.css("background-color",""),this.$el.hide(),r.trigger("breakingbar:after:close")},this))):!1},openBreakingBar:function(){r.trigger("breakingbar:opening",this.options.slideSpeed),this.$el.show();var e=this.$(".bnm-bar").outerHeight();e!=this.breakingBarHeight&&(this.breakingBarHeight=e,this.options.onBreakingNewsChange&&this.options.onBreakingNewsChange(!0),this.animate(this.$el,"height",this.breakingBarHeight,this.options.slideSpeed).done(this.onCompleteOpenBreakingBar))},onCompleteOpenBreakingBar:function(){r.trigger("breakingbar:after:open")},updateBreakingBar:function(){this.busyCheckingBreakingNews||(this.busyCheckingBreakingNews=!0,a.persistentFetchHtml("/services/breaking-news/nav-bar/",{headers:{"x-no-nav":"true"}}).done(this.checkBreakingNewsBarrier))},addToBarrier:function(e,i,t){this.barrier.add(e,i,t)},checkBreakingNewsBarrier:function(e){var t=e.find(".bnm-bar");return t.length?void this.barrier.wait().done(i.bind(function(){this.parseBreakingNews(t)},this)):void(this.busyCheckingBreakingNews=!1)},parseBreakingNews:function(e){try{var i=e.data("type"),t=e.data("lastUpdate"),r=a.getActivePageInfo();if(r&&r.sponsor_story)this.closeBreakingBar();else if(this.lastUpdate!=t&&this.lastUpdate!=t&&!r.sponsor_story){this.$el.html(e).stop(),this.lastUpdate=t;var n=this.breakingBarHeight>0;if(this.openBreakingBar(),n){var s=this.breakingColors[i].highlight,o=this.breakingColors[i].normal;this.$(".bnm-bar").animate({backgroundColor:s}).animate({backgroundColor:o})}}}catch(g){this.closeBreakingBar()}finally{this.busyCheckingBreakingNews=!1}}});return g});
//# sourceMappingURL=breaking-news.js.map