define(["jquery","underscore","managers/siteconfig"],function(e,t,s){"use strict";var i=function(){this.initialize()};return i.prototype={initialize:function(i){i=e.extend({siteModules:s.getSiteConfig().siteModules},i),this.siteModules=i.siteModules||{},this.$stylesheets=e([]),this.stylesheets=[],this.staticUrl=window.site_static_url||"/static/",this.staticVersion=window.site_static_version||"off",e("link[data-identifier]").each(t.bind(function(t,s){var i=e(s).data("identifier");"main"!=i&&(this.stylesheets.push(e(s).data("identifier")),this.$stylesheets.push(s))},this))},fetchStyles:function(s,i,n){var o=t.difference(s,this.stylesheets),r=t.difference(this.stylesheets,s);n&&r.length&&console.log("removing styles from dom: ",r),n&&o.length&&console.log("adding styles to dom: ",o);var l=this._findStyleTags(r);this.stylesheets=s,this.$stylesheets=e(t.filter(this.$stylesheets,function(e){return!t.include(l,e)})),this._addStylesToHead(o),l.length&&i.done(function(){l.remove()})},fetchJavascript:function(s,i){return e.Deferred(t.bind(function(e){s?require([s],t.bind(function(t){this._resolveFetchJavascript(e,t,i)},this)):this._resolveFetchJavascript(e,null,i)},this)).promise()},_resolveFetchJavascript:function(e,t,s){this.fetchPageModules(s).done(function(s){e.resolve(t,s)})},fetchPageModules:function(s){return s=s||[],e.Deferred(t.bind(function(e){var i=s.length,n=[];return i?void t.each(s,function(s){n.push(s),this.getSiteModuleByName(s.name).done(function(e){s.selector=e.selector||"."+e.name+"-module",s.ModuleClass=e.ModuleClass}).fail(function(){n=t.reject(n,function(e){return e.name===s.name})}).always(function(){i--,0===i&&e.resolve(n)})},this):void e.resolve(n)},this)).promise()},getSiteModuleByName:function(s){return e.Deferred(t.bind(function(e){var t=this.siteModules[s];t?t.ModuleClass?e.resolve(t):t.path?require([t.path],function(i){t.ModuleClass=i,t.name=s,e.resolve(t)},function(s){console.error("Failed loading "+t.path+": "+s.message,s),e.reject(s)}):e.reject():e.reject("No Such Module Found")},this)).promise()},_findStyleTags:function(s){return e(t.filter(this.$stylesheets,function(i){var n=e(i).data("identifier");return t.find(s,function(e){return n===e})}))},_addStylesToHead:function(s){if(s&&s.length>0){var i=e([]);t.each(s,function(t){var s=e('<link rel="stylesheet" data-identifier="'+t+'" href="'+this.staticUrl+"css/bundles/"+t+(window.use_minified_css?".min":"")+".css?v="+this.staticVersion+'">')[0];i.push(s),this.$stylesheets.push(s)},this),e("head").append(i)}}},new i});
//# sourceMappingURL=resourcemanager.js.map