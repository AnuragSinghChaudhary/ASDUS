define(["jquery","underscore","baseview","utils"],function(e,i,t,n){"use strict";var r=t.extend({initialize:function(){this.deferred=null,this.PersonalizedLinkFactory=null,this.UserFactory=null,this.ClientHelpers=null,t.prototype.initialize.call(this)},getUser:function(){if(!this.deferred){this.deferred=e.Deferred();var i={gupasURLTemplate:"https://user-stage.{domain-name}/{uaid}/{path}"},t=null,r=n.getNested(window.site_vars,"base_url")||"",o=n.getNested(window.site_vars,"gupUAID")||"";this.poll(this.checkFactories,function(){return this.setFactories(),t="prod"===n.getNested(window.site_vars,"site_env")||"production"===n.getNested(window.site_vars,"site_env")?new this.UserFactory:new this.UserFactory(i),r&&o&&t&&this.PersonalizedLinkFactory?void t.fetch(r,o,function(e){var i=new this.PersonalizedLinkFactory(e),t={};t.forGuid=this.PersonalizedLinkFactory.getGuidFromUrl(window.location),t.forGuidSession=this.PersonalizedLinkFactory.getSessionGuidFromUrl(window.location),i.doFeature(window.location,r,o),this.deferred.resolve(e.data,t)}.bind(this)):(console.warn("UserUtil: No domain name and/or uaid found"),this.deferred.reject())}.bind(this),function(){return console.warn("UserUtil: No factories found"),this.deferred.reject()}.bind(this))}return this.deferred},poll:function(e,i,t,n,r){var o=Number(new Date)+(n||2e3);r=r||100,function s(){e()?i():Number(new Date)<o?setTimeout(s,r):t(new Error("timed out for "+e+": "+arguments))}()},checkFactories:function(){return"UserFactory"in window&&"PersonalizedLinkFactory"in window&&"ClientHelpers"in window?!0:!1},setFactories:function(){"UserFactory"in window&&"PersonalizedLinkFactory"in window&&"ClientHelpers"in window&&(this.UserFactory=window.UserFactory,this.PersonalizedLinkFactory=window.PersonalizedLinkFactory,this.ClientHelpers=window.ClientHelpers)}});return r});
//# sourceMappingURL=userUtil.js.map