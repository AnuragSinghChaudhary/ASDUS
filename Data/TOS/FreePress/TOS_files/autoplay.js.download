define(["jquery","underscore","pubsub","admanager","utils"],function(t,e,n,s,i){"use strict";var u=function(){this.pubSub={"page:load":this._onPageLoad,"page:unload":this._onPageUnload}};return u.prototype={start:function(){this._pageIndex=0,this._currentModules=this._currentModules||{},this._playedModules=[],this._autoPlayOrder=i.getNested(window.site_vars,"autoplay","default")||[],n.attach(this.pubSub,this)},reset:function(){this._currentModules={},this._playedModules=[]},stop:function(){n.unattach(this.pubSub,this)},register:function(t,n){this._currentModules=this._currentModules||{},e.isFunction(n)&&(this._currentModules[t]=n)},_onPageLoad:function(){s.getActiveSlotStatistics().done(e.bind(function(t){t&&t.adLite||this._go(0,this._pageIndex)},this))},_onPageUnload:function(){this._pageIndex++,this.reset()},_go:function(t,n){n===this._pageIndex&&this._triggerAutoPlay(t||0).then(e.bind(function(){this._go(t+1,n)},this))},_triggerAutoPlay:function(n){var s=this._getAutoPlayResult(n);return s&&e.isFunction(s.then)?s:t.Deferred(e.bind(function(t){s===!1?t.reject():s===!0?t.resolve():(console.error("AutoPlayManager: Invalid return value from "+this._autoPlayOrder[n]+".startAutoPlay()"),t.resolve())},this))},_getAutoPlayResult:function(t){var e=this._autoPlayOrder[t],n=this._playedModules,s=this._currentModules[e];return s?(this._playedModules=this._playedModules.concat(e),s(n)):t<this._autoPlayOrder.length}},new u});
//# sourceMappingURL=autoplay.js.map