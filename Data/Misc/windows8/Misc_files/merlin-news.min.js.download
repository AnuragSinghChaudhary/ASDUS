/*! merlin-js - v1.0.0 - 2017-07-31 */
!function(){"use strict";navigator.sendBeacon=navigator.sendBeacon||function(e,t){var n=new XMLHttpRequest;n.open("POST",e,!1),n.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.send(t)};var e=function(t){var n=this,r=0,i=null,a=null,o=!1;n.name=t||null,Object.defineProperty(n,"value",{enumerable:!0,get:function(){return r}}),Object.defineProperty(n,"endTimestamp",{get:function(){return a},set:function(e){n.end(e)}}),Object.defineProperty(n,"startTimestamp",{get:function(){return i},set:function(e){n.start(e)}}),Object.defineProperty(n,"valid",{get:function(){return!n.isStrict||o}}),Object.defineProperty(n,"isStrict",{value:!0,writable:!0}),Object.defineProperty(n,"start",{value:function(t){o||(i=e.validateTimestamp(t),o=!0)}}),Object.defineProperty(n,"cancel",{value:function(){i=null,o=!1}}),Object.defineProperty(n,"end",{value:function(t){n.valid&&(a=e.validateTimestamp(t),i&&a>i&&(r+=a-i)),n.cancel()}}),Object.defineProperty(n,"peek",{value:function(){var e=(new Date).getTime();return o&&i?r+(e-i):r}}),Object.defineProperty(n,"reset",{value:function(e){r=0,i=null,a=null,o=!1,n.name=e||null}}),Object.defineProperty(n,"destroy",{value:function(){n=null}})};Object.defineProperty(e,"validTimestamp",{value:/^\d{13}$/}),e.validateTimestamp=function(t){var n=(new Date).getTime();return t&&t.toString().match(e.validTimestamp)?parseInt(t,10):n},window.Timer=e;var t=function(e,t,n,r,i){var a=this;Object.defineProperty(a,"name",{enumerable:!0,get:function(){return e},set:function(t){e="string"==typeof t?t:null}}),Object.defineProperty(a,"type",{enumerable:!0,get:function(){return t},set:function(e){switch(e="string"==typeof e?e.toUpperCase():null){case"TIMER":case"ERROR":t=e;break;case"METER":default:t="METER"}}}),Object.defineProperty(a,"value",{enumerable:!0,get:function(){return a.updateFunction&&a.enabled&&(n=this.updateFunction()),n},set:function(e){n="number"==typeof e?Math.round(e):0}}),Object.defineProperty(a,"traceId",{enumerable:!0,get:function(){return i},set:function(e){i=e&&"null"!==e?e.toString():null}}),Object.defineProperty(a,"updateFunction",{get:function(){return r},set:function(e){r="function"==typeof e?e:null}}),Object.defineProperty(a,"enabled",{value:!0,writable:!0}),Object.defineProperty(a,"destroy",{value:function(){a=null}}),a.name=e,a.type=t,a.value=n||0,a.updateFunction=r,a.traceId=i};window.Metrics=t;var n=function(e,t,n){var r,i,a,o,c=this;this.setReadyFn=function(e){return"function"==typeof e&&(i=e),this},this.setInitFn=function(e){return"function"==typeof e&&(a=e),this},this.setInitFnParam=function(e){return o=e,this},this.init=function(e,t,n){return this.setReadyFn(e).setInitFn(t).setInitFnParam(n),this},this.start=function(){return i&&i()?(a&&a(o),c.clear()):r=setTimeout(c.start,100),this},this.stop=function(){return clearTimeout(r),this},this.clear=function(){return c.stop(),i=null,a=null,o=null,this},this.init(e,t,n)};window.WaitForInitHandler=n;var r=function(n){var i=this,a={},o={},c=null,l=null,d=null,s=null,u=null,f=[],p=null,m=null,g=null,v=null,y=null,I=null,w=null,T=!1,b=!1,M=null,h=null,P={},S={},O=null,E=null,R=!1,j=null,F=null;Object.defineProperty(i,"contentId",{enumerable:!0,get:function(){return p}}),Object.defineProperty(i,"productId",{enumerable:!0,get:function(){return m}}),Object.defineProperty(i,"source",{enumerable:!0,get:function(){return g}}),Object.defineProperty(i,"pageNumber",{enumerable:!0,get:function(){return v}}),Object.defineProperty(i,"referrer",{enumerable:!0,get:function(){return y}}),Object.defineProperty(i,"masterViewId",{enumerable:!0,get:function(){return I}}),Object.defineProperty(i,"searchTerms",{enumerable:!0,get:function(){return w}}),Object.defineProperty(i,"cookieEnabled",{enumerable:!0,get:function(){return T}}),Object.defineProperty(i,"localStorageEnabled",{enumerable:!0,get:function(){return b}}),Object.defineProperty(i,"traceId",{enumerable:!0,get:function(){return M}}),Object.defineProperty(i,"contentDomain",{enumerable:!0,get:function(){return window.location.hostname}}),Object.defineProperty(i,"context",{enumerable:!0,get:function(){var e={};return h&&(e.template={type:h}),i.parentId&&(e.parentContent=P),i.grandParentId&&(e.grandParentContent=S),Object.keys(e).length>0?e:null}}),Object.defineProperty(i,"rec",{enumerable:!0,get:function(){return O&&E?{name:O,id:E}:null}}),Object.defineProperty(i,"metrics",{enumerable:!0,configurable:!1,get:function(){return i.parseMetrics(a,o)}}),Object.defineProperty(i,"M_ID",{get:function(){return i.getItem("M_ID")}}),Object.defineProperty(i,"M_SID",{get:function(){return i.getItem("M_SID")}}),Object.defineProperty(i,"M_INITREFERRER",{get:function(){return i.getItem("M_INITREFERRER")}}),Object.defineProperty(i,"M_INITREFERRERTYPE",{get:function(){return i.getItem("M_INITREFERRERTYPE")}}),Object.defineProperty(i,"attsStr",{get:function(){var e="",t=i.M_ID,n=i.M_SID,r=i.M_INITREFERRER,a=i.M_INITREFERRERTYPE;return e+=t?"M_ID="+t+";":"",e+=n?"M_SID="+n+";":"",e+=r?"M_INITREFERRER="+r+";":"",e+=a?"M_INITREFERRERTYPE="+a+";":""}}),Object.defineProperty(i,"timeLastMetricSent",{get:function(){return u}}),Object.defineProperty(i,"updateMetricsLink",{get:function(){return d}}),Object.defineProperty(i,"template",{get:function(){return h}}),Object.defineProperty(i,"parentId",{get:function(){return P?P.contentId:null}}),Object.defineProperty(i,"grandParentId",{get:function(){return S?S.contentId:null}}),Object.defineProperty(i,"hasSentView",{get:function(){return R}}),Object.defineProperty(i,"isSendingMetrics",{get:function(){return!(!d||!c)}}),Object.defineProperty(i,"isSendingVideoMetrics",{value:!1,writable:!0}),Object.defineProperty(i,"viewId",{get:function(){return j}}),Object.defineProperty(i,"activityIndex",{get:function(){return F}});var V=function(){var e=i.timeLastMetricSent?(new Date).getTime()-i.timeLastMetricSent:0;return Math.max(r.metricInterval-e,1)},D=function(){for(var n in a){var c=a[n];c instanceof e?c.reset():c instanceof t&&(c.value=0,c.enabled=!1)}for(var f in o)o[f]=0;j=null,d=null,s=null,R=!1,u=null,I=null,i.isSendingVideoMetrics=!1,clearTimeout(l),y=document.referrer||null,b=r.isLocalStorage(),T=navigator.cookieEnabled},L=function(){if(f&&f.length){var n,r,o,c=f.pop(),l=f.pop(),d=f.pop();for(n=0;n<l.length;n++)r=l[n],(o=a[r])instanceof e||(a[r]=new e(r),o=a[r]),o.start(d);for(n=0;n<c.length;n++)r=c[n],(o=a[r])instanceof t||(i.setMetric(r,"METER",0),i.setMetric("Missing self updating metric: "+r,"ERROR",1)),o.enabled=!0}},x=function(){i.sendLastMetric(!1);var n=i.getMetricValue("activityAgeD")+1;f=[(new Date).getTime()];var r=[],o=[];for(var c in a){var l=a[c];l instanceof e&&l.valid?o.push(l.name):l instanceof t&&l.updateFunction&&l.enabled&&r.push(l.name)}return f.push(o),f.push(r),D(),L(),i.setMetric("activityAgeD","METER",n),i.postActivity(),i};i.reset=function(e){return D(),e?(m=e.productId,p=e.contentId,g=e.source,M=r.isValidValue(e.traceId)?e.traceId:null,v=e.hasOwnProperty("pageNumber")?e.pageNumber:null,h=r.isValidValue(e.template)?e.template:null,I=r.isValidValue(e.masterViewId)?e.masterViewId:null,w=e.searchTerms||this.parseSearchTerms(),i.setParentContent(e.parentSource,e.parentId),i.setGrandParentContent(e.grandParentSource,e.grandParentId),i.setRec(e.recName,e.recId)):(m=null,p=null,w=this.parseSearchTerms(),g=null,M=null,v=null,h=null,i.setParentContent().setGrandParentContent().setRec()),i},i.setParentContent=function(e,t){var n=r.isValidValue(e)?e:null,a=r.isValidValue(t)?t:null;return P=a&&a!=i.contentId?{contentId:a,source:n||i.source}:null,i},i.setGrandParentContent=function(e,t){var n=r.isValidValue(e)?e:null,a=r.isValidValue(t)?t:null;return S=a&&a!=i.parentId?{contentId:a,source:n||i.source}:null,i},i.setRec=function(e,t){return r.isValidValue(e)&&r.isValidValue(t)?(O=e,E=t):(O=null,E=null),i},i.getReferrer=function(){return i.referrer},i.startTimer=function(t){var n=(new Date).getTime(),r=a[t];r?r.start(n):((r=new e(t)).startTimestamp=n,a[t]=r)},i.endTimer=function(t){var n=(new Date).getTime(),r=a[t];r instanceof e&&r.end(n)},i.resetTimer=function(t){var n=a[t];n instanceof e&&n.reset(t)},i.cancelTimer=function(t){var n=a[t];n instanceof e&&n.cancel()};var A=function(e,t,n){var r={dataType:(n=n||!1)?"text":"json",type:"POST",contentType:"application/json",url:e,data:"string"==typeof t?t:JSON.stringify(t),xhrFields:{withCredentials:!0},async:!0},a=i.attsStr;return a&&(r.headers={},r.headers["X-M-ATTRIBUTES"]=a),r};i.doneGeneric=function(e){u=(new Date).getTime(),e&&e.attributes&&i.setAtts(e.attributes)},i.doneActivity=function(e){if(i.doneGeneric(e),e&&e.mObId==i.contentId){if(e.originalData){var t=e.originalData.data;try{t=JSON.parse(t)}finally{W(t.metrics)}}if(e&&e.data){j=e.data.id;var n=e.data.links;if(n.updateMetrics&&(d=n.updateMetrics.href,i.startSendingMetrics(),l=setTimeout(x,r.viewLifespan||864e5),!j)){var a=d.match(/[/]activities[/](.+)[/]views[/](.+)[/]metrics/);a&&a.length>2&&(F=a[1],j=a[2])}n.endView&&(s=n.endView.href)&&!i.masterViewId&&r.postMessage({type:"endView.save",viewId:i.viewId,mObId:i.contentId,endLink:s})}}return i},i.doneMetrics=function(e){if(i.doneGeneric(e),e&&e.originalData){var t=[],n=e.originalData.data;try{t=JSON.parse(n)}finally{W(t)}}},i.postActivity=function(){var e=r.domain+"/public/api/activities/views",t=JSON.stringify(i);if(!i.contentId)return i;if(i.hasSentView)i.startSendingMetrics();else{var n=A(e,t);r.postToFrame(i.contentId,n,i.doneActivity,r.postFailHandler)||$.ajax(n).done(function(e,t,r){202===r.status&&i.doneActivity({mObId:i.contentId,originalData:n,data:e,attributes:r.getResponseHeader("X-M-SET-ATTRIBUTE")})}).fail(function(e,t,n){console.log("Failed in ajax postActivity",e,t,n)}),R=!0}return i},i.setMetric=function(e,n,r,o){var c=a[e];return c||(c=new t(e,n,r,o,M),a[e]=c),c instanceof t&&(c.enabled=!0,c.type=n,c.value=r,c.updateFunction=o||null),i},i.disableMetric=function(n){var r=a[n];return r instanceof t?r.enabled=!1:r instanceof e&&r.cancel(),i},i.enableMetric=function(e){var n=a[e];return n instanceof t&&(n.enabled=!0),i},i.getMetricValue=function(e){var t=a[e];return(t&&t.enabled?t.value:o[e])||0},i.parseMetrics=function(n,r){var i=[];for(var a in n){var o=n[a],c=null;o instanceof e?(c=o.peek(),o=new t(a,"TIMER",c,null,M)):o instanceof t&&(c=o.value),!c||r&&c===r[a]||(c<0?i.push(new t("NEGATIVE METRIC ["+a+"]","ERROR",1+~c,null,M)):0!==c&&i.push(o))}return i};var W=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];o[n.name]=n.value}return i};i.incrementMetric=function(e,n){n=parseInt(n,10)||1;var r=a[e];return r instanceof t?r.value+=n:r||(a[e]=new t(e,"METER",n,null,M)),i},i.postMetrics=function(e,t,n){var a=t||i.metrics;if(n=!1!==n,d&&a&&("string"==typeof a||a.length)){var o=A(e||d,a,!0);r.postToFrame(i.contentId,o,n?i.doneMetrics:i.doneGeneric,r.postFailHandler)||$.ajax(o).done(function(e,t,r){var a={attributes:r.getResponseHeader("X-M-SET-ATTRIBUTE")};n&&(a.originalData=o),i.doneMetrics(a)}).fail(function(e,t,n){console.log("Failed in ajax postUpdatedMetrics",e,t,n)})}else d||i.stopSendingMetrics();return i},i.sendLastMetric=function(e){var t=i.metrics;t=t&&t.length?JSON.stringify(t):null;var n=i.updateMetricsLink,r=V(),a=null;return n&&t&&(a=setTimeout(function(){i.postMetrics(n,t,e)},r)),a},i.stopSendingMetrics=function(){return c&&window.clearInterval(c),c=null,i},i.startSendingMetrics=function(e){return e=e||r.metricInterval,i.stopSendingMetrics(),c=window.setInterval(i.postMetrics,e),i},i.restartMetrics=function(e){if(i.hasSentView){var t=V();setTimeout(i.startSendingMetrics,t,e)}else i.postActivity();return i},i.endView=function(){return r.frame?(r.postToFrame(i.contentId,{dataType:"text",type:"POST",contentType:"text/plain",url:s,data:null,async:!0},null,null),r.postMessage({type:"endView.remove",viewId:i.viewId,mObId:i.contentId})):navigator.sendBeacon(s,i.metrics),i.stopSendingMetrics(),x(),i},i.reset(n)};r.prototype.registerBasic=function(e,t){var n=this;return e&&this.startTimer("pageLoad"),$(function(){e&&n.endTimer("pageLoad"),t&&n.setMetric("engagedTime","TIMER",0,a.getEngagedSeconds),r.frame&&!r.isFrameValid?$(document).on("merlin.frame.loaded",n.postActivity).on("merlin.frame.failed",n.postActivity):n.postActivity()}),this},r.prototype.parseSearchTerms=function(e){var t=e||this.referrer;if(null!==t){var n=t.indexOf("?");if(n>0){var r=t.substring(0,n);if(-1!==r.indexOf("search",r.length-6)){var i=t.substring(n+1);if(i.length>2)for(var a=i.split("&"),o=0;o<a.length;o++){var c=a[0].split("="),l=decodeURIComponent(c[0]);if("q"==l||"searchtext"==l)return decodeURIComponent(c[1]).replace(/\+/g," ")}}}}return null},r.prototype.saveItem=function(e,t,n){this.localStorageEnabled?localStorage.setItem(e,t+";"+n):r.cookieStore[e]=t+";"+n},r.prototype.removeItem=function(e){this.localStorageEnabled?localStorage.removeItem(e):delete r.cookieStore[e]},r.prototype.getItem=function(e){var t=null,n=(new Date).getTime();if(e){var i=null;i=this.localStorageEnabled?localStorage.getItem(e):r.cookieStore[e];var a=/^(\S+);(\d{10,13})$/.exec(i);a&&3===a.length&&(t=a[1],n>parseInt(a[2],10)&&(t=null,this.removeItem(e)))}return t},r.prototype.parseAttHeader=function(e,t){t=t||(new Date).getTime();var n=/^\s?(\S+)=(\S+); Max-Age=(\d+)\s?$/.exec(e);if(n&&4==n.length){var r=n[1],i=n[2],a=t+1e3*parseInt(n[3],10);return this.saveItem(r,i,a),[r,i,a]}return null},r.prototype.setAtts=function(e,t){if(e=e||null,t=t||(new Date).getTime(),e)for(var n=e.split(","),r=0;r<n.length;r++)this.parseAttHeader(n[r],t)},window.Merlin=r;var i=function(e){function t(){var e=n.playlistArr;if(e){for(var t=0;t<e.length;t++)if(e[t]==n.contentId){n.playlistPosition=t,n.playlistSize=e.length,!0;break}}else n.playlistPosition=0,n.playlistSize=0}r.call(this,e);var n=this;n.playlistPosition=0,n.playlistSize=0;var i=!1,a=null;Object.defineProperty(n,"playlistArr",{value:[],writable:!0}),Object.defineProperty(n,"playlist",{get:function(){return{position:n.playlistPosition,size:n.playlistSize}}}),Object.defineProperty(n,"isSet",{get:function(){return i}}),n.setVideo=function(e){return n.reset(e),e&&(n.playlistSize=e.playlistSize||0,n.playlistPosition=e.playlistPosition||0,e.playlistArr&&(n.playlistArr=e.playlistArr,t())),i=!0,n},n.ended=function(){n.stopSendingMetrics(),i=!1},n.initWhenReady=function(e,t,r){e&&e()?(t&&t(r),clearTimeout(a)):a=setTimeout(n.initWhenReady,100,e,t,r)},n.cancelInit=function(){clearTimeout(a)}};(i.prototype=Object.create(r.prototype)).constructor=i,window.VideoMerlin=i,Object.defineProperty(r,"domain",{value:"https://merlin.abc.go.com"}),Object.defineProperty(r,"viewLifespan",{value:864e5}),Object.defineProperty(r,"engagmentDuration",{value:5e3}),Object.defineProperty(r,"metricInterval",{value:15e3}),Object.defineProperty(r,"isValidValue",{value:function(e){return e&&"null"!==e}}),r.frame=null,r.postCounter=0,r.postHandlers={},r.isFrameValid=!1,r.createFrame=function(){if(!r.frame){r.frame=document.createElement("iframe"),r.postCounter=0,r.postHandlers={};var e=r.frame;e.height=0,e.width=0,e.style.display="none",e.src=r.domain+"/public/merlinFrame",window.addEventListener("message",function(t){if(t.origin===r.domain){var n={},i=null;try{"ping"===(n=JSON.parse(t.data)).type?r.isFrameValid=null!==e&&void 0!==e:i=r.postHandlers[n.id]}finally{if(i)if("success"===n.type&&i.done)i.done(n);else if("fail"===n.type&&i.fail)i.fail(n);else if("error"===n.type)throw n.errorThrown;delete r.postHandlers[n.id]}}},!1),$(function(){document.body.appendChild(r.frame),r.initFrame()})}return r.frame},r.postMessage=function(e){return!(!r.frame||!r.frame.contentWindow)&&(r.frame.contentWindow.postMessage(JSON.stringify(e),r.domain),!0)},r.pingFrame=function(){return r.postMessage({type:"ping"})},r.postToFrame=function(e,t,n,i){if(r.frame){r.postCounter++;var a="m"+r.postCounter,o={options:t,mObId:e,id:a,type:"post"};return r.postHandlers[a]={done:n,fail:i},r.postMessage(o)}return!1},r.postFailHandler=function(e){var t=(e=e||{}).originalData||{},n="Failed in "+t.type+" to: "+t.url+" for ID "+e.mObId;console.log(n,e.errorThrown)},r.initFrame=function(){if(r.frame){var e,t=new n(function(){return r.isFrameValid},function(){clearTimeout(e),$.event.trigger("merlin.frame.loaded")}),i=function(){t.stop(),r.frame=null,$.event.trigger("merlin.frame.failed")};$(r.frame).load(function(){r.pingFrame(),e=setTimeout(i,3e4),t.start()})}else"function"==typeof failFn&&$.event.trigger("merlin.frame.failed")},r.createFrame(),r.isLocalStorage=function(){try{return localStorage.setItem("testLS","test"),localStorage.removeItem("testLS"),!0}catch(e){return!1}},r.cookieStore={};var a=function(){var t=r.engagmentDuration||5e3,n=null,i=new e,a=0;i.name="viewTimer",i.isStrict=!0;var o=function(){window.clearTimeout(n),a=0,i.reset()},c=function(e){e=e||(new Date).getTime(),document.hasFocus()&&i.end(e)},l=function(){var e=(new Date).getTime();document.hasFocus()&&(window.clearTimeout(n),n=window.setTimeout(c,t),c(e),i.start(e))},d=function(){window.clearTimeout(n),i.cancel()};return{init:function(){o(),$(window).focus(l),$(window).scroll(l),$(window).resize(l),$(document.body).mousedown(l),$(document.body).mousemove(l),$(document.body).keydown(l),$(window).blur(d)},resetTimer:o,setInitValue:function(e){a=parseInt(e,10)},engagementHandler:l,loseFocus:d,getEngagedSeconds:function(){return i.value.toString().length>=10?-1:a+i.value}}}();a.init(),window.PageViewTimer=a}(),function(){"use strict";window.MerlinTemplateHandlers=function(){function e(){var e=0;try{e=window.amp.getDuration()}catch(t){e=0}if(e){var t=parseInt(window.amp.getCurrentTime()/e*100,10);return Math.min(t,100)}return 0}function t(){return!(!window.androidUser||!1!==window.androidUser.useAMP)}function n(){var e=null;return t()?e=$(".videoContainer").attr("data-id"):window.amp&&(e=window.amp.evaluateBindings("#{media.guid}")),e}function r(){return window.amp&&window.amp.ads}function i(e){var t=window.amp?window.amp.ads:null;r()&&(e.ads&&e.ads(),t.addEventListener("start",e.start),t.addEventListener("started",e.started),t.addEventListener("ended",e.ended),t.addEventListener("loaded",e.loaded))}function a(){return!!window.amp}function o(e){function t(t,n,r){if(t&&e){var i=e[r=r||n];i&&t.addEventListener(n,i)}}var n=window.amp;if(a()){t(n,"ready"),t(n,"playrequest"),t(n,"playing"),t(n,"play"),t(n,"paused","pause"),t(n,"pause"),t(n,"started"),t(n,"ended"),t(n,"loadedmetadata"),t(n,"canplay"),t(n,"canplaythrough"),t(n,"waiting"),t(n,"durationchange"),t(n,"seeking"),t(n,"seeked"),t(n,"timeupdate"),t(n,"initialized"),t(n,"loadstart"),t(n,"progress"),t(n,"error");var r=window.amp.autoadvance;r&&e.autoadvance&&e.autoadvance(),t(r,"advance","autoadvance_advance");var i=n.share;i&&e.share&&e.share(),t(i,"share","share_share");var o=n.recommendations;o&&e.recommendations&&e.recommendations(),t(o,"selected","recommendations_selected")}}Merlin.maxScrollReached=0,Merlin.prototype.getScrollHeight=function(){var e=$("article.article[data-id="+this.contentId+"]"),t=e.next("article.article"),n=Math.max($(window).scrollTop(),Merlin.maxScrollReached);Merlin.maxScrollReached=n;var r=e.length?e.position().top:-1;if(r>=0&&n>r){var i=t.length?t.position().top:-1;i<0||n<i?n-=r:n=0}return parseInt(n,10)};var c=new Timer("playerReady"),l=function(){document.hidden||(c.start(),document.removeEventListener("visibilitychange",l))},d=function(){},s=function(){var e=window.merlinObj;e instanceof Merlin&&e.setMetric("scrollHeight","METER",0,e.getScrollHeight.bind(e))},u=function(){function d(e){return"function"==typeof e}$(function(){$(document).on("visibilitychange",l),l()});var s,u,f,p,m,g,v,y,I,w=null,T=new VideoMerlin,b=!0,M=!1,h={},P=null,S=!0,O={videoObj:T,setUnicornSelector:function(e){return e&&(P=e),O},setFn:function(e,t){switch(e){case"startParent":s=t;break;case"endParent":u=t;break;case"findParent":f=t;break;case"getParent":p=t;break;case"getVideoId":m=t;break;case"getPlaylist":g=t;break;case"getPlaylistPosition":v=t;break;case"getPlaylistSize":y=t;break;case"getMasterView":I=t}return O},setDefaultFields:function(e){return e instanceof Object&&(h=e),O},setDefaultField:function(e,t){return h instanceof Object||(h={}),e&&t&&(h[e]=t),O},disableExtentWatched:function(){return S=!1,O}},E=function(e){return d(s)?s(e):null},R=function(e){return d(u)?u(e):null},j=function(e){return d(f)?f(e):null},F=function(e){return d(p)?p(e):null},V=function(){return d(n)?m():null},D=function(){return d(g)?g():null},L=function(){return d(v)?v():null},x=function(){return d(y)?y():null},A=function(){return d(I)?I():null},W=function(){b=!0},k=new WaitForInitHandler(r,i).setInitFnParam({start:W,started:function(){T.startTimer("adWatchTime"),T.endTimer("adLoad"),T.incrementMetric("adStarts"),w instanceof Merlin?(w.startTimer("adWatchTime"),w.incrementMetric("adStarts")):null!==f&&T.setMetric("Parent Story Object Not Found in Time [Ad]","ERROR",parseInt(j(),10)),W()},ended:function(){T.endTimer("adWatchTime"),T.startTimer("videoLoad"),T.incrementMetric("adCompletes"),b=!1,w instanceof Merlin&&(w.endTimer("adWatchTime"),w.incrementMetric("adCompletes"))}}),H=function(e,t){T instanceof VideoMerlin||(T=new VideoMerlin),e&&(T.setVideo({contentId:e,productId:h.productId,source:h.source,traceId:h.traceId||null,masterViewId:A()||null,playlistArr:D()||null,playlistSize:x()||null,playlistPosition:L()||null,parentId:t||h.parentId||null,grandParentId:h.grandParentId||null,template:h.template||null}),T.registerBasic(),$.event.trigger({type:"merlin.video.registered",newId:e,parentId:t}))},_=function(){b?(T.isSet&&(T.startTimer("adWatchTime"),T.endTimer("waitTime")),w instanceof Merlin&&w.startTimer("adWatchTime")):M&&(T.isSet&&(T.startTimer("videoWatchTime"),T.endTimer("waitTime")),w instanceof Merlin&&w.startTimer("videoWatchTime"))},C=function(){M=!0},N=function(){b?(T.isSet&&(T.endTimer("adWatchTime"),T.endTimer("waitTime")),w instanceof Merlin&&w.endTimer("adWatchTime")):(T.isSet&&(T.endTimer("videoWatchTime"),T.endTimer("waitTime")),w instanceof Merlin&&w.endTimer("videoWatchTime"))},z=function(){N(),T.endTimer("videoWatchTime"),T.ended(),T.sendLastMetric(!1),T.stopSendingMetrics(),b=!0,M=!1},U=new WaitForInitHandler(a,o).setInitFnParam({ready:function(){c.end(),window.merlinObj instanceof Merlin&&window.merlinObj.setMetric("playerReady","TIMER",c.value),$.event.trigger({type:"merlin.player.ready"}),k.start()},playrequest:function(){var e=j(),t=V();T.contentId===t&&T.isSet||(T.isSet&&T.contentId!==t&&z(),H(t,e),T.resetTimer("adLoad"),T.startTimer("adLoad"),w instanceof Merlin&&w.endTimer("videoWatchTime"),w&&w.contentId==e||(w instanceof Merlin&&(w.endTimer("videoWatchTime"),w.isSendingVideoMetrics=!1,R(w)),w=F(e),E(w)),w instanceof Merlin&&(w.isSendingVideoMetrics=!0))},loadedmetadata:function(){T.endTimer("videoLoad")},canplay:C,canplaythrough:C,started:function(){b=!1,_(),S&&T.setMetric("extentWatched","METER",0,e),T.incrementMetric("videoStarts"),T.cancelTimer("adWatchTime"),T.cancelTimer("adLoad"),w instanceof Merlin?(w.incrementMetric("videoStarts"),w.cancelTimer("adWatchTime")):null!==f&&T.setMetric("Parent Story Object Not Found in Time [Video]","ERROR",parseInt(j(),10))},playing:_,play:_,pause:N,ended:function(){N(),w instanceof Merlin&&(w.incrementMetric("videoCompletes"),w.isSendingVideoMetrics=!1,R(w)),T.incrementMetric("videoCompletes"),S&&T.setMetric("extentWatched","METER",100),z()},error:function(e){console.log("AMP Player ERROR",e);var t="Unknown Error";e&&e.detail&&e.detail.message?t=e.detail.message:e&&e.data&&e.data.message&&(t=e.data.message),T.setMetric(t,"ERROR",1),w instanceof Merlin&&w.setMetric(t,"ERROR",1)},waiting:function(){N(),T.startTimer("waitTime")}});return t()?P&&$(P).click(function(){H(V(),j())}):(U.start(),$(document).on("merlin.video.softend",z)),O},f=function(){var e=window.merlinObj;return e.setMetric("scrollHeight","METER",0,e.getScrollHeight.bind(e)),e};return{beta_story:function(e){var t=window.merlinObj;s();var r={};window.merlinObjectMap=r,r[t.contentId]=t;var i=window.abcnvideo||{},a=t,o=e.toString(),c={},l=null,d=!0,f=function(n){return n&&!r.hasOwnProperty(n)?(r[n]=new Merlin({contentId:n.toString(),productId:t.productId,source:t.source,traceId:t.traceId,template:t.template,parentId:e,parentSource:t.source,masterViewId:t.viewId}),r[n]):r.hasOwnProperty(n)?r[n]:null},p=function(e){var t=c[e];t&&(window.clearTimeout(t),c[e]=null)},m=function(e){e instanceof Merlin&&e.contentId!=o&&e.isSendingMetrics&&(e.isSendingVideoMetrics||(e.stopSendingMetrics(),c[e.contentId]=e.sendLastMetric(!0)),e.disableMetric("engagedTime"),e.disableMetric("scrollHeight"))},g=function(e){if(!(e instanceof Merlin))return null;var n=e.contentId;return e.hasSentView||n==t.contentId?e.hasSentView&&!e.isSendingMetrics&&(p(n),e.restartMetrics()):(e.registerBasic(),PageViewTimer.resetTimer(),e.setMetric("engagedTime","TIMER",0,PageViewTimer.getEngagedSeconds),e.setMetric("scrollHeight","METER",0,e.getScrollHeight.bind(e))),e},v=function(e){e.hasSentView&&e.contentId==o&&(PageViewTimer.resetTimer(),PageViewTimer.setInitValue(e.getMetricValue("engagedTime")),e.enableMetric("engagedTime"))},y=function(){return i.playlist||[]},I=(new u).setUnicornSelector(".videoPlay").setFn("startParent",g).setFn("endParent",m).setFn("findParent",function(){for(var e=n(),t=y(),r=l,a=0;a<t.length;a++)if(e==t[a]){r=i.storyid.toString();break}return r}).setFn("getParent",function(e){return r[e]||null}).setFn("getVideoId",n).setFn("getPlaylist",y).setFn("getMasterView",function(){return t.viewId}).setDefaultFields({productId:t.productId,source:t.source,traceId:t.traceId,grandParentId:e,template:t.template?t.template.trim()+"Player":"Player"}).videoObj;return $(document).on("merlin.player.ready",function(){$("body").on("click",".video-play-button:not(.video-play-button-external)",function(){l=$(this).parents("article").attr("data-id")})}),$(document).on("abcn.story.reload",function(e){e.storyObj.id&&!d&&(o=e.storyObj.id.toString(),m(a),a=g(r[o]),v(a)),d=!1}),$(document).on("article.load",function(){f($("article.article").last().attr("data-id"))}),$(document).on("abcn.story.reload_complete",function(){o=(window.abcnvideo.storyid||o).toString(),m(a),o&&o!==e&&(r.hasOwnProperty(o)||f(o),a=g(r[o]),v(a))}),$(document).on("merlin.video.registered",function(e){e.parentId!==o&&m(a)}),$(document).on("page.render",function(){Merlin.maxScrollReached=0,o=$("article.article").last().attr("data-id"),m(a),f(o),o&&(a=g(r[o]),v(a))}),I},story_all:s,story:d,story_m2:d,story_t:d,video:function(){function t(e){return e?(e=e.toString()).replace(/^\w+_(\d+)$/,"$1"):null}function n(){$.event.trigger("merlin.video.softend")}var r=$(document),i=0,a=0,o=!0,d=window.merlinObj,s=null,f=d.productId.toLowerCase().indexOf("tablet")>0,p="16856090"===d.contentId,m="16856096"===d.contentId,g=(new u).setFn("findParent",function(){return o&&d?d.contentId:null}).setFn("getParent",function(){return o?d:null}).setFn("getVideoId",function(){return s}).setFn("getPlaylistSize",function(){return i}).setFn("getPlaylistPosition",function(){return a}).setFn("getMasterView",function(){if(!p&&!m)return d.viewId}).setDefaultFields({productId:d.productId,source:d.source,traceId:d.traceId,playlistSize:d.playlistSize,template:d.template}).videoObj,v=function(e){o&&("ended"===e.type&&d.setMetric("extentWatched","METER",100),d.sendLastMetric(!0),d instanceof VideoMerlin?d.ended():d.stopSendingMetrics(),d.disableMetric("engagedTime"),d.disableMetric("extentWatched"),window.amp.removeEventListener("ended",v),r.off("merlin.video.playvideo",v)),o=!1};return r.on("abcn.video.playvideo",v),r.on("abcn.video.playvideo",n),r.on("abcn.video.select",function(e){$.event.trigger("merlin.video.softend"),s=t(e.id),i=e.playlist_length,f&&(a=0,m||p?o&&(c.reset(),l()):(i=0,v(e)))}),r.on("abcn.video.vclose",n),r.on("merlin.player.ready",function(){window.amp.addEventListener("ended",v)}),r.on("abcn.video.loadnextclip",function(e){PageViewTimer.resetTimer(),s=t(e.id),i=e.playlist_length||i,++a>=i&&s==d.contentId&&(a=0)}),r.on("merlin.video.registered",function(e){g.setMetric("engagedTime","TIMER",0,PageViewTimer.getEngagedSeconds),f&&o&&(v(e),g.setMetric("pageLoad","METER",d.getMetricValue("pageLoad")),g.setMetric("playerReady","TIMER",c.value))}),d.setMetric("extentWatched","METER",0,e),g},liveEvent:function(e){var t=window.merlinObj;return(new u).setFn("getVideoId",n).setFn("getParent",function(){return t}).setDefaultFields({productId:t.productId,source:t.source,traceId:e||t.traceId,template:t.template,parentSource:t.source,parentId:t.contentId}).disableExtentWatched().videoObj},homepage:f,rsidx:function(e,t){var r,i=f(),a=(new u).setFn("getVideoId",n).setFn("getPlaylist",function(){var e=n().toString();if(r&&r.indexOf(e)>=0)return r;var t=$(".video-play-button[data-id="+e+"]");return"string"==typeof(r=t?t.attr("data-playlist"):[])&&r.length>0&&(r=r.split(",")),r instanceof Array&&r.indexOf(e)<0&&r.unshift(e),r}).setDefaultFields({productId:i.productId,source:i.source,traceId:e||i.traceId,parentSource:i.source,parentId:i.contentId,template:"homePage player"});return t&&a.setFn("getParent",function(){return i}),a.videoObj},videoSingleParent:function(e,t,r){var i=window.merlinObj;s();var a=(new u).setFn("getVideoId",n).setDefaultFields({productId:i.productId,source:i.source,traceId:e||i.traceId,parentSource:i.source,parentId:i.contentId,template:i.template?i.template.trim()+"Player":"Player"});return t&&a.setFn("getParent",function(){return i}),r&&a.setFn("getPlaylist",r),a}}}()}();