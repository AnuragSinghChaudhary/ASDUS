/*! ElasticPress Autosuggest - v0.1.0
 * http://github.com/10up/ElasticPress-Autosuggest
 * Copyright (c) 2015; * Licensed GPLv2+ */
!function(e,t){"use strict";var s=e.document;jQuery(s).ready(function(t){function s(e,t){return"all"!==t&&void 0!==t&&""!==t||(t="all"),{"post-suggest":{text:e,completion:{field:"term_suggest_"+t,fuzzy:!0}}}}function o(s){var o=e.ElasticPressAutoSuggest.index+"/",a=d+o+"_suggest";jQuery.support.cors=!0;return t.ajax({url:a,type:"POST",dataType:"json",crossDomain:!0,data:e.JSON.stringify(s)})}function a(t,s){var o=null;return function(){var a=this,n=arguments;e.clearTimeout(o),o=e.setTimeout(function(){t.apply(a,n)},s)}}function n(s,o){var a,n=o.closest(".ep-autosuggest-container").find(".ep-autosuggest"),i=n.find(".autosuggest-list");i.empty();for(t(".autosuggest-item").unbind(),s.length>0?n.show():n.hide(),a=0;a<s.length;++a){var u=s[a].text.toLowerCase(),l=s[a].payload.id;t('<li><span class="autosuggest-item" data-itemurl="/?p='+l+'" data-search="'+u+'">'+u+"</span></li>").appendTo(i)}t(".autosuggest-item").on("click",function(s){e.location=t(this).data("itemurl")}),o.unbind("keydown"),o.on("keydown",function(t){if(38!==t.keyCode&&40!==t.keyCode&&13!==t.keyCode);else{var s,a=o.closest(".ep-autosuggest-container").find(".autosuggest-list li"),n=a.filter(".selected");switch(t.keyCode){case 38:s=n.prev();break;case 40:a.hasClass("selected")||a.first().addClass("selected"),s=n.next();break;case 13:if(a.hasClass("selected"))return e.location=n.find("span").data("itemurl"),!1}if(s.is("li")&&(n.removeClass("selected"),s.addClass("selected")),38===t.keyCode)return!1}})}function i(){t(".autosuggest-list").empty(),t(".ep-autosuggest").hide()}var u=t("input.elasticpress-autosuggest"),l=t('<div class="ep-autosuggest"><ul class="autosuggest-list"></ul></div>');u.each(function(e,s){var o=t('<div class="ep-autosuggest-container"></div>'),a=t(s);a.attr("autocomplete","off"),o.insertAfter(a);var n=a.siblings("label");a.closest("form").find(".ep-autosuggest-container").append(n).append(a),l.clone().insertAfter(a),a.trigger("elasticpress.input.moved")});var r=e.location.host+"/es-search/",c=u.data("es-host");void 0!==c&&null!==c&&c.length>0&&(r=u.data("es-host")+"/");var d=e.location.protocol+"//"+r;l.css({top:u.outerHeight()-1,"background-color":u.css("background-color")}),t(u).each(function(e,s){t(s).bind("keyup keydown keypress",function(e){38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),27===e.keyCode&&i()})}),u.each(function(e,u){var l=t(u);l.on("keyup",a(function(e){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode&&27!==e.keyCode){var t=l.val(),a=l.data("estype");t.length>=2?o(s(t,a)).done(function(e){if(e._shards.successful>0){var t=e["post-suggest"][0].options;0===t.length?i():n(t,l)}else i()}):0===t.length&&i()}},100))})})}(this);
